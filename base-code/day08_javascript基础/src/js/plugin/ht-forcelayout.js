!function(U,b){"use strict";var Q="ht",J=Q+".layout.",S=U[Q]||module.parent.exports.ht,i=S.List,u=S.DataModel,d=S.Node,h=S.Edge,m=S.Group,N=Math,e=N.sqrt,W=N.random,F=N.max,z=N.min,j=function(D){return D*D};S.Default.getInternal().addMSMap({ms_force:function(y){y._interval=50,y._stepCount=10,y._motionLimit=.01,y._edgeRepulsion=.65,y._nodeRepulsion=.65,y._damper=1,y._maxMotion=0,y._motionRatio=0,y.init=function(U){var I=this;U instanceof u?I.dm=U:I.gv=U,I._nodeMap={},I._nodes=new i,I._edges=new i},y.start=function(){var H=this,I=H.gv;if(!H._timer){var A=H.cdm=I?I.dm():H.dm;A.mm(H.handleDataModelChange,H),A.md(H.handleDataPropertyChange,H),I&&I.mp(H.handleGV,H),A.each(function(T){if(H.isVisible(T)&&H.isLayoutable(T)&&T instanceof d)if(H instanceof q){var c=T.p3();T.p3([c[0]+W(),c[1]+W(),c[2]+W()])}else c=T.p(),T.p(c.x+W(),c.y+W())}),H._timer=setInterval(function(){H.relax()},H._interval),H._damper=1}},y.stop=function(){var r=this;r._timer&&(r.cdm.umm(r.handleDataModelChange,r),r.cdm.umd(r.handleDataPropertyChange,r),r.gv&&r.gv.ump(r.handleGV,r),clearInterval(r._timer),delete r._timer,delete r.cdm)},y.handleGV=function(C){var f=this;if("dataModel"===C.property){var K=C.oldValue,B=C.newValue;K&&(K.umm(f.handleDataModelChange,f),K.umd(f.handleDataPropertyChange,f)),this.cdm=B,B.mm(f.handleDataModelChange,f),B.md(f.handleDataPropertyChange,f)}},y.relax=function(){var b=this;if(!(b._damper<.1&&b._maxMotion<b._motionLimit)){this.cdm.each(function(L){b.isVisible(L)&&(L instanceof h?b.addEdge(L):L instanceof d&&b.addNode(L))});for(var E,R,e=0,B=b._edges,O=b._nodes,z=O.size();e<b._stepCount;e++){for(B.each(b.relaxEdge,b),E=0;z>E;E++)for(R=0;z>R;R++)b.relaxNode(O.get(E),O.get(R));b.moveNode()}b._isAdjusting=1,O.each(function(O){O.fix||(O.p?O.v.p3(O.p):O.v.p(O.x,O.y))}),delete b._isAdjusting,b._nodeMap={},O.clear(),B.clear(),b.onRelaxed()}},y.onRelaxed=function(){},y.isRunning=function(){return!!this._timer},y.isVisible=function(i){return i.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(i):!0},y.isLayoutable=function(o){if(o.s("layoutable")===!1)return!1;if(o instanceof m)return!1;var $=this;return $.gv?$.gv.isMovable(o)&&!$.gv.isSelected(o):!($.cdm||$.dm).sm().co(o)},y.getNodeRepulsion=function(){return this._nodeRepulsion},y.setNodeRepulsion=function(y){this._nodeRepulsion=y,this._damper=1},y.getEdgeRepulsion=function(){return this._edgeRepulsion},y.setEdgeRepulsion=function(x){this._edgeRepulsion=x,this._damper=1},y.getStepCount=function(){return this._stepCount},y.setStepCount=function(W){this._stepCount=W,this._damper=1},y.getInterval=function(){return this._interval},y.setInterval=function(I){var b=this;b._interval!==I&&(b._interval=I,b._timer&&(clearInterval(b._timer),b._timer=setInterval(function(){b.relax()},I)))},y.handleDataPropertyChange=function(V){!this._isAdjusting&&this.isVisible(V.data)&&(this._damper=1)},y.handleDataModelChange=function(){this._damper=1},y.damp=function(){var R=this._maxMotion,t=this._damper;this._motionRatio<=.001&&((.2>R||R>1&&.9>t)&&t>.01?this._damper-=.01:.4>R&&t>.003?this._damper-=.003:t>1e-4&&(this._damper-=1e-4)),R<this._motionLimit&&(this._damper=0)}}}),S.layout.ForceLayout=function(L){this.init(L)},S.Default.def(J+"ForceLayout",b,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(X){this._limitBounds=X,this._damper=1},getNodeSize:function(i){var s=this.gv;return s&&s.getDataUIBounds?s.getDataUIBounds(i):i.getRect()},addNode:function(E){var a=this,$=a._nodeMap[E._id];if($)return $;var h=E.p();$={v:E,x:h.x,y:h.y,dx:0,dy:0,fix:!a.isLayoutable(E),s:a.getNodeSize(E)};var W=$.s,F=e(j(W.width)+j(W.height))*a._nodeRepulsion;return $.r=1>F?100:F,a._nodeMap[E._id]=$,a._nodes.add($),$},addEdge:function(Z){if(Z._40I&&Z._41I){var K=this,s=K.addNode(Z._40I),t=K.addNode(Z._41I),C={s:s,t:t};t=t.s,s=s.s;var W=t.width+s.width,V=t.height+s.height;C.length=e(W*W+V*V)*K._edgeRepulsion,C.length<=0&&(C.length=100),K._edges.add(C)}},relaxEdge:function(V){var q=V.t,k=V.s,X=q.x-k.x,T=q.y-k.y,l=e(X*X+T*T),W=100*V.length,_=.25*X/W*l,m=.25*T/W*l;q.dx=q.dx-_,q.dy=q.dy-m,k.dx=k.dx+_,k.dy=k.dy+m},relaxNode:function(C,P){if(C!==P){var y=0,S=0,H=C.x-P.x,k=C.y-P.y,l=H*H+k*k;0===l?(y=W(),S=W()):36e4>l&&(y=H/l,S=k/l);var w=C.r*P.r/400;y*=w,S*=w,C.dx+=y,C.dy+=S,P.dx-=y,P.dy-=S}},moveNode:function(){var f=this,N=f._limitBounds,n=f._maxMotion,D=0,A=f._damper;f._nodes.each(function(C){if(!C.fix){var G=C.dx*A,s=C.dy*A;if(C.dx=G/2,C.dy=s/2,D=F(e(G*G+s*s),D),C.x+=F(-40,z(40,G)),C.y+=F(-40,z(40,s)),N){C.x<N.x&&(C.x=N.x,f.adjust(1,0)),C.y<N.y&&(C.y=N.y,f.adjust(0,1));var Q=C.s;C.x+Q.width>N.x+N.width&&(C.x=N.x+N.width-Q.width,f.adjust(-1,0)),C.y+Q.height>N.y+N.height&&(C.y=N.y+N.height-Q.height,f.adjust(0,-1))}}}),f._maxMotion=D,f._motionRatio=D>0?n/D-1:0,f.damp()},adjust:function($,d){var t=this._limitBounds;this._nodes.each(function(v){$>0?(!t||v.x+v.s.width+$<t.x+t.width)&&(v.x+=$):(!t||v.x+$>t.x)&&(v.x+=$),d>0?(!t||v.y+v.s.height+d<t.y+t.height)&&(v.y+=d):(!t||v.y+d>t.y)&&(v.y+=d)})}});var q=S.layout.Force3dLayout=function(S){this.init(S)};S.Default.def(J+"Force3dLayout",b,{ms_force:1,getNodeSize3d:function(H){return H.s3()},addNode:function(n){var U=this,B=U._nodeMap[n._id];if(B)return B;B={v:n,p:n.p3(),d:[0,0,0],fix:!U.isLayoutable(n),s:U.getNodeSize3d(n)};var G=B.s,q=S.Default.getDistance(G)*U._nodeRepulsion;return B.r=1>q?100:q,U._nodeMap[n._id]=B,U._nodes.add(B),B},addEdge:function(v){if(v._40I&&v._41I){var g=this,X=g.addNode(v._40I),D=g.addNode(v._41I),l={s:X,t:D};D=D.s,X=X.s,l.length=e(j(D[0]+X[0])+j(D[1]+X[1])+j(D[2]+X[2]))*g._edgeRepulsion,l.length<=0&&(l.length=100),g._edges.add(l)}},relaxEdge:function(i){var A=i.t.p,K=i.s.p,j=i.t.d,L=i.s.d,D=A[0]-K[0],O=A[1]-K[1],g=A[2]-K[2],U=e(D*D+O*O+g*g),W=100*i.length,G=.25*D/W*U,J=.25*O/W*U,Q=.25*g/W*U;j[0]-=G,j[1]-=J,j[2]-=Q,L[0]+=G,L[1]+=J,L[2]+=Q},relaxNode:function(S,H){if(S!==H){var g=S.p,b=H.p,M=0,j=0,$=0,K=g[0]-b[0],C=g[1]-b[1],r=g[2]-b[2],E=K*K+C*C+r*r;0===E?(M=W(),j=W(),$=W()):216e6>E&&(M=K/E,j=C/E,$=r/E);var q=S.r*H.r/400,h=S.d,O=H.d;M*=q,j*=q,$*=q,h[0]+=M,h[1]+=j,h[2]+=$,O[0]-=M,O[1]-=j,O[2]-=$}},moveNode:function(){var d=this,O=d._maxMotion,$=0,I=d._damper;d._nodes.each(function(Z){if(!Z.fix){var P=Z.p,y=Z.d,M=y[0]*I,X=y[1]*I,r=y[2]*I;y[0]=M/2,y[1]=X/2,y[2]=r/2,$=F(e(M*M+X*X+r*r),$),P[0]+=F(-40,z(40,M)),P[1]+=F(-40,z(40,X)),P[2]+=F(-40,z(40,r))}}),d._maxMotion=$,d._motionRatio=$>0?O/$-1:0,d.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);