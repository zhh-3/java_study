!function(Y){"use strict";var l="ht",L=Y[l],Z=L.Default,F=Math,U=F.PI,k=2*U,O=F.sin,H=F.cos,b=F.atan2,a=F.sqrt,N=F.max,A=F.floor,z=(F.round,F.ceil),_=F.abs,T=L.Shape,K=L.Edge,n=L.List,p=L.Style,V=L.graph,S=Z.getInternal(),d=S.ui(),J=null,s="__segmentLengths",w="__lineTotalLength",W="__linePoints",v="__distance0",C="flow.count",B="flow.step",g="flow.element.max",y="flow.element.count",c="flow.element.min",Q="flow.element.space",G="flow.element.autorotate",q="flow.element.background",i="flow.element.shadow.max",M="flow.element.shadow.min",r="flow.element.shadow.begincolor",e="flow.element.shadow.endcolor",D="flow.element.shadow.visible",E="flow.element.image",X="flow",u="prototype",P=V.GraphView[u],o=L.Data[u],R=d.DataUI[u],t=d.ShapeUI[u],x=d.EdgeUI[u],I=L.DataModel[u],m=t._80o,h=x._80o,j=I.prepareRemove,f=x._79o,$=t._79o,Mc=P.setDataModel,kb=function(x){return document.createElement(x)};P.calculatePointLength=function(r,b,T){var N=this,Y=N.getDataUI(r);T==J&&(T=.1);var h=Zq(Y),D=[];if(h){for(var O=h.length,H=0;O>H;H++){var $=h[H];$._as&&($=$._as);for(var n=$[0],V=1;V<$.length;V++)D.push([n,$[V]]),n=$[V]}for(var x=[],H=0;H<D.length;H++){var S=dj(D[H][0],D[H][1],b);x.push(S)}var A=x.slice(0);A.sort(function(j,C){return j.z>C.z?1:j.z<C.z?-1:0});var F=A[0];if(F.z<T){for(var U=x.indexOf(F),q=0,H=0;U>=H;H++)q+=U>H?Z.getDistance(D[H][0],D[H][1]):Z.getDistance(D[H][0],F);return q}}},Z.calculatePointLength=function(B,g,y,a){a==J&&(a=.1);var X=Zq(J,B,g),g=[];if(X){for(var c=X.length,$=0;c>$;$++){var p=X[$];p._as&&(p=p._as);for(var d=p[0],m=1;m<p.length;m++)g.push([d,p[m]]),d=p[m]}for(var W=[],$=0;$<g.length;$++){var S=dj(g[$][0],g[$][1],y);W.push(S)}var x=W.slice(0);x.sort(function(V,w){return V.z>w.z?1:V.z<w.z?-1:0});var l=x[0];if(l.z<a){for(var e=W.indexOf(l),o=0,$=0;e>=$;$++)o+=e>$?Z.getDistance(g[$][0],g[$][1]):Z.getDistance(g[$][0],l);return o}}},P.calculateClosestPoint=function(R,c){var N=this,Q=N.getDataUI(R),k=Zq(Q),I=[];if(k){for(var P=k.length,d=0;P>d;d++){var u=k[d];u._as&&(u=u._as);for(var p=u[0],n=1;n<u.length;n++)I.push([p,u[n]]),p=u[n]}for(var H=[],d=0;d<I.length;d++){var G=dj(I[d][0],I[d][1],c);H.push(G)}return H.sort(function(h,l){return h.z>l.z?1:h.z<l.z?-1:0}),H[0]}},Z.calculateClosestPoint=function(z,c,g){var X=Zq(J,z,c),c=[];if(X){for(var S=X.length,M=0;S>M;M++){var V=X[M];V._as&&(V=V._as);for(var N=V[0],R=1;R<V.length;R++)c.push([N,V[R]]),N=V[R]}for(var n=[],M=0;M<c.length;M++){var L=dj(c[M][0],c[M][1],g);n.push(L)}return n.sort(function(w,A){return w.z>A.z?1:w.z<A.z?-1:0}),n[0]}},P.getPercentAngle=function(D,n){var S=this,v=S.getDataUI(D),k=D.getRotation?D.getRotation():0,B=Zq(v);if(B)if(0===n){var I=B[0][0],H=B[0][1];k+=b(H.y-I.y,H.x-I.x)}else if(100===n){B=B[B.length-1];var I=B[B.length-2],H=B[B.length-1];k+=b(H.y-I.y,H.x-I.x)}else{for(var e=0,h=[],X=B.length,M=0;X>M;M++){var Z=B[M],V=Xc(Z);e+=V,h.push(V)}for(var o=e*n/100,Q=cg(o,h),L=0,Y=0;Q>Y;Y++)L+=h[Y];o-=L;for(var j=Ol(B[Q],o),C=B[Q],E=0,d=0,U=0;U<C.length-1;U++){var N=C[U],x=C[U+1],m=x.x-N.x,y=x.y-N.y,K=a(m*m+y*y);if(E+=K,E>o){d=U;break}}var g=C[d];k+=b(j.y-g.y,j.x-g.x)}return k},Z.getPercentAngle=function(B,M,k){var h=0,y=Zq(J,B,M);if(y)if(0===k){var P=y[0][0],s=y[0][1];h+=b(s.y-P.y,s.x-P.x)}else if(100===k){y=y[y.length-1];var P=y[y.length-2],s=y[y.length-1];h+=b(s.y-P.y,s.x-P.x)}else{for(var l=0,Z=[],G=y.length,E=0;G>E;E++){var Q=y[E],T=Xc(Q);l+=T,Z.push(T)}for(var X=l*k/100,O=cg(X,Z),R=0,u=0;O>u;u++)R+=Z[u];X-=R;for(var r=Ol(y[O],X),D=y[O],o=0,V=0,U=0;U<D.length-1;U++){var I=D[U],e=D[U+1],v=e.x-I.x,W=e.y-I.y,F=a(v*v+W*W);if(o+=F,o>X){V=U;break}}var C=D[V];h+=b(r.y-C.y,r.x-C.x)}return h},P.calculateLength=function(_){var P=this,W=P.getDataUI(_),A=Zq(W),z=0;if(A)if(Array.isArray(A[0]))for(var K=A.length,n=0;K>n;n++){var w=A[n],k=Xc(w);z+=k}else z=Xc(A);return z},Z.calculateLength=function(B,i){var B=Zq(J,B,i),W=0;if(B)if(Array.isArray(B[0]))for(var F=B.length,g=0;F>g;g++){var c=B[g],U=Xc(c);W+=U}else W=Xc(B);return W};var dj=Z.calculateClosestPointOnLine=function(n,T,I){var F=n.x,M=n.y,K=T.x,p=T.y,l=I.x,J=I.y,U={},D=K-F,S=p-M,c=Math.sqrt(D*D+S*S),N=D/c,E=S/c,o=(-F+l)*N+(-M+J)*E;return U.x=F+o*N,U.y=M+o*E,ch(U,n,T)||(U.x=Math.abs(U.x-n.x)<Math.abs(U.x-T.x)?n.x:T.x,U.y=Math.abs(U.y-n.y)<Math.abs(U.y-T.y)?n.y:T.y),D=l-U.x,S=J-U.y,U.z=Math.sqrt(D*D+S*S),U},ch=function(x,K,U){return x.x>=Math.min(K.x,U.x)&&x.x<=Math.max(K.x,U.x)&&x.y>=Math.min(K.y,U.y)&&x.y<=Math.max(K.y,U.y)},Xc=function(u){for(var x=0,J=u.length-1,i=0;J>i;i++){var k=u[i],l=u[i+1],E=l.x-k.x,H=l.y-k.y,D=a(E*E+H*H);x+=D}return x},Ol=function(S,j){for(var l=0,z=0,k=0,s=S.length-1,L=0;s>L;L++){var d=S[L],R=S[L+1],T=R.x-d.x,g=R.y-d.y;if(k=a(T*T+g*g),l+=k,l>j){l-=k,z=L;break}}var Q=S[z],n=S[z+1],q=b(n.y-Q.y,n.x-Q.x),J=j-l,g=O(q)*J,T=H(q)*J;return{x:Q.x+T,y:Q.y+g}},kn=function(k,i,C,K){var l=H(K),S=O(K),A=l*i-S*C,p=S*i+l*C;return k?{x:k.x+A,y:k.y+p}:{x:A,y:p}},Tg=function(P,A){P[s]=P[w]=P[W]=A[v]=J},go=function(l,h,M,Z,T,W){var s,i,L,a,J,S,D,t,x,c,g,d=[];if(_(Z)>k&&(Z=k),J=z(_(Z)/(U/4)),s=Z/J,i=-s,L=-M,J>0){S=l+H(M)*T,D=h+O(-M)*W,d.push({x:S,y:D});for(var q=0;J>q;q++)L+=i,a=L-i/2,t=l+H(L)*T,x=h+O(L)*W,c=l+H(a)*(T/H(i/2)),g=h+O(a)*(W/H(i/2)),d.push({x:c,y:g}),d.push({x:t,y:x})}return d},Zq=function(r,B,V){if(B==J){var h=r._data;if(h instanceof T){if(B=h.getPoints(),V=h.getSegments(),(!V||0===V.size())&&B){V=new L.List([1]);for(var w=1;w<B.size();w++)V.add(2)}}else if(h instanceof K){var l=r._78o;if(l){var X=l.type,d=l.points,i=l.segments,_=l.edgeTypeInfo;if(!X||d){var x=l.sourcePoint,e=x.x,b=x.y,N=l.targetPoint,I=N.x,G=N.y;if(X)i?(B=new n({x:e,y:b}),B.addAll(d),B.add({x:I,y:G}),V=new n(i._as)):(B=new n({x:e,y:b}),V=new n([1]),d.each(function(c){B.add(c),V.add(2)}),B.add({x:I,y:G}),V.add(2));else if(l.looped){B=new n(go(e,b,0,k,l.radius,l.radius)),V=new n([1]);for(var w=0;w<(B.size()-1)/2;w++)V.add(3)}else B=new n,l.center?(B.add({x:l.c1.x,y:l.c1.y}),B.add({x:e,y:b}),B.add({x:I,y:G}),B.add({x:l.c2.x,y:l.c2.y}),V=new n([1,2,2,2])):(B.add({x:e,y:b}),B.add({x:I,y:G}),V=new n([1,2]))}else if(_)if(B=new n(_.points._as),_.segments)V=new n(_.segments._as);else{V=new n([1]);for(var w=1;w<_.points.size();w++)V.add(2)}}}}if(B){if(Array.isArray(B)&&(B=new n(B)),"number"==typeof B.get(0)){for(var W=new L.List,w=0;w<B.size();w+=2)W.add({x:B.get(w),y:B.get(w+1)});B=W}if(!V){V=[];for(var w=0;w<B.size();w++)0===w?V.push(1):V.push(2)}Array.isArray(V)&&(V=new n(V));for(var Q=S.toPointsArray(B._as,V._as,50),j=Q.length,$=[],w=0;j>w;w++){var z=Q[w];z.length>1&&$.push(z)}return $}},Jj=function(h){var A=h._data,J=Zq(h);if(J){A.s("flow.reverse")&&(J.reverse(),J.forEach(function(C){C.reverse()}));for(var d=0,u=[],V=J.length,l=0;V>l;l++){var f=J[l],q=Xc(f);d+=q,u.push(q)}if(A[s]=u,A[w]=d,A[W]=J,A instanceof K){var x=Z.unionPoint(J),U=x.x+x.width/2,P=x.y+x.height/2;A.$10e={x:U,y:P}}lp(h,!0)}},lp=(Z.getPercentPositionOnPoints=function(t,Y,u){if(t){var W=Zq(J,t,Y);if(W){var h;if(0===u)h=W[0][0];else if(100===u)W=W[W.length-1],h=W[W.length-1];else{for(var d=0,F=[],q=W.length,a=0;q>a;a++){var U=W[a],l=Xc(U);d+=l,F.push(l)}for(var L=d*u/100,c=cg(L,F),x=0,Q=0;c>Q;Q++)x+=F[Q];L-=x,h=Ol(W[c],L)}return h}}},P.getPercentPosition=function(N,V){var F=this,p=F.getDataUI(N),J=Zq(p);if(J){var O;if(0===V)O=J[0][0];else if(100===V)J=J[J.length-1],O=J[J.length-1];else{for(var P=0,z=[],I=J.length,U=0;I>U;U++){var o=J[U],K=Xc(o);P+=K,z.push(K)}for(var l=P*V/100,c=cg(l,z),Q=0,u=0;c>u;u++)Q+=z[u];l-=Q,O=Ol(J[c],l)}return O}},function(h,$){var u=h._data,R=u[w],J=u.s(C),O=u.s(B),W=0,q=u[s],r=u.s(g),F=u.s(c),z=u.s(y),Y=(r-F)/(z-1),L=[];if(q){if(1===z)L.push(r);else if(2===z)L.push(r),L.push(F);else{if(!(z>2))return;L.push(r);for(var P=z-2;P>0;P--)L.push(F+Y*P);L.push(F)}var e=0,S=0;L.forEach(function(A){z-1>e&&(S+=u.getFlowElementSpace(A)),e++}),S+=(r+F)/2,W=(R-J*S+S)/J;var H=h[v];for(null==H&&(H=0),$||(H+=O);H>R+S;){var l=h._overCount;l?l++:l=1,l>=J&&(l=null),h._overCount=l,u.s("flow.autoreverse")?l?H-=W+S:(H=0,u.s("flow.reverse",!u.s("flow.reverse"))):H-=W+S}h[v]=H}}),Dh=function(f){var t=f.data,p=this.dm();if(t&&"add"===f.kind){var Z=p.$3e;Z&&t.s(X)&&Z.indexOf(t)<0&&Z.push(t)}"clear"===f.kind&&(p.$3e=[])},wh=function(R){var $=R.property,K=R.data,D=R.newValue,T=this.dm().$3e;if(T&&"s:flow"===$)if(D)T.indexOf(K)<0&&T.push(K);else for(var m=T.length,k=0;m>k;k++)if(T[k]===K){T.splice(k,1);break}},cg=cg=function(q,f){for(var D=0,e=f.length,T=0;e>T;T++){var J=f[T];if(D+=J,D>q)return T}return Math.min(T,e-1)},Rc=function(K){var k=this,_=k._data,p=_[w],o=_[s],j=_[W],h=_.s(C),u=0,x=k[v],S=_.s(g),Z=_.s(c),A=_.s(y),t=_.s(M),B=_.s(i),N=_.s(G),T=(B-t)/(A-1),D=(S-Z)/(A-1),f=_.getRotation?_.getRotation():0,Q=_.getPosition?_.p():_.$10e,l=[],d=[];if(x!=J){if(1===A)l.push(S);else if(2===A)l.push(S),l.push(Z);else{if(!(A>2))return;l.push(S);for(var n=A-2;n>0;n--)l.push(Z+D*n);l.push(Z)}if(1===A)d.push(B);else if(2===A)d.push(B),d.push(t);else{if(!(A>2))return;d.push(B);for(var n=A-2;n>0;n--)d.push(t+T*n);d.push(t)}var R=0,z=0;l.forEach(function(v){A-1>R&&(z+=_.getFlowElementSpace(v)),R++}),z+=(S+Z)/2,u=(p-h*z+z)/h,K.save();for(var n=0;h>n;n++){var I=x,r=0,q=k._overCount,V=0;_.s("flow.autoreverse")&&q&&q>h-(n+1)||(I-=n*(u+z),R=0,l.forEach(function(v){var h=I-r;if(h>=0&&p>h){var q=!0,J=cg(h,o);V=0;for(var u=0;J>u;u++)V+=o[u];if(h-=V,q){var w=Ol(j[J],h),D=f;if(N){for(var E=j[J],Y=0,M=0,U=0;U<E.length-1;U++){var y=E[U],F=E[U+1],Z=F.x-y.x,A=F.y-y.y,L=a(Z*Z+A*A);if(Y+=L,Y>h){M=U;break}}var n=E[M];D+=b(w.y-n.y,w.x-n.x)}f&&(w=kn(Q,w.x-Q.x,w.y-Q.y,f)),k.$5e(K,w,v,d[R],D)}}r+=_.getFlowElementSpace(l[R]),R++}))}K.restore()}},$m=function(){var R=this,q=R._data,n=q.s(g),s=!1,o=J;if(R._6I||(s=!0),o=q instanceof K?f.call(R):$.call(R),q.s(X)&&s){var S=q.s(i),I=q.s(D);I&&S>n&&(n=S),n>0&&Z.grow(o,z(n/2)),Jj(R)}return!q.s(X)&&s&&Tg(q,R),o};o.getFlowElementSpace=function(){return this.s(Q)},t._79o=$m,x._79o=$m,p[g]==J&&(p[g]=7),p[c]==J&&(p[c]=0),p[C]==J&&(p[C]=1),p[B]==J&&(p[B]=3),p[y]==J&&(p[y]=10),p[Q]==J&&(p[Q]=3.5),p[G]==J&&(p[G]=!1),p[q]==J&&(p[q]="rgba(255, 255, 114, 0.4)"),p[r]==J&&(p[r]="rgba(255, 255, 0, 0.3)"),p[e]==J&&(p[e]="rgba(255, 255, 0, 0)"),p[D]==J&&(p[D]=1),p[i]==J&&(p[i]=22),p[M]==J&&(p[M]=4),I.prepareRemove=function(n){j.call(this,n);var R=n._dataModel,O=R.$3e;if(O)for(var V=O.length,e=0;V>e;e++)if(O[e]===n){O.splice(e,1);break}},P.setDataModel=function(y){var x=this,D=x._dataModel;if(D!==y){D&&(D.umm(Dh,x),D.umd(wh,x),D.$3e=[]),y.mm(Dh,x),y.md(wh,x);var f=y.$3e=[];y.each(function(U){U.s(X)&&f.indexOf(U)<0&&f.push(U)}),Mc.call(x,y)}},P.setFlowInterval=function(E){var f=this,i=f.$11e;f.$11e=E,f.fp("flowInterval",i,E),f.$7e!=J&&(clearInterval(f.$7e),delete f.$7e,f.enableFlow(E))},P.getFlowInterval=function(){return this.$11e},P.$9e=function(){var d,R,I,m=this,v=m.tx(),_=m.ty(),L=m.getZoom(),u=m.getWidth(),W=m.getHeight(),B={x:-v/L,y:-_/L,width:u/L,height:W/L},x=m.dm().$3e,F=m._56I,f=new n;if(x.forEach(function(q){F[q.getId()]&&(d=m.getDataUI(q),d&&(I=d._79o(),I&&f.add(I)))}),0!==f.size()&&(f.each(function(N){Z.intersectsRect(B,N)&&(R=Z.unionRect(R,N))}),R&&(R&&(Z.grow(R,N(1,1/L)),R.x=A(R.x*L)/L,R.y=A(R.y*L)/L,R.width=z(R.width*L)/L,R.height=z(R.height*L)/L,R=Z.intersection(B,R)),R))){var T=m._canvas.getContext("2d");T.save(),T.lineCap=Z.lineCap,T.lineJoin=Z.lineJoin,S.translateAndScale(T,v,_,L),T.beginPath(),T.rect(R.x,R.y,R.width,R.height),T.clip(),T.clearRect(R.x,R.y,R.width,R.height),m.$6e(T,R),T.restore()}},P.$6e=function(k,C){var v,F,I=this;I._93db(k),I.each(function(B){I._56I[B._id]&&(v=I.getDataUI(B),v&&(F=v._79o(),(!C||Z.intersectsRect(C,F))&&v._42(k)))}),I._92db(k)},P.enableFlow=function(y){var m=this,G=m.dm(),p=G.$3e;m.$7e==J&&(p.forEach(function(g){var L=m.getDataUI(g);Jj(L)}),m.$7e=setInterval(function(){G.$3e.forEach(function(A){lp(m.getDataUI(A))}),m.$9e()},y||m.$11e||50))},P.disableFlow=function(){var P=this;clearInterval(P.$7e),delete P.$7e;var q=P.dm().$3e;q&&P.$9e()},R.$5e=function(x,H,L,$,i){var X=this,T=X._data,v=X.gv,b=T.s(q),d=T.s(r),V=T.s(e),Y=T.s(D),s=v.$8e,B=T.s(E);if(s==J&&(s=v.$8e={}),x.beginPath(),B!=J){var u=Z.getImage(B),n=L/2;x.translate(H.x,H.y),x.rotate(i),x.translate(-H.x,-H.y),Z.drawImage(x,u,H.x-n,H.y-n,L,L,T),x.translate(H.x,H.y),x.rotate(-i),x.translate(-H.x,-H.y)}else x.fillStyle=b,x.arc(H.x,H.y,L/2,0,k,!0),x.fill();if(Y){var Q=22,_=Q+"_"+d+"_"+V,G=s[_];if(G==J){var M=kb("canvas");S.setCanvas(M,Q,Q);var a=M.getContext("2d"),R=Q/2,p=R,U=R;S.translateAndScale(a,0,0,1),a.beginPath();var o=a.createRadialGradient(p,U,0,p,p,R);o.addColorStop(0,d),o.addColorStop(1,V),a.fillStyle=o,a.arc(p,U,R,0,k,!0),a.fill(),G=s[_]=M}var n=$/2;Z.drawImage(x,G,H.x-n,H.y-n,$,$,T)}},x._80o=function(c){h.call(this,c);var o=this,$=o._data,g=o.gv;$.s(X)&&g.$7e!=J&&Rc.call(o,c)},t._80o=function(P){m.call(this,P);var R=this,G=R._data,j=R.gv;G.s(X)&&j.$7e!=J&&Rc.call(R,P)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);