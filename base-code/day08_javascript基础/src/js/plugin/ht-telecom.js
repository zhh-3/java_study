!function(N,c){"use strict";var i=ht.AlarmSeverity=function(r,x,e,z,A){this.value=r,this.name=x,this.nickName=e,this.color=z,this.displayName=A};ht.Default.def("ht.AlarmSeverity",c,{toString:function(){return this.displayName||this.name}}),function(){i.severities=new ht.List,i._vm={},i._nm={},i._cp=function($,S){if($&&S){var c=$.value-S.value;return c>0?1:0>c?-1:0}return $&&!S?1:!$&&S?-1:0},i.each=function(S,t){i.severities.each(S,t)},i.getSortFunction=function(){return i._cp},i.setSortFunction=function(G){i._cp=G,i.severities.sort(G)},i.add=function(N,Z,p,P,V){var z=new i(N,Z,p,P,V);return i._vm[N]=z,i._nm[Z]=z,i.severities.add(z),i.severities.sort(i._cp),z},i.remove=function(g){var E=i._nm[g];return E&&(delete i._nm[g],delete i._vm[E.value],i.severities.remove(E)),E},i.CRITICAL=i.add(500,"Critical","C","#FF0000"),i.MAJOR=i.add(400,"Major","M","#FFA000"),i.MINOR=i.add(300,"Minor","m","#FFFF00"),i.WARNING=i.add(200,"Warning","W","#00FFFF"),i.INDETERMINATE=i.add(100,"Indeterminate","N","#C800FF"),i.CLEARED=i.add(0,"Cleared","R","#00FF00"),i.isClearedAlarmSeverity=function(k){return k?0===k.value:!1},i.getByName=function(U){return i._nm[U]},i.getByValue=function(o){return i._vm[o]},i.clear=function(){i.severities.clear(),i._vm={},i._nm={}},i.compare=function(Q,j){return i._cp(Q,j)}}();var F=ht.AlarmState=function(i){this._d=i,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",c,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var C=null;for(var z in this._am)z=i.getByName(z),i.isClearedAlarmSeverity(z)||0!==this.getAcknowledgedAlarmCount(z)&&(C=C?i.compare(C,z)>0?C:z:z);this._haa=C},_c2:function(){var _=null;for(var b in this._nm)b=i.getByName(b),i.isClearedAlarmSeverity(b)||0!==this.getNewAlarmCount(b)&&(_=_?i.compare(_,b)>0?_:b:b);this._hna=_},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var Q in this._nm)if(Q=i.getByName(Q),!i.isClearedAlarmSeverity(Q)&&0!==this.getNewAlarmCount(Q)&&i.compare(this._hna,Q)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var k=this._haa,F=this._hna,d=this._ps;this._hoa=k,i.compare(F,this._hoa)>0&&(this._hoa=F),i.compare(d,this._hoa)>0&&(this._hoa=d)},_c5:function(){var Y=this._haa,F=this._hna;this._hta=Y,i.compare(F,this._hta)>0&&(this._hta=F)},increaseAcknowledgedAlarm:function(H,M){if(0!==M){M=M||1;var S=this._am[H.name]||0;S+=M,this._am[H.name]=S,this._f()}},increaseNewAlarm:function(J,E){if(0!==E){E=E||1;var V=this._nm[J.name]||0;V+=E,this._nm[J.name]=V,this._f()}},decreaseAcknowledgedAlarm:function(R,t){if(0!==t){t||(t=1);var J=this._am[R.name]||0;if(J-=t,0>J)throw"Alarm count can not be negative";this._am[R.name]=J,this._f()}},decreaseNewAlarm:function(o,U){if(0!==U){U||(U=1);var w=this._nm[o.name]||0;if(w-=U,0>w)throw"Alarm count can not be negative";this._nm[o.name]=w,this._f()}},acknowledgeAlarm:function(n){this.decreaseNewAlarm(n,1),this.increaseAcknowledgedAlarm(n,1)},acknowledgeAllAlarms:function(w){if(w){var m=this.getNewAlarmCount(w);this.decreaseNewAlarm(w,m),this.increaseAcknowledgedAlarm(w,m)}else for(var I in this._nm)this.acknowledgeAllAlarms(i.getByName(I))},_c6:function(){this._aac=0;for(var j in this._am)j=i.getByName(j),this._aac+=this.getAcknowledgedAlarmCount(j)},getAcknowledgedAlarmCount:function(M){return M?this._am[M.name]||0:this._aac},getAlarmCount:function(V){return this.getAcknowledgedAlarmCount(V)+this.getNewAlarmCount(V)},_c7:function(){this._nac=0;for(var p in this._nm)this._nac+=this.getNewAlarmCount(i.getByName(p))},getNewAlarmCount:function(n){return n?this._nm[n.name]||0:this._nac},setNewAlarmCount:function(q,T){this._nm[q.name]=T,this._f()},removeAllNewAlarms:function(x){x?delete this._nm[x]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(w,c){this._am[w.name]=c,this._f()},removeAllAcknowledgedAlarms:function(C){C?delete this._am[C.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(g){if(this._ep||(g=null),this._ps!==g){var A=this._ps;this._ps=g,this._f(),this._d.fp("propagateSeverity",A,g)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(b){var P=this._ep;this._ep=b,this._d.fp("enablePropagation",P,b)&&(b||this.setPropagateSeverity(null))}});var P=ht.AlarmStatePropagator=function(F){this._dataModel=F,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",c,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(j){this._enable!==j&&(this._enable=j,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(v){this.propagate(v)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(C){C.data&&this.propagate(C.data)},handleDataPropertyChange:function(G){if("alarmState"===G.property||"enablePropagation"===G.property)this.propagate(G.data);else if("parent"===G.property){var Z=G.oldValue;Z&&this.propagate(Z),this.propagate(G.data)}},propagate:function(v){v&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(v),this._isPropagating=!1)},propagateToTop:function(t){for(this.propagateToParent(null,t);t&&t.getParent();)this.propagateToParent(t,t.getParent()),t=t.getParent()},propagateToParent:function(Y,f){var E=null;f.getChildren().each(function(I){var g=I.getAlarmState().getHighestOverallAlarmSeverity();i.compare(g,E)>0&&(E=g)}),f.getAlarmState().setPropagateSeverity(E)}}),ht.AlarmStateStatistics=function(G){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(G)},ht.Default.def("ht.AlarmStateStatistics",c,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(E){var O=this._dataModel;O!==E&&(O&&(O.umd(this.handleDataPropertyChange,this),O.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=E,this.reset(),E.md(this.handleDataPropertyChange,this),E.mm(this.handleDataModelChange,this),this.fp("dataModel",O,E))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(z){"alarmState"===z.property&&(this.increase(z.data),this.fireAlarmStateChange())},handleDataModelChange:function(Q){"add"===Q.kind?(this.increase(Q.data),this.fireAlarmStateChange()):"remove"===Q.kind?(this.decrease(Q.data),this.fireAlarmStateChange()):"clear"===Q.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,i.each(function(B){var e=this.getSumInfo(B);this.sumAcked+=e.ackedCount,this.sumNew+=e.newCount,this.sumTotal+=e.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(Q){if(!Q)return this.sumNew;var N=this.getSumInfo(Q);return N.newCount},getAcknowledgedAlarmCount:function(G){if(!G)return this.sumAcked;var V=this.getSumInfo(G);return V.ackedCount},getTotalAlarmCount:function(T){if(!T)return this.sumTotal;var p=this.getSumInfo(T);return p.totalCount},getSumInfo:function(L){var D=this.severtiyMap[L.name];return D||(D={},D.newCount=0,D.ackedCount=0,D.totalCount=0,this.severtiyMap[L.name]=D),D},decrease:function(q){var t=this.dataMap[q.getId()];t&&(delete this.dataMap[q.getId()],i.each(function(d){var M=t[d.name],D=this.getSumInfo(d);D.newCount=D.newCount-M.newCount,D.ackedCount=D.ackedCount-M.ackedCount,D.totalCount=D.totalCount-M.totalCount},this))},increase:function(A){if(this.decrease(A),!this._filterFunc||this._filterFunc(A)){var t={},K=A.getAlarmState();this.dataMap[A.getId()]=t,i.each(function(k){var q={};q.newCount=K.getNewAlarmCount(k),q.ackedCount=K.getAcknowledgedAlarmCount(k),q.totalCount=K.getAlarmCount(k),t[k.name]=q;var d=this.getSumInfo(k);d.newCount=d.newCount+q.newCount,d.ackedCount=d.ackedCount+q.ackedCount,d.totalCount=d.totalCount+q.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(F){var Q=this._filterFunc;this._filterFunc=F,this.reset(),this.fp("filterFunc",Q,F)},getFilterFunc:function(){return this._filterFunc}});var K=ht.Data.prototype;K.getAlarmState=function(){return this._alarmState||(this._alarmState=new F(this))},K=ht.DataModel.prototype,K.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},K.setEnableAlarmStatePropagator=function(a){a!=this.isEnableAlarmStatePropagator()&&(a?(this._alarmStatePropagator=new P(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},K=ht.graph.GraphView.prototype,K.getNote2=function(g){var q=g.getAlarmState().getHighestNewAlarmSeverity();if(q){var Y=g.getAlarmState().getNewAlarmCount(q)+q.nickName;return g.getAlarmState().hasLessSevereNewAlarms()&&(Y+="+"),Y}return g.s("note2")},K.getNote2Background=function(d){var Q=d.getAlarmState().getHighestNewAlarmSeverity();return Q?Q.color:d.s("note2.background")},K.getBodyColor=function(L){var M=L.getAlarmState().getHighestNativeAlarmSeverity();return M?M.color:L.s("body.color")},K.getBorderColor=function(Z){var K=Z.getAlarmState().getPropagateSeverity();return K?K.color:Z.s("border.color")},K=ht.widget.TreeView.prototype,K.getBorderColor=function(K){var N=K.getAlarmState().getPropagateSeverity();return N?N.color:K.s("border.color")},K.getIcon=function(n){return n.getIcon()?"__alarmIcon__":null},K=ht.widget.TreeTableView.prototype,K.getBorderColor=function(F){var i=F.getAlarmState().getPropagateSeverity();return i?i.color:F.s("border.color")},K.getIcon=function(V){return V.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(h){return h.getIcon()}},color:{func:function(k){var j=k.getAlarmState().getHighestNativeAlarmSeverity();return j?j.color:k.s("body.color")}},rect:[0,0,16,16]}]});var Z=ht.Style;Z["note2.expanded"]=!0,Z["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);