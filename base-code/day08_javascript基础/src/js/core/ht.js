!function(F,G,j){"use strict";var Y="ht";if(!F[Y]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),F.performance&&F.performance.now||function(){var q=Date.now();F.performance||(F.performance={}),F.performance.now=function(){return Date.now()-q}}();for(var h=Date.now(),k=16,H=["ms","moz","webkit","o"],l=0;l<H.length&&!F.requestAnimationFrame;++l)F.requestAnimationFrame=F[H[l]+"RequestAnimationFrame"],F.cancelAnimationFrame=F[H[l]+"CancelAnimationFrame"]||F[H[l]+"CancelRequestAnimationFrame"];F.requestAnimationFrame||(F.requestAnimationFrame=function(O){var g=Date.now(),L=k+h-g;return 0>L&&(L=0),h=g,F.setTimeout(function(){h=Date.now(),O(performance.now())},L)}),F.cancelAnimationFrame||(F.cancelAnimationFrame=function(w){return F.clearTimeout(w)}),G.assign===j&&(G.assign=function(D){if(D===j||null===D)throw new TypeError("Cannot convert undefined or null to object");for(var U=G(D),Y=1;Y<arguments.length;Y++){var H=arguments[Y];if(H!==j&&null!==H)for(var x in H)G.prototype.hasOwnProperty.call(H,x)&&(U[x]=H[x])}return U})}();var k=F.document,R=null,q=F[Y]={},M=F[Y+"config"],d=q.Default=M&&M.Default||{},c=q.Style=M&&M.Style||{},z=q.Attr=M&&M.Attr||{},r=q.Color=M&&M.Color||{},T=q.IsGetter=M&&M.IsGetter||{};!function(){var C=!1;try{var m=G.defineProperty({},"passive",{get:function(){C=!0}});F.addEventListener("test",m,m),F.removeEventListener("test",m,m)}catch(s){C=!1}d.passiveSupported=C}();var p,l,V,J,P=d.passiveSupported,y=d.eventListenerOptionsFalse=P?{passive:!1,capture:!1}:!1,U=d.eventListenerOptionsTrue=P?{passive:!1,capture:!0}:!0,Q=Math,$=Q.round,X=Q.floor,S=Q.ceil,C=Q.sqrt,Z=Q.max,f=Q.min,K=Q.abs,D=Q.cos,u=Q.acos,w=Q.sin,h=Q.pow,v=Q.asin,b=Q.PI,m=2*b,s=b/2,g=Q.tan,i=Q.atan2,x=Q.random,O=Q.log,B=!0,N=!1,L=F.parseInt||global.parseInt,o="2018-12-31",a=F.navigator?F.navigator.platform.indexOf("Win")>-1:!1,n=function(y){return y*y},I=F.setTimeout,E=F.clearTimeout,W=F.location,H=F.navigator?F.navigator.userAgent.toLowerCase():"",e=function(_){return _.test(H)},A=e(/msie/),_=e(/msie/)||e(/trident/),t=e(/msie 10/),Kb=e(/edge/),Ti=e(/firefox/),Tf=e(/mac/),Ei=d.isTouchable===j?a?!1:k?"ontouchend"in k:!1:d.isTouchable,kb="default",Cf="single",Fe="multiple",Vb="front",Lo="back",Xf="left",pp="right",Cd="top",bn="bottom",on="center",wc="eye",uj="middle",Jm="east",Jf="west",Kc="north",Pi="none",Rq="px",_r="absolute",rp="border",De="triangle",gq="rect",Rh="circle",Rd="cylinder",ks="shape",ej="items",um="normal",Mg="remove",Oq="clear",Uj="width",ys="height",Rb="ingroup",Of="check",Lg="uncheck",Gq="radio",re="radioOn",jc="radioOff",Ue="points",Zc="values",zq="series",wj="body",Ym="label",Vr="label2",Gj="note",Sh="note2",np="icons",fi="labelFont",Kn="labelColor",sr="labelSelectColor",Hk="note.expanded",Oe="note2.expanded",ib="edge.expanded",ip="edge.points",fo="edge.type",Yd="rotation",Em="hidden",Wk="visible",Jg="tuv",qq="no",Cg="draw",Yl="select",Vo="currentSubGraph",Al="selectBackground",ap="autoMakeVisible",cq="autoHideScrollBar",Pd="scrollBarColor",of="scrollBarSize",he="indent",Ae="rowHeight",$i="columnLineColor",yr="rowLineColor",xi="columnLineVisible",ql="rowLineVisible",Xd="visibleFunc",Cs="expandIcon",_k="collapseIcon",lj="checkMode",Mf="sortFunc",Ac="editable",jb="batchEditable",Po="tristate",ah="asc",Ir="desc",Xc="position",hp="elevation",gp="children",kf="translateX",_m="translateY",Xp="dataModel",gc="maxSize",jk="shape3d",yg="shape3d.resolution",ik="shape3d.visible",ac="shape3d.from.visible",Nc="shape3d.to.visible",dj="shape3d.top.visible",Jl="shape3d.bottom.visible",rr="repeat.uv.length",Gm="serializeValue",we="deserializeValue",hr="centerUniform",xd="uniform",Fc="rgba(255,255,255,0)",Hj="style",ek="attr",Fp="field",Fg="string",Fn="boolean",He="color",Ib="int",uf="number",Cc="ew-resize",wb="ns-resize",qs="pointer",Lp="auto",Zd="mousedown",dk="mousemove",ti="mouseup",fc="mouseout",fk="touchstart",Xl="touchmove",Ff="touchend",ng="keydown",Tm="keyup",dq=["DOMMouseScroll","mousewheel"],af=Ti?dq[0]:dq[1],Oo=Ei?[fk,Xl,Ff,ng,Tm,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[ng,Tm,"keypress","input",Zd,dk,ti,fc,af,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],km=R,vm=R,vn=R,Vq=ti.length,Ep=function(){vn&&(E(vn.timeout),vn=R)},Np=function(){vn&&xe(vn.e,vn.info)};F.addEventListener&&(Ei||(F.addEventListener(fc,function(){Ep()},y),F.addEventListener(af,function(){$j()},y)),F.addEventListener(Tm,function(K){91===K.keyCode?Do={}:delete Do[K.keyCode]},U),F.addEventListener(ng,function(G){Do[G.keyCode]=!0},U),F.addEventListener("blur",function(){Do={}},y));var _g,Mq,kl,Vi=0,Vl=R,hm=function(B,P){var J=I(function(){delete Vl[J],Zi(Vl)&&(Vl=R),B()},P);return J},mb=R,dh=R,Kp={},wo={},Ag={},Nq={},rc={},Do={},Wq={},ir={},qb={},ve={},ye=/.json$/,Sp=/^data:image\/svg\+xml/,yl={},nj=[],Dl={},fh=R,Sk=R,_i=function(){},Hm=function(){throw"Oops!"},Jr=[0,0,0],hd=[0,0,0,0],lc={x:0,y:0,width:0,height:0},Qf=R,_n=R,nr=R,Si=function(f){_n&&!f._72O&&(nr||(nr={}),nr[f._72O=qi()]=f),_g!=R?ok()<.05&&J&&!Mq&&(qk=Ep):qk=yf},Il=function(T,x,m,F){_n||(_n={});var N=_n[T];if(N){if(N.url===x)return;N.image?(N.image.onload=_i,N.image.onerror=_i):N.request&&(N.request.onload=_i,N.request.onerror=_i)}if(ye.test(x)){var $=new Yj;if(_n[T]={request:$,url:x},x=d.beforeLoadURL(x),x.data){var X=d.parse(x.data);Un(T,X),d.handleImageLoaded(T,X)}else{$.onload=function(C){if(200===this.status||0===this.status){var K=d.parse(C.target.response||C.target.responseText);Un(T,K),d.handleImageLoaded(T,K)}else Un(T,d.handleUnfoundImage(T,x)||R)},$.onerror=function(){Un(T,d.handleUnfoundImage(T,x)||R)};var D={};D.url=encodeURI(x),D.sync=!1,$.send(D)}}else{var X=new Image;_n[T]={image:X,url:x},/^data:image/.test(x)||(x=d.beforeLoadURL(x),x=d.appendTimeStamp(x),x=encodeURI(x),X.crossOrigin=d.crossOrigin),d.convertImageSrc(x,function(f){_&&(x.toLowerCase().indexOf(".svg")>0||Sp.test(x))?(k.body.appendChild(X),X.style.visibility="hidden",X.onload=function(){I(function(){if(m&&(X.width=m),F&&(X.height=F),!X.width||!X.height){var J=X.width||X.clientWidth,s=X.height||X.clientHeight;X.width=J,X.height=s}d.handleImageLoaded(T,X),Un(T,X),k.body.removeChild(X),X.style.visibility=""},180)},X.onerror=function(){Un(T,d.handleUnfoundImage(T,x)||R),k.body.removeChild(X),X.style.visibility=""}):(X.onload=function(){m&&(X.width=m),F&&(X.height=F),d.handleImageLoaded(T,X),Un(T,X)},X.onerror=function(){Un(T,d.handleUnfoundImage(T,x)||R)}),X.src=f})}},Un=function(x,e){if(wo[x]=e,delete _n[x],Zi(_n)&&(_n=R,nr)){for(var I in nr){var P=nr[I];P._2O&&(P._2O={}),P.invalidateAll&&P.invalidateAll(j,"imageLoaded",x),P.redraw&&P.redraw(),P.iv(),delete P._72O}nr=R}if(e&&nr)for(var I in nr){var P=nr[I];P.invalidateAll&&P.invalidateAll(j,"imageLoading",x),P.redraw&&P.redraw(),P.iv()}},Pk=function(){return O=Q&&Date,function(){return F.performance&&F.performance.now?F.performance.now():Date.now()}}(),Ll=function(g,O){O?E(g):F.cancelAnimationFrame(g)},Or=function(V,j,u){return{width:V,height:j,comps:Sj(u)?u:[u]}},Bo=function($,L){return{type:Rh,rect:[$,L,1.6,1.6],borderWidth:1,borderColor:rh,gradient:Pn,gradientColor:Xg,background:rh}},Cj=function(Z,k){return Or(16,16,{type:De,rect:[4,4,10,8],background:Z,rotation:k?1.57:3.14})},gg=function(Q,p){return Or(16,16,{type:De,rect:[4,4,8,7],background:Q,rotation:p?3.14:0})},Ze=function(K){var m=K._orientation;return"horizontal"===m||"h"===m},gh=function(A){var s=R||4,I=R||1,H=R||1;0>s?s=0:s>.25&&(s=.25);var O,M,f,G,_,i,r,x=.5,U=[],V=[],F=[],j=m/H,K=m/I,v=x-s;for(M=0;I>=M;M++)for(G=-b+M*K,i=D(G),_=w(G),O=0;H>=O;O++)f=O*j,r=v+s*i,U.push(D(f)*r,_*s,-w(f)*r),(l=A)&&V.push(O/H,1-M/I);for(M=0;I>M;M++){var Q=M*(H+1),q=(M+1)*(H+1);for(O=0;H>O;O++)F.push(Q+O,q+O+1,q+O,Q+O,Q+O+1,q+O+1),sn.z=yo.z=A}},zg=function(d){var N=2,G=0;for(var Q in d)Q.length===N&&L(Q,32)===Dc&&(fh=Sk=d[Q]),G++;return G},yj=function(G,T,V,S){return V||(V=Ei?5:3,V/=S||1),{x:G-V,y:T-V,width:2*V,height:2*V}},di=function(P,z,v,X){var j=this;z||(z=Ei?5:3,v=20,X=20);var S={x:P,y:z,width:v,height:X};if(v)for(var n=0;v>n;n++)if(3===v)X=20;else for(var N=0;X>N;N++)j=F?F:v;var s={x:b,y:2*b};if(oq(S,s)){var _=ys[0]+Cd[0]+Oq[1]+(ah.length-1);er[wc]=j[_],j[_]=bl[wc]}},dg=function(D){return(/ble$/.test(D)||/ed$/.test(D)||T[D]?"is":"get")+D.charAt(0).toUpperCase()+D.slice(1)},bl=function(Z){return"set"+Z.charAt(0).toUpperCase()+Z.slice(1)},gd=function(Q){return typeof Q===Fg||Q instanceof String},Zl=function(m){return typeof m===uf},yf=function(v){return typeof v===Fn},Eg=function(n){return n&&"object"==typeof n},cl=function(L){return"function"==typeof L},Sj=function($){return $ instanceof Array},Af=function(s){return s instanceof ob},Ec=function(T){return Sj(T)?new ob(T):T},ei=function(J){return J instanceof Pc},mm=function(n){return n instanceof zj},sq=function(I){return I instanceof Ap},xm=function(l,y){if(!(l instanceof q.Group))return!1;if(!y)return l.isExpanded();var o=y.getDataUI(l);return o&&o._88I?!0:!1},Tk=function(O){return O instanceof Gk},vs=function(B){return B&&"IFRAME"===B.tagName},ub=function(V){return V==R||d.numberDigits==R?V:parseFloat(V.toFixed(d.numberDigits))},Oj=function(O,E,v){var Y,d=E.length;if(v)for(var w=0;v>w;w++)if(3===d)O.push(E[0]),O.push(E[1]),O.push(E[2]);else for(Y=0;d>Y;Y++)O.push(E[Y]);else if(3===d)O.push(E[0]),O.push(E[1]),O.push(E[2]);else for(Y=0;d>Y;Y++)O.push(E[Y])},fq=function(_){return _?Eg(_)?_:{}:!1},wg=function(a,M,o){var s,Z=Eg(a)?a:a.prototype;for(s in M)o&&Z[s]!==j||(Z[s]=M[s]);return a},mc=function(e){return String.fromCharCode(e)},Oh=function(P){for(var U,m=0,$="";m<P.length;m++)U=P[P.length-1-m],"%"===U?U="'":"a"===U?U='"':"]"===U&&(U="\\"),$+=mc(U.charCodeAt(0)-1);return $},Id=function(n,G,r){n.superClass.constructor.apply(G,r)},Zi=function(R){for(var z in R)return!1;return!0},Zm=function(q){return q?0===q.length:!0},cm=function(){var J="";return[Lg[0],yr[0],Ym[0]].forEach(function(p){J+=bl(p).slice(3)}),xd=k&&k[J]||hr,function(b,V){return b===V?!0:b.x===V.x&&b.y===V.y&&b.width===V.width&&b.height===V.height}}(),zs=function(x,w,s){return w>x?w:x>s?s:x},qg=function(z){return 0>z?-1:z>0?1:0},ok=function(){var V=1e4*w(Vq++);return V-X(V)},ri=function(z,O,S){return Sm(z.x,z.y,O.x,O.y,S.x,S.y,S.x+S.width,S.y,!0)||Sm(z.x,z.y,O.x,O.y,S.x+S.width,S.y,S.x+S.width,S.y+S.height,!0)||Sm(z.x,z.y,O.x,O.y,S.x+S.width,S.y+S.height,S.x,S.y+S.height,!0)||Sm(z.x,z.y,O.x,O.y,S.x,S.y+S.height,S.x,S.y,!0)},Sm=function(X,u,P,m,b,C,E,L,B){var N=(E-b)*(u-C)-(L-C)*(X-b),a=(L-C)*(P-X)-(E-b)*(m-u);if(0!==a){var o=N/a,Q=X+o*(P-X),l=u+o*(m-u);return B&&(Q+Yb<f(X,P)||Q-Yb>Z(X,P)||Q+Yb<f(b,E)||Q-Yb>Z(b,E)||l+Yb<f(u,m)||l-Yb>Z(u,m)||l+Yb<f(C,L)||l-Yb>Z(C,L))?R:[Q,l]}return R},Ch=function(X,z,h){if(X&&h)if(z){if(z===Hj)return X.getStyle(h);if(z===ek)return X.getAttr(h);if(z===Fp)return X[h]}else if(h=dg(h),X[h])return X[h]();return j},Ij=function(_,p,y,R){if(_&&y)if(p){if(p===Hj)_.s(y,R);else if(p===ek)_.a(y,R);else if(p===Fp){var n=_[y];_[y]=R,_.fp("f:"+y,n,R)}}else y=bl(y),_[y]&&_[y](R)},oi=function(K,k,C){return k&&"top"!==k?"bottom"===k?{x:K.x,y:K.y,width:K.width,height:K.height*C}:"right"===k?{x:K.x,y:K.y,width:K.width*C,height:K.height}:"left"===k?{x:K.x+K.width*(1-C),y:K.y,width:K.width*C,height:K.height}:void 0:{x:K.x,y:K.y+K.height*(1-C),width:K.width,height:K.height*C}},xp=function(o,D,g,h,w){D&&wk(o,g,h,1,w,D)},Wb=function(o,P,d,X){var Y=1-o;return Y*Y*P+2*o*Y*d+o*o*X},sn=function(l,f,B,W,J){var p=1-l;return p*p*p*f+3*p*p*l*B+3*p*l*l*W+l*l*l*J},mh=function(K){var b,I,u,V,h=0;return K.forEach(function(_){if(b=_.length,b>0)for(I=_[0],V=1;b>V;V++)u=_[V],h+=Yi(I,u),I=u}),h},td=function(i,w,A){var u="__"+i,g=function(d){A.disabled||A["handle_"+i](d)};A[u]||(A[u]=g,w.addEventListener(i,g,y))},ie=function(N,j,C){var d="__"+N,m=C[d];m&&(j.removeEventListener(N,m,y),delete C[d])},tl=function(E,F){var s="_"+F;E[dg(F)]=function(){return this[s]},E[bl(F)]=function(z){var j=this[s];this[s]=z,this.fp(F,j,z)}},as=function(Q){return G.create(Q)},Jd=function(e){if(!e.element){var L,n;(L=e.textField)?n=Ur(Wn.TextField,L):(L=e.textArea)?n=Ur(Wn.TextArea,L):(L=e.button)?n=Ur(Wn.Button,L):(L=e.comboBox)?n=Ur(Wn.ComboBox,L):(L=e.checkBox)?n=Ur(Wn.CheckBox,L):(L=e.radioButton)?n=Ur(Wn.RadioButton,L):(L=e.slider)?n=Ur(Wn.Slider,L):(L=e.colorPicker)?n=Ur(Wn.ColorPicker,L):(L=e.image)&&(n=Ur(Wn.Image,L)),n&&(e.element=n)}},jj=function(e,Y){var k=me(e);return k._ht=Y,k},me=function(n,O){var S=k.createElement("div"),Y=S.style;return S.tabIndex=-1,S.onkeydown=bf,Y.msTouchAction=Pi,ms(S,R,0),Ei&&Y.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",R),n&&(Y.overflow=Em),O&&ke(O,S),S},oe=function(T,u){var r=k.createElement("canvas"),F=r.style;return F.msTouchAction=Pi,u||(F.pointerEvents=Pi),ms(r,R,0),T&&ke(T,r),r},ms=function(j,o,N){var R=j.style;R.border=o?o+" solid 1px":0,R.outline=0,R.padding=N?"0 "+N+Rq:0,ts(j)},ts=function(u){var k=u.style;k.position=_r,k.margin=0,k.setProperty("box-sizing","border-box",R),k.setProperty("-moz-box-sizing","border-box",R)},ul=function(F,N,y,n){n||(n=xs),N!=R&&(F.width=N*n,F.style.width=N+Rq),y!=R&&(F.height=y*n,F.style.height=y+Rq)},ke=function(e,s,R){e.appendChild(s),R&&(s.style.position=_r)},ol=function(i,g){g.split||(g+="");for(var Z,a=g.split("\n"),G=0,$=a.length,B=0;$>B;B++){var R=gi(i.font,a[B]);R.width>G&&(G=R.width),Z||(Z=R.height)}return i.ss=a,{width:G,height:Z*$}},qo=function(h,v,i,Q,I,y){var t=v.length;if(1===t)jl(h,v[0],i,Q,I);else for(var V=i.height/t,E={x:i.x,y:i.y,width:i.width,height:V},D=0;D<v.length;D++)y?Im(h,v[D],Q,I,E.x,E.y,E.width,E.height,y):jl(h,v[D],E,Q,I),E.y+=V},jl=function(U,t,X,S,i){U.font=S?S:og,U.fillStyle=i?i:kn,U.textAlign=on,U.textBaseline=uj;var e,R;X?X.width===j?(e=X.x,R=X.y):(e=X.x+X.width/2,R=X.y+X.height/2):(e=0,R=0),U.fillText(t,$(e),$(R))},ge=function(K){K.getView&&(K=K.getView());var b=K.offsetWidth||K.scrollWidth;return!b&&K.style.width&&(b=L(K.style.width)),b},Yk=function(D){D.getView&&(D=D.getView());var q=D.offsetHeight||D.scrollHeight;return!q&&D.style.height&&(q=L(D.style.height)),q},ef=function(x,e,I){var L=e[0].toUpperCase()+e.substring(1,e.length);x["webkit"+L]=I,x["moz"+L]=I,x["ms"+L]=I,x["o"+L]=I,x[e]=I},Qq=function(){var k=function(S){bf(S),S.stopPropagation()},z=function(m){bf(m)},o=Ei?[fk]:[ng,Zd];return function(w,B){var m=me(),O=m.style;return O.backgroundColor=d.disabledBackground,w&&(O.backgroundImage="url("+w+")",O.backgroundPosition="50% 50%",O.backgroundRepeat="no-repeat no-repeat"),B===!1?o.forEach(function(x){m.addEventListener(x,z,y)}):o.forEach(function(M){m.addEventListener(M,k,y)}),m}}(),Nf=function(d){var R=d.getContext("2d");return R.save(),R.lineCap=kc,R.lineJoin=Uk,R},qk=function(g,m,n,b){gm(g,m*xs,n*xs),b*=xs,1!==b&&g.scale(b,b)},gm=function(d,f,b){d.translate(f,b)},hc=function(m,y){y&&m.rotate(y)},ic=function(D,F,A){F===j&&(F=1),A===j&&(A=1),(1!==F||1!==A)&&D.scale(F,A)},df=!1,ud=function(v){var w=k.activeElement;if(k.activeElement!==v){w&&w.forceOnblur&&w.forceOnblur();for(var r=[],R=v.parentNode;R;)r.push([R,R.scrollLeft,R.scrollTop]),R=R.parentNode;if(!df){var L=[],t=[];try{for(var X=F.parent,x=F;X!==x;)L.push([X,X.scrollX,X.scrollY]),x=X,X=F.parent;var $=F.frameElement;if($)for(var b=$.parentNode;b;)t.push([b,b.scrollLeft,b.scrollTop]),b=b.parentNode}catch(u){df=!0}}if(Ei)v.focus();else{var o=Xh(),S=o.target;v.focus(),S.scrollLeft=o.left,S.scrollTop=o.top}r.forEach(function(U){U[0].scrollLeft=U[1],U[0].scrollTop=U[2]}),df||(L.forEach(function(i){i[0].scrollTo(i[1],i[2])}),t.forEach(function(o){o[0].scrollLeft=o[1],o[0].scrollTop=o[2]}))}},Lb=function(M){return M&&M.getView?M.getView():M},Zh=function(a,y,l,D,R){if(2===arguments.length&&(l=y.y,D=y.width,R=y.height,y=y.x),a.isSelfViewEvent)a.setX(y),a.setY(l),a.setWidth(D),a.setHeight(R);else{var u=Lb(a),z=u.style;if((k.fullscreenElement||k.mozFullScreenElement||k.webkitFullscreenElement||k.msFullscreenElement)!==u)y!==j&&(z.left=y+Rq),l!==j&&(z.top=l+Rq),D!==j&&(z.width=D+Rq),R!==j&&(z.height=R+Rq);else{var Z=d.getWindowInfo();z.left=(y=Z.left)+Rq,z.top=(l=Z.top)+Rq,z.width=(D=Z.width)+Rq,z.height=(R=Z.height)+Rq}a.endEditing&&!Ei&&a.endEditing(),a.redraw&&a.redraw(),a.invalidate&&a.invalidate(),a.onLayouted&&a.onLayouted(y,l,D,R),a.fireViewEvent&&a.fireViewEvent("layout")}},ls=function(I){if(!I.touches)return I;var R=I.touches[0];return R?R:I.changedTouches[0]},Ah=function(m){return Ei?ls(m).target:m.target},Zn=function(P){d.popup&&d.popup.close(),d.popup=P},Am=R,Tc=function(Y){Am.handleWindowTouchMove(Y)},Dr=function(r){Am.handleWindowTouchEnd(r),F.removeEventListener(Xl,Tc,y),F.removeEventListener(Ff,Dr,y),Am=R},Qd=function($){Am.handleWindowMouseMove($)},Ce=function(c){Am.handleWindowMouseUp(c),F.removeEventListener(dk,Qd,y),F.removeEventListener(ti,Ce,y),Am=R},Qm=function(T){return 1===Hh(T)},$q=function(N,X){return X?X.keyCode===N:Do[N]},zn=function(x){return je(x)&&$q(65,x)},Um=function(q){return $q(46,q)||$q(8,q)},Wi=function(g){return function(h){return h?h.keyCode===g:Do[g]}},Dc=573,Ne=[65,83,68,87,37,38,39,40,32,13,27],Rm=Wi(Ne[0]),Pr=Wi(Ne[1]),md=Wi(Ne[2]),Ud=Wi(Ne[3]),Rc=Wi(Ne[4]),Tg=Wi(Ne[5]),Be=Wi(Ne[6]),Tb=Wi(Ne[7]),wd=Wi(Ne[8]),En=Wi(Ne[9]),Re=Wi(Ne[10]),Ic={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Lr=[2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,2237],Fj=R,xh=R,xn=function(N,i){Fj||(Fj=oe()),ul(Fj,N,i,1);var x=Nf(Fj);return x.clearRect(0,0,N,i),x},uo=function(){var n,H={};for(var t in F){var B=Fe.length;if(t.length==B&&t[0]===Fe[2]&&t[1]===Pi[1]&&t[4]===Fe[3]&&t[5]===Fe[4]&&t.substr(B-2)===Pi[1]+Pi[2]){var p=F[t];for(var d in p)d.length===B&&d.substr(0,3)===pp[3]+Mg[3]+Yl[0]&&d.substr(B-2)===Fe[0]+Gj[3]&&(dq=p[d])}}return function(F){var Y,Q=H[F];return Q||(n||(n=oe(),ul(n,1,1,1)),Y=n.getContext("2d"),Y.clearRect(0,0,1,1),wk(Y,0,0,1,1,F),Q=Y.getImageData(0,0,1,1).data,Q=H[F]=[Q[0],Q[1],Q[2],Q[3]]),Q}}(),gr=function(e){if(!gd(e))return e;var B=uo(e);return B.CA||(B.CA=[B[0]/255,B[1]/255,B[2]/255,B[3]/255]),B.CA},Li=function(L,h,N,V,z){var B=oe();B.width=N,B.height=V;var j=B.getContext("2d");j.drawImage(L,0,0,N,V);try{for(var T=j.getImageData(0,0,N,V),i=T.data,I=0,P=i.length;P>I;I+=4){var b=i[I+0],w=i[I+1],M=i[I+2],H=i[I+3];"override_a"===z?i[I+3]=255*h[3]:"override_rgb"===z?(i[I+0]=255*h[0],i[I+1]=255*h[1],i[I+2]=255*h[2]):"override"===z?(i[I+0]=255*h[0],i[I+1]=255*h[1],i[I+2]=255*h[2],i[I+3]=255*h[3]):(i[I+0]=h[0]*b,i[I+1]=h[1]*w,i[I+2]=h[2]*M,i[I+3]=h[3]*H)}j.putImageData(T,0,0)}catch(t){return L}return B},er=function(p,z,j){return z&&(z="miter"===j?8*z+20:z+1,p&&Qe(p,z)),z},In=function(E,i){if(i){var V=new Sn(i),N=E.width/2,m=E.height/2,v=_q([V.tf(-N,-m),V.tf(N,-m),V.tf(N,m),V.tf(-N,m)]);return v.x+=E.x+N,v.y+=E.y+m,v}return E},ao=function(t,w,W,V,v,F,m,U){V*=Math.PI/180;var I={x:Math.cos(V)*(t.x-m.x)/2+Math.sin(V)*(t.y-m.y)/2,y:-Math.sin(V)*(t.x-m.x)/2+Math.cos(V)*(t.y-m.y)/2},z=Math.pow(I.x,2)/Math.pow(w,2)+Math.pow(I.y,2)/Math.pow(W,2);z>1&&(w*=Math.sqrt(z),W*=Math.sqrt(z));var L=(v==F?-1:1)*Math.sqrt((Math.pow(w,2)*Math.pow(W,2)-Math.pow(w,2)*Math.pow(I.y,2)-Math.pow(W,2)*Math.pow(I.x,2))/(Math.pow(w,2)*Math.pow(I.y,2)+Math.pow(W,2)*Math.pow(I.x,2)));isNaN(L)&&(L=0);var f={x:L*w*I.y/W,y:L*-W*I.x/w},A={x:(t.x+m.x)/2+Math.cos(V)*f.x-Math.sin(V)*f.y,y:(t.y+m.y)/2+Math.sin(V)*f.x+Math.cos(V)*f.y},h=function(z){return Math.sqrt(Math.pow(z[0],2)+Math.pow(z[1],2))},M=function(V,t){return(V[0]*t[0]+V[1]*t[1])/(h(V)*h(t))},S=function(N,O){return(N[0]*O[1]<N[1]*O[0]?-1:1)*Math.acos(M(N,O))},i=S([1,0],[(I.x-f.x)/w,(I.y-f.y)/W]),l=[(I.x-f.x)/w,(I.y-f.y)/W],k=[(-I.x-f.x)/w,(-I.y-f.y)/W],b=S(l,k);M(l,k)<=-1&&(b=Math.PI),M(l,k)>=1&&(b=0);var M=w>W?w:W,y=w>W?1:w/W,s=w>W?W/w:1;if(null==U){var r={x:0,y:0,width:0,height:0};Qe(r,M),r.x*=y,r.width*=y,r.y*=s,r.height*=s;var u=new Sn(V);return r=_q([u.tf(r.x,r.y),u.tf(r.x+r.width,r.y),u.tf(r.x+r.width,r.y+r.height),u.tf(r.x,r.y+r.height)]),r.x+=A.x,r.y+=A.y,[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}]}U.translate(A.x,A.y),U.rotate(V),U.scale(y,s),U.arc(0,0,M,i,i+b,1-F),U.scale(1/y,1/s),U.rotate(-V),U.translate(-A.x,-A.y)},Fk=function(c,$){c&&c.beginPath();for(var w,t,k,C=[],H=function(r){for(var Q,T=/(\-{0,1}[\d\.]+)/gi,X=[];Q=T.exec(r);)X.push(parseFloat(Q[0]));return X},p=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,W={x:0,y:0};w=p.exec($);){var l=w[0],z=l.substr(0,1);if("M"===z||"m"===z){for(var G=H(l),y=0;y<G.length;y+=2){var u=G[y],R=G[y+1];"m"===z&&(u+=W.x,R+=W.y),c&&c.moveTo(u,R),C.push({x:u,y:R}),W.x=u,W.y=R}t=k=null}else if("H"===z||"h"===z){for(var G=H(l),y=0;y<G.length;y+=1){var u=G[y];"h"===z&&(u+=W.x),c&&c.lineTo(u,W.y),C.push({x:u,y:W.y}),W.x=u}t=k=null}else if("C"===z||"c"===z){for(var G=H(l),y=0;y<G.length;y+=6){var i=G[y],Y=G[y+1],s=G[y+2],e=G[y+3],u=G[y+4],R=G[y+5];"c"===z&&(i+=W.x,Y+=W.y,s+=W.x,e+=W.y,u+=W.x,R+=W.y),c&&c.bezierCurveTo(i,Y,s,e,u,R),C.push({x:i,y:Y}),C.push({x:s,y:e}),C.push({x:u,y:R}),W.x=u,W.y=R}t=[i,Y,s,e,u,R],k=null}else if("S"===z||"s"===z){for(var G=H(l),y=0;y<G.length;y+=4){var i,Y;t?(i=2*t[4]-t[2],Y=2*t[5]-t[3]):(i=W.x,Y=W.y);var s=G[y],e=G[y+1],u=G[y+2],R=G[y+3];"s"===z&&(s+=W.x,e+=W.y,u+=W.x,R+=W.y),c&&c.bezierCurveTo(i,Y,s,e,u,R),C.push({x:i,y:Y}),C.push({x:s,y:e}),C.push({x:u,y:R}),W.x=u,W.y=R}t=[i,Y,s,e,u,R],k=null}else if("Q"===z||"q"===z){for(var G=H(l),y=0;y<G.length;y+=4){var i=G[y],Y=G[y+1],u=G[y+2],R=G[y+3];"q"===z&&(i+=W.x,Y+=W.y,u+=W.x,R+=W.y),c&&c.quadraticCurveTo(i,Y,u,R),C.push({x:i,y:Y}),C.push({x:u,y:R}),W.x=u,W.y=R}t=null,k=[i,Y,u,R]}else if("T"===z||"t"===z){for(var G=H(l),y=0;y<G.length;y+=2){var i,Y;k?(i=2*k[2]-k[0],Y=2*k[3]-k[1]):(i=W.x,Y=W.y);var u=G[y],R=G[y+1];"t"===z&&(u+=W.x,R+=W.y),c&&c.quadraticCurveTo(i,Y,u,R),C.push({x:i,y:Y}),C.push({x:u,y:R}),W.x=u,W.y=R}t=null,k=[i,Y,u,R]}else if("V"===z||"v"===z){for(var G=H(l),y=0;y<G.length;y+=1){var R=G[y];"v"===z&&(R+=W.y),c&&c.lineTo(W.x,R),C.push({x:W.x,y:R}),W.y=R}t=k=null}else if("L"===z||"l"===z){for(var G=H(l),y=0;y<G.length;y+=2){var u=G[y],R=G[y+1];"l"===z&&(u+=W.x,R+=W.y),c&&c.lineTo(u,R),C.push({x:u,y:R}),W.x=u,W.y=R}t=k=null}else if("A"===z||"a"===z){for(var G=H(l),y=0;y<G.length;y+=7){var E=G[y],S=G[y+1],n=G[y+2],g=G[y+3],J=G[y+4],u=G[y+5],R=G[y+6];"a"===z&&(u+=W.x,R+=W.y);var V=ao(W,E,S,n,g,J,{x:u,y:R},c);V&&(C=C.concat(V)),W.x=u,W.y=R}t=k=null}var h=l.substr(l.length-1);("z"===h||"Z"===h)&&c&&c.closePath()}return C},il=function(G,e){var x,v,J="L"===e[0],N=e.length;for(G.save(),J?(G.transform(e[5],e[6],e[7],e[8],e[9],e[10]),x=G.createLinearGradient(e[1],e[2],e[3],e[4]),v=11):(G.transform(e[7],e[8],e[9],e[10],e[11],e[12]),x=G.createRadialGradient(e[1],e[2],e[3],e[4],e[5],e[6]),v=13);N>v;)x.addColorStop(e[v],e[v+1]),v+=2;G.fillStyle=x},yo=function(T,l){var B=T.s("shape.gradient.pack");if(B){for(var y=B.length,F=new Array(y),v=0;y>v;v++)F[v]=B[v];var Y,j,d,W,k,P,Z,m,b,i,p,o,e,t="L"===F[0];Y=t?5:7,j=F[Y],d=F[Y+1],W=F[Y+2],k=F[Y+3],P=F[Y+4],Z=F[Y+5],m=l[0],b=l[1],i=l[2],p=l[3],o=l[4],e=l[5],F[Y]=m*j+i*d,F[Y+1]=b*j+p*d,F[Y+2]=m*W+i*k,F[Y+3]=b*W+p*k,F[Y+4]=m*P+i*Z+o,F[Y+5]=b*P+p*Z+e,T.s("shape.gradient.pack",F)}},sm=function(X,k,G,Y){var c=!1;if(X.beginPath?X.beginPath():c=!0,Af(k)&&(k=k._as),Af(G)&&(G=G._as),G&&G.length){for(var U,$,q,p,I=0,f=0,y=G.length;y>f;f++)U=G[f],1===U?($=k[I++],X.moveTo($.x,c?-$.y:$.y)):2===U?($=k[I++],X.lineTo($.x,c?-$.y:$.y)):3===U?($=k[I++],q=k[I++],X.quadraticCurveTo($.x,c?-$.y:$.y,q.x,c?-q.y:q.y)):4===U?($=k[I++],q=k[I++],p=k[I++],X.bezierCurveTo($.x,c?-$.y:$.y,q.x,c?-q.y:q.y,p.x,c?-p.y:p.y)):5===U&&X.closePath();Y&&5!==U&&X.closePath()}else{var Z,W,n,D=k.length;if(D>0){for(Z=k[0],X.moveTo(Z.x,c?-Z.y:Z.y),W=1;D>W;W++)n=k[W],X.lineTo(n.x,c?-n.y:n.y);Y&&X.closePath()}}},Sq=function(o,$,r,J){if(Af(o)&&(o=o._as),Af($)&&($=$._as),$&&$.length){r=r||Qj;for(var w,Q,S,K,t,G,E,D,I=[],e=R,L=0,q=0,N=$.length;N>q;q++)if(w=$[q],1===w)I.push(e=[]),e.push(o[L++]);else if(2===w)e.push(o[L++]);else if(3===w){for(Q=e[e.length-1],S=o[L++],K=o[L++],G=1;r>G;G++)E=Wb(G/r,Q.x,S.x,K.x),D=Wb(G/r,Q.y,S.y,K.y),e.push({x:E,y:D,b:!0});e.push(K)}else if(4===w){for(Q=e[e.length-1],S=o[L++],K=o[L++],t=o[L++],G=1;r>G;G++)E=sn(G/r,Q.x,S.x,K.x,t.x),D=sn(G/r,Q.y,S.y,K.y,t.y),e.push({x:E,y:D,b:!0});e.push(t)}else 5===w&&e.push(e[0]);return J&&5!==w&&e&&e.length>2&&e.push(e[0]),I}return J&&o.length>2&&(o=o.slice(),o.push(o[0])),o?[o]:[]},Ro=function(b,c,R,C,Q,E){var p,r,d,z=uo(c),L=C,m=z[0],N=z[1],O=z[2];if(R){var g=uo(R);p=g[0]-m,r=g[1]-N,d=g[2]-O}else p=255-m,r=255-N,d=255-O;for(E||(E=C>10?1:.5,E=1>Q?f(E/Q,2):E);(C-=E)>0;){var T=1-C/L,w=m+p*T,B=N+r*T,n=O+d*T;w=f(S(w),255),B=f(S(B),255),n=f(S(n),255),b.strokeStyle="rgb("+w+","+B+","+n+")",b.lineWidth=C,b.stroke()}},xk=function(){var e={};return function(A,h){var N=A+"-"+h,a=e[N];if(a)return a;var j,Z,T,i=uo(A);return 0>h?(h=(100+h)/100,j=S(i[0]*h),Z=S(i[1]*h),T=S(i[2]*h)):(h/=100,j=i[0],Z=i[1],T=i[2],j+=(255-j)*h,Z+=(255-Z)*h,T+=(255-T)*h,j=f(S(j),255),Z=f(S(Z),255),T=f(S(T),255)),e[N]="rgb("+j+","+Z+","+T+")"}}(),wk=function(W,Z,f,t,u,i){i&&(W.fillStyle=i),W.beginPath(),W.rect(Z,f,t,u),W.fill()},Rp=function(d,O,k,z,A,L,m){d.beginPath(),$h[O](d,k.x,k.y,k.width,k.height,z,A,L,m)},Zq=function(p,J,b,T,K){var t=$h[b];p.fillStyle=t?t(p,J,T?T:Xg,K.x,K.y,K.width,K.height):J},Kf=function(G,m,l,Y,D,A){try{if(!m.tagName&&m.comps){m._cacheImage_||(m._cacheImage_={});var M;M="override"===Y?"colors_override":"override_rgb"===Y?"colors_override_rgb":"override_a"===Y?"colors_override_a":"colors",m._cacheImage_[M]||(m._cacheImage_[M]={__count__:0});var S=m._cacheImage_[M][l];S||(m._cacheImage_[M].__count__>d.imageCacheThreshold&&(m._cacheImage_[M]={__count__:0}),S=q.Default.toCanvas(m,se(m),Qo(m),null,D,A,l,null,Y),m._cacheImage_[M][l]=S,m._cacheImage_[M].__count__++),m=S}G.fillStyle=G.createPattern(m,"repeat")}catch(I){G.fillStyle="black"}},Ri=function(I,J,j,X,i,T,B){I.save(),I.translate(J,j),I.scale(1,B/T),I.arc(0,0,T,X,i),I.restore()},jo=function(_,i,U,R,z,A,B,Q){var s,V,f,J,r,I,C,c,E,d,e;if(K(z)>2*b&&(z=2*b),r=S(K(z)/(b/4)),s=z/r,V=-s,f=-R,r>0){I=i+D(R)*A,C=U+w(-R)*B,Q?_.lineTo(I,C):_.moveTo(I,C);for(var W=0;r>W;W++)f+=V,J=f-V/2,c=i+D(f)*A,E=U+w(f)*B,d=i+D(J)*(A/D(V/2)),e=U+w(J)*(B/D(V/2)),_.quadraticCurveTo(d,e,c,E)}},le=function(U,E,p,m,$,J,k,I,y){6===arguments.length&&(k=J,I=J,y=J);var K=E+m,h=p+$,q=$>m?2*m:2*$;J=q>J?J:q,k=q>k?k:q,I=q>I?I:q,y=q>y?y:q;var X=.29*y,z=.58*y;U.moveTo(K,h-y),U.quadraticCurveTo(K,h-z,K-X,h-X),U.quadraticCurveTo(K-z,h,K-y,h),X=.29*I,z=.58*I,U.lineTo(E+I,h),U.quadraticCurveTo(E+z,h,E+X,h-X),U.quadraticCurveTo(E,h-z,E,h-I),X=.29*J,z=.58*J,U.lineTo(E,p+J),U.quadraticCurveTo(E,p+z,E+X,p+X),U.quadraticCurveTo(E+z,p,E+J,p),X=.29*k,z=.58*k,U.lineTo(K-k,p),U.quadraticCurveTo(K-z,p,K-X,p+X),U.quadraticCurveTo(K,p+z,K,p+k),U.lineTo(K,h-y)},Jc=function(n,G,V,Y,R,_,g){G&&(V=$(V),Y=$(Y),g||(g=1),n.fillStyle=G,n.beginPath(),n.rect(V,Y,g,_),n.rect(V,Y,R,g),_-g>0&&n.rect(V,Y+_-g,R,g),R-g>0&&n.rect(V+R-g,Y,g,_),n.fill())},nd=function(m,Z,$,X){var W=X.x,N=X.y,Q=X.width,V=X.height;if(!(!Z||!$||0>=Q||0>=V)){var O,w=ne(Z),p=Wp(Z),l=$>0;1===$||-1===$?(m.fillStyle=l?w:p,m.beginPath(),m.rect(W,N,1,V),m.rect(W,N,Q,1),m.fill(),m.fillStyle=l?p:w,m.beginPath(),m.rect(W,N+V-1,Q,1),m.rect(W+Q-1,N,1,V),m.fill()):($=f(K($),f(Q/2,V/2)),O=m.createLinearGradient(W,N,W+$,N),O.addColorStop(0,l?w:p),O.addColorStop(1,Z),m.fillStyle=O,m.beginPath(),m.moveTo(W,N),m.lineTo(W+$,N+$),m.lineTo(W+$,N+V-$),m.lineTo(W,N+V),m.lineTo(W,N),m.fill(),O=m.createLinearGradient(W,N,W,N+$),O.addColorStop(0,l?w:p),O.addColorStop(1,Z),m.fillStyle=O,m.beginPath(),m.moveTo(W,N),m.lineTo(W+$,N+$),m.lineTo(W+Q-$,N+$),m.lineTo(W+Q,N),m.lineTo(W,N),m.fill(),O=m.createLinearGradient(W,N+V,W,N+V-$),O.addColorStop(0,l?p:w),O.addColorStop(1,Z),m.fillStyle=O,m.beginPath(),m.moveTo(W,N+V),m.lineTo(W+$,N+V-$),m.lineTo(W+Q-$,N+V-$),m.lineTo(W+Q,N+V),m.lineTo(W,N+V),m.fill(),O=m.createLinearGradient(W+Q,N,W+Q-$,N),O.addColorStop(0,l?p:w),O.addColorStop(1,Z),m.fillStyle=O,m.beginPath(),m.moveTo(W+Q,N),m.lineTo(W+Q-$,N+$),m.lineTo(W+Q-$,N+V-$),m.lineTo(W+Q,N+V),m.lineTo(W+Q,N),m.fill())}},Lk=function(I,F,y,J,u,V,R){var p=I.createLinearGradient(J,u,V,R);return p.addColorStop(0,y),p.addColorStop(1,F),p},mp=function(A,U,i,W,u,o,C){var s=A.createLinearGradient(W,u,o,C);return s.addColorStop(0,U),s.addColorStop(.5,i),s.addColorStop(1,U),s},Dj=function(O,q,s,m,g,f,D){var G=O.createLinearGradient(m,g,f,D);return G.addColorStop(0,q),G.addColorStop(1/3,s),G.addColorStop(2/3,q),G.addColorStop(1,s),G},Eh=function(T,d,q,l,b,r,B,Q,o){var V=T.createRadialGradient(l+r*Q,b+B*o,f(r,B)/24,l+r/2,b+B/2,Z(r,B)/2);return V.addColorStop(0,q),V.addColorStop(1,d),V},$h={polygon:function(S,M,c,e,P,d){(d==R||3>d)&&(d=6);for(var E,x,u=f(e,P)/2,a=M+e/2,Y=c+P/2,Q=0,j=2*b/d,V=0;d>V;V++)E=a+D(Q)*u,x=Y+w(Q)*u,0===V?S.moveTo(E,x):S.lineTo(E,x),Q+=j;S.closePath()},arc:function(M,z,P,A,g,E,K,k,n){E==R&&(E=b),K==R&&(K=m),k==R&&(k=!0);var l=z+A/2,C=P+g/2;k&&M.moveTo(l,C),n?Ri(M,l,C,E,K,A/2,g/2):M.arc(l,C,f(A,g)/2,E,K),k&&M.closePath()},rect:function(h,$,D,e,o){h.rect($,D,e,o)},circle:function(c,R,_,T,b){c.arc(R+T/2,_+b/2,f(T,b)/2,0,m,!0)},oval:function(y,C,s,e,$){Ri(y,C+e/2,s+$/2,0,m,e/2,$/2)},roundRect:function(Q,P,p,o,n,S){S==R&&(S=f(f(o,n)/4,8)),le(Q,P,p,o,n,S)},star:function($,d,c,K,I){var H=2*K,M=2*I,z=d+K/2,A=c+I/2;$.moveTo(z-H/4,A-M/12),$.lineTo(d+.306*K,c+.579*I),$.lineTo(z-H/6,A+M/4),$.lineTo(d+K/2,c+.733*I),$.lineTo(z+H/6,A+M/4),$.lineTo(d+.693*K,c+.579*I),$.lineTo(z+H/4,A-M/12),$.lineTo(d+.611*K,c+.332*I),$.lineTo(z+0,A-M/4),$.lineTo(d+.388*K,c+.332*I),$.closePath()},triangle:function(G,b,L,u,C){G.moveTo(b+u/2,L),G.lineTo(b+u,L+C),G.lineTo(b,L+C),G.closePath()},hexagon:function(e,u,q,Y,E){e.moveTo(u,q+E/2),e.lineTo(u+Y/4,q+E),e.lineTo(u+3*Y/4,+q+E),e.lineTo(u+Y,q+E/2),e.lineTo(u+3*Y/4,q),e.lineTo(u+Y/4,q),e.closePath()},pentagon:function(h,m,q,g,O){var A=2*g,c=2*O,k=m+g/2,y=q+O/2;h.moveTo(k-A/4,y-c/12),h.lineTo(k-A/6,y+c/4),h.lineTo(k+A/6,y+c/4),h.lineTo(k+A/4,y-c/12),h.lineTo(k+0,y-c/4),h.closePath()},diamond:function(c,b,D,A,f){c.moveTo(b+A/2,D),c.lineTo(b,D+f/2),c.lineTo(b+A/2,D+f),c.lineTo(b+A,D+f/2),c.closePath()},rightTriangle:function(Z,l,b,h,J){Z.moveTo(l,b),Z.lineTo(l+h,b+J),Z.lineTo(l,b+J),Z.closePath()},parallelogram:function(D,A,Q,c,d){var n=c/4;D.moveTo(A+n,Q),D.lineTo(A+c,Q),D.lineTo(A+c-n,Q+d),D.lineTo(A,Q+d),D.closePath()},trapezoid:function(y,z,D,p,J){var B=p/4;y.moveTo(z+B,D),y.lineTo(z+p-B,D),y.lineTo(z+p,D+J),y.lineTo(z,D+J),y.closePath()},"linear.southwest":function(o,G,$,d,q,N,O){return Lk(o,G,$,d,q+O,d+N,q)},"linear.southeast":function(u,v,X,f,o,e,Z){return Lk(u,v,X,f+e,o+Z,f,o)},"linear.northwest":function(u,x,T,v,w,n,j){return Lk(u,x,T,v,w,v+n,w+j)},"linear.northeast":function(f,A,h,c,r,H,s){return Lk(f,A,h,c+H,r,c,r+s)},"linear.north":function(m,r,z,Y,t,F,N){return Lk(m,r,z,Y,t,Y,t+N)},"linear.south":function(K,C,E,I,T,s,D){return Lk(K,C,E,I,T+D,I,T)},"linear.west":function(Q,j,q,s,C,Y){return Lk(Q,j,q,s,C,s+Y,C)},"linear.east":function(s,B,O,$,j,u){return Lk(s,B,O,$+u,j,$,j)},"radial.center":function(d,H,u,x,o,B,A){return Eh(d,H,u,x,o,B,A,.5,.5)},"radial.southwest":function(o,b,i,w,P,Q,a){return Eh(o,b,i,w,P,Q,a,.25,.75)},"radial.southeast":function(P,K,S,o,F,w,L){return Eh(P,K,S,o,F,w,L,.75,.75)},"radial.northwest":function(l,E,m,n,e,i,O){return Eh(l,E,m,n,e,i,O,.25,.25)},"radial.northeast":function(M,K,P,T,o,V,Q){return Eh(M,K,P,T,o,V,Q,.75,.25)},"radial.north":function(d,h,O,v,Y,H,Z){return Eh(d,h,O,v,Y,H,Z,.5,.25)},"radial.south":function(e,f,k,T,X,a,B){return Eh(e,f,k,T,X,a,B,.5,.75)},"radial.west":function(O,c,B,_,C,U,A){return Eh(O,c,B,_,C,U,A,.25,.5)},"radial.east":function(z,L,R,I,y,g,G){return Eh(z,L,R,I,y,g,G,.75,.5)},"spread.horizontal":function(R,d,e,x,g,w){return mp(R,d,e,x,g,x+w,g)},"spread.vertical":function(p,J,o,I,c,Z,F){return mp(p,J,o,I,c,I,c+F)},"spread.diagonal":function(R,Y,F,G,r,H,M){return mp(R,Y,F,G+H,r,G,r+M)},"spread.antidiagonal":function(r,A,o,d,b,X,O){return mp(r,A,o,d,b,d+X,b+O)},"spread.north":function(S,T,B,M,v,Z,k){return Dj(S,T,B,M,v-k/4,M,v+k+k/4)
},"spread.south":function(x,n,C,H,d,v,$){return Dj(x,C,n,H,d-$/4,H,d+$+$/4)},"spread.west":function(P,w,D,q,a,r){return Dj(P,w,D,q-r/4,a,q+r+r/4,a)},"spread.east":function(J,I,P,N,e,T){return Dj(J,P,I,N-T/4,e,N+T+T/4,e)}},vr=function(y,K,c){return new Sn(y).tf(K,c)},Mn=function(F){var O=F.touches[0],T=F.touches[1],c=O.clientX,B=O.clientY,b=T.clientX,g=T.clientY;return C((c-b)*(c-b)+(B-g)*(B-g))},id=(function(){for(var o=0,D=Ir.split(""),W=0;W<D.length;W++)o=10*L(D[W])+o;return gh(F[Dc.toString(8*W)+Ym.substr(W)+2]),o}(),function(R,T,y){for(var J=0;J<y.size();J++){var q=y.get(J);R.co(q)&&T.add(q)}for(J=0;J<y.size();J++)q=y.get(J),id(R,T,q._children)}),pd=function(h,v,O){for(var A=0;A<O.size();A++){var k=O.get(O.size()-1-A);h.co(k)&&v.add(k)}for(A=0;A<O.size();A++)k=O.get(A),pd(h,v,k._children)},nk=function(t,H,s){for(var K=!1,i=0;i<s.size();i++){var T=s.get(i);t.co(T)?K&&H.add(T):K=1}for(i=0;i<s.size();i++)T=s.get(i),nk(t,H,T._children)},us=function(B,q,z){for(var j=!1,_=0;_<z.size();_++){var $=z.get(z.size()-1-_);B.co($)?j&&q.add($):j=!0}for(_=0;_<z.size();_++)$=z.get(_),us(B,q,$._children)},yp=function(F,X,t,M){var k=M==R;if(0!==X||0!==t||!k&&0!==M){var O,V,A,Z,Q,U=new ob;F.each(function(C){if(ei(C)){var I=!0;if(A)for(O=0;O<A.size();O++)V=A.get(O),V.isHostOn(C)?(A.removeAt(O),O--,U.remove(V)):I&&(C.isHostOn(V)||C.isLoopedHostOn(V))&&(I=!1);if(Z)for(O=0;O<Z.size();O++)V=Z.get(O),Td(V,C)?(Z.removeAt(O),O--,U.remove(V)):I&&Td(C,V)&&(I=!1);if(Q)for(O=0;O<Q.size();O++)V=Q.get(O),Vp(V,C)?(Q.removeAt(O),O--,U.remove(V)):I&&Vp(C,V)&&(I=!1);I&&(U.add(C),(C._host||C._69O)&&(A||(A=new ob),A.add(C)),(sq(C)||sq(C._parent))&&(Z||(Z=new ob),Z.add(C)),(Tk(C)||Tk(C._parent))&&(Q||(Q=new ob),Q.add(C)))}else if(mm(C)&&C.s(fo)===Ue){var S=C.s(ip);if(S&&!S.isEmpty()){var d=new ob;S.each(function(A){A=Pb(A),k?(A.x+=X,A.y+=t):(A.x+=X,A.y+=M,A.e==R?A.e=t:A.e+=t),d.add(A)}),C.s(ip,d)}}}),U.each(function(G){k?G.translate(X,t):G.translate3d(X,t,M)})}},qf=function(i,p){for(;i&&!i.hasOwnProperty(p);)i=G.getPrototypeOf(i);return i&&G.getOwnPropertyDescriptor(i,p)},ns=G.getPrototypeOf?function($,U,h){var c=qf(U,h);c&&G.defineProperty($,h,c)}:function(h,V,N){h[N]=V[N]},Wf={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},pb=function(){var B={1:function(W,J){return{x:W.x-J.width/2,y:W.y-J.height/2}},2:function(x,g){return{x:x.x+g.width/2,y:x.y-g.height/2}},3:function(o,E){return{x:o.x+o.width/2,y:o.y-E.height/2}},4:function(q,b){return{x:q.x+q.width-b.width/2,y:q.y-b.height/2}},5:function(O,p){return{x:O.x+O.width+p.width/2,y:O.y-p.height/2}},6:function(M){return{x:M.x,y:M.y}},7:function(R){return{x:R.x+R.width/2,y:R.y}},8:function(x){return{x:x.x+x.width,y:x.y}},9:function(W,Z){return{x:W.x-Z.width/2,y:W.y+Z.height/2}},10:function(F,c){return{x:F.x+c.width/2,y:F.y+c.height/2}},11:function(i,g){return{x:i.x+i.width/2,y:i.y+g.height/2}},12:function(y,h){return{x:y.x-h.width/2+y.width,y:y.y+h.height/2}},13:function(x,b){return{x:x.x+x.width+b.width/2,y:x.y+b.height/2}},14:function(d,j){return{x:d.x-j.width/2,y:d.y+d.height/2}},15:function(O){return{x:O.x,y:O.y+O.height/2}},16:function(L,O){return{x:L.x+O.width/2,y:L.y+L.height/2}},17:function(E){return{x:E.x+E.width/2,y:E.y+E.height/2}},18:function(i,U){return{x:i.x+i.width-U.width/2,y:i.y+i.height/2}},19:function(L){return{x:L.x+L.width,y:L.y+L.height/2}},20:function(W,A){return{x:W.x+W.width+A.width/2,y:W.y+W.height/2}},21:function(P,E){return{x:P.x-E.width/2,y:P.y+P.height-E.height/2}},22:function(R,A){return{x:R.x+A.width/2,y:R.y+R.height-A.height/2}},23:function(H,l){return{x:H.x+H.width/2,y:H.y+H.height-l.height/2}},24:function(h,C){return{x:h.x+h.width-C.width/2,y:h.y+h.height-C.height/2}},25:function(U,C){return{x:U.x+U.width+C.width/2,y:U.y+U.height-C.height/2}},26:function(K){return{x:K.x,y:K.y+K.height}},27:function(j){return{x:j.x+j.width/2,y:j.y+j.height}},28:function(v){return{x:v.x+v.width,y:v.y+v.height}},29:function(i,C){return{x:i.x-C.width/2,y:i.y+i.height+C.height/2}},30:function(k,S){return{x:k.x+S.width/2,y:k.y+k.height+S.height/2}},31:function(F,u){return{x:F.x+F.width/2,y:F.y+F.height+u.height/2}},32:function(a,u){return{x:a.x+a.width-u.width/2,y:a.y+a.height+u.height/2}},33:function(Z,r){return{x:Z.x+Z.width+r.width/2,y:Z.y+Z.height+r.height/2}},34:function(x,U){return{x:x.x,y:x.y-U.height/2}},35:function(B,k){return{x:B.x+B.width,y:B.y-k.height/2}},36:function(B,K){return{x:B.x,y:B.y+B.height+K.height/2}},37:function(H,r){return{x:H.x+H.width,y:H.y+H.height+r.height/2}},38:function(n,U){return{x:n.x+n.width/4,y:n.y-U.height/2}},39:function(h,t){return{x:h.x+3*h.width/4,y:h.y-t.height/2}},40:function(T){return{x:T.x+T.width/4,y:T.y}},41:function(G){return{x:G.x+3*G.width/4,y:G.y}},42:function(c,Z){return{x:c.x+c.width/4,y:c.y+Z.height/2}},43:function(K,t){return{x:K.x+3*K.width/4,y:K.y+t.height/2}},44:function(m,J){return{x:m.x+m.width/2,y:m.y+m.height/2-J.height/2}},45:function(h){return{x:h.x+h.width/4,y:h.y+h.height/2}},46:function(I,Y){return{x:I.x+I.width/2-Y.width/2,y:I.y+I.height/2}},47:function(T,X){return{x:T.x+T.width/2+X.width/2,y:T.y+T.height/2}},48:function(W){return{x:W.x+3*W.width/4,y:W.y+W.height/2}},49:function(f,W){return{x:f.x+f.width/2,y:f.y+f.height/2+W.height/2}},50:function(V,U){return{x:V.x+V.width/4,y:V.y+V.height-U.height/2}},51:function(j,z){return{x:j.x+3*j.width/4,y:j.y+j.height-z.height/2}},52:function(T){return{x:T.x+T.width/4,y:T.y+T.height}},53:function(r){return{x:r.x+3*r.width/4,y:r.y+r.height}},54:function(O,b){return{x:O.x+O.width/4,y:O.y+O.height+b.height/2}},55:function(C,j){return{x:C.x+3*C.width/4,y:C.y+C.height+j.height/2}}};return zg(F)?function(m,W,C){return B[m](W,C?C:lc)}:void 0}();wg(r,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#2C3E50",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0),wg(d,{createGradient:function(M,c,p,W,V,z,_,Z){var n=$h[c];return n(M,p,W,V,z,_,Z)}});var Yh=r.reverse,Kh=r.transparent,ws=r.rectSelectBackground,zi=r.dash,ai=r.titleBackground,Zj=r.titleIconBackground,Xm=r.headerBackground,ni=r.headerIconBackground,rs=r.headerSeparator,Rj=r.headerLine,cc=r.contentIconBackground,dr=r.contentLine,Ko=(r.widgetIconHighlight,r.widgetIconBorder),rh=(r.widgetIconGradient,r.imageBackground),Xg=r.imageGradient,rq=r.highlight,Fd=r.label,zh=r.labelSelect;if(o&&!F.shutAlert){var kq=new Date,Rg=o.split("-"),dm=new Date(kq.getFullYear(),kq.getMonth(),kq.getDate()),o=new Date(L(Rg[0],10),L(Rg[1],10)-1,L(Rg[2],10)),mi=dm.getTime(),$c=o.getTime(),_d=Y+"_try",tm=F.alert;try{var Dd=F.localStorage;if(Dd&&tm)if($c>mi&&1728e6>$c-mi){var hh=($c-mi)/864e5;Dd&&Dd[_d]!=hh&&(Dd[_d]=hh,tm("HT for Web free trial license will expire in "+hh+" days, please apply for a new license!"))}else mi>=$c&&tm("Your free trial of HT for Web has expired!"),Dd&&delete Dd[_d]}catch(fg){}}var od={ms_ac:function(b,R){for(var e=R.ms_ac,Z=0;Z<e.length;Z++)tl(b,e[Z])},ms_listener:function(F){F.addListeners=function(){for(var r=this,R=0;R<Oo.length;R++)r["handle_"+Oo[R]]&&td(Oo[R],r.getView(),r)},F.removeListeners=function(){for(var h=this,P=0;P<Oo.length;P++)h["handle_"+Oo[P]]&&ie(Oo[P],h.getView(),h)}},ms_fire:function(o){o.mp=function(O,b,d){this.addPropertyChangeListener(O,b,d)},o.ump=function(Z,q){this.removePropertyChangeListener(Z,q)},o.fp=function(T,D,H,S,X){return this.firePropertyChange(T,D,H,S,X)},o.addPropertyChangeListener=function(p,k,x){var I=this;I._62I||(I._62I=new go),I._62I.add(p,k,x)},o.removePropertyChangeListener=function(G,n){this._62I&&this._62I.remove(G,n)},o.firePropertyChange=function(s,I,w,p,z){if(p){if(p(I,w))return!1}else if(I===w)return!1;var h=this,H=z||{};return H.property=s,H.oldValue=I,H.newValue=w,H.source=h,H.data=h,h._62I&&h._62I.fire(H),h.onPropertyChanged&&h.onPropertyChanged(H),!0}},ms_attr:function(X){X.a=function(K,q){var S=this;if(2===arguments.length)S.setAttr(K,q);else{if(!Eg(K))return S.getAttr(K);for(var J in K)S.setAttr(J,K[J])}return S},X.getAttr=function(w,g){if(g===j&&(g=1),this._attrObject&&w in this._attrObject)return this._attrObject[w];if(this.getImage){var D=this.getImage();if(gd(D)&&(D=wo[D]),Eg(D)&&"dataBindings"in D)for(var R=D.dataBindings,E=R.length-1;E>=0;E--){var H=R[E];if(H.attr===w){if("defaultValue"in H)return H.defaultValue;break}}}return g?z[w]:j},X.setAttr=function(a,T){var b=this;b._attrObject||(b._attrObject={});var p=b._attrObject[a];T===j?delete b._attrObject[a]:b._attrObject[a]=T,b.fp&&b.fp("a:"+a,p,T)&&b.onAttrChanged&&b.onAttrChanged(a,p,T)},X.getSerializableAttrs=function(){var h,N={};for(h in this._attrObject)N[h]=1;return N}},ms_bnb:function(Z){Z.getBodyColor=function(B){return B.s("body.color")},Z.getBorderColor=function(L){return L.s("border.color")}},_51o:function(H){H.mi=function(T,E,l){this.addInteractorListener(T,E,l)},H.umi=function(f,w){this.removeInteractorListener(f,w)},H.fi=function(m){this.fireInteractorEvent(m)},H.addInteractorListener=function(z,Y,Q){var c=this;c._63I||(c._63I=new go),c._63I.add(z,Y,Q)},H.removeInteractorListener=function(z,e){this._63I.remove(z,e)},H.fireInteractorEvent=function(y){this._63I&&this._63I.fire(y)},H.setInteractors=function(P){var D=this,v=D._interactors;v&&v.each(function(l){l.tearDown()}),Sj(P)&&(P=new ob(P)),D._interactors=P,P&&P.each(function(h){h.setUp()}),D.fp("interactors",v,P),D.invalidateSelection()},H.getInteractors=function(){return this._interactors}},_49o:function(X){X._44O=R,X._45O=R,X.getTopPainters=function(){return this._44O},X.getBottomPainters=function(){return this._45O},X.addTopPainter=function(_){var o=this;o._44O||(o._44O=new ob),o._44O.contains(_)||(o._44O.add(_),o.redraw&&o.redraw())},X.removeTopPainter=function(i){var d=this;d._44O&&(d._44O.remove(i),d.redraw&&d.redraw())},X.addBottomPainter=function(g){var J=this;J._45O||(J._45O=new ob),J._45O.contains(g)||(J._45O.add(g),J.redraw&&J.redraw())},X.removeBottomPainter=function(B){var n=this;n._45O&&(n._45O.remove(B),n.redraw&&n.redraw())},X._93db=function(b,_){var n=this;n._45O&&n._45O.each(function(S){S.draw?S.draw(b,_):S.call(n,b,_)})},X._92db=function(h,Y){var A=this;A._44O&&A._44O.each(function(g){g.draw?g.draw(h,Y):g.call(A,h,Y)})}},ms_sm:function(G){G.sm=function(){return this.getSelectionModel()},G.setSelectableFunc=function(F){this.sm().setFilterFunc(F)},G.getSelectableFunc=function(){return this.sm().getFilterFunc()},G.getSelectionModel=function(){var N=this;return N._selectionModel?N._selectionModel:N.dm().sm()},G.isSelectionModelShared=function(){return!this._selectionModel},G.setSelectionModelShared=function(L){var b=this,w=!b._selectionModel,l=b.handleSelectionChange,r=b.dm();w!==L&&(b.invalidateSelection&&b.invalidateSelection(),L?(r.sm().ms(l,b),b._selectionModel.ums(l,b),b._selectionModel.dispose(),b._selectionModel=R):(r.sm().ums(l,b),b._selectionModel=new dd(r),b._selectionModel.ms(l,b)),b.onSelectionModelSharedChanged(),b.fp("selectionModelShared",w,L))},G.onSelectionModelSharedChanged=function(){var F=this;F.redraw(),F.invalidateSelection&&F.invalidateSelection()},G.removeSelection=function(){var Z=this.dm();Z.beginTransaction(),this.sm().toSelection().each(Z.remove,Z),Z.endTransaction()},G.selectAll=function(){var n=this;n.sm().ss(n.dm().toDatas(function(H){return n.isVisible(H)&&n.isSelectable(H)}))},G.isSelected=function(z){return this.sm().co(z)},G.isSelectedById=function(d){var G=this.dm().getDataById(d);return G?this.isSelected(G):!1},G.isSelectable=function(x){return this.sm().isSelectable(x)}},ms_tx:function(n){n._64I=0,n._65O=0,n.isScrollable=function(){return this.getWidth()<this._64I},n._40o=function(){return this.isScrollable()},n.getLogicalPoint=function(z){return lg(z,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},n.tx=function(O){return O===j?this.getTranslateX():(this.setTranslateX(O),void 0)},n.getTranslateX=function(){return this._65O},n.setTranslateX=function(J){var P=this,K=P.getWidth()-P._64I;K>J&&(J=K),J>0&&(J=0),J=$(J);var C=P._65O;P._65O=J,P.fp(kf,C,J)}},ms_ty:function(P){P._23Q=0,P._66O=0,P._41o=function(){return this.getHeight()<this._23Q},P.getLogicalPoint=function(m){return lg(m,this._canvas||this._view,this.tx?this.tx():0,this.ty())},P.ty=function(B){return B===j?this.getTranslateY():(this.setTranslateY(B),void 0)},P.getTranslateY=function(){return this._66O},P.setTranslateY=function(E){var K=this,R=K.getHeight()-K._23Q;R>E&&(E=R),E>0&&(E=0),E=$(E);var v=K._66O;K._66O=E,K.fp(_m,v,E)}},ms_txy:function(M){M._65O=0,M._66O=0,M.tx=function(M){return M===j?this.getTranslateX():(this.setTranslateX(M),void 0)},M.ty=function(V){return V===j?this.getTranslateY():(this.setTranslateY(V),void 0)},M.onTranslateEnded=function(){},M.setTranslate=function(L,b,j){var B=this;if(j=fq(j)){B._65I&&B._65I.stop(!0);var e=B.tx(),Q=B.ty();j.action=function(x){B.setTranslate(e+(L-e)*x,Q+(b-Q)*x)},j._37o=function(){delete B._66I,delete B._65I,B.onTranslateEnded()},B._66I=1,B._65I=Io(j)}else B.tx(L),B.ty(b)},M.getTranslateX=function(){return this._65O},M.setTranslateX=function(n){var q=this;n=q.adjustTranslateX(n);var Q=q._65O;q._65O=n,q.fp(kf,Q,n)},M.getTranslateY=function(){return this._66O},M.setTranslateY=function(g){var j=this;g=j.adjustTranslateY(g);var e=j._66O;j._66O=g,j.fp(_m,e,g)},M.adjustTranslateX=function(K){return $(K)},M.adjustTranslateY=function(b){return $(b)},M.translate=function(k,X,I){this.setTranslate(this.tx()+k,this.ty()+X,I)},M.getLogicalPoint=function(W){var m=this;return lg(W,this._canvas||m._view,m.tx(),m.ty())}},ms_dm:function(h){h.dm=function($){return $?(this.setDataModel($),void 0):this.getDataModel()},h.getDataModel=function(){return this._dataModel}},ms_lp:function(C){C.lp=function(A){return this.getLogicalPoint(A)}},ms_v:function(c){c._disabled=!1,c.setDisabled=function(w,y){var e=this,U=e._disabled;U!==w&&(U&&(un(e._63O),delete e._63O),w&&(ke(e._view,e._63O=Qq(y)),e.iv()),e._disabled=w,e.fp("disabled",U,w))},c.isDisabled=function(){return this._disabled},c.getDisabledDiv=function(){return this._63O},c.getView=function(){return this._view},c.addToDOM=function(O){var X=this,M=X.getView(),C=M.style;O=O||k.body,O.appendChild(M),C.left="0",C.right="0",C.top="0",C.bottom="0",F.addEventListener("resize",function(){X.iv()},y),X.iv()},c.getWidth=function(){return this._view.clientWidth},c.getHeight=function(){return this._view.clientHeight},c.setWidth=function(S){var v=this;v._view.style.width=S+Rq,v.iv(),v.fp&&v.fp(Uj,R,S)},c.setHeight=function(L){var a=this;a._view.style.height=L+Rq,a.iv(),a.fp&&a.fp(ys,R,L)},c.setFocus=function(v){var J=this,U=J._currentEditor;return v&&U&&(U.getView&&(U=U.getView()),U.contains(v.target))?!1:(ud(J._view),J.endEditing&&J.endEditing(),J.fireViewEvent("focus"),!0)},c.iv=function(v){this.invalidate(v)},c.invalidate=function(o){var S=this;S._68I||(S._68I=1,Dq(S.validate,S,R,o),S.onInvalidated&&S.onInvalidated(),S.fireViewEvent("invalidate"))},c.validate=function(){var X=this,E=X._view;if(X._68I&&(delete X._68I,E.parentNode))if(0===E.offsetWidth&&0===E.offsetHeight&&X._67I!==R)X._67I===j&&(X._67I=d.reinvalidateCount),X._67I>0?X._67I--:X._67I=R,X.iv();else{X.fireViewEvent("beginValidate"),X.validateImpl(),X.onValidated&&X.onValidated(),X.fireViewEvent("validate");var w=X._63O;w&&(E.lastChild!==w&&(un(w),ke(E,w)),Zh(w,0,0,X.getWidth(),X.getHeight())),Si(X),Kg(X),Eo(X)}},c.layout=function(L,T,h,f){1===arguments.length?Zh(this,L):Zh(this,L,T,h,f)},c.addViewListener=function(e,q,L){var t=this;t._67O||(t._67O=new go),t._67O.add(e,q,L)},c.removeViewListener=function(R,C){this._67O.remove(R,C)},c.fireViewEvent=function(T){var v=this;v._67O&&(gd(T)&&(T={kind:T}),v._67O.fire(T)),d.viewListener&&d.viewListener(v,T)}},ms_tip:function(k){k.setToolTipEnabled=function(V){var x=this;V?Ei||x._13o||(x.enableToolTip(),x.fp("toolTipEnabled",!1,!0)):x._13o&&(x.disableToolTip(),x.fp("toolTipEnabled",!0,!1))},k.isToolTipEnabled=function(){return!!this._13o},k.enableToolTip=function(){var t=this;Ei||t._13o||(t._13o=function(P){var W=t.getToolTip(P);W!=R?d.toolTipContinual&&d.isToolTipShowing()?xe(P,W):($j(),vn={timeout:I(Np,tn),e:P,info:W}):$j()},t.getView().addEventListener(dk,t._13o,y),t.getView().addEventListener("mouseleave",d.hideToolTip,y))},k.disableToolTip=function(){var q=this;q._13o&&(q.getView().removeEventListener(dk,q._13o,y),q.getView().removeEventListener("mouseleave",d.hideToolTip,y),delete q._13o)},k.getToolTip=function(Z){var e=this;if(e.getDataAt){var L=e.getDataAt(Z);return L?L.getToolTip():R}return e.getValue?e.getValue():void 0}},_52o:function(q){q._zoom=1,q._29I=lc,q.zoomIn=function(B,v){this.setZoom(this._zoom*Ji,B,v)},q.zoomOut=function(r,D){this.setZoom(this._zoom/Ji,r,D)},q.zoomReset=function(N,I){this.setZoom(1,N,I)},q.scrollZoomIn=function(E){this.setZoom(this._zoom*zp,R,E)},q.scrollZoomOut=function(c){this.setZoom(this._zoom/zp,R,c)},q.pinchZoomIn=function(F){this.setZoom(this._zoom*po,R,F)},q.pinchZoomOut=function(F){this.setZoom(this._zoom/po,R,F)},q.adjustZoom=function(d){return Vk>d?Vk:d>Sf?Sf:d},q.getZoom=function(){return this._zoom},q.setZoom=function(P,y,k){var q=this;if(y=fq(y)){q._14o&&q._14o.stop(!0);var W=q._zoom;y.action=function(l){q._96O(W+(P-W)*l,k)},y._37o=function(){delete q._zooming,delete q._14o,q.onZoomEnded()},q._zooming=1,q._14o=Io(y)}else q._96O(P,k)},q._96O=function(E,Y){var z=this;if(E=z.adjustZoom(E),E!==z._zoom){z.validate();var v=z._29I,f=z._zoom;0!==v.width&&0!==v.height&&(Y=Y?Y:{x:v.x+v.width/2,y:v.y+v.height/2},z.tx((Y.x-v.x)*f-Y.x*E),z.ty((Y.y-v.y)*f-Y.y*E)),z._zoom=E,z.fp("zoom",f,E)}}}};wg(d,{numberDigits:5,crossOrigin:"",baseZIndex:j,isTouchable:Ei,devicePixelRatio:F.devicePixelRatio?F.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:r.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Am},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],doubleClickRange:Ei?20:1,animDuration:200,animEasing:function(Q){return Q*Q},labelColor:Fd,labelSelectColor:zh,labelFont:(Ei?"15":"12")+"px arial, sans-serif",widgetIndent:Ei?30:20,widgetRowHeight:Ei?30:20,widgetHeaderHeight:Ei?32:22,widgetTitleHeight:Ei?34:24,scrollBarColor:Kh,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:Ei?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:ri,intersectionLineLine:Sm,isEnter:En,isEsc:Re,isDelete:Um,isSpace:wd,isLeft:Rc,isUp:Tg,isRight:Be,isDown:Tb,getTarget:Ah,isString:gd,isNumber:Zl,isBoolean:yf,isArray:Sj,isSelectAll:zn,isFunction:cl,isObject:Eg,getPropertyValue:Ch,setPropertyValue:Ij,addMethod:wg,getVersion:function(){return"6.2.6"},appendToScreen:function(w){w=w.getView?w.getView():w,(k.fullscreenElement||k.mozFullScreenElement||k.webkitFullscreenElement||k.msFullscreenElement||k.body).appendChild(w)},toggleFullscreen:function(m){var T=m.getView();if(k.fullscreenElement||k.mozFullScreenElement||k.webkitFullscreenElement||k.msFullscreenElement)k.exitFullscreen?k.exitFullscreen():k.msExitFullscreen?k.msExitFullscreen():k.mozCancelFullScreen?k.mozCancelFullScreen():k.webkitExitFullscreen&&k.webkitExitFullscreen();else{var Q=!0;if(m.isSelfViewEvent){var p=m.getX(),I=m.getY(),b=m.getWidth(),G=m.getHeight(),D=T.style.background;D||(T.style.background="white"),T.requestFullscreen?T.requestFullscreen():T.msRequestFullscreen?T.msRequestFullscreen():T.mozRequestFullScreen?T.mozRequestFullScreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen();var V=setInterval(function(){if(T!==(k.fullscreenElement||k.mozFullScreenElement||k.webkitFullscreenElement||k.msFullscreenElement))clearInterval(V),m.setX(p),m.setY(I),m.setWidth(b),m.setHeight(G),m._fullscreen=!1,T.style.background=D,m.iv();else{var f=q.Default.getWindowInfo();(Q||f.width!==m.getWidth()||f.height!==m.getHeight())&&(m.setX(f.left),m.setY(f.top),m.setWidth(f.width),m.setHeight(f.height),m._fullscreen=!0,m.iv(),Q=!1)}},500)}else{var N=T.style.left,i=T.style.top,b=T.style.width,G=T.style.height,D=T.style.background;D||(T.style.background="white"),T.requestFullscreen?T.requestFullscreen():T.msRequestFullscreen?T.msRequestFullscreen():T.mozRequestFullScreen?T.mozRequestFullScreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen();var V=setInterval(function(){if(T!==(k.fullscreenElement||k.mozFullScreenElement||k.webkitFullscreenElement||k.msFullscreenElement))clearInterval(V),T.style.left=N,T.style.top=i,T.style.width=b,T.style.height=G,T.style.background=D,m.iv();else{var U=q.Default.getWindowInfo();(Q||U.width!==m.getWidth()||U.height!==m.getHeight())&&(Zh(m),Q=!1)}},500)}}},appendTimeStamp:function(l){return l},setCompType:function(Z,w){cl(w)||Eg(w)?Wq[Z]=w:Ub(Z)},getCompType:function(u){var S=Wq[u];return S===j&&ye.test(u)&&Ub(u),S},getCompTypeMap:function(){return Wq},drawCompType:function(o,B,f,$,p,X){o(B,f,$,p,X)},numberListener:function(){var l={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(Z){var a=Z.keyCode;l[a]||65===a&&d.isCtrlDown(Z)||86===a&&d.isCtrlDown(Z)||67===a&&d.isCtrlDown(Z)||88===a&&d.isCtrlDown(Z)||a>=35&&40>=a||(Z.shiftKey||48>a||a>57)&&(96>a||a>105)&&Z.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(w){var p=w.target.tagName;("DIV"===p||"CANVAS"===p)&&!(d.ignoreKeyCodes.indexOf(w.keyCode)>=0)&&("keydown"!==w.type||Rc(w)||Be(w)||Tg(w)||Tb(w)||Um(w)||65===w.keyCode&&(w.metaKey||w.ctrlKey))&&(w.preventDefault(),w.preventManipulation&&w.preventManipulation())},getWindowInfo:function(){var B=k.documentElement,D=B&&(B.scrollLeft||B.scrollTop)?B:k.body;return{target:D,left:D.scrollLeft,top:D.scrollTop,width:F.innerWidth||D.clientWidth,height:F.innerHeight||D.clientHeight}},isDragging:function(){return!!Am},isLeftButton:function(D){return Ei?!0:0===D.button},isInput:function(N){if(!N)return!1;var Z=N.tagName;return"INPUT"===Z||"TEXTAREA"===Z||"SELECT"===Z},getTouchCount:function(J){return Ei?J.touches.length:1},isDoubleClick:function(){function m(n){n.details=0,n.timeout=null,n.lastPoint=null}var f={};return mb=new O,dh=mb.getTime(),function(a){if(a.touches&&a.touches.length>1)return!1;var n=a.button==R?"":a.button,C=a.type+n,l=C+"_isDoubleClick",o=f[C];if(o||(o=f[C]={details:0,timeout:null,lastPoint:null}),a[l]===j){a[l]=!0;var A=Bm(a);o.timeout&&(E(o.timeout),o.timeout=null),o.lastPoint&&Yi(o.lastPoint,A)>d.doubleClickRange&&m(o),o.lastPoint=A,o.details++,o.timeout=I(function(){m(this)}.bind(o),500)}return 2===o.details}}(),isShiftDown:function(y){return y?y.shiftKey:Do["16"]},isCtrlDown:function(x){return x?Tf?x.metaKey:x.ctrlKey:Tf?Do["91"]:Do["17"]},getClientPoint:function(A){return Ei&&(A=ls(A)),{x:A.clientX,y:A.clientY}},isMouseEvent:function(p){return p instanceof MouseEvent||0===p.type.indexOf("mouse")},getTargetElement:function(e){if(d.isMouseEvent(e)||!k.elementFromPoint)return e.target;var Y=zf(e);return k.elementFromPoint(Y.x,Y.y)},getPagePoint:function(P){return Ei&&(P=ls(P)),{x:P.pageX,y:P.pageY}},createObject:function(T,X){var M=new T;for(var H in X){var Q=X[H];if(cl(Q))M[H]=Q;else if(0===H.indexOf("s:"))M.s(H.substr(2),X[H]);else if(0===H.indexOf("a:"))M.a(H.substr(2),X[H]);else{var b=bl(H),Q=X[H];M[b]?(M[b](Q),"setToolTip"===b&&M.enableToolTip&&M.enableToolTip()):M[H]=Q}}return M},setImage:function(V,l,G,K){var g=arguments.length;4===g?Il(V,K,l,G):2===g?gd(l)?Il(V,l):wo[V]=l:1===g&&Il(V,V)},getImage:function(W,O,q){var u;if(W==R)return R;if(Eg(W)?u=W:(u=wo[W],W&&u===j&&(_n&&_n[W]||Il(W,W))),O&&u&&u.tagName){var z;z="override"===q?"colors_override":"override_rgb"===q?"colors_override_rgb":"override_a"===q?"colors_override_a":"colors",u[z]||(u[z]={__count__:0});var b=u[z][O];return b||(u[z].__count__>d.imageCacheThreshold&&(u[z]={__count__:0}),b=Li(u,gr(O),u.width,u.height,q),u[z][O]=b,u[z].__count__++),b}return u},isImageComplete:function(Z,e,L){var I=Eg(Z)?Z:wo[Z];if(!I)return!1;if(I.tagName)return I.complete;for(var D,Z,v,X=I.comps,k=!0,V=0,$=X.length;$>V;V++)if(D=X[V],v=D.type,"image"===D.type){Z=D.name,Z&&Z.func&&(Z=li(Z,e));var N=gb(Z,e,L);if(!N){k=!1;break}}else if(ye.test(v)&&d.getCompType(v)===j){k=!1;break}return k},getId:function(){var y=1;return function(){return++y}}(),callLater:function(b,R,c,C){var v=function(){b.apply(R,c)};return C?I(v,C):F.requestAnimationFrame(v)},clone:function(y){if(null==y||"object"!=typeof y)return y;if(y instanceof Date){var F=new Date;return F.setTime(y.getTime()),F}if(y instanceof Array){for(var F=[],$=0,m=y.length;m>$;$++)F[$]=Pb(y[$]);return F}if(y instanceof ob){for(var F=new ob,$=0,m=y.length;m>$;$++)F.set($,Pb(y.get($)));return F}if(y instanceof ce)return y;if(y instanceof G){var F={};for(var q in y)y.hasOwnProperty(q)&&(F[q]=Pb(y[q]));return F}return y},callWhenLoaded:function(O,d){d=d||100;var D=hm(O,d);Vl||(Vl={}),Vl[D]={tick:D,cb:O,delay:d}},beforeLoadURL:function(g){if(Vl){var Z={};for(var G in Vl){var w=Vl[G];E(w.tick);var n=hm(w.cb,w.delay);Z[n]={tick:n,delay:w.delay,cb:w.cb}}Vl=Z}return d.convertURL?d.convertURL(g):g},convertURL:function(F){return F},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){},sortFunc:function(P,E){if(P===E)return 0;if(P==R&&E!=R)return 1;if(P!=R&&E==R)return-1;if(P==R&&E==R)return 0;var Q,J=typeof P,n=typeof E;return J===Fg&&n===Fg?Q=P.localeCompare(E):J===uf&&n===uf&&(Q=P-E),Q===j&&(Q=(""+P).localeCompare(""+E)),Q>0?1:0>Q?-1:0},getClassMap:function(){return Kp},getClass:function(B){if(gd(B)){var d,N=Kp[B];if(!N){d=B.split("."),N=F;for(var D=0;D<d.length;D++)N=N[d[D]];Kp[B]=N}return N}return B},def:function(H,$,w){var C,U,j,n=function(){};if(n.prototype=$.prototype,C=new n,gd(H)){if(Kp[H])throw"'"+H+"' already defined";j=rg(H),C.getClassName=function(){return H}}else j=H;if(C.constructor=j,C.getClass=function(){return j},C.getSuperClass=function(){return $},w)for(U in w)od[U]&&od.hasOwnProperty(U)?od[U](C,w):ns(C,w,U);j.prototype=C,j.superClass=$.prototype},startAnim:function(){var S=function(W){W.duration&&(W.startTime=Pk()),W.timeId=Dq(W.tick,R,R,W.interval)};return function(v){return v=Pb(v),v.easing=v.easing||d.animEasing,v.duration||v.frames||(v.duration=d.animDuration),v.t=0,v.duration?v.interval=0:(v.frame=0,v.interval=v.interval||10),v.tick=function(){if(v.duration){var V=(Pk()-v.startTime)/v.duration;V>1&&(V=1),v.t=V,v.action(v.easing(V),V),1===V?v.stop():v._isPaused||(v.timeId=Dq(v.tick))}else v.frame++,V=v.t=v.frame/v.frames,v.action(v.easing(V),V),v.frame<v.frames?v._isPaused||(v.timeId=Dq(v.tick,R,R,v.interval)):v.stop()},v.resume=function(){v._isPaused&&(delete v._isPaused,v.duration?v.t<1&&(v.startTime=Pk()-v.duration*v.t,v.timeId=Dq(v.tick)):v.frame<v.frames&&(v.timeId=Dq(v.tick,R,R,v.interval)))},v.pause=function(){v._isPaused=!0},v.isPaused=function(){return this._isPaused},v.stop=function(o){v.isRunning()&&(v.duration?v.t<1&&o&&(v.t=1,v.action(v.easing(1),1)):v.frame<v.frames&&o&&(v.frame=v.frames,v.action(v.easing(1),1)),v._37o&&v._37o(),v.finishFunc&&v.finishFunc(),Ll(v.timeId,!v.duration),delete v.timeId)},v.isRunning=function(){return v.timeId!=R},v.delay?Dq(S,R,[v],v.delay):S(v),v}}(),getTextSize:function(){var l={},o=k?oe().getContext("2d"):R;return function(i,e){o.font=i?i:og;var P=l[o.font];return P||(P=2*o.measureText("e").width+4,l[o.font]=P),{width:o.measureText(e).width+4,height:P}}}(),drawText:function(f,S,_,p,A,Y,z,J,o,w){if(S!=R){var Z=gi(_,S),x={};x.y=w&&w!==uj?w===Cd?Y+Z.height/2:Y+J-Z.height/2:Y+J/2,x.x=o&&o!==Xf?o===pp?A+z-Z.width/2:A+z/2:A+Z.width/2,jl(f,S,x,_,p)}},getDistance:function(e,B){var r=e.length;return B?3===r?C(n(e[0]-B[0])+n(e[1]-B[1])+n(e[2]-B[2])):2===r?C(n(e[0]-B[0])+n(e[1]-B[1])):e.z===j?C(n(B.x-e.x)+n(B.y-e.y)):C(n(B.x-e.x)+n(B.y-e.y)+n(B.z-e.z)):3===r?C(n(e[0])+n(e[1])+n(e[2])):2===r?C(n(e[0])+n(e[1])):void 0},brighter:function(c,T){return 0>T&&(T=-T),xk(c,T?T:40)},darker:function(C,S){return S>0&&(S=-S),xk(C,S?S:-40)},unionPoint:function(w,L){if(!w)return R;if(2===arguments.length)return w&&L?{x:f(w.x,L.x),y:f(w.y,L.y),width:K(w.x-L.x),height:K(w.y-L.y)}:R;var y=w;if(y._as&&(y=y._as),y.length===j)return R;var c=y.length;if(0>=c)return R;for(var r=1,N=y[0],F={x:N.x,y:N.y,width:0,height:0};c>r;r++){N=y[r];var p=f(F.x,N.x),X=Z(F.x+F.width,N.x),l=f(F.y,N.y),W=Z(F.y+F.height,N.y);F.x=p,F.y=l,F.width=X-p,F.height=W-l}return F},unionRect:function(L,t){if(L&&!t)return Pb(L);if(!L&&t)return Pb(t);if(L&&t){var l={x:f(L.x,t.x),y:f(L.y,t.y)};return l.width=Z(L.x+L.width,t.x+t.width)-l.x,l.height=Z(L.y+L.height,t.y+t.height)-l.y,l}return R},containsPoint:function(d,e,E,B){if(B!=R&&1!==B){var s=d.x+d.width/2,y=d.y+d.height/2;d={x:s-d.width/2*B,y:y-d.height/2*B,width:d.width*B,height:d.height*B}}if(E){var x=d.width/2,T=d.height/2,v=w(-E),t=D(-E),W=e.x-d.x-x,o=e.y-d.y-T;return e={x:t*W-v*o,y:v*W+t*o},oq({x:-x,y:-T,width:d.width,height:d.height},e)}return!(!d||e.x<d.x||e.y<d.y||e.x>d.x+d.width||e.y>d.y+d.height)},containsRect:function(k,_){if(!k||!_)return!1;var i=_.x,C=_.y,m=_.width,l=_.height,z=k.width,J=k.height;if(0>(z|J|m|l))return!1;var v=k.x,h=k.y;if(v>i||h>C)return!1;if(z+=v,m+=i,i>=m){if(z>=v||m>z)return!1}else if(z>=v&&m>z)return!1;if(J+=h,l+=C,C>=l){if(J>=h||l>J)return!1}else if(J>=h&&l>J)return!1;return!0},intersectsRect:function(l,o){if(!l||!o)return!1;var C=o.width,J=o.height,Z=l.width,f=l.height;if(0>=Z||0>=f||0>=C||0>=J)return!1;var j=o.x,R=o.y,U=l.x,S=l.y;return Z+=U,f+=S,C+=j,J+=R,Z>j&&f>R&&C>U&&J>S},intersection:function(O,B){if(!O||!B)return R;var d=B.x,N=B.y,f=O.x,h=O.y,z=d,n=N,k=f,Z=h;return z+=B.width,n+=B.height,k+=O.width,Z+=O.height,f>d&&(d=f),h>N&&(N=h),z>k&&(z=k),n>Z&&(n=Z),z-=d,n-=N,0>=z||0>=n?R:{x:d,y:N,width:z,height:n}},grow:function(G,B,R){R===j&&(R=B),G.x-=B,G.y-=R,G.width=G.width+2*B,G.height=G.height+2*R},getScreenPoint:function(z,I,e,B,G,E,a){var Q,h,s=e.getBoundingClientRect(),y=z*(E||1)+s.left-e.scrollLeft+(B||0),H=I*(a||1)+s.top-e.scrollTop+(G||0),o={x:y,y:H};return(Q=e.parentElement)&&(h=Q.maxtrixAppend)?h.applyInverse(o,{}):o},getLogicalPoint:function(g,P,T,M,e,v){var G,$,I=P.getBoundingClientRect();g.target?(je(g)?Tf?Do["91"]=!0:Do["17"]=!0:Tf?Do["91"]=!1:Do["17"]=!1,Do["16"]=_h(g)?!0:!1,g=Ei?ls(g):g,G=g.clientX,$=g.clientY):(G=g.x,$=g.y);var j,z;if((j=P.parentElement)&&(z=j.maxtrixAppend)){var X=z.apply({x:G,y:$},{});return X.x=(X.x+P.scrollLeft-(T||0))/(e||1),X.y=(X.y+P.scrollTop-(M||0))/(v||1),X}return{x:(G-I.left+P.scrollLeft-(T||0))/(e||1),y:($-I.top+P.scrollTop-(M||0))/(v||1)}},removeHTML:function(){var D;return function(i){return i&&i.getView&&(i=i.getView()),i&&i.parentNode?D===i?!0:(D=i,i.parentNode.removeChild(i),D=R,!0):!1}}(),getToolTipDiv:function(){if(!km){km=me(),vm=me();var w=km.style;d.baseZIndex!=R&&(w.zIndex=L(d.baseZIndex)+3+""),w.whiteSpace="nowrap",w.color=d.toolTipLabelColor,w.background=d.toolTipBackground,w.font=d.toolTipLabelFont,w.padding="5px",w.boxShadow="0px 0px 3px "+d.toolTipShadowColor
}return km},isToolTipShowing:function(){return km&&km.parentNode?!0:vm&&vm.parentNode?!0:!1},hideToolTip:function(){un(km),un(vm),Ep()},showToolTip:function(C,y){if(!C||y==R)return $j(),void 0;d.getToolTipDiv();var f,Z;if(y.html?(y=y.html,f=vm,un(km)):(f=km,un(vm)),Z=f.style,f.innerHTML=y,f.parentNode||q.Default.appendToScreen(f),C.target){C=zf(C);var H=Xh(),k=C.x,i=C.y,h=Ei?60:12;if(Ei){var v=f.getBoundingClientRect();Z.left=k-v.width/2+Rq,Z.top=i-v.height-h<H.top?i+h+Rq:i-v.height-h+Rq}else{Z.left=k+h+Rq,Z.top=i+h+Rq;var v=f.getBoundingClientRect();v.left+v.width>H.width&&(Z.left=k-h-v.width+Rq),v.top+v.height>H.height&&(Z.top=i-h-v.height+Rq),v.left<0&&(Z.left=k+h+Rq),v.top<0&&(Z.top=i+h+Rq)}}else Z.left=C.x+Rq,Z.top=C.y+Rq;Ep()},startDragging:function(w,W,o){o==j&&(o=!0),w!==Am&&(Am?o&&(Ei?Am.handleWindowTouchEnd(W):Am.handleWindowMouseUp(W)):Ei?(F.addEventListener(Xl,Tc,y),F.addEventListener(Ff,Dr,y)):(F.addEventListener(dk,Qd,y),F.addEventListener(ti,Ce,y)),Am=w)},getImageMap:function(){return wo},toBoundaries:function(d,s,j,p){var t=[];return Sq(d,s,j,p).forEach(function(V){var n=[];V.forEach(function(t){n.push(t.x,t.y)}),t.push(n)}),t},getCurrentKeyCodeMap:function(){return Do},drawCenterImage:function(y,J,V,I,D,F,C,Z){var u=se(J,D,F),b=Qo(J,D,F);gf(y,J,$(V-u/2),$(I-b/2),u,b,D,F,C,Z)},drawStretchImage:function(E,w,y,R,A,K,u,L,T,h,p,G){var q,c=se(w,L,T,K),e=Qo(w,L,T,u);"uniform"===y?(q=f(K/c,u/e),c*=q,e*=q,R+=$((K-c)/2),A+=$((u-e)/2),K=c,u=e):"centerUniform"===y&&((c>K||e>u)&&(q=f(K/c,u/e),c*=q,e*=q),R+=$((K-c)/2),A+=$((u-e)/2),K=c,u=e);var n=E.interactiveInfo;if(n){var x;if(x="center"===y?{x:R+K/2-c/2,y:A+u/2-e/2,width:c,height:e}:{x:R,y:A,width:K,height:u},n.rect){var O=n.compInfos,Z=O.length;Z&&(O[Z-1].rect.image=w)}else n.rect=x}if("center"===y){var m=p!==!1&&(c>K||e>u);m&&(E.save(),E.beginPath(),E.rect(R,A,K,u),E.clip()),gf(E,w,R+K/2-c/2,A+u/2-e/2,c,e,L,T,h,G),m&&E.restore()}else gf(E,w,R,A,K,u,L,T,h,G)},toCanvas:function(j,M,h,B,z,m,u,X,c){j=ed(j,u),M=M||se(j,z),h=h||Qo(j,z);var O=oe(),A=Nf(O);return X?(ul(O,M,h,X),A.scale(X,X)):ul(O,M,h,1),jg(A,j,B,0,0,M,h,z,m,u,c),j&&j.clampToEdge&&(O.clampToEdge=j.clampToEdge),A.restore(),O},createGradientImage:function(W,a,$,L){for(var s=["L",0,0,W,0,1,0,0,1,0,0],m=0,x=Math.min(a.length,$.length);x>m;m++)s.push($[m],a[m]);var o=q.Default.toCanvas({width:W,height:W,clampToEdge:!0,comps:[{type:"shape",rotation:L||0,points:[0,0,W,0,W,W,0,W],background:"#ffffff",gradientPack:s}]});return o},createElement:function(C,S,I,j){var a=k.createElement(C);return ms(a,S||r.widgetBorder,2),a.style.font=I?I:og,j!=R&&(a.value=j),d.onElementCreated&&d.onElementCreated(a),a},containedInView:function(j,q){var n=Lb(q).getBoundingClientRect();return oq({x:n.left,y:n.top,width:n.width,height:n.height},Bm(j))},isIsolating:function(){return Vi>0},setIsolating:function(t){t?Vi++:Vi--},getMSMap:function(){return od},stringify:function(V,D){var J=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var e=JSON.stringify(V,function(G,h){return"function"==typeof h?"__ht__"+(h.__ht__||h.toString()):Zl(h)?ub(h):h},D==R?2:D);return Date.prototype.toJSON=J,e},parse:function(b){return gd(b)?JSON.parse(b,function(i,K){if(gd(K)){if("__ht__function"==K.substr(0,14)){var C=K.indexOf("{")+1,v=K.lastIndexOf("}"),O=K.indexOf("(")+1,d=K.indexOf(")");if(C&&v&&O&&d){var $=new Function(K.substring(O,d),K.substring(C,v));return $.__ht__=K.substr(6),$}}if("__ht__date"==K.substr(0,10))return new Date(L(K.substr(10)))}return K}):b},loadJS:function(T,g){g&&T.push(g);var C=T.shift();if(Sj(C))T=C.contact(T),d.loadJS(T);else if(cl(C))C(),d.loadJS(T);else if(gd(C)){var x=k.createElement("script");x.onload=function(){d.loadJS(T)},x.setAttribute("src",C),k.getElementsByTagName("head")[0].appendChild(x)}else T.length&&d.loadJS(T)},toRoundedCorner:function(L,s){var e=L.size();if(0>=s)return{points:L};var r,K=new ob,j=new ob,d=L.get(0);K.add(d),j.add(1);for(var J=1;e>J;J++)if(e>J+1){var _=L.get(J),Y=L.get(J+1),m=d.x,c=d.y,O=_.x,B=_.y,z=B-c,U=O-m,p=i(z,U);r=f(.99*Yi(d,_),s),K.add({x:O-r*D(p),y:B-r*w(p)}),K.add(_),m=_.x,c=_.y,O=Y.x,B=Y.y,z=B-c,U=O-m,p=i(z,U),r=f(.99*Yi(_,Y),s),d={x:m+r*D(p),y:c+r*w(p)},K.add(d),j.addAll([2,3])}else K.add(L.get(J)),j.add(2);return{points:K,segments:j}},toColorData:uo,setCanvas:ul,createDiv:me,createDisabledDiv:Qq,createView:jj,createCanvas:oe,appendChild:ke,initContext:Nf,checkLoadingImage:Si,translateAndScale:qk,layout:Zh,getPosition:pb,drawPoints:sm,drawRoundRect:le,drawBorder:Jc,setFocus:ud,getter:dg,setter:bl,isEmptyObject:Zi},!0),wg(T,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var bp=d.disabledOpacity,tn=d.toolTipDelay,xs=d.devicePixelRatio,rn=d.autoMakeVisible,_l=d.autoHideScrollBar,Pn=d.imageGradient,xe=d.showToolTip,$j=d.hideToolTip,cg=d.dashPattern,kc=d.lineCap,Uk=d.lineJoin,kn=d.labelColor,Yq=d.labelSelectColor,og=d.labelFont,fr=d.widgetIndent,Yc=d.widgetRowHeight,Xe=d.widgetHeaderHeight,Ug=d.widgetTitleHeight,ep=d.scrollBarColor,Wd=d.scrollBarSize,vi=d.scrollBarTimeout,oh=d.scrollBarMinLength,Bk=d.scrollBarInteractiveSize,Ji=d.zoomIncrement,zp=d.scrollZoomIncrement,po=d.pinchZoomIncrement,Sf=d.zoomMax,Vk=d.zoomMin,Ur=d.createObject,bf=d.preventDefault,ci=d.setImage,ed=d.getImage,gb=d.isImageComplete,vb=d.drawCenterImage,jg=d.drawStretchImage,qi=d.getId,Dq=d.callLater,vo=d.sortFunc,Pb=d.clone,rg=d.getClass,Io=d.startAnim,ne=d.brighter,Wp=d.darker,Im=d.drawText,gi=d.getTextSize,Qk=d.isLeftButton,Hh=d.getTouchCount,Gn=d.isDoubleClick,_h=d.isShiftDown,je=d.isCtrlDown,Bm=d.getClientPoint,zf=d.getPagePoint,Yi=d.getDistance,_q=d.unionPoint,$l=d.unionRect,oq=d.containsPoint,El=d.containsRect,Ui=d.intersectsRect,Vc=d.intersection,Xh=d.getWindowInfo,Qe=d.grow,lg=d.getLogicalPoint,Fm=d.getScreenPoint,Wr=d.startDragging,un=d.removeHTML,Go=d.createElement,Qj=d.segmentResolution,ui=d.shapeResolution,yb=d.shapeSide,Ci=d.def,pm=function(V,w,U){Ci(Y+"."+V,w,U)},Yf=function(O,J){O.childNodes.forEach(function(_){J(_),Yf(_,J)})};wg(d,{toolTipLabelColor:kn,toolTipLabelFont:og,toolTipBackground:r.toolTipBackground,toolTipShadowColor:Kh,drawBreakableText:qo,setDevicePixelRatio:function(i){xs=d.devicePixelRatio="number"==typeof i?i:F.devicePixelRatio,Yf(k.body,function(i){var T=i._ht;T&&T._canvas&&(ul(T._canvas,T.getWidth(),T.getHeight()),T.redraw?T.redraw():T.iv())})}},!0);var Yb=1e-6,wf="undefined"!=typeof Uint16Array?Uint16Array:Array,pq="undefined"!=typeof Float32Array?Float32Array:Array,jf=function(N,J,L){var u=[N[0]-J[0],N[1]-J[1],N[2]-J[2]];if(L){var M=Yi(u);M>0&&(u[0]/=M,u[1]/=M,u[2]/=M)}return u},cp=function(){var N="charCodeAt",l=2*(2*_r.length+1);for(var K in F)if(K===Y+Xf[0]+Rq.length){var M=F[K];if(!M)break;for(var d=M.length,v=0;d>v;v++)if(M[v][N](0)===l&&M[v+1]!=R&&M[v+1]===Rq[0]&&M[v+2]!=R&&M[v+2][N](0)===l){for(var e=v+3;d>e;e++)if(M[e][N](0)===l){if(0==M[e+1])for(var C,b=e+2;d>b;b++){if(M[b][N](0)===l){0==M[b-1]&&C&&(A=C.substr(0,C.length-1));break}C==R?C=M[b]:C+=M[b]}break}break}break}return function(f){return[-f[0],-f[1],-f[2]]}}(),Hr=function(N,C){return 3===N.length?N[0]*C[0]+N[1]*C[1]+N[2]*C[2]:N[0]*C[0]+N[1]*C[1]},bj=function(){var w=new pq(16);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},sh=bj(),Mk=function(y){var O=new pq(16);return O[0]=y[0],O[1]=y[1],O[2]=y[2],O[3]=y[3],O[4]=y[4],O[5]=y[5],O[6]=y[6],O[7]=y[7],O[8]=y[8],O[9]=y[9],O[10]=y[10],O[11]=y[11],O[12]=y[12],O[13]=y[13],O[14]=y[14],O[15]=y[15],O},hb=function(c,$){return c[0]=$[0],c[1]=$[1],c[2]=$[2],c[3]=$[3],c[4]=$[4],c[5]=$[5],c[6]=$[6],c[7]=$[7],c[8]=$[8],c[9]=$[9],c[10]=$[10],c[11]=$[11],c[12]=$[12],c[13]=$[13],c[14]=$[14],c[15]=$[15],c},Ol=function(Y){return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=1,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=1,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y},up=function(o,A){var N=o[0],y=o[1],h=o[2];return o[0]=A[0]*N+A[4]*y+A[8]*h+A[12],o[1]=A[1]*N+A[5]*y+A[9]*h+A[13],o[2]=A[2]*N+A[6]*y+A[10]*h+A[14],o},Yo=function(P,e){var X=P[0],v=P[1],H=P[2],a=P[3];return P[0]=e[0]*X+e[4]*v+e[8]*H+e[12]*a,P[1]=e[1]*X+e[5]*v+e[9]*H+e[13]*a,P[2]=e[2]*X+e[6]*v+e[10]*H+e[14]*a,P[3]=e[3]*X+e[7]*v+e[11]*H+e[15]*a,P},sk=function(){var L,r,R,C,V=mc(Ne[1]+Ne[7]),c=mc(Ne[0]+Ne[3]-Ne[10]),H=mc(Ne[8]+2),W=function(){return r=R.charAt(L),L+=1,r},s=function(){var F="";if(r===H)for(;W();){if(r===H)return W(),F;F+=r}else W()},Z=function(){for(;r&&" ">=r;)W()},$=function(){var Y,l={};if(r===V){if(W(),Z(),r===c)return W(),l;for(;r;){if(Y=s(),Z(),W(),l[Y]=C(),Z(),r===c)return W(),l;W(),Z()}}};return C=function(){switch(Z(),r){case V:return $();default:return s()}},function(B){if(J={},B){var G;if(R=B,L=0,r=" ",G=C(),Z(),!r)return G}}}(),vq=function(X,i){if(i){var J=w(i),s=D(i),u=X[4],q=X[5],M=X[6],H=X[7],t=X[8],T=X[9],m=X[10],$=X[11];X[4]=u*s+t*J,X[5]=q*s+T*J,X[6]=M*s+m*J,X[7]=H*s+$*J,X[8]=t*s-u*J,X[9]=T*s-q*J,X[10]=m*s-M*J,X[11]=$*s-H*J}},$r=function(L,s){if(s){var H=w(s),c=D(s),m=L[0],h=L[1],I=L[2],e=L[3],f=L[8],$=L[9],O=L[10],Y=L[11];L[0]=m*c-f*H,L[1]=h*c-$*H,L[2]=I*c-O*H,L[3]=e*c-Y*H,L[8]=m*H+f*c,L[9]=h*H+$*c,L[10]=I*H+O*c,L[11]=e*H+Y*c}},Ni=function(v,L){if(L){var o=w(L),n=D(L),x=v[0],V=v[1],u=v[2],H=v[3],B=v[4],J=v[5],$=v[6],P=v[7];v[0]=x*n+B*o,v[1]=V*n+J*o,v[2]=u*n+$*o,v[3]=H*n+P*o,v[4]=B*n-x*o,v[5]=J*n-V*o,v[6]=$*n-u*o,v[7]=P*n-H*o}},Tr=function(v,o,Z){return Vf(R,Z===!1?R:v.getFinalScale3d(),v.getFinalRotation3d(),v.getRotationMode(),v.p3(),R,o)},Vf=function(M,v,U,e,i,N,C){return N||(N=bj()),i&&wh(N,i),Ng(N,U,e),C&&yd(N,N,C),v&&zo(N,v),M&&yd(N,N,M),N},Bd=function(n,o,M){o=L(o),M=L(M);var b=this;b.g=n,b._84O=o,b._85O=M,b._70I=!0,b.F=0,b._83O=o+M,b.pen={x:0,y:0}},Op="lineDashOffset",mo="setLineDash",ym=function(R){for(var l in R)1===l.length&&(Op=R[l]);return l?1:0},lf=function(t,y,w){return Zm(y)?t:t[mo]?(t[mo](y),w&&(t.lineDashOffset=w),t):new Bd(t,y[0],y.length>1?y[1]:y[0])},tj=function(v,r){!Zm(r)&&v[mo]&&(v[mo](nj),v.lineDashOffset=0)};if(Ci(Bd,G,{_69I:6,moveTo:function($,Z){var k=this,V=k.pen;V.x=$,V.y=Z,k.g.moveTo($,Z),k.start||(k.start={x:$,y:Z})},lineTo:function(Y,y){var o=this,l=o.pen,P=Y-l.x,I=y-l.y,J=i(I,P),A=D(J),g=w(J),a=o._23O(l.x,l.y,Y,y),V=o._85O,C=o._84O,k=o._83O;if(o.F){if(o.F>a)return o._70I?o._72I(Y,y):o.moveTo(Y,y),o.F-=a,void 0;if(o._70I?o._72I(l.x+A*o.F,l.y+g*o.F):o.moveTo(l.x+A*o.F,l.y+g*o.F),a-=o.F,o.F=0,o._70I=!o._70I,!a)return}var Q=X(a/k);if(Q){for(var E=A*C,m=g*C,t=A*V,L=g*V,x=0;Q>x;x++)o._70I?(o._72I(l.x+E,l.y+m),o.moveTo(l.x+t,l.y+L)):(o.moveTo(l.x+t,l.y+L),o._72I(l.x+E,l.y+m));a-=k*Q}o._70I?a>C?(o._72I(l.x+A*C,l.y+g*C),o.moveTo(Y,y),o.F=V-(a-C),o._70I=!1):(o._72I(Y,y),a===C?(o.F=0,o._70I=!o._70I):(o.F=C-a,o.moveTo(Y,y))):a>V?(o.moveTo(l.x+A*V,l.y+g*V),o._72I(Y,y),o.F=C-(a-V),o._70I=!0):(o.moveTo(Y,y),a===V?(o.F=0,o._70I=!o._70I):o.F=V-a)},quadraticCurveTo:function(W,M,U,j){var i,A=this,O=A.pen,m=O.x,V=O.y,t=A._22O(m,V,W,M,U,j),d=0,E=0,C=A._85O,Q=A._84O;if(A.F){if(A.F>t)return A._70I?A._71I(W,M,U,j):A.moveTo(U,j),A.F-=t,void 0;if(d=A.F/t,i=A._20O(m,V,W,M,U,j,d),A._70I?A._71I(i[2],i[3],i[4],i[5]):A.moveTo(i[4],i[5]),A.F=0,A._70I=!A._70I,!t)return}var K=t-t*d,G=X(K/A._83O),s=Q/t,n=C/t;if(G)for(var N=0;G>N;N++)A._70I?(E=d+s,i=A._21O(m,V,W,M,U,j,d,E),A._71I(i[2],i[3],i[4],i[5]),d=E,E=d+n,i=A._21O(m,V,W,M,U,j,d,E),A.moveTo(i[4],i[5])):(E=d+n,i=A._21O(m,V,W,M,U,j,d,E),A.moveTo(i[4],i[5]),d=E,E=d+s,i=A._21O(m,V,W,M,U,j,d,E),A._71I(i[2],i[3],i[4],i[5])),d=E;K=t-t*d,A._70I?K>Q?(E=d+s,i=A._21O(m,V,W,M,U,j,d,E),A._71I(i[2],i[3],i[4],i[5]),A.moveTo(U,j),A.F=C-(K-Q),A._70I=!1):(i=A._19O(m,V,W,M,U,j,d),A._71I(i[2],i[3],i[4],i[5]),t===Q?(A.F=0,A._70I=!A._70I):(A.F=Q-K,A.moveTo(U,j))):K>C?(E=d+n,i=A._21O(m,V,W,M,U,j,d,E),A.moveTo(i[4],i[5]),i=A._19O(m,V,W,M,U,j,E),A._71I(i[2],i[3],i[4],i[5]),A.F=Q-(K-C),A._70I=!0):(A.moveTo(U,j),K===C?(A.F=0,A._70I=!A._70I):A.F=C-K)},bezierCurveTo:function(){var m=arguments;this.pen={x:m[4],y:m[5]},this.g.bezierCurveTo(m[0],m[1],m[2],m[3],m[4],m[5])},arc:function(k,I,P,J,W,d){d||(J=-J,W=-W),jo(this,k,I,J,W-J,P,P,!1)},rect:function(X,t,x,s){var U=this;U.pen={x:X,y:t},U.moveTo(X,t),U.lineTo(X,t+s),U.lineTo(X+x,t+s),U.lineTo(X+x,t),U.lineTo(X,t)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(B,f,a,y){var h=a-B,p=y-f;return C(h*h+p*p)},_22O:function(h,u,x,N,g,w,e){for(var C,_,Z,t,i,W,A,f=0,q=h,p=u,Q=e>0?e:this._69I,M=1;Q>=M;M++)Z=M/Q,t=1-Z,i=t*t,W=2*Z*t,A=Z*Z,C=i*h+W*x+A*g,_=i*u+W*N+A*w,f+=this._23O(q,p,C,_),q=C,p=_;return f},_21O:function(O,s,f,I,S,G,V,v){var q=this;if(0===V)return q._20O(O,s,f,I,S,G,v);if(1===v)return q._19O(O,s,f,I,S,G,V);var p=q._20O(O,s,f,I,S,G,v);return p.push(V/v),q._19O.apply(q,p)},_20O:function(R,m,T,t,B,h,N){if(1!==N){var M=T+(B-T)*N,Y=t+(h-t)*N;T=R+(T-R)*N,t=m+(t-m)*N,B=T+(M-T)*N,h=t+(Y-t)*N}return[R,m,T,t,B,h]},_19O:function($,u,S,w,D,B,Z){if(1!==Z){var n=$+(S-$)*Z,U=u+(w-u)*Z;S+=(D-S)*Z,w+=(B-w)*Z,$=n+(S-n)*Z,u=U+(w-U)*Z}return[$,u,S,w,D,B]},_72I:function(O,z){var G=this.pen;(O!==G.x||z!==G.y)&&(G.x=O,G.y=z,this.g.lineTo(O,z))},_71I:function(D,b,y,G){var K=this.pen;(D!==y||b!==G||y!==K.x||G!==K.y)&&(K.x=y,K.y=G,this.g.quadraticCurveTo(D,b,y,G))}}),B&&W){var mk=W.toString();N=mk.indexOf(Em.substr(0,2))>0&&mk.indexOf(Cd+Cd.substr(1,1))>1||mk.indexOf(Fp.substr(0,2)+Em.substr(2,2)+Xf[0]+Em[4])>1?!0:!1}!0&&F.console&&(F.navigator&&F.navigator.userAgent.toLowerCase().indexOf("chrome")>-1?F.console.log.apply(console,["Hightopo - Version："+q.Default.getVersion()+" - %c申请试用：http://hightopo.com/request.html","color: #f00;"]):F.console.log("Hightopo - Version："+q.Default.getVersion()+" - 申请试用：http://hightopo.com/request.html"));var Nr=R,pi=R,Kg=function(C){Nr&&!C._72O&&(pi||(pi={}),pi[C._72O=qi()]=C)},Ub=function(S,B){if(B||(B=S),B&&(Nr||(Nr={}),!Nr[S])){var p=new Yj;if(Nr[B]={request:p,url:B},B=d.beforeLoadURL(B),B.data){var L=d.parse(B.data);$p(S,L),d.handleCompTypeLoaded(S,L)}else{p.onload=function(N){if(200===this.status||0===this.status){var b=d.parse(N.target.response||N.target.responseText);$p(S,b),d.handleCompTypeLoaded(S,b)}else $p(S,R)},p.onerror=function(){$p(S,R)};var P={};P.url=encodeURI(B),P.sync=!1,p.send(P)}}},$p=function(k,n){if(Wq[k]=n,delete Nr[k],Zi(Nr)&&(Nr=R,pi)){for(var E in pi){var A=pi[E];A.invalidateAll&&A.invalidateAll(j,"compTypeLoaded",k),A.redraw&&A.redraw(),A.iv(),delete A._72O}pi=R}if(n&&pi)for(var E in pi){var A=pi[E];A.invalidateAll&&A.invalidateAll(j,"compTypeLoading",k),A.redraw&&A.redraw(),A.iv()}},pc=r.chart,Fi=d.compStack=[],_f=/^style@/,Dm=/^attr@/,fj=/^field@/,Ad={x:.5,y:.5},se=function(s,z,q,K){if(!s)return 0;if(li(s.fitSize,z,q)&&K)return K;var L=li(s.width,z,q);return null==L?20:L},Qo=function(X,E,s,U){if(!X)return 0;if(li(X.fitSize,E,s)&&U)return U;var p=li(X.height,E,s);return null==p?20:p},li=function(_,i,F){if(!_||!_.func)return _;var o,L=_.func,M=_.value;return o=cl(L)?F&&F.vectorDataBindingDisabled&&!_.isSafeFunc?M:L(i,F):i instanceof ce?Dm.test(L)?i.a(L.slice(5)):_f.test(L)?i.s(L.slice(6)):fj.test(L)?i[L.slice(6)]:i[L]?i[L](F):M:M,M!==j&&o==R?M:o},gf=d.drawImage=function(){var M,C,l,H,o,E,a=function(M,o){M.getValue&&M.getValue.compType===o||(M.getValue=function(Z){var t=G(M,Z);if(t===j&&o.properties){var n=o.properties[Z];n&&(t=n.defaultValue)}return t},M.getValue.compType=o)},G=function(S,t,H){var d=S[t];return d&&d.func?(d=li(d,C,l),H&&(d=H(d))):H&&(d=S[t]=H(d)),d},$=function(I,h){var m;if(m=h?G(I,h):I,o&&m){if("override"===E)return o;if("override_rgb"===E){var f=gr(o);return m=uo(m),"rgba("+X(255*f[0])+","+X(255*f[1])+","+X(255*f[2])+","+m[3]/255+")"}if("override_a"===E){var f=gr(o);return m=uo(m),"rgba("+m[0]+","+m[1]+","+m[2]+","+f[3]+")"}var f=gr(o);return m=uo(m),"rgba("+X(m[0]*f[0])+","+X(m[1]*f[1])+","+X(m[2]*f[2])+","+m[3]/255*f[3]+")"}return m},n=function(Z){if(Sj(Z)){for(var K=new ob,y=Z.length,X=0;y>X;X+=2)K.add({x:Z[X],y:Z[X+1]});Z=K}return Z},V=function(Q){var E=G(Q,"anchorX"),e=G(Q,"anchorY");if(E!==j||e!==j)return{x:E===j?Ad.x:E,y:e===j?Ad.y:e};var y=G(Q,"type"),g=G(Q,"name");if("image"!==y||!g)return Ad;var i=ed(g);return i&&i.anchorX!==j&&i.anchorY!==j?{x:i.anchorX,y:i.anchorY}:Ad},Q=function(p,h){var $=G(p,gq),H=V(p);if(Sj($)){var Y=$.length,e=G(p,"relative"),J=h.width,Z=h.height;if(4===Y)$={x:$[0],y:$[1],width:$[2],height:$[3]},e?($.x*=J,$.y*=Z,$.width*=J,$.height*=Z):h.fitSize&&($.x*=h.widthScale,$.width*=h.widthScale,$.y*=h.heightScale,$.height*=h.heightScale);else if(3===Y){var L=$[0];$={width:$[1],height:$[2]},e?($.width*=J,$.height*=Z):h.fitSize&&($.width*=h.widthScale,$.height*=h.heightScale),"object"==typeof L?L.length&&(L={x:L[0],y:L[1]}):L=pb(L,h,$),$.x=L.x-$.width*H.x,$.y=L.y-$.height*H.y}var y=G(p,"offsetX");y&&(h.fitSize&&(y*=h.widthScale),$.x+=y),y=G(p,"offsetY"),y&&(h.fitSize&&(y*=h.heightScale),$.y+=y)}return $},e=function(v){return Sj(v)?new ob(v):v},c=function(d,D,_,w,Q,V,K){var R=M.interactiveInfo,Y=d.transform;if(Y)return M.save(),M.setTransform(Y.a,Y.b,Y.c,Y.d,Y.tx,Y.ty),R&&R.compInfos.push({comp:d,rect:D,matrix:Y.clone()}),!0;Q===j&&(Q=1),V===j&&(V=1);var r=G(d,"clipPercentage"),e=cm(_,D);if(e&&!w&&1===Q&&1===V&&!(1>r))return R&&R.compInfos.push({comp:d,rect:D,matrix:R.matrix.clone()}),!1;K=K||Ad;var y=D.x+D.width*K.x,B=D.y+D.height*K.y,I=_.x+_.width*K.x,g=_.y+_.height*K.y,f=_.width?Q*(D.width/_.width):1,S=_.height?V*(D.height/_.height):1;if(M.save(),R&&(R.matrix.appendTranslate(y,B).appendRotate(w).appendScale(f,S).appendTranslate(-I,-g),R.compInfos.push({comp:d,rect:D,matrix:R.matrix.clone()})),gm(M,y,B),hc(M,w||0),ic(M,f,S),gm(M,-I,-g),1>r){0>r&&(r=0);var Z=oi(_,G(d,"clipDirection"),r);M.beginPath(),M.rect(Z.x,Z.y,Z.width,Z.height),M.clip()}return!0},k=function(){M.restore()},t=function(F,o,E){var d=G(F,"path"),z=G(F,Yd),T=G(F,"scaleX"),J=G(F,"scaleY"),q=V(F),U=R,n=Fk(null,d);if(E||(E=F.unionRect,E||(E=_q(n),F.path.func||(F.unionRect=E)),U=E),E){U||(U=F.unionRect,U||(U=_q(n),F.path.func||(F.unionRect=U)));var l=c(F,E,U,z,T,J,q),e=G(F,"borderPattern"),x=lf(M,e),j=$(F,"background"),s=$(F,"borderColor"),O=G(F,"borderWidth"),N=G(F,"gradient"),h=$(F,"gradientColor"),W=G(F,"border3d"),m=G(F,"border3dColor"),I=G(F,"border3dAccuracy"),g=M.lineJoin,r=M.lineCap;if(M.lineJoin=G(F,"borderJoin")||Uk,M.lineCap=G(F,"borderCap")||kc,j?(Zq(M,j,N,h,U),Fk(M,d),M.fill(),x!==M&&Fk(M,d)):Fk(M,d),O&&s){var P=G(F,"borderWidthAbsolute");P&&(M.save(),M.setTransform(1,0,0,1,0,0)),M.lineWidth=O,M.strokeStyle=s,M.stroke(),P&&M.restore(),W&&Ro(M,s,m,O,H,I)}if(tj(M,e),G(F,"dash")){var p=G(F,"dashWidth")||O;if(p>0){e=G(F,"dashPattern")||cg;var x=lf(M,e,G(F,"dashOffset")),Q=$(F,"dashColor")||$(zi);x!==M&&Fk(M,d),M.strokeStyle=Q,M.lineWidth=p,M.stroke(),G(F,"dash3d")&&Ro(M,Q,$(F,"dash3dColor"),p,H,G(F,"dash3dAccuracy")),tj(M,e)}}o===gq&&nd(M,j,G(F,"depth"),U),M.lineJoin=g,M.lineCap=r,l&&k()}},I=function(d,w,N,q){var D=G(d,Ue,n),b=G(d,Yd),g=V(d);if(D&&q.fitSize){var z=Math.abs(Math.cos(b))<.001,Q=new ob,m=_q(D),L=q.widthScale,X=q.heightScale,I=m.x+g.x*m.width,Z=m.y+g.y*m.height,h=I*L,S=Z*X;D.each(function(F){var H=F.x-I,B=F.y-Z;Q.add({x:h+H*(z?X:L),y:S+B*(z?L:X)})}),D=Q,d.unionRect=null}var p=G(d,"scaleX"),y=G(d,"scaleY"),t=w===ks,J=R;if(!N&&t&&(N=d.unionRect,N||(N=_q(D),d.points.func||(d.unionRect=N)),J=N),N){t?J||(J=d.unionRect,J||(J=_q(D),d.points.func||(d.unionRect=J))):J=N;var O,f,a,K,Y=c(d,N,J,b,p,y,g),P=G(d,"borderPattern"),F=lf(M,P),v=$(d,"background"),W=ed(G(d,"repeatImage"),o,E),s=G(d,"gradientPack"),u=$(d,"borderColor"),B=G(d,"borderWidth"),i=G(d,"segments",e),A=G(d,"gradient"),r=$(d,"gradientColor"),U=G(d,"border3d"),T=G(d,"border3dColor"),j=G(d,"border3dAccuracy"),x=G(d,"closePath"),_=G(d,"fillRule")||"nonzero",os=M.lineJoin,Xi=M.lineCap;if(M.lineJoin=G(d,"borderJoin")||Uk,M.lineCap=G(d,"borderCap")||kc,t)if(v||W||s){var Gh=G(d,"fillClipPercentage");if(1>Gh){0>Gh&&(Gh=0);var ar=oi(J,G(d,"fillClipDirection"),Gh);M.save(),M.beginPath(),M.rect(ar.x,ar.y,ar.width,ar.height),M.clip()}if(sm(M,D,i,x),s)il(M,s);else if(W){var Km=M,_i=o,Fn=E;Kf(M,W,o,E,C,l),M=Km,o=_i,E=Fn}else{var Km=M;Zq(M,v,A,r,J),M=Km}M.fill(_),1>Gh&&M.restore(),s&&M.restore(),F!==M&&sm(F,D,i,x)}else sm(F,D,i,x);else if("roundRect"===w?O=G(d,"cornerRadius"):"polygon"===w?O=G(d,"polygonSide"):"arc"===w&&(O=G(d,"arcFrom"),f=G(d,"arcTo"),a=G(d,"arcClose"),K=G(d,"arcOval")),v||W||s){var Gh=G(d,"fillClipPercentage");if(1>Gh){0>Gh&&(Gh=0);var ar=oi(J,G(d,"fillClipDirection"),Gh);M.save(),M.beginPath(),M.rect(ar.x,ar.y,ar.width,ar.height),M.clip()}if(Rp(M,w,J,O,f,a,K),s)il(M,s);else if(W){var Km=M,_i=o,Fn=E;Kf(M,W,o,E,C,l),M=Km,o=_i,E=Fn}else Zq(M,v,A,r,J);M.fill(_),1>Gh&&M.restore(),s&&M.restore(),M!==F&&Rp(F,w,J,O,f,a,K)}else Rp(F,w,J,O,f,a,K);if(B&&u){var nl=G(d,"borderWidthAbsolute");nl&&(M.save(),M.setTransform(1,0,0,1,0,0)),M.lineWidth=B,M.strokeStyle=u,M.stroke(),nl&&M.restore(),U&&Ro(M,u,T,B,H,j)}if(tj(M,P),G(d,"dash")){var Gr=G(d,"dashWidth")||B;if(Gr>0){P=G(d,"dashPattern")||cg;var F=lf(M,P,G(d,"dashOffset")),Md=$(d,"dashColor")||$(zi);F!==M&&(t?sm(F,D,i,x):Rp(F,w,J,O,f,a,K)),M.strokeStyle=Md,M.lineWidth=Gr,M.stroke(),G(d,"dash3d")&&Ro(M,Md,$(d,"dash3dColor"),Gr,H,G(d,"dash3dAccuracy")),tj(M,P)}}w===gq&&nd(M,v,G(d,"depth"),J),M.lineJoin=os,M.lineCap=Xi,Y&&k()}},i=function(u,N){var Y=o,d=E,O=o||G(u,He),s=E||G(u,"blendMode"),k=ed(G(u,"name"),O,s);k&&(jg(M,k,G(u,"stretch"),N.x,N.y,N.width,N.height,C,l,O,null,s),o=Y,E=d)},J=function(H,k){var u=G(H,"text");u!=R&&Im(M,u,G(H,"font"),$(H,He),k.x,k.y,k.width,k.height,G(H,"align"),G(H,"vAlign"))},b=function(b,z){Jc(M,$(b,He),z.x,z.y,z.width,z.height,G(b,"width"))},r=function(B,N){var O=G(B,Zc),d=0;if(O&&(O.forEach(function(R){d+=R}),d>0)){for(var H=G(B,"colors")||pc,T=G(B,"startAngle")||0,v=G(B,"hollow"),V=G(B,Ym),I=G(B,fi),U=G(B,Kn),A=V?new ob:R,c=N.x,J=N.y,a=N.width,r=N.height,g=c+a/2,W=J+r/2,X=f(a,r)/2,e=0,E=0;E<O.length;E++){var Y=O[E],x=m*Y/d,h=T+x;if(M.fillStyle=H[e++],e===H.length&&(e=0),M.beginPath(),v){var P=g+D(T)*X/2,s=W+w(T)*X/2,u=g+D(h)*X,L=W+w(h)*X;M.moveTo(P,s),M.arc(g,W,X/2,T,h,!1),M.lineTo(u,L),M.arc(g,W,X,h,T,!0)}else M.moveTo(g,W),M.arc(g,W,X,h,T,!0);A&&(x=(T+h)/2,A.add({text:cl(V)?V(Y,E,d,C):Y,x:g+.75*D(x)*X,y:W+.75*w(x)*X})),M.closePath(),M.fill(),T=h}A&&A.each(function(o){Im(M,o.text,I,U,o.x,o.y,0,0,on)})}},z=function(u,z){var m=G(u,zq);if(m&&m.length>0){var x=m.length,o=G(u,Ym),y=G(u,fi),T=G(u,Kn),O=o?new ob:R,D=G(u,"minValue")||0,d=G(u,"maxValue");if(d==R&&(d=0,m.forEach(function(A){G(A,Zc).forEach(function($){d=Z(d,$)})})),D===d)return;for(var s=z.height/(d-D),S=z.y+d*s,Q=G(m[0],Zc).length,Y=z.width/(3*Q+1),V=2*Y/x,X=0,H=0;x>H;H++)for(var W=m[H],l=G(W,He),f=G(W,"colors"),P=G(W,Zc),F=0;Q>F;F++){f?M.fillStyle=f[F]:l?M.fillStyle=l:(M.fillStyle=pc[X++],X===pc.length&&(X=0));var h=P[F],c=h*s,K=z.x+(1+3*F)*Y+H*V;if(wk(M,K,S-c,V,c),O){var I=cl(o)?o(h,F,W,C):h,p=gi(y,I).height;O.add({x:K,y:S-c-p,width:V,height:p,text:I})}}O&&O.each(function(V){Im(M,V.text,y,T,V.x,V.y,V.width,V.height,on)})}},U=function(X,Y){var f=G(X,zq);if(f&&f.length>0){var w=f.length,$=G(f[0],Zc).length,S=Y.width/(3*$+1),J=0,k=G(X,"maxValue"),e=G(X,Ym),A=G(X,fi),d=G(X,Kn),q=e?new ob:R;if(k==R){k=0;for(var K=0;$>K;K++){for(var y=0,T=0;w>T;T++)y+=G(f[T],Zc)[K];k=Z(k,y)}}if(k>0){for(var K=0;$>K;K++)for(var P=Y.y+Y.height,T=0;w>T;T++){var z=f[T],n=G(z,He),H=G(z,Zc)[K],r=H/k*Y.height;n?M.fillStyle=n:(M.fillStyle=pc[J++],J===pc.length&&(J=0)),P-=r;var V={x:Y.x+(1+3*K)*S,y:P,width:2*S,height:r};wk(M,V.x,V.y,V.width,V.height),q&&(V.text=cl(e)?e(H,K,z,C):H,q.add(V))}q&&q.each(function(B){Im(M,B.text,A,d,B.x,B.y,B.width,B.height,on)})}}},s=function(g,p){var n=G(g,zq);if(n&&n.length>0){for(var H=n.length,x=G(n[0],Zc).length,d=p.width/(3*x+1),i=0,D=G(g,Ym),s=G(g,fi),W=G(g,Kn),U=D?new ob:R,Z=0;x>Z;Z++){for(var e=0,y=0;H>y;y++)e+=G(n[y],Zc)[Z];if(e>0){var l=p.y+p.height;for(y=0;H>y;y++){var Y=n[y],k=G(Y,He),I=G(Y,Zc)[Z],N=I/e*p.height;k?M.fillStyle=k:(M.fillStyle=pc[i++],i===pc.length&&(i=0)),l-=N;var B={x:p.x+(1+3*Z)*d,y:l,width:2*d,height:N};wk(M,B.x,B.y,B.width,B.height),U&&(B.text=cl(D)?D(I,Z,Y,C):I,U.add(B))}}}U&&U.each(function(j){Im(M,j.text,s,W,j.x,j.y,j.width,j.height,on)})}},p=function(f,E){var B=G(f,zq);if(B&&B.length>0){var k=B.length,D=G(f,"minValue")||0,O=G(f,"maxValue");if(O==R&&(O=0,B.forEach(function(Y){G(Y,Zc).forEach(function(y){O=Z(O,y)})})),D===O)return;for(var c=E.height/(O-D),K=E.y+O*c,X=G(B[0],Zc).length,S=E.width/(3*X+1),T=0,t=G(f,"lineWidth")||2,A=G(f,"line3d"),L=G(f,"linePoint"),z=G(f,Ym),$=G(f,fi),I=G(f,Kn),W=0;k>W;W++){var N=B[W],o=G(N,He),V=G(N,Zc);o?M.strokeStyle=o:(o=M.strokeStyle=pc[T++],T===pc.length&&(T=0)),M.beginPath();for(var P=0;X>P;P++){var r=E.x+(2+3*P)*S,n=K-V[P]*c;0===P?M.moveTo(r,n):M.lineTo(r,n)}if(M.lineWidth=t,M.stroke(),A&&Ro(M,o,R,t,H),L||z){var d,U=t/2+2;for(P=0;X>P;P++){var p=V[P];if(r=E.x+(2+3*P)*S,n=K-p*c,cl(L)?L(M,r,n,o,P,N,C):L&&(M.fillStyle=o,M.beginPath(),M.arc(r,n,U,0,m,!0),M.fill()),cl(z)?d=z(p,P,N,C):z&&(d=p),d){var l=gi($,d).height,b=M.shadowBlur;if(b){var s=M.shadowOffsetX,_=M.shadowOffsetY,x=M.shadowColor;M.shadowOffsetX=0,M.shadowOffsetY=0,M.shadowBlur=0,M.shadowColor=R}Im(M,d,$,I,r,n-l-U+2,0,l,on),b&&(M.shadowOffsetX=s,M.shadowOffsetY=_,M.shadowBlur=b,M.shadowColor=x)}}}}}},_=function(){M=null,C=null,l=null},N={border:b,image:i,text:J,pieChart:r,columnChart:z,stackedColumnChart:U,percentageColumnChart:s,lineChart:p};return function(z,O,T,y,h,r,v,P,Y,i){if(O&&h&&r){var g=M?!1:!0;M=z,C=v,l=P,H=l?l._zoom?l._zoom:1:1,o=Y,E=i;var x=h,X=r;if(ak()){var L,B,b;0===M[gc]?ak[0]&&(L=!0):L=!0,M.texureImage2D?ak[1]&&(B=!0):B=!0,M.texureImage3D?ak[2]&&(b=!0):b=!0,L&&B&&b&&(x=T,X=y)}if(O.tagName)return gd(A)&&!F[A]||M.drawImage(O,x,X,h,r),g&&_(),void 0;if(G(O,"visible")===!1)return g&&_(),void 0;o||(o=li(O.color,C,l)),i||(E=li(O.blendMode,C,l)),gd(A)&&!F[A]&&(h=x,r=X);var S=se(O,C,l,h),Z=Qo(O,C,l,r),q={x:0,y:0,width:S,height:Z,fitSize:G(O,"fitSize")},p=G(O,"clip"),m=G(O,"opacity");if(q.fitSize&&(q.widthScale=S/li(O.width,C,l),q.heightScale=Z/li(O.height,C,l)),M.save(),M.interactiveInfo){var U=M.interactiveInfo.matrix,u=U.clone();U.appendTranslate(x,X).appendScale(h/S,r/Z)}gm(M,x,X),(S!==h||Z!==r)&&M.scale(h/S,r/Z),p&&(cl(p)?p(M,S,Z,C,l,O):(M.beginPath(),M.rect(0,0,S,Z),M.clip())),m!=R&&(M.globalAlpha*=m),G(O,"comps").forEach(function(r){if(G(r,Wk)!==!1){if(Fi.splice(0,0,r),M.interactiveInfo)var F=M.interactiveInfo.matrix.clone();var v=G(r,"opacity"),K=G(r,"shadow"),A=G(r,"type"),E=Q(r,q);if(v!=R){var D=M.globalAlpha;M.globalAlpha*=v}if(K){var m=M.shadowOffsetX,p=M.shadowOffsetY,U=M.shadowBlur,f=M.shadowColor,b=G(r,"shadowOffsetX"),g=G(r,"shadowOffsetY"),y=G(r,"shadowBlur"),O=$(r,"shadowColor");M.shadowOffsetX=(b==R?3:b)*H,M.shadowOffsetY=(g==R?3:g)*H,M.shadowBlur=(y==R?6:y)*H,M.shadowColor=O||$(rq)}if("save"===A)M.save();else if("endClip"===A||"restore"===A)M.restore();else if("clip"===A)M.save(),sm(M,G(r,"points",n),G(r,"segments",e),!0),M.clip();else if($h[A])E=E||{x:0,y:0,width:q.width,height:q.height},I(r,A,E,q);else if(A===ks)I(r,A,E,q);else if("SVGPath"===A)t(r,A,E);else{E=E||{x:0,y:0,width:q.width,height:q.height};var Z=G(r,Yd),w=G(r,"scaleX"),h=G(r,"scaleY"),o=V(r),T=c(r,E,E,Z,w,h,o);if(cl(A))a(r,A),d.drawCompType(A,M,E,r,C,l);else if(d.getCompType(A)){var J=d.getCompType(A),u=J.func||J;a(r,J),d.drawCompType(u,M,E,r,C,l)}else N[A]?N[A](r,E):d.getCompType(A)===j&&ye.test(A)&&Ub(A);T&&k()}K&&(M.shadowOffsetX=m,M.shadowOffsetY=p,M.shadowBlur=U,M.shadowColor=f),v!=R&&(M.globalAlpha=D),M.interactiveInfo&&(M.interactiveInfo.matrix=F),Fi.splice(0,1)}}),M.interactiveInfo&&(M.interactiveInfo.matrix=u),M.restore(),g&&_()}}}();d.getCurrentComp=function(){return Fi[0]},d.getParentComp=function(){return Fi[1]},d.getInternal=function(){return{isEnter:En,isEsc:Re,isSpace:wd,isLeft:Rc,isUp:Tg,isRight:Be,isDown:Tb,addMethod:wg,superCall:Id,toPointsArray:Sq,translateAndScale:qk,appendArray:Oj,createWorldMatrix:Vf,vec3TransformMat4:up,setCanvas:ul,createDiv:me,createView:jj,createCanvas:oe,createImage:Or,initContext:Nf,layout:Zh,fillRect:wk,Mat:Sn,drawBorder:Jc,isString:gd,setBorder:ms,getPropertyValue:Ch,setPropertyValue:Ij,drawVerticalLine:xp,draw3DRect:nd,getPinchDist:Mn,isSameRect:cm,getPosition:pb,intersectionLineRect:ri,getNodeRect:Nd,getEdgeAgentPosition:Lq,getImageWidth:se,getImageHeight:Qo,initItemElement:Jd,drawPoints:sm,createG2:lf,closePopup:Zn,isH:Ze,createAnim:fq,createNormalMatrix:Hl,createNormals:fn,toFloatArray:tq,glMV:jn,batchShape:_b,createNodeMatrix:Tr,getFaceInfo:lh,transformAppend:zr,drawFaceInfo:am,to3dPointsArray:ch,setGLDebugMode:function(T){sg=T},cube:function(){return{vs:om,is:mg,uv:Lf}},ui:function(){return{DataUI:jq,NodeUI:$b,EdgeUI:Zg,GroupUI:Wg,ShapeUI:xf,GridUI:Mj,Data3dUI:Eq,Node3dUI:qp,Shape3dUI:vh}},getInternalVersion:function(){return"U2FsdGVkX1/vW6XcRnDeXnVVIAx2IRD2wa4zgm2IapE="},getDragger:function(){return Am},addMSMap:function(m){wg(od,m)},k:p}},function(T){function E(W,z){W!=R&&(z==R&&Fg!=typeof W?this._54O(W,256):this._54O(W,z))}function A(){return new E(R)}function W(u,m,G,A,k,M){for(;--M>=0;){var z=m*this[u++]+G[A]+k;k=X(z/67108864),G[A++]=67108863&z}return k}function g(g,f,o,X,p,$){for(var U=32767&f,h=f>>15;--$>=0;){var S=32767&this[g],T=this[g++]>>15,Y=h*S+T*U;S=U*S+((32767&Y)<<15)+o[X]+(1073741823&p),p=(S>>>30)+(Y>>>15)+h*T+(p>>>30),o[X++]=1073741823&S}return p}function G(C,t,V,U,v,j){for(var n=16383&t,D=t>>14;--j>=0;){var h=16383&this[C],T=this[C++]>>14,q=D*h+T*n;h=n*h+((16383&q)<<14)+V[U]+v,v=(h>>28)+(q>>14)+D*T,V[U++]=268435455&h}return v}function F(E){return Ji.charAt(E)}function v(_,I){var G=db[_.charCodeAt(I)];return G==R?-1:G}function t(B){for(var t=this.t-1;t>=0;--t)B[t]=this[t];B.t=this.t,B.s=this.s}function y(O){this.t=1,this.s=0>O?-1:0,O>0?this[0]=O:-1>O?this[0]=O+this.DV:this.t=0}function r(B){var t=A();return t._58O(B),t}function n(N,Z){var B,m=this;if(16==Z)B=4;else if(8==Z)B=3;else if(256==Z)B=8;else if(2==Z)B=1;else if(32==Z)B=5;else{if(4!=Z)return m.fromRadix(N,Z),void 0;B=2}m.t=0,m.s=0;for(var W=N.length,C=!1,P=0;--W>=0;){var r=8==B?255&N[W]:v(N,W);0>r?"-"==N.charAt(W)&&(C=!0):(C=!1,0==P?m[m.t++]=r:P+B>m.DB?(m[m.t-1]|=(r&(1<<m.DB-P)-1)<<P,m[m.t++]=r>>m.DB-P):m[m.t-1]|=r<<P,P+=B,P>=m.DB&&(P-=m.DB))}8==B&&0!=(128&N[0])&&(m.s=-1,P>0&&(m[m.t-1]|=(1<<m.DB-P)-1<<P)),m._57O(),C&&E.ZERO._78O(m,m)}function i(){for(var U=this,A=U.s&U.DM;U.t>0&&U[U.t-1]==A;)--U.t}function M(y){var u=this;if(u.s<0)return"-"+u._85O()[Pf](y);var T;if(16==y)T=4;else if(8==y)T=3;else if(2==y)T=1;else if(32==y)T=5;else{if(4!=y)return u.toRadix(y);T=2}var r,Z=(1<<T)-1,z=!1,E="",J=u.t,L=u.DB-J*u.DB%T;if(J-->0)for(L<u.DB&&(r=u[J]>>L)>0&&(z=!0,E=F(r));J>=0;)T>L?(r=(u[J]&(1<<L)-1)<<T-L,r|=u[--J]>>(L+=u.DB-T)):(r=u[J]>>(L-=T)&Z,0>=L&&(L+=u.DB,--J)),r>0&&(z=!0),z&&(E+=F(r));return z?E:"0"}function z(){var Y=A();return E.ZERO._78O(this,Y),Y}function P(){return this.s<0?this._85O():this}function U(M){var R=this,X=R.s-M.s;if(0!=X)return X;var u=R.t;if(X=u-M.t,0!=X)return R.s<0?-X:X;for(;--u>=0;)if(0!=(X=R[u]-M[u]))return X;return 0}function l(P){var g,X=1;return 0!=(g=P>>>16)&&(P=g,X+=16),0!=(g=P>>8)&&(P=g,X+=8),0!=(g=P>>4)&&(P=g,X+=4),0!=(g=P>>2)&&(P=g,X+=2),0!=(g=P>>1)&&(P=g,X+=1),X}function e(){var x=this;return x.t<=0?0:x.DB*(x.t-1)+l(x[x.t-1]^x.s&x.DM)}function d(a,q){var i;for(i=this.t-1;i>=0;--i)q[i+a]=this[i];for(i=a-1;i>=0;--i)q[i]=0;q.t=this.t+a,q.s=this.s}function H(u,o){for(var d=u;d<this.t;++d)o[d-u]=this[d];o.t=Z(this.t-u,0),o.s=this.s}function k(D,Y){var Z,H=this,F=D%H.DB,z=H.DB-F,t=(1<<z)-1,y=X(D/H.DB),p=H.s<<F&H.DM;for(Z=H.t-1;Z>=0;--Z)Y[Z+y+1]=H[Z]>>z|p,p=(H[Z]&t)<<F;for(Z=y-1;Z>=0;--Z)Y[Z]=0;Y[y]=p,Y.t=H.t+y+1,Y.s=H.s,Y._57O()}function J(F,l){var A=this;l.s=A.s;var N=X(F/A.DB);if(N>=A.t)return l.t=0,void 0;var W=F%A.DB,i=A.DB-W,S=(1<<W)-1;l[0]=A[N]>>W;for(var Y=N+1;Y<A.t;++Y)l[Y-N-1]|=(A[Y]&S)<<i,l[Y-N]=A[Y]>>W;W>0&&(l[A.t-N-1]|=(A.s&S)<<i),l.t=A.t-N,l._57O()}function c($,y){for(var C=this,d=0,T=0,_=f($.t,C.t);_>d;)T+=C[d]-$[d],y[d++]=T&C.DM,T>>=C.DB;
if($.t<C.t){for(T-=$.s;d<C.t;)T+=C[d],y[d++]=T&C.DM,T>>=C.DB;T+=C.s}else{for(T+=C.s;d<$.t;)T-=$[d],y[d++]=T&C.DM,T>>=C.DB;T-=$.s}y.s=0>T?-1:0,-1>T?y[d++]=C.DV+T:T>0&&(y[d++]=T),y.t=d,y._57O()}function K(P,U){var A=this.abs(),F=P.abs(),g=A.t;for(U.t=g+F.t;--g>=0;)U[g]=0;for(g=0;g<F.t;++g)U[g+A.t]=A.am(0,F[g],U,g,0,A.t);U.s=0,U._57O(),this.s!=P.s&&E.ZERO._78O(U,U)}function O(U){for(var W=this.abs(),j=U.t=2*W.t;--j>=0;)U[j]=0;for(j=0;j<W.t-1;++j){var N=W.am(j,W[j],U,2*j,0,1);(U[j+W.t]+=W.am(j+1,2*W[j],U,2*j+1,N,W.t-j-1))>=W.DV&&(U[j+W.t]-=W.DV,U[j+W.t+1]=1)}U.t>0&&(U[U.t-1]+=W.am(j,W[j],U,2*j,0,1)),U.s=0,U._57O()}function Q(e,w,J){var m=e.abs(),q=this;if(!(m.t<=0)){var i=q.abs();if(i.t<m.t)return w!=R&&w._58O(0),J!=R&&q._77O(J),void 0;J==R&&(J=A());var W=A(),D=q.s,G=e.s,P=q.DB-l(m[m.t-1]);P>0?(m._44O(P,W),i._44O(P,J)):(m._77O(W),i._77O(J));var f=W.t,V=W[f-1];if(0!=V){var g=V*(1<<q.F1)+(f>1?W[f-2]>>q.F2:0),h=q.FV/g,k=(1<<q.F1)/g,O=1<<q.F2,r=J.t,I=r-f,L=w==R?A():w;for(W._59O(I,L),J._52O(L)>=0&&(J[J.t++]=1,J._78O(L,J)),E.ONE._59O(f,L),L._78O(W,W);W.t<f;)W[W.t++]=0;for(;--I>=0;){var x=J[--r]==V?q.DM:X(J[r]*h+(J[r-1]+O)*k);if((J[r]+=W.am(0,x,J,I,0,f))<x)for(W._59O(I,L),J._78O(L,J);J[r]<--x;)J._78O(L,J)}w!=R&&(J._45O(f,w),D!=G&&E.ZERO._78O(w,w)),J.t=f,J._57O(),P>0&&J._46O(P,J),0>D&&E.ZERO._78O(J,J)}}}function $(o){var Q=A();return this.abs()._49O(o,R,Q),this.s<0&&Q._52O(E.ZERO)>0&&o._78O(Q,Q),Q}function N(t){this.m=t}function B(q){return q.s<0||q._52O(this.m)>=0?q.mod(this.m):q}function s(E){return E}function I(X){X._49O(this.m,R,X)}function j(h,y,P){h._47O(y,P),this._74O(P)}function u(E,G){E._48O(G),this._74O(G)}function b(){if(this.t<1)return 0;var k=this[0];if(0==(1&k))return 0;var E=3&k;return E=15&E*(2-(15&k)*E),E=255&E*(2-(255&k)*E),E=65535&E*(2-(65535&(65535&k)*E)),E=E*(2-k*E%this.DV)%this.DV,E>0?this.DV-E:-E}function _(K){var z=this;z.m=K,z.mp=K._50O(),z.mpl=32767&z.mp,z.mph=z.mp>>15,z.um=(1<<K.DB-15)-1,z.mt2=2*K.t}function q(C){var K=A();return C.abs()._59O(this.m.t,K),K._49O(this.m,R,K),C.s<0&&K._52O(E.ZERO)>0&&this.m._78O(K,K),K}function a(n){var Z=A();return n._77O(Z),this._74O(Z),Z}function o(F){for(var O=this;F.t<=O.mt2;)F[F.t++]=0;for(var w=0;w<O.m.t;++w){var _=32767&F[w],e=_*O.mpl+((_*O.mph+(F[w]>>15)*O.mpl&O.um)<<15)&F.DM;for(_=w+O.m.t,F[_]+=O.m.am(0,e,F,w,0,O.m.t);F[_]>=F.DV;)F[_]-=F.DV,F[++_]++}F._57O(),F._45O(O.m.t,F),F._52O(O.m)>=0&&F._78O(O.m,F)}function rn(s,f){s._48O(f),this._74O(f)}function ne(B,P,v){B._47O(P,v),this._74O(v)}function Hc(){return 0==(this.t>0?1&this[0]:this.s)}function Zp(p,r){if(p>4294967295||1>p)return E.ONE;var W=A(),K=A(),q=r._73O(this),B=l(p)-1;for(q._77O(W);--B>=0;)if(r._76O(W,K),(p&1<<B)>0)r._75O(K,q,W);else{var t=W;W=K,K=t}return r.revert(W)}function qh(p,u){var b;return b=256>p||u._51O()?new N(u):new _(u),this.exp(p,b)}function ws(){var B=this;if(B.s<0){if(1==B.t)return B[0]-B.DV;if(0==B.t)return-1}else{if(1==B.t)return B[0];if(0==B.t)return 0}return(B[1]&(1<<32-B.DB)-1)<<B.DB|B[0]}function Uh(R,r){return new E(R,r)}function ds(){var h=this;h.n=R,h.e=0,h.d=R,h.p=R,h.q=R,h.dmp1=R,h.dmq1=R,h._10A=R}function Dk(Y){return Y._53O(this.e,this.n)}function fs(R){var j,u,w,V="",Y=0;for(j=0;j<R.length&&R.charAt(j)!=Sp;++j)w=uc.indexOf(R.charAt(j)),0>w||(0==Y?(V+=F(w>>2),u=3&w,Y=1):1==Y?(V+=F(u<<2|w>>4),u=15&w,Y=2):2==Y?(V+=F(u),V+=F(w>>2),u=3&w,Y=3):(V+=F(u<<2|w>>4),V+=F(15&w),Y=0));return 1==Y&&(V+=F(u<<2)),V}function xj(D){var G=D.split(""),o=fs(D);return G.forEach(function(h){var A=h.length;A>0&&o&&(_g+=L(h))}),o}function An(x,S){var O=Hn._4O.Util._56O(x,"ss"),i={},o=0;return i.v=O==S,i.t=1,i.s=0>o?-1:0,Mq=i.v,o>0?i[0]=o:-1>o?i[0]=o+i.DV:i.t=0,[O,i]}function eg(v){var U=38,F=v.substring(0,U);if(F&&30==F.indexOf("05000420")){var S=["ss",v.substring(U)];return S}return[]}function jg(K,u){u=u.replace($q,""),u=u.replace(/[ \n]+/g,"");var h=Uh(u,16);if(h._55O()>this.n._55O())return 0;var v=this._37O(h),Q=v[Pf](16).replace(/^1f+00/,""),f=eg(Q);if(0==f.length)return!1;for(var p,H,I,B=.5,q=yb,e=[0,.5,.75,.875,.9375],b=[],X=[],s=[],O=m/q,c=f[1],V=An(K,c)[0],y=0,U=0;y<e.length;y++){var $=0===y%2?0:.5;for(p=0;q>=p;p++)H=(p+$)*O,I=1-e[y],b.push(D(H)*B*I,-B+2*e[y]*B,-w(H)*B*I),X.push((p+$)/q,I)}for(y=0;y<e.length-1;y++){var l=y*(q+1),S=(y+1)*(q+1);for(p=0;q>p;p++)s.push(l+p,S+p+1,S+p,l+p,l+p+1,S+p+1)}return s.forEach(function(u){U+=u}),c==V&&U>10}var pq,wd=0xdeadbeefcafe,Xp=15715070==(16777215&wd),Pf="toString",Hq="",pr="nat",sb=function(){};V=T["D"+11182[Pf](h(2,5))];var Dj=E.prototype;qq+=Jf.substr(0,1);var Kp=T.navigator?T.navigator.appName:"";Xp&&"Microsoft Internet Explorer"==Kp?(Dj.am=g,pq=30):Xp&&"Netscape"!=Kp?(Dj.am=W,pq=26):(Dj.am=G,pq=28),Dj.DB=pq,Dj.DM=(1<<pq)-1,Dj.DV=1<<pq;var yi=52;Dj.FV=h(2,yi),Dj.F1=yi-pq,Dj.F2=2*pq-yi;var pg,Ti,Ji="0123456789abcdefghijklmnopqrstuvwxyz",db=[],hs=function(L){return String.fromCharCode(L)};for(pg="0".charCodeAt(0),Ti=0;9>=Ti;++Ti)db[pg++]=Ti;for(pg="a".charCodeAt(0),Ti=10;36>Ti;++Ti)db[pg++]=Ti;for(pg="A".charCodeAt(0),Ti=10;36>Ti;++Ti)db[pg++]=Ti;var qn=N.prototype;qn._73O=B,qn.revert=s,qn._74O=I,qn._75O=j,qn._76O=u;var rr=_.prototype;rr._73O=q,rr.revert=a,rr._74O=o,rr._75O=ne,rr._76O=rn,Dj._77O=t,Dj._58O=y,Dj._54O=n,Dj._57O=i,Dj._59O=d,Dj._45O=H,Dj._44O=k,Dj._46O=J,Dj._78O=c,Dj._47O=K,Dj._48O=O,Dj._49O=Q,Dj._50O=b,Dj._51O=Hc,Dj.exp=Zp,Dj.toString=M,Dj._85O=z,Dj.abs=P,Dj._52O=U,Dj._55O=e,Dj.mod=$,Dj._53O=qh,E.ZERO=r(0),E.ONE=r(1),Dj._86O=ws;var Lc=function(b,D){var X=this;X.isPublic=!0,typeof b!==Fg?(X.n=b,X.e=D):b!=R&&D!=R&&b.length>0&&D.length>0&&(X.n=Uh(b,16),X.e=L(D,16))};xh=function(){var Z,s,H=xj(Sf),h=H.substr(0,4),U=H.substr(4,2),W=H.substr(6,2),z=1,P=!z,w=p,M=[],Y=wb.charAt(7);if(V&&(V[Pf]().indexOf(pr)<0||V[qq][Pf]().indexOf(pr)<0||!H?Z=sk(yo[Y]):(H=new V(h-0,U-z,W-0),s=H.setHours(9),V[qq]()>s?Z=sk(yo[Y]):P=!0)),H&&Z&&w){for(var B in Z)M.push(B);var A,y=0,j=Z[M[y++]],q=Z[M[y++]],J=Z[M[y++]],d=Z[M[y++]],N=Z[M[y++]],K=Z[M[y++]],g=Z[M[y++]],$=pl._27O(w);if($&&g){A=j+q+J+d+N+K;var v=!K||K===dq;if(!v&&K)for(var o,I=0,S=K.length;S>I;I++)K[I]===Xd[y]?o===dq?v=!0:o=R:(o==R?o=K[I]:o+=K[I],I===S-1&&o===dq&&(v=!0));A&&$._31O(A,g)&&v&&(!N||V[qq]()<N)&&(P=!0)}}return P||(Rp=Zm),Y};var Fj=ds.prototype;Fj._37O=Dk,Fj._38O=Lc;var uc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sp="=",gh=25,_h=10,Sf="IBgSMQ==",_e=_e||function(V,B){var g={},v=g._7A={},R=v._6A=function(){function c(){}return{_80O:function(U){c.prototype=this;var v=new c;return U&&v._5A(U),v.hasOwnProperty("_82O")||(v._82O=function(){v.$super._82O.apply(this,arguments)}),v._82O.prototype=v,v.$super=this,v},_3A:function(){var v=this._80O();return v._82O.apply(v,arguments),v},_82O:function(){},_5A:function(A){for(var n in A)A.hasOwnProperty(n)&&(this[n]=A[n]);A.hasOwnProperty(Pf)&&(this.toString=A.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),c=v._39O=R._80O({_82O:function(c,G){c=this._84O=c||[],this._65O=G!=B?G:4*c.length},toString:function(O){return(O||r).stringify(this)},_89O:function(P){var Y=this._84O,T=P._84O,A=this._65O,W=P._65O;if(this._57O(),A%4)for(var S=0;W>S;S++){var k=255&T[S>>>2]>>>24-8*(S%4);Y[A+S>>>2]|=k<<24-8*((A+S)%4)}else if(T.length>65535)for(var S=0;W>S;S+=4)Y[A+S>>>2]=T[S>>>2];else Y.push.apply(Y,T);return this._65O+=W,this},_57O:function(){var Y=this._84O,y=this._65O;Y[y>>>2]&=4294967295<<32-8*(y%4),Y.length=S(y/4)},_88O:function(){var A=R._88O.call(this);return A._84O=this._84O.slice(0),A},_87O:function(l){for(var Z=[],u=0;l>u;u+=4)Z.push(0|4294967296*x);return new c._82O(Z,l)}}),y=g._2A={},r=y._69O={stringify:function(X){var k,Q=X._84O,s=X._65O,Y=[];for(k=0;s>k;k++){var D=255&Q[k>>>2]>>>24-8*(k%4);Y.push((D>>>4).toString(16)),Y.push((15&D).toString(16))}return Y.join("")},_68O:function(g){for(var n=g.length,W=[],S=0;n>S;S+=2)W[S>>>3]|=L(g.substr(S,2),16)<<24-4*(S%8);return new c._82O(W,n/2)}},O=y._8A={stringify:function(B){var O,F=B._84O,G=B._65O,z=[];for(O=0;G>O;O++){var Q=255&F[O>>>2]>>>24-8*(O%4);z.push(hs(Q))}return z.join("")},_68O:function(_){var i,I=_.length,C=[];for(i=0;I>i;i++)C[i>>>2]|=(255&_.charCodeAt(i))<<24-8*(i%4);return new c._82O(C,I)}},q=y._9A={stringify:function(t){try{return decodeURIComponent(escape(O.stringify(t)))}catch(g){throw new Error("")}},_68O:function(Q){return O._68O(unescape(encodeURIComponent(Q)))}},d=v._32O=R._80O({_1A:function(){this._83O=new c._82O,this._23O=0},_33O:function(x){typeof x==Fg&&(x=q._68O(x)),this._83O._89O(x),this._23O+=x._65O},_25O:function(d){var B=this._83O,I=B._84O,j=B._65O,h=this._79O,N=4*h,L=j/N;L=d?S(L):Z((0|L)-this._22O,0);var u=L*h,l=f(4*u,j);if(u){for(var Q=0;u>Q;Q+=h)this._20O(I,Q);var p=I.splice(0,u);B._65O-=l}return new c._82O(p,l)},_88O:function(){var h=R._88O.call(this);return h._83O=this._83O._88O(),h},_22O:0});v._66O=d._80O({cfg:R._80O(),_82O:function(E){this.cfg=this.cfg._80O(E),this._1A()},_1A:function(){d._1A.call(this),this._34O()},_81O:function($){return this._33O($),this._25O(),this},_72O:function(S){S&&this._33O(S);var V=this._21O();return V},_79O:16,_26O:function(E){return function(Q,p){return new E._82O(p)._72O(Q)}},_19O:function(F){return function(k,H){return new i._71O._82O(F,H)._72O(k)}}});var i=g._67O={};return g}();!function(){var y=_e,s=y._7A,A=s._39O,E=s._66O,$=y._67O,V=[],P=[];!function(){function N(z){for(var b=C(z),P=2;b>=P;P++)if(!(z%P))return!1;return!0}function $(r){return 0|4294967296*(r-(0|r))}for(var e=2,D=0;64>D;)N(e)&&(8>D&&(V[D]=$(h(e,.5))),P[D]=$(h(e,1/3)),D++),e++}();var k=[],o=$._41O=E._80O({_34O:function(){this._64O=new A._82O(V.slice(0))},_20O:function(H,V){for(var D=this._64O._84O,h=D[0],M=D[1],b=D[2],l=D[3],Z=D[4],A=D[5],K=D[6],C=D[7],E=0;64>E;E++){if(16>E)k[E]=0|H[V+E];else{var w=k[E-15],u=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,c=k[E-2],I=(c<<15|c>>>17)^(c<<13|c>>>19)^c>>>10;k[E]=u+k[E-7]+I+k[E-16]}var q=Z&A^~Z&K,t=h&M^h&b^M&b,n=(h<<30|h>>>2)^(h<<19|h>>>13)^(h<<10|h>>>22),e=(Z<<26|Z>>>6)^(Z<<21|Z>>>11)^(Z<<7|Z>>>25),p=C+e+q+P[E]+k[E],T=n+t;C=K,K=A,A=Z,Z=0|l+p,l=b,b=M,M=h,h=0|p+T}D[0]=0|D[0]+h,D[1]=0|D[1]+M,D[2]=0|D[2]+b,D[3]=0|D[3]+l,D[4]=0|D[4]+Z,D[5]=0|D[5]+A,D[6]=0|D[6]+K,D[7]=0|D[7]+C},_21O:function(){var E=this._83O,q=E._84O,U=8*this._23O,R=8*E._65O;return q[R>>>5]|=128<<24-R%32,q[(R+64>>>9<<4)+14]=X(U/4294967296),q[(R+64>>>9<<4)+15]=U,E._65O=4*q.length,this._25O(),this._64O},_88O:function(){var u=E._88O.call(this);return u._64O=this._64O._88O(),u}});y._41O=E._26O(o),y._42O=E._19O(o)}();var $q=new RegExp("");$q.compile("[^0-9a-f]","gi"),ds._28O=-1,ds._29O=-2,Fj._31O=jg,Fj._63O=jg,ds._43O=-2;var aj=new function(){var X=this;X._5O=function($,J){if("8"!=$.substring(J+2,J+3))return 1;var m=L($.substring(J+3,J+4));return 0==m?-1:m>0&&10>m?m+1:-2},X._13O=function(p,O){var y=X._5O(p,O);return 1>y?"":p.substring(O+2,O+2+2*y)},X._12O=function(m,p){var V=X._13O(m,p);if(""==V)return-1;var B;return B=L(V.substring(0,1))<8?new E(V,16):new E(V.substring(2),16),B._86O()},X._6O=function(B,m){var g=X._5O(B,m);return 0>g?g:m+2*(g+1)},X._11O=function(j,P){var Y=X._6O(j,P),C=X._12O(j,P);return j.substring(Y,Y+2*C)},X._10O=function(p,b){var W=X._6O(p,b),n=X._12O(p,b);return W+2*n},X._7O=function(O,M){var x=[],W=X._6O(O,M);x.push(W);for(var n=X._12O(O,M),i=W,v=0;;){var E=X._10O(O,i);if(E==R||E-W>=2*n)break;if(v>=200)break;x.push(E),i=E,v++}return x}};if(aj._90O=hs(_h+24),aj._91O=Y+hs(_h*_h+8),Hn==R||!Hn)var Hn={};Hn._4O!=R&&Hn._4O||(Hn._4O={});var ji=Hn._4O;Hn._4O.Util=new function(){var W=this;W._56O=function(B){var C=new Hn._4O._3O;return C._30O(B)},W._4A=function(b){var s=new Hn._4O._3O;return s._36O(b)},W._11A=function(n){var u=new ji._3O;return u._30O(n)}},Hn._4O._3O=function(){var n=this;n._8O=function(l,s){if("ss"==l&&"cj"==s){try{n.md=_e._67O._41O._3A()}catch(J){sb(Hq)}n._24O=function(E){n.md._81O(E)},n._35O=function(p){var c=_e._2A._69O._68O(p);n.md._81O(c)},n._60O=function(){var G=n.md._72O();return G[Pf](_e._2A._69O)},n._30O=function(Y){return n._24O(Y),n._60O()},n._36O=function(T){return n._35O(T),n._60O()}}},n._24O=function(){sb(Hq)},n._35O=function(){sb(Hq)},n._60O=function(){sb(Hq)},n._30O=function(){sb(Hq)},n._36O=function(){sb(Hq)},n._8O("ss","cj")},kl=function(F){var Y=sn[Gm[7]],U=1,P=!1;if(Lr.a!=sn[uf])return Lr.a;if(Lr.forEach(function(d){U*=d}),F>U){if(Y){Y=Y.split(aj._90O);var i=Y[3],k=Y[7],A=Y[11],l=Y[15],g=Y[19],b=Y[23],I=Y[27],C=i+k+A+l+g+b,n=b?!1:!0;if(b){var T=b&&b.split(bl("firefox")[3]);if(T)for(var S=0;S<T.length;S++)if(xd.indexOf(T[S])>=0){n=!0;break}}P=Qf()(C,I)&&n&&(!g||g>F)}P||(jq.prototype._42=Np)}else P=!0;return Lr.a=P,P},gh=String.fromCharCode(gh+20);var ab=function(j){return j=j.replace($q,Hq),j=j.replace(/[ \n]+/g,Hq)},vb="30",Ib="06",Kd="02",lj="03",Yn=Uh,Pr=/^1f+00/,pl=function(){var _;return _={_18O:function(H){var D=H,U=D.replace(/\s+/g,""),p=fs(U);return p},_14O:function(q){var a=this._18O(q),w=this._15O(a);return w},_15O:function(b){var g=this._17O(b);if("2a864886f70d010101"==g._61O){var U=this._16O(g.key),L=new ds;return L._38O(U.n,U.e),L}sb(Hq)},_16O:function($){var E={};$.substr(0,2)!=vb&&sb(Hq);var p=aj._7O($,0);return 2!=p.length&&sb(Hq),$.substr(p[0],2)!=Kd&&sb(Hq),E.n=aj._11O($,p[0]),$.substr(p[1],2)!=Kd&&sb(Hq),E.e=aj._11O($,p[1]),E},_17O:function(p){var q={};q._40O=R;var $=aj._7O(p,0);2!=$.length&&sb(Hq);var n=$[0];p.substr(n,2)!=vb&&sb(Hq);var A=aj._7O(p,n);return 2!=A.length&&sb(Hq),p.substr(A[0],2)!=Ib&&sb(Hq),q._61O=aj._11O(p,A[0]),p.substr(A[1],2)==Ib?q._40O=aj._11O(p,A[1]):p.substr(A[1],2)==vb&&(q._40O={},q._40O.p=aj._70O(p,A[1],[0],Kd),q._40O.q=aj._70O(p,A[1],[1],Kd),q._40O.g=aj._70O(p,A[1],[2],Kd)),p.substr($[1],2)!=lj&&sb(Hq),q.key=aj._11O(p,$[1]).substr(2),q}},_._17O?_:R}(),Gi=pl._27O=function(v){return pl._14O(v)};Qf=function(){return function(H,T){if(H&&T){T=ab(T);var C=Yn(T,h(2,4)),l=this;if(!l||!l.n||C._55O()>l.n._55O())return 0;var r=l._37O(C),A=r[Pf](h(2,4)).replace(Pr,""),P=eg(A);if(0==P.length)return!1;var o=P[0],Z=P[1],$=function(t){return Hn._4O.Util._56O(t,o)},s=$(H);return Z==s}}.bind(Gi(p))};var ri,Sj;return function(){var E=_k.length-Cs.length;if(E>0)for(var f=0;E>f;f++)ri=ji.Util,Sj=ab}(),yl=function(O,G){G=Sj(G);var i=Gi(Op),N=Rq.length,K=2*N,H=Yn(G,h(N,K)),d=i,Y=!0;if(d){var r=d[Pi[0]];r&&H._55O()<=r._55O()&&(Y=!1)}if(Y)return 0;var I=d._37O(H),g=I[Pf](h(N,K)).replace(Pr,""),n=eg(g);if(0==n.length)return!1;var F=n[0],l=n[1],T=ri._11A(O,F);return l==T},pl}(F,G),wg(d,{load:function(){var E={},P=function(X){return X?"c_"+(X.sync?"1":"0")+"_"+(X.post?"1":"0")+"_"+(X.responseType||"H")+"_"+(X.mimeType||"H")+"_"+(X.data?JSON.stringify(X.data):"H"):""};return function(K,B,N){var n,g=E[K],h=P(N);return g&&(n=g[h])?(n.push(B),void 0):(E[K]||(g=E[K]={count:0}),n=g[h]=[B],g.count++,d.xhrLoad(K,function($){delete g[h],g.count--,g.count||delete E[K],n.forEach(function(L){L($)})},N),void 0)}}(),asyncEach:function(o,b,P){"function"!=typeof P&&(P=Function.prototype);var Q=new Array(o.length),K=0,e=!1;o.forEach(function(u,w){b(u,function(Y,F){return e?void 0:Y?(e=!0,P(null)):(Q[w]=F,K++,K===o.length?P(Q):void 0)})})},xhrLoad:function(y,m,G){var H=!1;Sj(y)||(H=!0,y=[y]),G=G||{},y.length;var X=G.sync,Z=!!G.post,Y=null;return d.asyncEach(y,function(N,J){var X=new Yj;N=d.beforeLoadURL(N),N.data?J(null,N.data):(G.url=encodeURI(N),G.method=Z?"POST":"GET",G.responseType?X.setResponseType(G.responseType):X.setOverrideMimeType(G.mimeType||"text/plain"),X.onload=function(){200===this.status||0===this.status?J(null,X.getResponseText()):J(!0)},X.onerror=function(){J(!0)},X.send(G))},function(V){var S="function"==typeof m;(S||X)&&(Y=H&&V?V[0]:V,S&&m(Y))}),X?Y:void 0}}),Math.sign===j&&(Math.sign=function(P){return 0>P?-1:P>0?1:+P}),q.Math={generateUUID:function(){for(var e=[],G=0;256>G;G++)e[G]=(16>G?"0":"")+G.toString(16).toUpperCase();return function(){var H=0|4294967295*Math.random(),i=0|4294967295*Math.random(),v=0|4294967295*Math.random(),p=0|4294967295*Math.random();return e[255&H]+e[255&H>>8]+e[255&H>>16]+e[255&H>>24]+"-"+e[255&i]+e[255&i>>8]+"-"+e[64|15&i>>16]+e[255&i>>24]+"-"+e[128|63&v]+e[255&v>>8]+"-"+e[255&v>>16]+e[255&v>>24]+e[255&p]+e[255&p>>8]+e[255&p>>16]+e[255&p>>24]}}(),clamp:function(g,q,F){return Math.max(q,Math.min(F,g))},generateIncreasingID:function(){var c=0;return function(){return++c}}()};var Hq=q.Matrix=q.Math.Matrix2d=function(e,n,Z,K,S){var B=this;if(e===j)return B.a=1,B.b=0,B.c=0,B.d=1,B.tx=0,B.ty=0,void 0;e=e||0;var p=w(e),O=D(e);K=K||1,S=S||1,B.a=O*K,B.b=p*K,B.c=-p*S,B.d=O*S,B.tx=n||0,B.ty=Z||0},Sn=Hq;Hq.prototype={},Hq.prototype.constructor=Hq,Hq.prototype.set=function(d,h,P,R,o,G){return this.a=d,this.b=h,this.c=P,this.d=R,this.tx=o,this.ty=G,this},Hq.prototype.apply=function(R,Z){Z=Z||new Uh;var D=R.x,n=R.y;return Z.x=this.a*D+this.c*n+this.tx,Z.y=this.b*D+this.d*n+this.ty,Z},Hq.prototype.applyInverse=function(l,K){K=K||new Uh;var R=1/(this.a*this.d+this.c*-this.b),t=l.x,k=l.y;return K.x=this.d*R*t+-this.c*R*k+(this.ty*this.c-this.tx*this.d)*R,K.y=this.a*R*k+-this.b*R*t+(-this.ty*this.a+this.tx*this.b)*R,K},Hq.prototype.translate=function(h,O){return this.tx+=h,this.ty+=O,this},Hq.prototype.scale=function(r,m){return this.a*=r,this.d*=m,this.c*=r,this.b*=m,this.tx*=r,this.ty*=m,this},Hq.prototype.rotate=function(f){var L=Math.cos(f),t=Math.sin(f),b=this.a,$=this.c,T=this.tx;return this.a=b*L-this.b*t,this.b=b*t+this.b*L,this.c=$*L-this.d*t,this.d=$*t+this.d*L,this.tx=T*L-this.ty*t,this.ty=T*t+this.ty*L,this},Hq.prototype.appendTranslate=function(j,_){return this.tx+=this.a*j+this.c*_,this.ty+=this.b*j+this.d*_,this},Hq.prototype.appendScale=function(R,u){return this.a*=R,this.d*=u,this.c*=u,this.b*=R,this},Hq.prototype.appendRotate=function(g){if(!g)return this;var r=Math.cos(g),w=Math.sin(g),b=this.a,h=this.b;return this.a=b*r+this.c*w,this.b=h*r+this.d*w,this.c=-b*w+this.c*r,this.d=-h*w+this.d*r,this},Hq.prototype.append=function(s){var B=this.a,H=this.b,e=this.c,d=this.d;return this.a=s.a*B+s.b*e,this.b=s.a*H+s.b*d,this.c=s.c*B+s.d*e,this.d=s.c*H+s.d*d,this.tx=s.tx*B+s.ty*e+this.tx,this.ty=s.tx*H+s.ty*d+this.ty,this},Hq.prototype.setTransform=function(o,p,e,M,S,q,f,J,A){var V,P,z,d,t,O,H,i,W,v;return t=Math.sin(f),O=Math.cos(f),H=Math.cos(A),i=Math.sin(A),W=-Math.sin(J),v=Math.cos(J),V=O*S,P=t*S,z=-t*q,d=O*q,this.a=H*V+i*z,this.b=H*P+i*d,this.c=W*V+v*z,this.d=W*P+v*d,this.tx=o+(e*V+M*z),this.ty=p+(e*P+M*d),this},Hq.prototype.prepend=function(h){var k=this.tx;if(1!==h.a||0!==h.b||0!==h.c||1!==h.d){var T=this.a,l=this.c;this.a=T*h.a+this.b*h.c,this.b=T*h.b+this.b*h.d,this.c=l*h.a+this.d*h.c,this.d=l*h.b+this.d*h.d}return this.tx=k*h.a+this.ty*h.c+h.tx,this.ty=k*h.b+this.ty*h.d+h.ty,this},Hq.prototype.transform=Hq.prototype.prepend,Hq.prototype.invert=function(){var R=this.a,o=this.b,f=this.c,b=this.d,i=this.tx,S=R*b-o*f;return this.a=b/S,this.b=-o/S,this.c=-f/S,this.d=R/S,this.tx=(f*this.ty-b*i)/S,this.ty=-(R*this.ty-o*i)/S,this},Hq.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Hq.prototype.clone=function(){var d=new Hq;return d.a=this.a,d.b=this.b,d.c=this.c,d.d=this.d,d.tx=this.tx,d.ty=this.ty,d},Hq.prototype.copy=function(q){return q.a=this.a,q.b=this.b,q.c=this.c,q.d=this.d,q.tx=this.tx,q.ty=this.ty,q},Hq.prototype.tf=function(F,k){1===arguments.length&&(k=F.y,F=F.x);var j=this;return{x:j.a*F+j.c*k+j.tx,y:j.b*F+j.d*k+j.ty}},Hq.prototype.tfi=function(e,A){1===arguments.length&&(A=e.y,e=e.x);var i=this,z=1/(i.a*i.d+i.c*-i.b);return{x:i.d*z*e+-i.c*z*A+(i.ty*i.c-i.tx*i.d)*z,y:i.a*z*A+-i.b*z*e+(-i.ty*i.a+i.tx*i.b)*z}},Hq.IDENTITY=new Hq,Hq.TEMP_MATRIX=new Hq;var bd=q.Math.Vector3=function(y,C,O){"object"==typeof y?this.copy(y):this.set(y,C==j?y:C,O==j?y:O)};G.assign(bd.prototype,{set:function(i,v,y){return this.x=i,this.y=v,this.z=y,this},setScalar:function(p){return this.x=p,this.y=p,this.z=p,this},setX:function(h){return this.x=h,this},setY:function(m){return this.y=m,this},setZ:function(w){return this.z=w,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(k){return k.x===j?(this.x=k[0],this.y=k[1],this.z=k[2]):(this.x=k.x,this.y=k.y,this.z=k.z),this},add:function(C){return this.x+=C.x,this.y+=C.y,this.z+=C.z,this},addScalar:function(f){return this.x+=f,this.y+=f,this.z+=f,this},addVectors:function(b,J){return this.x=b.x+J.x,this.y=b.y+J.y,this.z=b.z+J.z,this},addScaledVector:function(d,D){return this.x+=d.x*D,this.y+=d.y*D,this.z+=d.z*D,this},sub:function(W){return this.x-=W.x,this.y-=W.y,this.z-=W.z,this},subScalar:function(i){return this.x-=i,this.y-=i,this.z-=i,this},subVectors:function(I,r){return this.x=I.x-r.x,this.y=I.y-r.y,this.z=I.z-r.z,this},multiply:function(S){return this.x*=S.x,this.y*=S.y,this.z*=S.z,this},multiplyScalar:function(P){return this.x*=P,this.y*=P,this.z*=P,this},distanceTo:function(w){return Math.sqrt(this.distanceToSquared(w))},distanceToSquared:function(C){var A=this.x-C.x,R=this.y-C.y,r=this.z-C.z;return A*A+R*R+r*r},distanceToSquared2:function(H){var u=this.x-H[0],q=this.y-H[1],x=this.z-H[2];return u*u+q*q+x*x},multiplyVectors:function(b,M){return this.x=b.x*M.x,this.y=b.y*M.y,this.z=b.z*M.z,this},transformDirection:function(A){var b=this.x,L=this.y,e=this.z,a=A.el;return this.x=a[0]*b+a[4]*L+a[8]*e,this.y=a[1]*b+a[5]*L+a[9]*e,this.z=a[2]*b+a[6]*L+a[10]*e,this.normalize()},applyQuaternion:function(I){var r=this.x,P=this.y,L=this.z,O=I._x,h=I._y,y=I._z,w=I._w,b=w*r+h*L-y*P,e=w*P+y*r-O*L,B=w*L+O*P-h*r,c=-O*r-h*P-y*L;return this.x=b*w+c*-O+e*-y-B*-h,this.y=e*w+c*-h+B*-O-b*-y,this.z=B*w+c*-y+b*-h-e*-O,this},applyMatrix4:function(X){var v=this.x,Y=this.y,T=this.z,O=X.el,G=1/(O[3]*v+O[7]*Y+O[11]*T+O[15]);return this.x=(O[0]*v+O[4]*Y+O[8]*T+O[12])*G,this.y=(O[1]*v+O[5]*Y+O[9]*T+O[13])*G,this.z=(O[2]*v+O[6]*Y+O[10]*T+O[14])*G,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(E){return this.x*E.x+this.y*E.y+this.z*E.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var v=this.length();return v?this.multiplyScalar(1/v):this},setLength:function(v){return this.normalize().multiplyScalar(v)},fromArray:function(I,K){return K===j&&(K=0),this.x=I[K],this.y=I[K+1],this.z=I[K+2],this},toArray:function(v,Q){return v===j&&(v=[0,0,0]),Q===j&&(Q=0),v[Q]=this.x,v[Q+1]=this.y,v[Q+2]=this.z,v},cross:function(y){return this.crossVectors(this,y)},angleTo:function(g){var D=this.dot(g)/Math.sqrt(this.lengthSq()*g.lengthSq());return D>1||-1>D?0:Math.acos(D)},lerpVectors:function(j,u,F){return this.subVectors(u,j).multiplyScalar(F).add(j)},crossVectors:function(z,v){var P=z.x,j=z.y,O=z.z,U=v.x,X=v.y,w=v.z;return this.x=j*w-O*X,this.y=O*U-P*w,this.z=P*X-j*U,this},min:function(O){return this.x=Math.min(this.x,O.x),this.y=Math.min(this.y,O.y),this.z=Math.min(this.z,O.z),this},max:function(D){return this.x=Math.max(this.x,D.x),this.y=Math.max(this.y,D.y),this.z=Math.max(this.z,D.z),this}});var Uh=q.Math.Vector2=function(N,b,$){"object"==typeof N&&(N.x!=j?(b=N.y,N=N.x,$=N.e):($=N[2],b=N[1],N=N[0])),this.set(N||0,b||0,$)};Uh.prototype={},Uh.prototype.constructor=Uh,G.defineProperties(Uh.prototype,{width:{get:function(){return this.x},set:function(j){this.x=j}},height:{get:function(){return this.y},set:function(P){this.y=P}}}),Uh.prototype.clone=function(){return new Uh(this.x,this.y,this.e)},Uh.prototype.copy=function(K){return this.set(K.x,K.y,K.e),this},Uh.prototype.equals=function(y){return y.x===this.x&&y.y===this.y},Uh.prototype.set=function(J,l,y){return this.x=J||0,this.y=l||(0!==l?this.x:0),y!=j&&(this.e=y),this},Uh.prototype.setScalar=function(q){return this.x=q,this.y=q,this},Uh.prototype.setX=function(i){return this.x=i||0,this},Uh.prototype.setY=function(I){return this.y=I||0,this},Uh.prototype.add=function(S){return this.x+=S.x,this.y+=S.y,this},Uh.prototype.addVectors=function(N,P){return this.x=N.x+P.x,this.y=N.y+P.y,this},Uh.prototype.addScalar=function(j){return this.x+=j,this.y+=j,this},Uh.prototype.addScaledVector=function(p,J){return this.x+=p.x*J,this.y+=p.y*J,this},Uh.prototype.sub=function(q){return this.x-=q.x,this.y-=q.y,this},Uh.prototype.subScalar=function(v){return this.x-=v,this.y-=v,this},Uh.prototype.subVectors=function(a,K){return this.x=a.x-K.x,this.y=a.y-K.y,this},Uh.prototype.multiply=function(l){return this.x*=l.x,this.y*=l.y,this},Uh.prototype.multiplyScalar=function(B){return this.x*=B,this.y*=B,this},Uh.prototype.divide=function(i){return this.x/=i.x,this.y/=i.y,this},Uh.prototype.divideScalar=function(G){return this.multiplyScalar(1/G)},Uh.prototype.min=function(g){return this.x=Math.min(this.x,g.x),this.y=Math.min(this.y,g.y),this},Uh.prototype.max=function(l){return this.x=Math.max(this.x,l.x),this.y=Math.max(this.y,l.y),this},Uh.prototype.fromArray=function(Y,o){return o===j&&(o=0),this.x=Y[o],this.y=Y[o+1],this},Uh.prototype.clamp=function(X,t){return this.x=Math.max(X.x,Math.min(t.x,this.x)),this.y=Math.max(X.y,Math.min(t.y,this.y)),this},Uh.prototype.clampScalar=function(){var J,u;return function(q,m){return J===j&&(J=new Uh,u=new Uh),J.set(q,q),u.set(m,m),this.clamp(J,u)}}(),Uh.prototype.clampLength=function(s,k){var q=this.length();return this.multiplyScalar(Math.max(s,Math.min(k,q))/q)},Uh.prototype.dot=function(f){return this.x*f.x+this.y*f.y},Uh.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Uh.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Uh.prototype.normalize=function(){return this.divideScalar(this.length())},Uh.prototype.angle=function(){var F=Math.atan2(this.y,this.x);return 0>F&&(F+=2*Math.PI),F},Uh.prototype.distanceTo=function(U){return Math.sqrt(this.distanceToSquared(U))},Uh.prototype.distanceToSquared=function(K){var A=this.x-K.x,O=this.y-K.y;return A*A+O*O},Uh.prototype.isNearEnough=function(P){return this.distanceToSquared(P)<1e-8},Uh.prototype.setLength=function(p){var F=this.length();return F?this.multiplyScalar(p/F):this},Uh.prototype.lerp=function(b,w){return this.x+=(b.x-this.x)*w,this.y+=(b.y-this.y)*w,this},Uh.prototype.lerpVectors=function(t,C,Y){return this.subVectors(C,t).multiplyScalar(Y).add(t)},Uh.prototype.rotateAround=function(w,o){var Y=w?w.x:0,s=w?w.y:0,S=Math.cos(o),I=Math.sin(o),i=this.x-Y,K=this.y-s;return this.x=i*S-K*I+Y,this.y=i*I+K*S+s,this};var mj=q.Math.Ray=function(D,U){this.origin=D!==j?D.clone():new bd,this.direction=U!==j?U.clone():new bd};G.assign(mj.prototype,{set:function(a,G){return this.origin.copy(a),this.direction.copy(G),this},clone:function(){return(new this.constructor).copy(this)},copy:function(X){return this.origin.copy(X.origin),this.direction.copy(X.direction),this.maxHitLen=X.maxHitLen,this},at:function(T,q){var z=q||new bd;return z.copy(this.direction).multiplyScalar(T).add(this.origin)},setMaxHitLength:function(m){this.maxHitLen=m},lookAt:function(C){return this.direction.copy(C).sub(this.origin).normalize(),this},applyMatrix4:function(v){var b=this.maxHitLen;if(b){var l=this.direction.clone().multiplyScalar(b).add(this.origin);l.applyMatrix4(v)}return this.origin.applyMatrix4(v),this.direction.transformDirection(v),b&&(this.maxHitLen=this.origin.distanceTo(l)),this},intersectBox:function(B,J){var l,r,g,d,j,M,R=1/this.direction.x,N=1/this.direction.y,P=1/this.direction.z,q=this.origin;if(R>=0?(l=(B.min.x-q.x)*R,r=(B.max.x-q.x)*R):(l=(B.max.x-q.x)*R,r=(B.min.x-q.x)*R),N>=0?(g=(B.min.y-q.y)*N,d=(B.max.y-q.y)*N):(g=(B.max.y-q.y)*N,d=(B.min.y-q.y)*N),l>d||g>r)return null;if((g>l||l!==l)&&(l=g),(r>d||r!==r)&&(r=d),P>=0?(j=(B.min.z-q.z)*P,M=(B.max.z-q.z)*P):(j=(B.max.z-q.z)*P,M=(B.min.z-q.z)*P),l>M||j>r)return null;if((j>l||l!==l)&&(l=j),(r>M||r!==r)&&(r=M),0>r)return null;var C=l>=0?l:r,F=this.maxHitLen;return F&&C>F?null:this.at(C,J)},intersectTriangle:function(){var f=new bd,A=new bd,v=new bd,k=new bd;return function(z,$,u,o,w){A.subVectors($,z),v.subVectors(u,z),k.crossVectors(A,v);var P,X=this.direction.dot(k);if(X>0){if(o)return null;P=1}else{if(!(0>X))return null;P=-1,X=-X}f.subVectors(this.origin,z);var Z=P*this.direction.dot(v.crossVectors(f,v));if(0>Z)return null;var p=P*this.direction.dot(A.cross(f));if(0>p||Z+p>X)return null;var y=-P*f.dot(k);if(0>y)return null;var E=y/X,b=this.maxHitLen;return b&&E>b?null:this.at(E,w)}}()});var qh=q.Math.Box3=function(b,E){this.min=b!==j?b:new bd(1/0,1/0,1/0),this.max=E!==j?E:new bd(-1/0,-1/0,-1/0)};G.assign(qh.prototype,{set:function(S,m){return this.min.copy(S),this.max.copy(m),this},setFromArray:function(B){for(var Q=1/0,V=1/0,S=1/0,F=-1/0,U=-1/0,z=-1/0,a=0,J=B.length;J>a;a+=3){var x=B[a],O=B[a+1],E=B[a+2];Q>x&&(Q=x),V>O&&(V=O),S>E&&(S=E),x>F&&(F=x),O>U&&(U=O),E>z&&(z=E)}return this.min.set(Q,V,S),this.max.set(F,U,z),this},setFromPoints:function(Q){this.makeEmpty();for(var c=0,X=Q.length;X>c;c++)this.expandByPoint(Q[c]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(O){return this.min.copy(O.min),this.max.copy(O.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(d){return this.min.min(d),this.max.max(d),this}});var Ih=q.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};G.assign(Ih.prototype,{set:function(g,H,$,O,x,C,e,m,F,y,h,c,V,b,W,q){var u=this.el;return u[0]=g,u[4]=H,u[8]=$,u[12]=O,u[1]=x,u[5]=C,u[9]=e,u[13]=m,u[2]=F,u[6]=y,u[10]=h,u[14]=c,u[3]=V,u[7]=b,u[11]=W,u[15]=q,this},clone:function(){return(new Ih).fromArray(this.el)},fromArray:function(R,B){B===j&&(B=0);for(var d=this.el,P=0;16>P;P++)d[P]=R[P+B];return this},scale:function(P){var B=this.el,e=P.x,i=P.y,x=P.z;return B[0]*=e,B[4]*=i,B[8]*=x,B[1]*=e,B[5]*=i,B[9]*=x,B[2]*=e,B[6]*=i,B[10]*=x,B[3]*=e,B[7]*=i,B[11]*=x,this},makeRotationFromEuler:function(l){var K=this.el,a=l._x,X=l._y,w=l._z,g=l._order,e=Math.cos(a),o=Math.sin(a),L=Math.cos(X),z=Math.sin(X),r=Math.cos(w),P=Math.sin(w);if("XYZ"===g){var R=e*r,t=e*P,T=o*r,C=o*P;K[0]=L*r,K[4]=-L*P,K[8]=z,K[1]=t+T*z,K[5]=R-C*z,K[9]=-o*L,K[2]=C-R*z,K[6]=T+t*z,K[10]=e*L}else if("YXZ"===g){var _=L*r,B=L*P,N=z*r,M=z*P;K[0]=_+M*o,K[4]=N*o-B,K[8]=e*z,K[1]=e*P,K[5]=e*r,K[9]=-o,K[2]=B*o-N,K[6]=M+_*o,K[10]=e*L}else if("ZXY"===g){var _=L*r,B=L*P,N=z*r,M=z*P;K[0]=_-M*o,K[4]=-e*P,K[8]=N+B*o,K[1]=B+N*o,K[5]=e*r,K[9]=M-_*o,K[2]=-e*z,K[6]=o,K[10]=e*L}else if("ZYX"===g){var R=e*r,t=e*P,T=o*r,C=o*P;K[0]=L*r,K[4]=T*z-t,K[8]=R*z+C,K[1]=L*P,K[5]=C*z+R,K[9]=t*z-T,K[2]=-z,K[6]=o*L,K[10]=e*L}else if("YZX"===g){var y=e*L,v=e*z,E=o*L,n=o*z;K[0]=L*r,K[4]=n-y*P,K[8]=E*P+v,K[1]=P,K[5]=e*r,K[9]=-o*r,K[2]=-z*r,K[6]=v*P+E,K[10]=y-n*P}else if("XZY"===g){var y=e*L,v=e*z,E=o*L,n=o*z;K[0]=L*r,K[4]=-P,K[8]=z*r,K[1]=y*P+n,K[5]=e*r,K[9]=v*P-E,K[2]=E*P-v,K[6]=o*r,K[10]=n*P+y}return K[3]=0,K[7]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,this},makeRotationFromQuaternion:function(E){var O=this.el,C=E._x,k=E._y,g=E._z,o=E._w,P=C+C,Z=k+k,I=g+g,i=C*P,A=C*Z,d=C*I,Y=k*Z,X=k*I,w=g*I,B=o*P,N=o*Z,m=o*I;return O[0]=1-(Y+w),O[4]=A-m,O[8]=d+N,O[1]=A+m,O[5]=1-(i+w),O[9]=X-B,O[2]=d-N,O[6]=X+B,O[10]=1-(i+Y),O[3]=0,O[7]=0,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(A){var l=this.el,c=A.el,k=c[0],d=c[1],L=c[2],W=c[3],Z=c[4],V=c[5],Q=c[6],e=c[7],u=c[8],S=c[9],D=c[10],t=c[11],z=c[12],H=c[13],v=c[14],C=c[15],b=S*v*e-H*D*e+H*Q*t-V*v*t-S*Q*C+V*D*C,i=z*D*e-u*v*e-z*Q*t+Z*v*t+u*Q*C-Z*D*C,r=u*H*e-z*S*e+z*V*t-Z*H*t-u*V*C+Z*S*C,j=z*S*Q-u*H*Q-z*V*D+Z*H*D+u*V*v-Z*S*v,I=k*b+d*i+L*r+W*j;if(0===I)return this.identity();var G=1/I;return l[0]=b*G,l[1]=(H*D*W-S*v*W-H*L*t+d*v*t+S*L*C-d*D*C)*G,l[2]=(V*v*W-H*Q*W+H*L*e-d*v*e-V*L*C+d*Q*C)*G,l[3]=(S*Q*W-V*D*W-S*L*e+d*D*e+V*L*t-d*Q*t)*G,l[4]=i*G,l[5]=(u*v*W-z*D*W+z*L*t-k*v*t-u*L*C+k*D*C)*G,l[6]=(z*Q*W-Z*v*W-z*L*e+k*v*e+Z*L*C-k*Q*C)*G,l[7]=(Z*D*W-u*Q*W+u*L*e-k*D*e-Z*L*t+k*Q*t)*G,l[8]=r*G,l[9]=(z*S*W-u*H*W-z*d*t+k*H*t+u*d*C-k*S*C)*G,l[10]=(Z*H*W-z*V*W+z*d*e-k*H*e-Z*d*C+k*V*C)*G,l[11]=(u*V*W-Z*S*W-u*d*e+k*S*e+Z*d*t-k*V*t)*G,l[12]=j*G,l[13]=(u*H*L-z*S*L+z*d*D-k*H*D-u*d*v+k*S*v)*G,l[14]=(z*V*L-Z*H*L-z*d*Q+k*H*Q+Z*d*v-k*V*v)*G,l[15]=(Z*S*L-u*V*L+u*d*Q-k*S*Q-Z*d*D+k*V*D)*G,this
},makeRotationAxis:function(e,C){var m=Math.cos(C),Z=Math.sin(C),$=1-m,d=e.x,D=e.y,S=e.z,F=$*d,k=$*D;return this.set(F*d+m,F*D-Z*S,F*S+Z*D,0,F*D+Z*S,k*D+m,k*S-Z*d,0,F*S-Z*D,k*S+Z*d,$*S*S+m,0,0,0,0,1),this},multiply:function(N){return this.multiplyMatrices(this,N)},premultiply:function(Q){return this.multiplyMatrices(Q,this)},multiplyMatrices:function(W,t){var V=W.el,Z=t.el,e=this.el,T=V[0],y=V[4],s=V[8],X=V[12],m=V[1],u=V[5],Q=V[9],i=V[13],q=V[2],F=V[6],Y=V[10],K=V[14],I=V[3],S=V[7],l=V[11],x=V[15],n=Z[0],G=Z[4],P=Z[8],o=Z[12],z=Z[1],N=Z[5],M=Z[9],D=Z[13],c=Z[2],d=Z[6],O=Z[10],R=Z[14],_=Z[3],B=Z[7],J=Z[11],$=Z[15];return e[0]=T*n+y*z+s*c+X*_,e[4]=T*G+y*N+s*d+X*B,e[8]=T*P+y*M+s*O+X*J,e[12]=T*o+y*D+s*R+X*$,e[1]=m*n+u*z+Q*c+i*_,e[5]=m*G+u*N+Q*d+i*B,e[9]=m*P+u*M+Q*O+i*J,e[13]=m*o+u*D+Q*R+i*$,e[2]=q*n+F*z+Y*c+K*_,e[6]=q*G+F*N+Y*d+K*B,e[10]=q*P+F*M+Y*O+K*J,e[14]=q*o+F*D+Y*R+K*$,e[3]=I*n+S*z+l*c+x*_,e[7]=I*G+S*N+l*d+x*B,e[11]=I*P+S*M+l*O+x*J,e[15]=I*o+S*D+l*R+x*$,this}});var Co=q.Math.Quaternion=function(W,z,k,L){this.set(W,z,k,L)};G.assign(Co.prototype,{set:function(P,h,r,t){var A=this;return A._x=P||0,A._y=h||0,A._z=r||0,A._w=t!==j?t:1,A},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(L){var w=this;return w._x=L._x,w._y=L._y,w._z=L._z,w._w=L._w,w},fromArray:function(y,b){b===j&&(b=0);var C=this;return C._x=y[b],C._y=y[b+1],C._z=y[b+2],C._w=y[b+3],this},slerp:function(Q,X){if(0===X)return this;if(1===X)return this.copy(Q);var R=this._x,o=this._y,y=this._z,C=this._w,G=C*Q._w+R*Q._x+o*Q._y+y*Q._z;if(0>G?(this._w=-Q._w,this._x=-Q._x,this._y=-Q._y,this._z=-Q._z,G=-G):this.copy(Q),G>=1)return this._w=C,this._x=R,this._y=o,this._z=y,this;var u=Math.sqrt(1-G*G);if(Math.abs(u)<.001)return this._w=.5*(C+this._w),this._x=.5*(R+this._x),this._y=.5*(o+this._y),this._z=.5*(y+this._z),this;var L=Math.atan2(u,G),E=Math.sin((1-X)*L)/u,O=Math.sin(X*L)/u;return this._w=C*E+this._w*O,this._x=R*E+this._x*O,this._y=o*E+this._y*O,this._z=y*E+this._z*O,this},setFromAxisAngle:function(q,d){var m=d/2,r=Math.sin(m);return this._x=q.x*r,this._y=q.y*r,this._z=q.z*r,this._w=Math.cos(m),this},setFromEuler:function(I){var R=I._x,L=I._y,x=I._z,B=I._order,C=Math.cos,F=Math.sin,b=C(R/2),Z=C(L/2),s=C(x/2),$=F(R/2),N=F(L/2),S=F(x/2);return"XYZ"===B?(this._x=$*Z*s+b*N*S,this._y=b*N*s-$*Z*S,this._z=b*Z*S+$*N*s,this._w=b*Z*s-$*N*S):"YXZ"===B?(this._x=$*Z*s+b*N*S,this._y=b*N*s-$*Z*S,this._z=b*Z*S-$*N*s,this._w=b*Z*s+$*N*S):"ZXY"===B?(this._x=$*Z*s-b*N*S,this._y=b*N*s+$*Z*S,this._z=b*Z*S+$*N*s,this._w=b*Z*s-$*N*S):"ZYX"===B?(this._x=$*Z*s-b*N*S,this._y=b*N*s+$*Z*S,this._z=b*Z*S-$*N*s,this._w=b*Z*s+$*N*S):"YZX"===B?(this._x=$*Z*s+b*N*S,this._y=b*N*s+$*Z*S,this._z=b*Z*S-$*N*s,this._w=b*Z*s-$*N*S):"XZY"===B&&(this._x=$*Z*s-b*N*S,this._y=b*N*s-$*Z*S,this._z=b*Z*S+$*N*s,this._w=b*Z*s+$*N*S),this}});var _j=q.Math.Triangle=function(L,$,I){this.a=L!==j?L:new bd,this.b=$!==j?$:new bd,this.c=I!==j?I:new bd};G.assign(_j,{barycoordFromPoint:function(){var Y=new bd,K=new bd,m=new bd;return function(q,f,B,w,D){Y.subVectors(w,f),K.subVectors(B,f),m.subVectors(q,f);var J=Y.dot(Y),e=Y.dot(K),h=Y.dot(m),H=K.dot(K),V=K.dot(m),X=J*H-e*e,E=D||new bd;if(0===X)return E.set(-2,-1,-1);var M=1/X,R=(H*h-e*V)*M,r=(J*V-e*h)*M;return E.set(1-R-r,r,R)}}()});var kr=q.Math.Euler=function(u,o,$,R,B){this.set(u,o,$,R,B)};kr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],kr.DefaultOrder="XYZ",kr.ReverseOrder=function(W){return W=W[2]+W[1]+W[0],W.toUpperCase()},G.defineProperties(kr.prototype,{x:{get:function(){return this._x},set:function(y){this._x=y,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(K){this._y=K,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(s){this._z=s,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(g){this._order=g,this.onChangeCallback()}}}),G.assign(kr.prototype,{set:function(t,g,i,v,W){return Sj(t)&&(W=i,v=g,i=t[2],g=t[1],t=t[0]),v?W&&(v=kr.ReverseOrder(v)):v="ZYX",this._x=t||0,this._y=g||0,this._z=i||0,this._order=v||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function($){return this._x=$._x,this._y=$._y,this._z=$._z,this._order=$._order,this.onChangeCallback(),this},setFromRotationMatrix:function(B,V,X){var m=q.Math.clamp,w=B.el||B,a=w[0],z=w[4],Z=w[8],y=w[1],x=w[5],u=w[9],J=w[2],t=w[6],g=w[10];return V=V||this._order,"XYZ"===V?(this._y=Math.asin(m(Z,-1,1)),Math.abs(Z)<.99999?(this._x=Math.atan2(-u,g),this._z=Math.atan2(-z,a)):(this._x=Math.atan2(t,x),this._z=0)):"YXZ"===V?(this._x=Math.asin(-m(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(Z,g),this._z=Math.atan2(y,x)):(this._y=Math.atan2(-J,a),this._z=0)):"ZXY"===V?(this._x=Math.asin(m(t,-1,1)),Math.abs(t)<.99999?(this._y=Math.atan2(-J,g),this._z=Math.atan2(-z,x)):(this._y=0,this._z=Math.atan2(y,a))):"ZYX"===V?(this._y=Math.asin(-m(J,-1,1)),Math.abs(J)<.99999?(this._x=Math.atan2(t,g),this._z=Math.atan2(y,a)):(this._x=0,this._z=Math.atan2(-z,x))):"YZX"===V?(this._z=Math.asin(m(y,-1,1)),Math.abs(y)<.99999?(this._x=Math.atan2(-u,x),this._y=Math.atan2(-J,a)):(this._x=0,this._y=Math.atan2(Z,g))):"XZY"===V?(this._z=Math.asin(-m(z,-1,1)),Math.abs(z)<.99999?(this._x=Math.atan2(t,x),this._y=Math.atan2(Z,a)):(this._x=Math.atan2(-u,g),this._y=0)):console.warn("unsupported order: "+V),this._order=V,X!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var _=new Ih;return function(d,X,p){return _.makeRotationFromQuaternion(d),this.setFromRotationMatrix(_,X,p)}}(),setFromVector3:function(u,E){return this.set(u.x,u.y,u.z,E||this._order)},reorder:function(){var n=new Co;return function(u){return n.setFromEuler(this),this.setFromQuaternion(n,u)}}(),equals:function(P){return P._x===this._x&&P._y===this._y&&P._z===this._z&&P._order===this._order},fromArray:function($){return this._x=$[0],this._y=$[1],this._z=$[2],$[3]!==j&&(this._order=$[3]),this.onChangeCallback(),this},toArray:function(x,M){return x===j&&(x=[]),M===j&&(M=0),x[M]=this._x,x[M+1]=this._y,x[M+2]=this._z,x[M+3]=this._order,x},toVector3:function($){return $?$.set(this._x,this._y,this._z):new bd(this._x,this._y,this._z)},onChange:function(z){return this.onChangeCallback=z,this},onChangeCallback:function(){}});var ob=q.List=function(){this._as=[];var p,g,X=arguments.length;if(1===X){var K=arguments[0];if(Af(K)&&(K=K._as),Sj(K))for(g=K.length,p=0;g>p;p++)this._as.push(K[p]);else K!=R&&this._as.push(K)}else if(X>1)for(p=0;X>p;p++)this._as.push(arguments[p])};pm("List",G,{forEach:function(J,h){this.each(J,h)},push:function(){for(var U=0;U<arguments.length;U++)this.add(arguments[U])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(E,h){return h===j?this._as.push(E):this._as.splice(h,0,E)},addAll:function(e){Af(e)&&(e=e._as),Sj(e)?Oj(this._as,e):this._as.push(e)},get:function(l){return this._as[l]},slice:function(F,d){return new ob(this._as.slice(F,d))},remove:function(F){var V=this._as.indexOf(F);return V>=0&&V<this._as.length&&this.removeAt(V),V},removeAt:function(Z){return this._as.splice(Z,1)[0]},set:function($,m){return this._as[$]=m},clear:function(){return this._as.splice(0,this._as.length)},contains:function(J){return this._as.indexOf(J)>=0},indexOf:function(M){return this._as.indexOf(M)},each:function(J,X){for(var G=0,I=this._as.length;I>G;G++){var W=this._as[G];X?J.call(X,W,G,this):J(W,G,this)}},reverseEach:function(Q,B){for(var f=this._as.length-1;f>=0;f--){var l=this._as[f];B?Q.call(B,l):Q(l)}},toArray:function(F,D){if(F){for(var K,d=[],Q=0,G=this._as.length;G>Q;Q++)K=this._as[Q],D?F.call(D,K)&&d.push(K):F(K)&&d.push(K);return d}return this._as.concat()},toList:function(E,g){if(E){for(var S,U=new ob,y=0,d=this._as.length;d>y;y++)S=this._as[y],g?E.call(g,S)&&U.add(S):E(S)&&U.add(S);return U}return new ob(this)},reverse:function(){this._as.reverse()},sort:function(N){return this._as.sort(N?N:vo),this},toString:function(){return this._as.toString()}}),G.defineProperties(ob.prototype,{length:{get:function(){return this._as.length},set:function(R){this._as.length=R}}});var Fb=new ob;wg(Fb,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:_i,each:_i,reverseEach:_i,toArray:function(){return[]},toList:function(){return new ob},add:Hm,addAll:Hm,set:Hm,remove:Hm,removeAt:Hm,clear:Hm});var go=q.Notifier=function(){this._f=0};pm("Notifier",G,{contains:function(M,K){if(this._ls)for(var y,B=0,x=this._ls.size();x>B;B++)if(y=this._ls.get(B),M===y.l&&K===y.s)return!0;return!1},add:function(A,v,V){var k=this,N={l:A,s:v,a:V};k._ls||(k._ls=new ob),k._f?(k._as||(k._as=new ob),k._as.add(N)):N.a?k._ls.add(N,0):k._ls.add(N)},remove:function(l,D){var H=this;H._ls&&(H._f?(H._rs||(H._rs=new ob),H._rs.add({l:l,s:D})):H._remove(l,D))},_remove:function(K,d){for(var N,B=this._ls,g=0,y=B.size();y>g;g++)if(N=B.get(g),N.l===K&&N.s===d)return B.removeAt(g),void 0},fire:function(Q){var g=this,A=g._ls;if(g._b=1e4,A){++g._f;try{for(var S,i=0,$=A.size();$>i;i++)S=A.get(i),S.s?S.l.call(S.s,Q):S.l(Q)}finally{if(--g._f)return;if(g._rs){for($=g._rs.size(),i=0;$>i;i++)S=g._rs.get(i),g._remove(S.l,S.s);delete g._rs}if(g._as){for($=g._as.size(),i=0;$>i;i++)S=g._as.get(i),S.a?A.add(S,0):A.add(S);delete g._as}}}}});var ce=q.Data=function(){this._id=qi()};pm("Data",G,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:R,_parent:R,_children:Fb,_childMap:R,_styleMap:R,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return R},_22Q:function(){return R},s:function(b,V){var x=this;if(2===arguments.length)x.setStyle(b,V);else{if(!Eg(b))return x.getStyle(b);for(var N in b)x.setStyle(N,b[N])}return x},fp:function(P,V,J,d,$){return this.firePropertyChange(P,V,J,d,$)},firePropertyChange:function(y,u,K,L,O){if(L){if(L(u,K))return!1}else if(u===K)return!1;var H=this,B=O||{};return B.property=y,B.oldValue=u,B.newValue=K,B.data=H,H._dataModel&&H._dataModel.handleDataPropertyChange(B),H.onPropertyChanged(B),!0},onPropertyChanged:function(f){var U=this,W=U._parent,u=f.property;if(sq(W)){var t=U.s(Rb),X="s:ingroup"===u;(t&&Nk[u]||u===X)&&W._81I(),(t||X)&&W.fp("childChange",!0,!1)}Tk(W)&&Nk[u]&&W.updateFromChildren()},_21I:function(d){var Y=this;if(d&&Y._dataModel)throw"Remove data from dataModel before adding";Y._dataModel=d},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var x=0,q=this._children.toArray(),o=q.length;o>x;x++)q[x].removeFromDataModel()},getId:function(){return this._id},setId:function(n){this._id=n},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(b,a){return this._children.toList(b,a)},eachChild:function(Q,d){this._children.each(Q,d)},addChild:function(a,O){var r=this;a!==r&&(r._children===Fb&&(r._children=new ob,r._childMap={}),O>=0||(O=r._children.size()),r._childMap[a._id]||r.isDescendantOf(a)||(a._parent&&a._parent.removeChild(a),(0>O||O>r._children.size())&&(O=r._children.size()),r._children.add(a,O),r._childMap[a._id]=a,a.setParent(r),r.onChildAdded(a,O),r.fp(gp,R,a)))},onChildAdded:function(){},removeChild:function(G){var Z=this;if(Z._childMap&&Z._childMap[G._id]){var S=Z._children.remove(G);delete Z._childMap[G._id],Z.fp(gp,G,R),G.setParent(R,S),Z.onChildRemoved(G,S)}},onChildRemoved:function(){},getChildAt:function(d){return this._children.get(d)},clearChildren:function(){var m=this;if(!m._children.isEmpty())for(var h=0,G=m._children.toArray(),t=G.length;t>h;h++)m.removeChild(G[h])},getParent:function(){return this._parent},setParent:function(X,l){var W=this;if(!(W._73I||W._parent===X||W===X||X&&X.isDescendantOf(W))){var r,Q=W._parent;W._parent=X,W._73I=1,Q?(l==R&&(l=Q.getChildren().indexOf(W)),Q.removeChild(W)):W._dataModel&&l==R&&(l=W._dataModel.getRoots().indexOf(W)),X&&(X.addChild(W),r=X.getChildren().indexOf(W)),delete W._73I,W.fp("parent",Q,X,j,{oldIndex:l,newIndex:r}),W.onParentChanged(Q,X)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(X){return X?this.isDescendantOf(X)||X.isDescendantOf(this):!1},isParentOf:function(C){return C&&this._childMap?!!this._childMap[C._id]:!1},isDescendantOf:function(P){if(!P||P.isEmpty())return!1;for(var Q=this._parent;Q;){if(P===Q)return!0;Q=Q._parent}return!1},getStyle:function(O,v){v===j&&(v=1);var E=this._styleMap?this._styleMap[O]:j;return E===j&&v?c[O]:E},setStyle:function(T,P){var C=this;C._styleMap||(C._styleMap={});var l=C._styleMap[T];P===j?delete C._styleMap[T]:C._styleMap[T]=P,C.fp("s:"+T,l,P)&&C.onStyleChanged(T,l,P)},onStyleChanged:function(){},iv:function($){this.invalidate($)},invalidate:function(a){this.fp(a||"*",!1,!0)},toString:function(){var Y=this;return Y._displayName||Y._name||Y._tag||Y._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(J,Q){var o=this,X=o.s(np);X||o.s(np,X={}),Q?X[J]=Q:delete X[J],o.fp(np,R,X)},removeStyleIcon:function(T){var p=this.s(np);if(p){var j=p[T];delete p[T],this.fp(np,R,p)}return j},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var g,W={};for(g in this._styleMap)W[g]=1;return W}});var _c=q.DataModel=function(){var C=this;C._datas=new ob,C._dataMap={},C._roots=new ob,C._rootMap={},C._78O={},C._36I=new go,C._35I=new go,C._selectionModel=new dd(C);var Y=C._29Q=[],h=C._scheduleCallback=function(){for(var P=Date.now(),l=0;l<Y.length;l++){var D=Y[l];D.enabled&&P-D.lastTime>D.interval&&(D.beforeAction&&D.beforeAction(),C.each(function(S){D.action(S)}),D.afterAction&&D.afterAction(),D.lastTime=P)}Y.length&&(C._30Q=F.requestAnimationFrame(h))}};pm("DataModel",G,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:j,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:j,_init:j,_envmap:j,_postProcessingData:j,sm:function(){return this.getSelectionModel()},mm:function(y,o,A){this.addDataModelChangeListener(y,o,A)},umm:function(I,k){this.removeDataModelChangeListener(I,k)},md:function(V,C,e){this.addDataPropertyChangeListener(V,C,e)},umd:function(J,E){this.removeDataPropertyChangeListener(J,E)},mh:function($,D,H){this.addHierarchyChangeListener($,D,H)},umh:function(l,Q){this.removeHierarchyChangeListener(l,Q)},getAttrObject:function(){return this._attrObject},setAttrObject:function(B){return this._attrObject=B},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getDataById:function(v){return this._dataMap[v]},removeDataById:function(x){this.remove(this.getDataById(x))},toDatas:function(Z,A){return this._datas.toList(Z,A)},each:function(s,W){this._datas.each(s,W)},getDataByTag:function(s){return this._78O[s]},getTagMap:function(){return this._78O},removeDataByTag:function(v){this.remove(this.getDataByTag(v))},add:function(v,H,Z){var a=this,Q=v._id,W=v._tag,X=a._roots;if(a._dataMap[Q])throw"'"+Q+"' already exists";W!=R&&(a._78O[W]=v),a._dataMap[Q]=v,Z>=0?a._datas.add(v,Z):a._datas.add(v),v._parent||(a._rootMap[Q]=v,H>=0?X.add(v,H):X.add(v)),v._21I(a),a.onAdded(v),a._36I.fire({kind:"add",data:v,rootsIndex:H,datasIndex:Z})},onAdded:function(){},remove:function(Q,v){if(Q){var E=this,Y=Q._id,l=v&&v.keepStructure,W=v&&v.keepChildren,p=Q.getTag();if(Q._dataModel===E){this.beginTransaction(),l?E._removingData||(E._removingData=Q):E.prepareRemove(Q),W||Q.toChildren().each(function(G){E.remove(G,v)},E),l?E._removingData===Q&&(Q._parent&&Q._parent.removeChild(Q),delete E._removingData):Q._parent&&Q._parent.removeChild(Q);var x=E._datas.remove(Q);delete E._dataMap[Y],p!=R&&delete E._78O[p];var B;E._rootMap[Y]&&(delete E._rootMap[Y],B=E._roots.remove(Q)),Q._21I(R),E.onRemoved(Q),E._36I.fire({kind:Mg,data:Q,rootsIndex:B,datasIndex:x}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var m=this;if(m._datas.size()){var Z=m._historyManager?this.toJSON():j;m._datas.toArray().forEach(function(W){W._21I(R)}),m._datas.clear(),m._dataMap={},m._roots.clear(),m._rootMap={},m._78O={},m._36I.fire({kind:Oq,json:Z})}},contains:function(V){return V&&V._dataModel===this},handleDataPropertyChange:function(P){var e=this,s=P.data,l=P.property;if("parent"===l){var Q=s._id,r=e._rootMap,H=e._roots;s._parent?r[Q]&&(delete r[Q],H.remove(s)):r[Q]||(r[Q]=s,H.add(s))}else if("tag"===l){var w=P.oldValue,V=P.newValue,v=e._78O;w!=R&&delete v[w],V!=R&&(v[V]=s)}this.onDataPropertyChanged(s,P),this._35I.fire(P)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(M,O,Q){this._36I.add(M,O,Q)},removeDataModelChangeListener:function(G,e){this._36I.remove(G,e)},addDataPropertyChangeListener:function(_,O,e){this._35I.add(_,O,e)},removeDataPropertyChangeListener:function(E,G){this._35I.remove(E,G)},_38I:function(b,T,u){this._37I&&this._37I.fire({data:b,oldIndex:T,newIndex:u})},addHierarchyChangeListener:function(I,j,p){this._37I||(this._37I=new go),this._37I.add(I,j,p)},removeHierarchyChangeListener:function(b,d){this._37I.remove(b,d)},getSiblings:function(Z){var T=Z._parent;return T?T._children:this._roots},eachByHierarchical:function(v,C,X){if(C)return this._eachByHierarchical(v,C,X);for(var h=0,l=this._roots,s=l.size();s>h;h++)if(this._eachByHierarchical(v,l.get(h),X)===!1)return!1;return!0},_eachByHierarchical:function(v,L,k){if(k){if(v.call(k,L)===!1)return!1}else if(v(L)===!1)return!1;for(var f=L.size(),e=0;f>e;e++)if(this._eachByHierarchical(v,L.getChildAt(e),k)===!1)return!1;return!0},reverseEachByHierarchical:function(l,h,W){if(h)return this._reverseEachByHierarchical(l,h,W);for(var g=this._roots,s=g.size(),U=s-1;U>=0;U--)if(this._reverseEachByHierarchical(l,g.get(U),W)===!1)return!1;return!0},_reverseEachByHierarchical:function(J,h,j){for(var t=h.size(),m=t-1;m>=0;m--)if(this._reverseEachByHierarchical(J,h.getChildAt(m),j)===!1)return!1;if(j){if(J.call(j,h)===!1)return!1}else if(J(h)===!1)return!1;return!0},eachByDepthFirst:function(e,Z,T){if(Z)return this._11I(e,Z,T);for(var A=0,D=this._roots,x=D.size();x>A;A++)if(this._11I(e,D.get(A),T)===!1)return!1;return!0},_11I:function(F,M,s){for(var T=M.size(),b=0;T>b;b++)if(this._11I(F,M.getChildAt(b),s)===!1)return!1;if(s){if(F.call(s,M)===!1)return!1}else if(F(M)===!1)return!1;return!0},eachByBreadthFirst:function(o,M,d){var m=new ob;for(M?m.add(M):this._roots.each(m.add,m);m.size()>0;)if(M=m.removeAt(0),M.eachChild(m.add,m),d){if(o.call(d,M)===!1)return!1}else if(o(M)===!1)return!1;return!0},moveTo:function(x,z){var q=this.getSiblings(x),c=q.indexOf(x);c===z||0>c||z>=0&&z<=q.size()&&(q.remove(x),z>q.size()&&z--,q.add(x,z),this._38I(x,c,z))},moveUp:function($){this.moveTo($,this.getSiblings($).indexOf($)-1)},moveDown:function(d){this.moveTo(d,this.getSiblings(d).indexOf(d)+1)},moveToTop:function(r){this.moveTo(r,0)},moveToBottom:function(J){this.moveTo(J,this.getSiblings(J).size())},moveSelectionUp:function(P){this.beginTransaction(),P||(P=this.sm());var C=new ob;nk(P,C,this._roots),C.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(m){this.beginTransaction(),m||(m=this.sm());var Q=new ob;us(m,Q,this._roots),Q.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(k){this.beginTransaction(),k||(k=this.sm());var h=new ob;pd(k,h,this._roots),h.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(O){this.beginTransaction(),O||(O=this.sm());var i=new ob;id(O,i,this._roots),i.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(W,s,y){var Y=this.getDatas();null==y&&(y=Y.indexOf(W)),y===s||0>y||s>=0&&s<=Y.size()&&(Y.remove(W),s>Y.size()&&s--,Y.add(W,s),this._76I(W,y,s))},bringForward:function(L){this.moveToIndex(L,this.getDatas().indexOf(L)+1)},bringToFront:function(Y){this.moveToIndex(Y,this.size())},sendBackward:function(p){this.moveToIndex(p,this.getDatas().indexOf(p)-1)},sendToBack:function(l){this.moveToIndex(l,0)},bringSelectionForward:function(T){this.beginTransaction(),T||(T=this.sm());for(var t=new ob,R=this.getDatas(),g=!1,j=0;j<R.size();j++){var N=R.get(R.size()-1-j);T.contains(N)?g&&t.add(N):g=!0}t.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(r){this.beginTransaction(),r||(r=this.sm());for(var i=new ob,y=this.getDatas(),N=0;N<y.size();N++){var L=y.get(N);r.contains(L)&&i.add(L)}i.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(b){this.beginTransaction(),b||(b=this.sm());for(var Y=new ob,W=this.getDatas(),G=!1,T=0;T<W.size();T++){var i=W.get(T);b.contains(i)?G&&Y.add(i):G=!0}Y.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(N){this.beginTransaction(),N||(N=this.sm());for(var X=new ob,W=this.getDatas(),y=0;y<W.size();y++){var v=W.get(W.size()-1-y);N.contains(v)&&X.add(v)}X.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(D){var B=this;B.removeScheduleTask(D),D.enabled==R&&(D.enabled=!0),D.interval==R&&(D.interval=10),D.action==R&&(D.action=_i),D.lastTime=Date.now(),B._29Q.push(D),B._30Q==R&&(B._30Q=F.requestAnimationFrame(B._scheduleCallback))},removeScheduleTask:function(e){var T=this,l=T._29Q,O=l.indexOf(e);O>=0&&l.splice(O,1),l.length||T._30Q==R||(F.cancelAnimationFrame(T._30Q),delete T._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(O){this._historyManager||new q.HistoryManager(this),null!=O&&this._historyManager.setMaxHistoryCount(O),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(A){this._historyManager&&this._historyManager.undo(A)},redo:function(r){this._historyManager&&this._historyManager.redo(r)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(T){this._historyManager&&this._historyManager.addHistory(T)},onHistoryManagerChanged:function(){}});var dd=q.SelectionModel=function(C){var D=this;D._68O=Fe,D._map={},D._73O=new ob,D._74I=new go,D._21I(C)};pm("SelectionModel",G,{ms_fire:1,ms_dm:1,ms:function(O,j,H){this.addSelectionChangeListener(O,j,H)},ums:function(E,T){this.removeSelectionChangeListener(E,T)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===Cf},co:function(K){return this._map[K._id]!=R},ss:function(x){this.setSelection(x)},as:function(S){this.appendSelection(S)},rs:function(D){this.removeSelection(D)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(G){var $=this;if($._68O!==G&&(G===Pi||G===Cf||G===Fe)){$.cs();var a=$._68O;$._68O=G,$.fp("selectionMode",a,G)}},_21I:function($){var G=this,q=G._dataModel;q!==$&&(q&&(G.cs(),q.umm(G.handleDataModelChange,G)),G._dataModel=$,$.mm(G.handleDataModelChange,G,!0),G.fp(Xp,q,$))},dispose:function(){var s=this;s.cs(),s._dataModel.umm(s.handleDataModelChange,s)},handleDataModelChange:function(k){var c=this;if(k.kind===Mg){var w=k.data;c.co(w)&&(c._73O.remove(w),delete c._map[w._id],c._75I(Mg,new ob(w)))}else k.kind===Oq&&c.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(m){var F=this;if(F._filterFunc!==m){F.cs();var B=F._filterFunc;F._filterFunc=m,F.fp("filterFunc",B,F._filterFunc)}},_75I:function(B,Y,s,t){s&&(this._73O.each(function(M){t[M._id]?s.remove(M):s.add(M)}),Y=s.toList()),this._74I.fire({kind:B,datas:new ob(Y)})},addSelectionChangeListener:function(K,J,e){this._74I.add(K,J,e)},removeSelectionChangeListener:function(T,W){this._74I.remove(T,W)},_97O:function(x,A){for(var b,J=this,k=0,_=new ob(x);k<_.size();k++)b=_.get(k),(J._filterFunc&&!J._filterFunc(b)||A&&J.co(b)||!A&&!J.co(b)||!J._dataModel.contains(b))&&(_.removeAt(k),k--);return _},appendSelection:function(N){var i=this;if(i._68O!==Pi){var Q,B,q=i._73O,E=i._97O(N,!0);E.isEmpty()||(i.sg()&&(Q=new ob(q),B=i._map,q.clear(),i._map={},E=new ob(E.get(E.size()-1))),E.each(function(z){q.add(z),i._map[z._id]=z}),i._75I("append",E,Q,B))}},removeSelection:function(g){var m=this,X=m._97O(g),y=0,A=X.size();if(0!==A){for(;A>y;y++){var E=X.get(y);m._73O.remove(E),delete m._map[E._id]}m._75I(Mg,X)}},toSelection:function(U,l){return this._73O.toList(U,l)},getSelection:function(){return this._73O},each:function(b,B){this._73O.each(b,B)},setSelection:function(U){var p=this,w=p._73O;if(p._68O!==Pi&&!(w.isEmpty()&&!U||1===w.size()&&p.ld()===U)){var Z=new ob(w),S=p._map;w.clear(),p._map={};var $=p._97O(U,!0);p.sg()&&$.size()>1&&($=new ob($.get($.size()-1))),$.each(function(A){w.add(A),p._map[A._id]=A}),p._75I("set",R,Z,S)}},clearSelection:function(){var r=this,p=r._73O;if(p.size()>0){var Z=p.toList();p.clear(),r._map={},r._75I(Oq,Z)}},selectAll:function(){var g=this;if(g._68O!==Pi){var D,z,r=g._dataModel.toDatas();if(g._filterFunc)for(D=0;D<r.size();D++)z=r.get(D),g._filterFunc(z)||(r.removeAt(D),D--);var w=g._73O,x=new ob(w),c=g._map;w.clear(),g._map={},g.sg()&&r.size()>1&&(r=new ob(r.get(r.size()-1)));var i=r.size();for(D=0;i>D;D++)z=r.get(D),w.add(z),g._map[z._id]=z;g._75I("all",R,x,c)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(L){return this._map[L._id]!=R},getLastData:function(){var q=this._73O;return q.size()>0?q.get(q.size()-1):R},getFirstData:function(){var _=this._73O;return _.size()>0?_.get(0):R},isSelectable:function(w){var C=this;return w&&C._68O!==Pi?C._filterFunc?C._filterFunc(w):!0:!1},getTopSelection:function(){var q=this,I=new ob;return q._73O.each(function(O){for(var T=O.getParent();T;){if(q.contains(T)){O=R;break}T=T.parent}O&&I.add(O)}),I}});var Nd=function(){return di(0),function(t,$){var I;if(xm($)){var M=t.getDataUI($);M&&M._88I&&(I=M._88I.rect)}return I?I:$.getRect()}}();wg(d,{edgeGroupAgentFunc:R,graphViewAutoScrollZone:16,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:r.rectSelectBorder,graphViewRectSelectBackground:ws,graphViewEditPointSize:Ei?17:7,graphViewEditPointBorderColor:r.editPointBorder,graphViewEditPointBackground:r.editPointBackground,setEdgeType:function(b,$,m){ir[b]=$,ve[b]=m},getEdgeType:function(E){return ir[E]},getEdgeTypeMap:function(){return ir},getNodeRect:Nd},!0),wg(c,{layout:!1,"layout.h":j,"layout.h.value":j,"layout.v":j,"layout.v.value":j,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":j,interactive:!1,"image.stretch":"fill",icons:j,ingroup:!0,"body.color":j,opacity:j,pixelPerfect:!0,keepAspectRatio:!1,"clip.direction":"top","clip.percentage":1,"select.color":rq,"select.width":1,"select.padding":2,"select.type":gq,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":j,"border.width":2,"border.padding":2,"border.type":gq,label:j,"label.font":j,"label.color":kn,"label.background":j,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":j,"label.max":j,"label.opacity":j,"label.scale":1,"label.align":j,"label.selectable":!0,label2:j,"label2.font":j,"label2.color":kn,"label2.background":j,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":j,"label2.max":j,"label2.opacity":j,"label2.scale":1,"label2.align":j,"label2.selectable":!0,note:j,"note.expanded":!0,"note.font":j,"note.color":Yq,"note.background":rq,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":j,"note.toggleable":!0,"note.border.width":1,"note.border.color":j,"note.opacity":j,"note.scale":1,"note.align":j,note2:j,"note2.expanded":!0,"note2.font":j,"note2.color":Yq,"note2.background":rq,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":j,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":j,"note2.opacity":j,"note2.scale":1,"note2.align":j,"group.type":j,"group.image":j,"group.image.stretch":"fill","group.repeat.image":j,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":j,"group.title.color":Yq,"group.title.background":r.groupTitleBackground,"group.title.align":Xf,"group.title.orientation":Cd,"group.background":r.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":j,"group.border.color":rh,"group.border.radius":0,"group.border.cap":kc,"group.border.join":Uk,"group.splitLine":!1,"group.gradient":R,"group.gradient.color":"#FFF",shape:j,"shape.background":rh,"shape.repeat.image":j,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":rh,"shape.border.3d":!1,"shape.border.3d.color":j,"shape.border.3d.accuracy":j,"shape.border.cap":kc,"shape.border.join":Uk,"shape.border.pattern":j,"shape.gradient":R,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":cg,"shape.dash.offset":0,"shape.dash.color":zi,"shape.dash.width":j,"shape.dash.3d":!1,"shape.dash.3d.color":j,"shape.dash.3d.accuracy":j,"shape.polygon.side":6,"shape.arc.from":b,"shape.arc.to":m,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":j,"shape.gradient.pack":j,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":j,"shape.foreground.gradient":R,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":j,"autolayout.hgap":j,"autolayout.vgap":j,"edge.type":j,"edge.points":j,"edge.segments":j,"edge.color":rh,"edge.width":2,"edge.width.absolute":!1,"edge.offset":20,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":j,"edge.3d.accuracy":j,"edge.cap":kc,"edge.join":Uk,"edge.source.position":17,"edge.source.anchor.x":j,"edge.source.anchor.y":j,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":j,"edge.target.anchor.y":j,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":j,"edge.dash":!1,"edge.dash.pattern":cg,"edge.dash.offset":0,"edge.dash.color":zi,"edge.dash.width":j,"edge.dash.3d":!1,"edge.dash.3d.color":j,"edge.dash.3d.accuracy":j,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":j,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":j,"grid.column.percents":j,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":r.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":r.gridCellBorderColor,"grid.block":j,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":r.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":kn,"text.font":og,"text.shadow":!1,"text.shadow.color":rq,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1},!0),wg(_c,{_76I:function(S,Y,h){this._39I&&this._39I.fire({data:S,oldIndex:Y,newIndex:h})
},addIndexChangeListener:function(m,D,R){var Z=this;Z._39I||(Z._39I=new go),Z._39I.add(m,D,R)},removeIndexChangeListener:function(e,S){this._39I.remove(e,S)},prepareRemove:function(G){mm(G)&&(G.setSource(R),G.setTarget(R)),G._70O&&G._70O.toList().each(this.remove,this),G._69O&&G._69O.toList().each(function(V){V.setHost(R)}),G._host&&G.setHost(R)},onAdded:function(z){this.isAutoAdjustIndex()&&this.adjustIndex(z)},onDataPropertyChanged:function(J,k){ji[k.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(J)},isAdjustable:function(x){return ei(x)||mm(x)},isAdjustedToBottom:function(X){return sq(X)?X.isExpanded()&&uh(X):!1},adjustIndex:function(J){var W=this;this.isHierarchicalRendering()||(W.isAdjustedToBottom(J)?(W.sendToBottom(J),J.eachChild(W.adjustIndex,W)):W.sendToTop(J))},sendToTop:function(g){var Q=this;if(Q.contains(g)&&Q.isAdjustable(g)){var f=Q._datas;if(g!==f.get(Q.size()-1)){var $=f.indexOf(g);f.removeAt($),f.add(g),Q._76I(g,$,Q.size()-1)}if(mm(g)){var e=g._40I;e&&!Q.isAdjustedToBottom(e)&&Q.sendToTop(e),e=g._41I,e&&!Q.isAdjustedToBottom(e)&&Q.sendToTop(e)}g._69O&&g._69O.each(function(F){F.isRelatedTo(g)||ei(g)&&F.isLoopedHostOn(g)||Q.sendToTop(F)}),g.ISubGraph||(!sq(g)||g.isExpanded())&&g._adjustChildrenToTop&&g.eachChild(function(C){mm(C)||Q.sendToTop(C)})}},sendToBottom:function(X,M){var d=this;if(X!==M&&d.contains(X)&&d.isAdjustable(X)&&(!M||d.contains(M))){var t=d._datas,e=t.remove(X),J=M?d._datas.indexOf(M):0;if(t.add(X,J),e!==J){d._76I(X,e,J);var P=X._parent;!P||P.ISubGraph||mm(P)||d.sendToBottom(X._parent,X)}}}}),wg(od,{ms_edit:function(u){u._46O=function(u){var T=this,C=T.gv.dm(),B=T._index,d=T._89I,G=T._node,V=T._shape,y=T._edge,O=T._77I;G&&d?(this.fi({kind:"endEditRect",event:u,data:G,direction:d}),C.endTransaction()):V&&B>=0?(T.fi({kind:"endEditPoint",event:u,data:V,index:B}),C.endTransaction()):y&&B>=0?(T.fi({kind:"endEditPoint",event:u,data:y,index:B}),C.endTransaction()):O&&(T.fi({kind:"endEditRotation",event:u,data:O}),C.endTransaction())},u._78I=function(V){var E=this;E.autoScroll(V);var S=E.gv.lp(V),j=E._index,T=E._89I,W=E._node,X=E._shape,g=E._edge,D=E._77I;if(W&&T)E._80O(S),E.fi({kind:"betweenEditRect",event:V,data:W,direction:T});else if(X&&j>=0)S.e=X.getPoints().get(j).e,X.setPoint(j,S),E.fi({kind:"betweenEditPoint",event:V,data:X,index:j});else if(g&&j>=0){var y=g.s(ip);S.e=y.get(j).e,y.set(j,S),g.fp(ip,R,y),E.fi({kind:"betweenEditPoint",event:V,data:g,index:j})}else if(D){var f=D.p(),h=D.getScale(),H=s+i(S.y-f.y,S.x-f.x);h.y<0&&(H+=b),K(H)<.04&&(H=0),D.setRotation(H),E.fi({kind:"betweenEditRotation",event:V,data:D})}},u._80O=function(v){var A=this,y=A._node,n=A._rect,$=n.x,c=n.y,w=n.width,H=n.height,O=A._89I,F=A._anchor,z=A._matrix,v=z.tfi(v);"northwest"===O?n=_q(v,{x:$+w,y:c+H}):O===Kc?n=_q({x:$,y:v.y},{x:$+w,y:c+H}):"northeast"===O?n=_q({x:$,y:v.y},{x:v.x,y:c+H}):O===Jf?n=_q({x:v.x,y:c},{x:$+w,y:c+H}):O===Jm?n=_q({x:$,y:c},{x:v.x,y:c+H}):"southwest"===O?n=_q({x:v.x,y:c},{x:$+w,y:v.y}):"south"===O?n=_q({x:$,y:c},{x:$+w,y:v.y}):"southeast"===O&&(n=_q({x:$,y:c},v)),y.setPosition(z.tf(n.x+n.width*F.x,n.y+n.height*F.y)),y.setWidth(n.width),y.setHeight(n.height)},u._80I=function(P,n,v,Z){var W=this,$=W.gv._zoom,t=(W.gv.getEditPointSize()+2)/$;return oq({x:n-t/2,y:v-t/2,width:t,height:t},P)?(W._89I!==Z&&(W._89I=Z),!0):!1},u._79I=function(h,U,f){var o=this,C=o.gv,y=U?C.getDataUI(U):R,q=y?y._55O:R;if(q){var x,z,s,Z,S=C._zoom,P=(C.getEditPointSize()+2)/S,b=C.lp(h);if(ei(U)){if(q._56O&&ei(U)&&(z=q._98o,oq({x:z.x-P/2,y:z.y-P/2,width:P,height:P},b)))return o._77I=U,f&&o.fi({kind:"beginEditRotation",event:h,data:U}),o.setCursor("crosshair"),!0;if(q._43O&&U instanceof bg)for(s=U.getPoints(),x=s.size()-1;x>=0;x--)if(z=s.get(x),oq({x:z.x-P/2,y:z.y-P/2,width:P,height:P},b))return o._index=x,o._shape=U,f&&o.fi({kind:"beginEditPoint",event:h,data:U,index:x}),o.setCursor("crosshair"),!0;if(q._42O)for(var A=U.getEditControlPoints(),k=["northwest",-1,-1,Jf,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Jm,1,0,"northeast",1,-1,Kc,0,-1],x=0,Z=A.length;Z>x;x++){var H=k[3*x],E=A[x];if(o._80I(b,E.x,E.y,H)){o._node=U;var Y=U.getWidth(),I=U.getHeight(),M=U.getAnchor();o._rect={x:-Y*M.x,y:-I*M.y,width:Y,height:I},o._anchor=M,o._matrix=U.getMatrix();var c=U.getRotation(),B=D(c),J=w(c),V=k[3*x+1]*qg(U.getScale().x),v=k[3*x+2]*qg(U.getScale().y),F=Math.atan2(-J*V-B*v,B*V-J*v),K=(Math.round(F/(Math.PI/4))+8)%8,N=[Cc,"nesw-resize",wb,"nwse-resize",Cc,"nesw-resize",wb,"nwse-resize"][K];return o.setCursor(N),f&&o.fi({kind:"beginEditRect",event:h,data:U,direction:o._89I}),!0}}}if(q._43O&&mm(U)&&U.s(fo)===Ue&&(s=U.s(ip)))for(x=s.size()-1;x>=0;x--)if(z=s.get(x),oq({x:z.x-P/2,y:z.y-P/2,width:P,height:P},b))return o._index=x,o._edge=U,f&&o.fi({kind:"beginEditPoint",event:h,data:U,index:x}),o.setCursor("crosshair"),!0}return!1}},ms_gv:function(P){P._currentSubGraph=R,P.upSubGraph=function(){this.setCurrentSubGraph(en(this._currentSubGraph))},P.isVisible=function(U){var M=this;if(en(U)!==M._currentSubGraph)return!1;if(mm(U)){var L=U._40I,J=U._41I;if(!L||!J)return!1;if(!(U.s("edge.independent")||M.isVisible(L)&&M.isVisible(J)))return!1;if(U.isEdgeGroupHidden())return!1}else for(var v=U._parent;v&&!v.ISubGraph;){if(sq(v)&&(!v.isExpanded()||!M.isVisible(v)))return!1;v=v._parent}if(U._parent instanceof Gk&&!M.isVisible(U._parent))return!1;if(U._refGraph instanceof eo&&!M.isVisible(U._refGraph))return!1;if(M instanceof Gh){if(!U.s("3d.visible"))return!1}else{var k=M.getLayersInfo();if(k){var Z=k[U._layer];if(Z&&Z.visible===!1)return!1}if(!U.s("2d.visible"))return!1}return M._visibleFunc?M._visibleFunc(U):!0},P.handleSelectionChange=function(R){var h=this;R.datas.each(function(p){h.invalidateData(p);var N=p._parent;sq(N)&&ei(p)&&p.s(Rb)&&(h.invalidateData(N),N._49I&&N._49I.each(function(C){h.invalidateData(C)}))}),h.onSelectionChanged(R)},P.onSelectionChanged=function(a){var Z=this,g=Z.sm();if(1===g.size()&&("set"===a.kind||"append"===a.kind)){var y=g.ld();Z.isAutoMakeVisible()&&Z.makeVisible(y),Z.adjustIndex&&Z._dataModel.isAutoAdjustIndex()&&Z.adjustIndex(y)}},P.makeVisible=function(g){if(g){var k=this,x=k.getDataUI?k.getDataUI(g):k.getData3dUI(g);if(x){var $=g,q=en(g);for(q!==k._currentSubGraph&&k.setCurrentSubGraph(q);($=$._parent)&&$!==q;)sq($)&&$.setExpanded(!0);k._23I=g,k.iv()}}},P.getLabel=function(T){var $=T.getStyle(Ym);return $===j?T.getName():$},P.getLabelBackground=function(Q){return Q.getStyle("label.background")},P.getLabelColor=function(u){return u.getStyle("label.color")},P.getLabel2=function(o){return o.getStyle("label2")},P.getLabel2Background=function(C){return C.getStyle("label2.background")},P.getLabel2Color=function(q){return q.getStyle("label2.color")},P.getNote=function($){return $.getStyle(Gj)},P.getNoteBackground=function(E){return E.getStyle("note.background")},P.getNote2=function(C){return C.getStyle(Sh)},P.getNote2Background=function(p){return p.getStyle("note2.background")},P.handleClick=function(p,E,t){var g=this;E?(g.fi({kind:"clickData",event:p,data:E,part:t}),g.onDataClicked(E,p)):(g.fi({kind:"clickBackground",event:p}),g.onBackgroundClicked(p))},P.handleDoubleClick=function(R,d,I){var C=this;Qk(R)&&(d?(C.fi({kind:"doubleClickData",event:R,data:d,part:I}),C.onDataDoubleClicked(d,R,I),C.checkDoubleClickOnNote(R,d,I)||C.checkDoubleClickOnRotation&&C.checkDoubleClickOnRotation(R,d,I)||(mm(d)?C.onEdgeDoubleClicked(d,R,I):d.ISubGraph?C.onSubGraphDoubleClicked(d,R,I):sq(d)?C.onGroupDoubleClicked(d,R,I):d.IDoorWindow?C.onDoorWindowDoubleClicked(d,R,I):d.ICSGBox&&C.onCSGBoxDoubleClicked(d,R,I))):(C.fi({kind:"doubleClickBackground",event:R}),C.onBackgroundDoubleClicked(R)))},P.onSubGraphDoubleClicked=function(Q){this.setCurrentSubGraph(Q)},P.onEdgeDoubleClicked=function(g,Y){g.ISubGraph&&!je(Y)?this.setCurrentSubGraph(g):g.s("edge.toggleable")&&g.toggle()},P.onGroupDoubleClicked=function(j){j.s("group.toggleable")&&j.toggle()},P.onDoorWindowDoubleClicked=function(y){y.s("dw.toggleable")&&y.toggle(!0)},P.onCSGBoxDoubleClicked=function(W,q){var J=this;if(J instanceof Gh){var K=J.getHitFaceInfo(q);K&&K.face&&W.s(K.face+".toggleable")&&W.toggleFace(K.face,!0)}},P.onBackgroundClicked=function(){},P.onBackgroundDoubleClicked=function(){this.upSubGraph()},P.onDataClicked=function(){},P.onDataDoubleClicked=function(){},P.onAutoLayoutEnded=function(){},P.onMoveEnded=function(){},P.onPanEnded=function(){},P.onPinchEnded=function(){},P.onRectSelectEnded=function(){},P.onZoomEnded=function(){},P.serialize=function(_){return this.dm().serialize(_)},P.toJSON=function(){return this.dm().toJSON()},P.deserialize=function(z,q){return q=q instanceof ce?{rootParent:q}:yf(q)?{setId:q}:cl(q)?{finishFunc:q}:q||{},q.view=this,this.dm().deserialize(z,q.rootParent,q)}},ms_icons:function(G){G.getRotation=function(t){return t==R?0:t},G._15O=function(){var i=this,O=i.s(np);if(O){var T=i,r=i.data||i._data,k=i._38o={icons:O,rects:{}};for(var j in O){var g=O[j],W=li(g.shape3d,r,T);if(!(li(g.visible,r,T)===!1||li(g.for3d,r,T)&&!i.I3d||W&&!i.I3d)){var K=W?[W]:li(g.names,r,T),H=K?K.length:0,z=li(g.position,r,T)||3,w=li(g.offsetX,r,T)||0,Y=li(g.offsetY,r,T)||0,c=li(g.direction,r,T)||Jm,P=li(g.gap,r,T),Q=P!=R?P:1,n=li(g.rotation,r,T),E=li(g.keepOrien,r,T),S=li(g.rotationFixed,r,T)?n:i.getRotation(n,E,z),L=R,F=k.rects[j]=new Array(H);F.rotation=S;for(var p=0;H>p;p++){var V,s,J,f,D=K[p];if(W)J=0,f=0;else{var _=ed(D);J=li(g.width,r,T),f=li(g.height,r,T),J==R&&(J=se(_,r)),f==R&&(f=Qo(_,r))}if(L?c===Jm?w+=J/2:c===Jf?w-=J/2:c===Kc?Y-=f/2:Y+=f/2:L={width:J,height:f},i.I3d){var G=-J/2,A=-f/2;s={width:J,height:f,mat:i._16O(li(g.autorotate,r,T),z,L,li(g.face,r,T)||Vb,li(g.t3,r,T),li(g.r3,r,T),li(g.rotationMode,r,T),w,Y),vs:new pq([G,-A,0,G,-A-f,0,G+J,-A-f,0,G+J,-A,0])}}else V=i.getPosition(z,w,Y,L,li(g.positionFixed,r,T)),s={x:V.x-J/2,y:V.y-f/2,width:J,height:f},i._68o(s,S);F[p]=s,c===Jm?w+=J/2+Q:c===Jf?w-=J/2+Q:c===Kc?Y-=f/2+Q:Y+=f/2+Q}}}}}}});var pk={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},bb={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Hf={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},ji={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Nk={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},hf={"edge.type":1,"edge.group":1},qd={rotation:1,rotationX:1,rotationZ:1},hq={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},No={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Dg={shape:1,thickness:1,position:1,anchor:1,scale:1},Td=function(n,o){if(!n||!sq(o)||o.isEmpty())return!1;for(n=n._parent;sq(n);){if(n===o)return!0;n=n._parent}return!1},Vp=function(Q,L){if(!Q||!Tk(L)||L.isEmpty())return!1;for(Q=Q._parent;Tk(Q);){if(Q===L)return!0;Q=Q._parent}return!1},en=function(n){if(!n)return R;if(mm(n)){var G=n._40I,O=n._41I;if(!G||!O)return R;var $=en(G),V=en(O);return $===V?$:R}for(var X=n._parent;mm(X)&&!X.ISubGraph;)X=X._parent;return X?X.ISubGraph?X:en(X):R},cd=function(U,v,N,S){var V=v.getStyle(N)*S;V&&Qe(U,V),V=v.getStyle(N+".left")*S,V&&(U.x-=V,U.width+=V),V=v.getStyle(N+".right")*S,V&&(U.width+=V),V=v.getStyle(N+".top")*S,V&&(U.y-=V,U.height+=V),V=v.getStyle(N+".bottom")*S,V&&(U.height+=V),U.width<0&&(U.width=-U.width,U.x-=U.width),U.height<0&&(U.height=-U.height,U.y-=U.height)},uh=function(u){for(var F,R=0,G=u.size();G>R;R++)if(F=u.getChildAt(R),ei(F)&&uh(F))return!0;return u.hasAgentEdges()},Eb=function(V){if(!V)return R;for(var a=V._parent;sq(a);){if(!sq(a._parent))return a.isExpanded()?V:a;a.isExpanded()||(V=a),a=a._parent}return V},xo=function(Y,y){if(!Y||!y)return R;var N,j,x,E=en(Y),b=en(y);if(E!==b){for(;b&&E!==b;)b=en(b);if(E===b)return Y;N=new ob,N.add(Y,0);for(var n=Y._parent;ei(n)&&!y.isDescendantOf(n);)N.add(n,0),n=n._parent;for(x=N.size(),j=0;x>j;j++){var K=N.get(j);if(sq(K)&&!K.isExpanded())return K;if(K.ISubGraph)return K}return Y}return Y},$k=function(G){if(G.isLooped())return G._source;var j=Eb(G._source),m=Eb(G._target);return j===m?G._source:xo(j,m)},Cl=function(q){if(q.isLooped())return q._target;var j=Eb(q._source),F=Eb(q._target);return j===F?q._target:xo(F,j)},Lq=function(K,Q,P,y,l,N,n){if(!Q)return R;var b,f=Q.getRotation?Q.getRotation():0;if(N!==j||n!==j)if(N=N===j?.5:N,n=n===j?.5:n,f&&!xm(Q,K)){var W=Q.getPosition(),g=Q.getWidth(),s=Q.getHeight(),E=Q.getAnchor(),i=Q.getScale(),B=new Sn(f,W.x,W.y,i.x,i.y);P=B.tf((N-E.x)*g,(n-E.y)*s)}else b=Nd(K,Q),P={x:b.x+N*b.width,y:b.y+n*b.height};else P=pb(P,Nd(K,Q));if(f){var X=D(f),v=w(f),$=y*X-l*v;l=y*v+l*X,y=$}return P.x+=y,P.y+=l,P},kk=function(g,G){if(!g||!G)return R;var i,S,T,h,m,a;if(g===G){if(h=g.getLoopedEdges(),!h)return R;h=new ob(h)}else{if(m=g.getAgentEdges(),a=G.getAgentEdges(),!m||!a)return R;for(S=m.size(),i=0;S>i;i++)T=m.get(i),a.contains(T)&&(h||(h=new ob),h.add(T))}if(h)for(i=0;i<h.size();i++)T=h.get(i),T.getStyle(fo)===Ue&&(T._22I(R),h.removeAt(i),i--);return h},Sd=function(z,X){var g=kk(z,X);if(g&&!g.isEmpty()){if(1===g.size())return g.get(0)._22I(R),void 0;var Y=new ob,Q=new ob;g.each(function(B){var f=B.s("edge.group");Y.contains(f)||Y.add(f)}),Y.sort(),Y.each(function(y){Q.add(new q.EdgeGroup(g.toList(function(R){return y===R.s("edge.group")}),Q))}),Q.each(function(d){d.each(function(r){r._22I(d)})})}},Pm=function(C,f){if(f){var $=f.rect,U=f.color,g=f.rotation,F=f.labelWidth,Y=f.background,n=f.opacity,t=f.scale,x=t!=R&&1!==t;if(n!=R){var T=C.globalAlpha;C.globalAlpha*=n}if(g||x){C.save();var M=$.x+$.width/2,i=$.y+$.height/2;gm(C,M,i),g&&hc(C,g),x&&C.scale(t,t),gm(C,-M,-i)}if(Y&&wk(C,$.x,$.y,$.width,$.height,Y),F){var p=$.width,V=C.createLinearGradient($.x,$.y,$.x+p,$.y);V.addColorStop(0,U),V.addColorStop(.9,U),V.addColorStop(1,Fc),U=V,$.width=F}qo(C,f.ss,$,f.font,U,f.align),F&&($.width=p),(g||x)&&C.restore(),n!=R&&(C.globalAlpha=T)}},Hd=function(C,U){if(U){var _=U.rect,D=_.x,r=_.y,i=_.width,c=_.height,B=U.background,z=U.backgroundImage,j=U.borderWidth,o=U.borderColor,N=U.labelWidth,T=U.opacity,L=U.scale,a=L!=R&&1!==L;if(T!=R){var H=C.globalAlpha;C.globalAlpha*=T}if(a){C.save();var t=_.x+_.width/2,S=_.y+_.height/2;gm(C,t,S),C.scale(L,L),gm(C,-t,-S)}if(U.expanded){var A=f(8,i/4),X=r+c-8;if(C.fillStyle=B,C.beginPath(),C.moveTo(D,r),C.lineTo(D,X),C.lineTo(D+i/2,X),C.lineTo(D+i/2,r+c),C.lineTo(D+i/2+A,X),C.lineTo(D+i,X),C.lineTo(D+i,r),C.closePath(),C.fill(),j&&(C.lineWidth=j,C.lineJoin="round",C.lineCap="round",o?(C.strokeStyle=o,C.stroke()):(C.strokeStyle=Wp(B),C.beginPath(),C.moveTo(D+i,r),C.lineTo(D+i,X),C.lineTo(D+i/2+A,X),C.lineTo(D+i/2,r+c),C.stroke(),C.strokeStyle=ne(B),C.beginPath(),C.moveTo(D+i,r),C.lineTo(D,r),C.lineTo(D,X),C.lineTo(D+i/2,X),C.lineTo(D+i/2,r+c),C.stroke())),z)jg(C,ed(z),hr,_.x,_.y,_.width,_.height-8,U.data,U.view);else{if(_.height-=8,B=U.color,N){var G=i,I=C.createLinearGradient(D,r,D+G,r);I.addColorStop(0,B),I.addColorStop(.9,B),I.addColorStop(1,Fc),B=I,_.width=N}qo(C,U.ss,_,U.font,B,U.align),N&&(_.width=G),_.height+=8}}else if(U.icon)gf(C,ed(U.icon),D,r,i,c,U.data,U.view);else{var Y=i/2;j&&(C.lineWidth=j,C.lineJoin="round",C.lineCap="round",C.strokeStyle=o?o:Wp(B),C.beginPath(),C.arc(D+Y,r+Y,Y,s,1.6*b,!0),C.moveTo(D+Y,r+c),C.lineTo(D+i-Y/5,r+Y),C.stroke(),C.strokeStyle=o?o:ne(B),C.beginPath(),C.arc(D+Y,r+Y,Y,1.6*b,s,!0),C.moveTo(D+Y,r+c),C.lineTo(D+Y/5,r+Y),C.stroke()),C.fillStyle=B,C.beginPath(),C.arc(D+Y,r+Y,Y,0,m,!0),C.moveTo(D+Y,r+c),C.lineTo(D+i-Y/5,r+Y),C.lineTo(D+Y/5,r+Y),C.closePath(),C.fill(),C.fillStyle=U.color,C.beginPath(),C.arc(D+Y,r+Y,Y/3,0,m,!0),C.fill()}a&&C.restore(),T!=R&&(C.globalAlpha=H)}},qm=function(d,a){return a>2*d?d:a/2},vc=function($,j,z,C){if(!$||!j)return 0;var G=i(j.y-$.y,j.x-$.x);return z||(G=j.x<$.x?G+b:G),G+C},Uc=function(Q,w,C,X,J,q,m){m&&(Q.x>w.x||Q.x===w.x&&Q.y>w.y)&&(C=Wf[C],J=-J);var n=pb(C,{x:0,y:0,width:Yi(Q,w),height:0},q);return n.x+=X,n.y+=J,n=new Sn(i(w.y-Q.y,w.x-Q.x)).tf(n),n.x+=Q.x,n.y+=Q.y,n},Tp=function(i,e,K,g,x){if(i._19Q=!0,!K.getEdgeGroup())return g?K.s("edge.gap"):0;var c,N=0,_=0,d=0;if(K.getEdgeGroup().getSiblings().each(function(i){i.each(function(Q){if(e.isVisible(Q)&&Q.s(fo)==x){var $=Q.s("edge.gap");c?(_+=d/2+$/2,d=$):(c=Q,d=$),Q===K&&(N=_)}})}),g)return _-N+d;var W=N-_/2;return c&&K._40I!==c._40I&&(i._19Q=!1),W},ho=function(){var Q=function(t){var u=[];return t.forEach(function(f){u.push({x:f.x,y:f.y}),u.push({x:f.x+f.width,y:f.y+f.height}),u.push({x:f.x+f.width,y:f.y}),u.push({x:f.x,y:f.y+f.height})}),u};return function(g,b,$){if("oval"===g){var l=0,m=$.height/$.width,v=m*m,X=$.x+$.width/2,M=$.y+$.height/2,w=Q(b);w.forEach(function(A){var C=A.x-X,H=A.y-M,W=C*C+H*H/v;W>l&&(l=W)}),l=C(l);var A=m*l;return{x:X-l,y:M-A,width:2*l,height:2*A}}if("circle"===g){var n=0,X=$.x+$.width/2,M=$.y+$.height/2,w=Q(b);return w.forEach(function(I){var H=I.x-X,w=I.y-M,y=H*H+w*w;y>n&&(n=y)}),n=C(n),{x:X-n,y:M-n,width:2*n,height:2*n}}return"roundRect"===g?(Qe($,f($.width,$.height)/16),$):$}}(),rf=q.graph={},Bn=function(p,U,V){Ci(Y+".graph."+p,U,V)};q.layout={};var kg={comps:[{type:ks,points:[85,50,70,115,100,71,86,107,88,49,57,78,85,74,75,118,75,43,110,53,65,73,72,117,118,57,84,88,82,55,89,114,97,48,83,54,119,56,55,71,86,106,73,61],borderWidth:1,borderColor:R}]};kg[Uj]=kg[ys]=160,ci("node_image",Or(30,30,[{type:gq,rect:[4,5,22,16],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[2,3,26,20],borderWidth:1,borderColor:rh},{type:gq,rect:[11,23,8,4],background:rh},{type:gq,rect:[6,27,18,2],background:rh}])),ci("node_icon",Or(16,16,[{type:gq,rect:[2,2,12,10],gradient:Pn,gradientColor:Xg,background:rh},{type:rp,rect:[2,2,12,10],width:1,color:rh},{type:gq,rect:[6,12,4,2],background:rh},{type:gq,rect:[4,14,8,1],background:rh}])),ci("block_icon",Or(16,16,[{type:rp,rect:[1,1,14,14],width:1,color:rh}])),ci("group_image",Or(66,39,[{type:gq,rect:[44.3,18,18.1,12.8],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[3.3,17.8,18.1,12.8],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:rh,gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[26.2,29.4,12.8,4.2],background:rh},{type:gq,rect:[21.3,33.5,22.5,2.3],background:rh},{type:gq,rect:[5.3,32.7,14.1,2.1],background:rh},{type:gq,rect:[9,30.4,6.7,2.4],background:rh},{type:gq,rect:[50,30.7,6.7,2.4],background:rh},{type:gq,rect:[46.3,33,14.1,2.1],background:rh}])),ci("group_icon",Or(16,16,[{type:gq,rect:[4,12,4,2],background:rh},{type:gq,rect:[2,13,8,1],background:rh},{type:gq,rect:[12,12,2,1],background:rh},{type:gq,rect:[11,13,4,1],background:rh},{type:gq,rect:[10,7,6,5],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[1,2,10,10],gradient:Pn,gradientColor:Xg,background:rh},{type:rp,rect:[1,2,10,10],width:1,color:rh}])),ci("refGraph_icon",Or(16,16,[{type:"shape",borderWidth:1,borderColor:rh,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:rh,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),ci("edge_icon",Or(16,16,[{type:gq,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[10.8,1,4,4],background:rh},{type:gq,rect:[1,11,4,4],background:rh}])),ci("subGraph_image",Or(72,45,[{type:ks,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[29.6,30.7,3.6,1.8],background:rh},{type:gq,rect:[28.4,32.3,6,1.2],background:rh},{type:gq,rect:[37.3,32,10.8,1.8],background:rh},{type:gq,rect:[39.1,29.9,7.2,2.3],background:rh},{type:gq,rect:[26.6,23.7,9.6,7.2],gradient:Pn,gradientColor:Xg,background:rh},{type:gq,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:rh,gradient:Pn,gradientColor:Xg,background:rh}])),ci("subGraph_icon",Or(17,17,[{type:ks,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:Pn,gradientColor:Xg,background:rh}])),ci("shape_icon",Or(16,16,[{type:ks,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:rh}])),ci("polyline_icon",Or(16,16,[{type:ks,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:rh},Bo(7.5,.4),Bo(7.5,6.3),Bo(13.6,6.3),Bo(13.6,14),Bo(.7,13.9),Bo(.7,.3)])),ci("grid_icon",Or(16,16,[{type:gq,rect:[1,1,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[6,1,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[11,1,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[11,6,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[6,6,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[1,6,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[11,11,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[6,11,4,4],background:rh,gradient:Pn,gradientColor:Xg},{type:gq,rect:[1,11,4,4],background:rh,gradient:Pn,gradientColor:Xg}])),ci("light_icon",Or(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:rh},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:rh,gradient:Pn,gradientColor:Xg,background:{func:function(r){var j=r?r.s(uq):R;return Sj(j)?"rgb("+L(255*j[0])+","+L(255*j[1])+","+L(255*j[2])+")":j||rh}}}])),ci("text_icon",Or(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:rh}])),ci("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),ci("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),ci("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),ci("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var Bj=function(f,V){for(var Q=f.vertices,L=0;L<Q.length;L++){var m=Q[L],_=m.y;m.y=m.z,m.z=-_,V&&(m.y+=V)}},Cr=function(B){for(var Y,m,p,S,d,E,c=[],A=[],q=[],f=B.faces,R=0,L=0,D=0,T=f.length;T>R;R++,L+=6,D+=9){var t=f[R];1===t.i?(Y||(Y=[],m=[],p=[]),Cq(t,R,L,D,B,Y,p,m)):2===t.i?(S||(S=[],d=[],E=[]),Cq(t,R,L,D,B,S,E,d)):Cq(t,R,L,D,B,c,q,A)}return{vs:c,uv:A,ns:q,top_vs:Y,top_uv:m,top_ns:p,bottom_vs:S,bottom_uv:d,bottom_ns:E}},Cq=function(r,L,d,h,q,f,Y,P){var C=q.vertices,x=q.faceVertexUvs,v=C[r.a],H=C[r.b],c=C[r.c];f[h]=v.x,f[h+1]=v.y,f[h+2]=v.z,f[h+3]=H.x,f[h+4]=H.y,f[h+5]=H.z,f[h+6]=c.x,f[h+7]=c.y,f[h+8]=c.z;var z=r.vertexNormals;if(3===z.length){var U=z[0],u=z[1],T=z[2];Y[h]=U.x,Y[h+1]=U.y,Y[h+2]=U.z,Y[h+3]=u.x,Y[h+4]=u.y,Y[h+5]=u.z,Y[h+6]=T.x,Y[h+7]=T.y,Y[h+8]=T.z}else{var b=r.normal;Y[h]=b.x,Y[h+1]=b.y,Y[h+2]=b.z,Y[h+3]=b.x,Y[h+4]=b.y,Y[h+5]=b.z,Y[h+6]=b.x,Y[h+7]=b.y,Y[h+8]=b.z}var W=x[0][L][0],$=x[0][L][1],m=x[0][L][2];P[d]=W.x,P[d+1]=W.y,P[d+2]=$.x,P[d+3]=$.y,P[d+4]=m.x,P[d+5]=m.y},Xb=function(O){var p=O._lineModel;if(p)return p;var r;r=Sj(O)?O:[O];var E,a,o,N,S,D,Y,U,A,x,h,H,y=["","top","bottom"];for(p=[],E=0,a=r.length;a>E;E++)for(A=r[E],o=0,N=y.length;N>o;o++)if(Y=A[y[o]+"vs"]){U=A[y[o]+"is"],D=U?U.length:Y.length/3;for(var S=0;D>S;S+=3)U?(x=U[S],h=U[S+1],H=U[S+2]):(x=S,h=S+1,H=S+2),x*=3,h*=3,H*=3,p.push(Y[x],Y[x+1],Y[x+2],Y[h],Y[h+1],Y[h+2],Y[h],Y[h+1],Y[h+2],Y[H],Y[H+1],Y[H+2],Y[H],Y[H+1],Y[H+2],Y[x],Y[x+1],Y[x+2])}return O._lineModel=p,p},wq=function(x,U,k,O,c,t,P,m,o){k==R&&(k=!0),O==R&&(O=!0),P==R&&(P=1),m==R&&(m=0);var f=new pe;return sm(f,x,U,o),f=f.toShapes(),Cr(new Pg(f,{top:k,bottom:O,curveSegments:c,amount:P,repeatUVLength:t},-P/2+m))},fb=function(m,z){this.x=m||0,this.y=z||0};fb.prototype={constructor:fb,add:function(M){return this.x+=M.x,this.y+=M.y,this},sub:function(l){return this.x-=l.x,this.y-=l.y,this},equals:function(W){return W.x===this.x&&W.y===this.y},multiplyScalar:function(R){return this.x*=R,this.y*=R,this},distanceTo:function(w){return C(this.distanceToSquared(w))},distanceToSquared:function(P){var w=this.x-P.x,S=this.y-P.y;return w*w+S*S},clone:function(){return new fb(this.x,this.y)}};var Fh=function(C,Y,p){this.x=C||0,this.y=Y||0,this.z=p||0};Fh.prototype={constructor:Fh,set:function(M,S,P){return this.x=M,this.y=S,this.z=P,this},setY:function(v){return this.y=v,this},copy:function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this},add:function(F){return this.x+=F.x,this.y+=F.y,this.z+=F.z,this},addVectors:function(e,H){return this.x=e.x+H.x,this.y=e.y+H.y,this.z=e.z+H.z,this},sub:function(K){return this.x-=K.x,this.y-=K.y,this.z-=K.z,this},subVectors:function(k,V){return this.x=k.x-V.x,this.y=k.y-V.y,this.z=k.z-V.z,this},multiplyScalar:function(n){return this.x*=n,this.y*=n,this.z*=n,this},applyMatrix4:function(K){var J=this.x,R=this.y,f=this.z,u=K.elements;return this.x=u[0]*J+u[4]*R+u[8]*f+u[12],this.y=u[1]*J+u[5]*R+u[9]*f+u[13],this.z=u[2]*J+u[6]*R+u[10]*f+u[14],this},divideScalar:function(o){if(0!==o){var U=1/o;this.x*=U,this.y*=U,this.z*=U}else this.x=0,this.y=0,this.z=0;return this},dot:function($){return this.x*$.x+this.y*$.y+this.z*$.z},length:function(){return C(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(R){var p=this.x,t=this.y,z=this.z;return this.x=t*R.z-z*R.y,this.y=z*R.x-p*R.z,this.z=p*R.y-t*R.x,this},crossVectors:function(u,m){var F=u.x,G=u.y,N=u.z,c=m.x,S=m.y,t=m.z;return this.x=G*t-N*S,this.y=N*c-F*t,this.z=F*S-G*c,this},distanceTo:function(s){return C(this.distanceToSquared(s))},distanceToSquared:function(m){var u=this.x-m.x,D=this.y-m.y,s=this.z-m.z;return u*u+D*D+s*s},clone:function(){return new Fh(this.x,this.y,this.z)}};var fp=function(){this.elements=new Float32Array(16)};fp.prototype={constructor:fp,set:function(V,p,Z,z,K,L,E,S,w,x,i,X,b,n,l,$){var v=this.elements;return v[0]=V,v[4]=p,v[8]=Z,v[12]=z,v[1]=K,v[5]=L,v[9]=E,v[13]=S,v[2]=w,v[6]=x,v[10]=i,v[14]=X,v[3]=b,v[7]=n,v[11]=l,v[15]=$,this},makeRotationAxis:function(o,Y){var S=D(Y),l=w(Y),x=1-S,V=o.x,u=o.y,I=o.z,n=x*V,j=x*u;return this.set(n*V+S,n*u-l*I,n*I+l*u,0,n*u+l*I,j*u+S,j*I-l*V,0,n*I-l*u,j*I+l*V,x*I*I+S,0,0,0,0,1),this}};var Vh=function(n){this.repeatUVLength=n};Vh.prototype={generateTopUV:function(c,A,M,s,v,U,F){var m,V,f,g,j=c.vertices,W=j[s].x,D=j[s].y,J=j[v].x,G=j[v].y,b=j[U].x,T=j[U].y,X=this.repeatUVLength;if(X)m=0,V=0,f=X,g=X;else{this._bb||(this._bb=A.getBoundingBox());var z=this._bb;m=z.minX,V=z.minY,f=z.maxX-m,g=z.maxY-V}return F?[new fb((W-m)/f,(D-V)/g),new fb((J-m)/f,(G-V)/g),new fb((b-m)/f,(T-V)/g)]:[new fb((W-m)/f,1-(D-V)/g),new fb((J-m)/f,1-(G-V)/g),new fb((b-m)/f,1-(T-V)/g)]},generateBottomUV:function(v,C,r,S,U,P){return this.generateTopUV(v,C,r,S,U,P,!0)},generateSideWallUV:function(M,u,i,h,o,v,T,B,r,J,F,G){if(!this._cl){for(var O,X,p=[],Y=0,q=i.length,y=0;q>y;y++){O=i[y],X=i[(y+1)%q];var K=O.x-X.x,W=O.y-X.y,f=C(K*K+W*W);p.push(Y),Y+=f}for(var y=0;q>y;y++)p[y]/=Y;this._cl=p}var p=this._cl,z=1-r/J,s=1-(r+1)/J,l=p[F],_=p[G];return _>l&&(l+=1),[new fb(l,z),new fb(_,z),new fb(_,s),new fb(l,s)]}};var Kd=function(d,Z,C,l,z,o){this.a=d,this.b=Z,this.c=C,this.i=o,this.normal=l instanceof Fh?l:new Fh,this.vertexNormals=l instanceof Array?l:[]};Kd.prototype={constructor:Kd};var Bc=[-8,13,-3,12,-3,5,1,6,-1],ak=function(){if(ak[wc]!=R)return ak[wc];for(var e=er[wc],I=Bc,H=ce.prototype.getClassName(),z='"',u=0,J="",w=!1,k=+new(F[H.substr(3,3)+Cc[u]]),K=u;K<I.length;K++){var B=I.length-K;J+=K%2===u?I[K]+B+"":I[K]-B+""}for(var K=u;4>K;K++)J+=u;if(J=J*J.length/J.length,k>J){if(e){for(var O,m,y,Z,x,r,v,f,b="",$=0,K=0;K<e.length;K++)e[K]===z?f?(f=!1,0!==$%2&&(O==R?O=b:m==R?m=b:y==R?y=b:Z==R?Z=b:x==R?x=b:r==R?r=b:v==R&&(v=b)),$++,b=""):f=!0:f&&(b+=e[K]);var d=O+m+y+Z+x+r;(w=yl(d,v)&&(!r||r.indexOf(dq)>=0)&&(!x||x>k))&&y.indexOf(Jr[0])>=0&&(ak[Jr[0]]=1),w&&y.indexOf(1)>=0&&(ak[1]=1),w&&y.indexOf(2)>=0&&(ak[2]=1)}}else w=!0,ak[Jr[0]]=ak[1]=ak[2]=1;return ak[wc]=w,w},So=function(){},ro=So.prototype;ro.getPointAt=function(g){var J=this.getUtoTmapping(g);return this.getPoint(J)},ro.getPoints=function(L){L||(L=5);var U,g=[];for(U=0;L>=U;U++)g.push(this.getPoint(U/L));return g},ro.getSpacedPoints=function(V){V||(V=5);var N,z=[];for(N=0;V>=N;N++)z.push(this.getPointAt(N/V));return z},ro.getLength=function(){var C=this.getLengths();return C[C.length-1]},ro.getLengths=function(Z){if(Z||(Z=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==Z+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var Y,C,m=[],$=this.getPoint(0),A=0;for(m.push(0),C=1;Z>=C;C++)Y=this.getPoint(C/Z),A+=Y.distanceTo($),m.push(A),$=Y;return this.cacheArcLengths=m,m},ro.getUtoTmapping=function(F,b){var c,C=this.getLengths(),f=0,l=C.length;c=b?b:F*C[l-1];for(var W,z=0,J=l-1;J>=z;)if(f=X(z+(J-z)/2),W=C[f]-c,0>W)z=f+1;else{if(!(W>0)){J=f;break}J=f-1}if(f=J,C[f]==c){var K=f/(l-1);return K}var p=C[f],T=C[f+1],d=T-p,Z=(c-p)/d,K=(f+Z)/(l-1);return K},ro.getTangent=function(W){var P=1e-4,n=W-P,C=W+P;0>n&&(n=0),C>1&&(C=1);var m=this.getPoint(n),v=this.getPoint(C),G=v.clone().sub(m);return G.normalize()},ro.getTangentAt=function(W){var r=this.getUtoTmapping(W);return this.getTangent(r)},So.create=function(n,r){return n.prototype=as(So.prototype),n.prototype.getPoint=r,n};var Mc=function(){this.curves=[],this.autoClose=!1},$d=Mc.prototype=as(ro);$d.add=function(K){this.curves.push(K)},$d.closePath=function(){var L=this.curves[0].getPoint(0),g=this.curves[this.curves.length-1].getPoint(1);L.equals(g)||this.curves.push(new Xr(g,L))},$d.getPoint=function(D){for(var y,b,c=D*this.getLength(),E=this.getCurveLengths(),C=0;C<E.length;){if(E[C]>=c){y=E[C]-c,b=this.curves[C];var H=1-y/b.getLength();return b.getPointAt(H)}C++}return null},$d.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},$d.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var K,r=[],E=0,c=this.curves.length;for(K=0;c>K;K++)E+=this.curves[K].getLength(),r.push(E);return this.cacheLengths=r,r},$d.getTransformedPoints=function(o){return this.getPoints(o)},$d.getBoundingBox=function(){var b,o,P,j,$,g,H=this.getPoints();b=o=Number.NEGATIVE_INFINITY,j=$=Number.POSITIVE_INFINITY;var R,h,k,n,E=H[0]instanceof Fh;
for(n=E?new Fh:new fb,h=0,k=H.length;k>h;h++)R=H[h],R.x>b&&(b=R.x),R.x<j&&(j=R.x),R.y>o&&(o=R.y),R.y<$&&($=R.y),E&&(R.z>P&&(P=R.z),R.z<g&&(g=R.z)),n.add(R);var I={minX:j,minY:$,maxX:b,maxY:o};return E&&(I.maxZ=P,I.minZ=g),I};var pl=function(E){Mc.call(this),this.actions=[],E&&this.fromPoints(E)},dn=pl.prototype=as(Mc.prototype),Cb="moveTo",Df="lineTo",Ge="quadraticCurveTo",nl="bezierCurveTo",wr="arc",nh="ellipse";dn.fromPoints=function(w){this.moveTo(w[0].x,w[0].y);for(var E=1,S=w.length;S>E;E++)this.lineTo(w[E].x,w[E].y)},dn.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:Cb,args:e})},dn.lineTo=function(n,D){var N=Array.prototype.slice.call(arguments),q=this.actions[this.actions.length-1].args,X=q[q.length-2],K=q[q.length-1],f=new Xr(new fb(X,K),new fb(n,D));this.curves.push(f),this.actions.push({action:Df,args:N})},dn.quadraticCurveTo=function(r,m,A,I){var U=Array.prototype.slice.call(arguments),N=this.actions[this.actions.length-1].args,Y=N[N.length-2],C=N[N.length-1],T=new Nl(new fb(Y,C),new fb(r,m),new fb(A,I));this.curves.push(T),this.actions.push({action:Ge,args:U})},dn.bezierCurveTo=function(i,Z,h,l,m,H){var w=Array.prototype.slice.call(arguments),S=this.actions[this.actions.length-1].args,L=S[S.length-2],r=S[S.length-1],D=new Oc(new fb(L,r),new fb(i,Z),new fb(h,l),new fb(m,H));this.curves.push(D),this.actions.push({action:nl,args:w})},dn.arc=function(x,P,j,p,M,E){var u=this.actions[this.actions.length-1].args,v=u[u.length-2],z=u[u.length-1];this.absarc(x+v,P+z,j,p,M,E)},dn.absarc=function(C,P,G,w,M,Q){this.absellipse(C,P,G,G,w,M,Q)},dn.ellipse=function(W,A,r,p,n,B,R){var F=this.actions[this.actions.length-1].args,z=F[F.length-2],_=F[F.length-1];this.absellipse(W+z,A+_,r,p,n,B,R)},dn.absellipse=function(Y,p,t,W,D,O,l){var k=Array.prototype.slice.call(arguments),x=new xb(Y,p,t,W,D,O,l);this.curves.push(x);var r=x.getPoint(1);k.push(r.x),k.push(r.y),this.actions.push({action:nh,args:k})},dn.getSpacedPoints=function($){$||($=40);for(var _=[],Q=0;$>Q;Q++)_.push(this.getPoint(Q/$));return _},dn.getPoints=function(r,t){r=r||12;var s,m,$,L,o,U,Q,k,J,_,l,N,B,a,y,j,h,e,P=[];for(s=0,m=this.actions.length;m>s;s++)switch($=this.actions[s],L=$.action,o=$.args,L){case Cb:P.push(new fb(o[0],o[1]));break;case Df:P.push(new fb(o[0],o[1]));break;case Ge:for(U=o[2],Q=o[3],_=o[0],l=o[1],P.length>0?(a=P[P.length-1],N=a.x,B=a.y):(a=this.actions[s-1].args,N=a[a.length-2],B=a[a.length-1]),y=1;r>=y;y++)j=y/r,h=Zr.b2(j,N,_,U),e=Zr.b2(j,B,l,Q),P.push(new fb(h,e));break;case nl:for(U=o[4],Q=o[5],_=o[0],l=o[1],k=o[2],J=o[3],P.length>0?(a=P[P.length-1],N=a.x,B=a.y):(a=this.actions[s-1].args,N=a[a.length-2],B=a[a.length-1]),y=1;r>=y;y++)j=y/r,h=Zr.b3(j,N,_,k,U),e=Zr.b3(j,B,l,J,Q),P.push(new fb(h,e));break;case wr:var c,F=o[0],S=o[1],i=o[2],A=o[3],q=o[4],T=!!o[5],E=q-A,W=2*r;for(y=1;W>=y;y++)j=y/W,T||(j=1-j),c=A+j*E,h=F+i*D(c),e=S+i*w(c),P.push(new fb(h,e));break;case nh:var c,F=o[0],S=o[1],R=o[2],Z=o[3],A=o[4],q=o[5],T=!!o[6],E=q-A,W=2*r;for(y=1;W>=y;y++)j=y/W,T||(j=1-j),c=A+j*E,h=F+R*D(c),e=S+Z*w(c),P.push(new fb(h,e))}var v=P[P.length-1],z=1e-10;return K(v.x-P[0].x)<z&&K(v.y-P[0].y)<z&&P.splice(P.length-1,1),t&&P.push(P[0]),P},dn.toShapes=function(J,H){function i(Z){var C,L,U,c,x,p=[],P=new pl;for(C=0,L=Z.length;L>C;C++)U=Z[C],x=U.args,c=U.action,c==Cb&&0!=P.actions.length&&(p.push(P),P=new pl),P[c].apply(P,x);return 0!=P.actions.length&&p.push(P),p}function U(H){for(var m=[],o=0,N=H.length;N>o;o++){var s=H[o],Z=new pe;Z.actions=s.actions,Z.curves=s.curves,m.push(Z)}return m}function E(o,k){for(var Y=1e-10,d=k.length,e=!1,m=d-1,i=0;d>i;m=i++){var c=k[m],T=k[i],b=T.x-c.x,V=T.y-c.y;if(K(V)>Y){if(0>V&&(c=k[i],b=-b,T=k[m],V=-V),o.y<c.y||o.y>T.y)continue;if(o.y==c.y){if(o.x==c.x)return!0}else{var h=V*(o.x-c.x)-b*(o.y-c.y);if(0==h)return!0;if(0>h)continue;e=!e}}else{if(o.y!=c.y)continue;if(T.x<=o.x&&o.x<=c.x||c.x<=o.x&&o.x<=T.x)return!0}}return e}var I=i(this.actions);if(0==I.length)return[];if(H===!0)return U(I);var f,T,B,S=[];if(1==I.length)return T=I[0],B=new pe,B.actions=T.actions,B.curves=T.curves,S.push(B),S;var e=!Zr.isClockWise(I[0].getPoints());e=J?!e:e;var n,d=[],D=[],b=[],w=0;D[w]=j,b[w]=[];var P,s;for(P=0,s=I.length;s>P;P++)T=I[P],n=T.getPoints(),f=Zr.isClockWise(n),f=J?!f:f,f?(!e&&D[w]&&w++,D[w]={s:new pe,p:n},D[w].s.actions=T.actions,D[w].s.curves=T.curves,e&&w++,b[w]=[]):b[w].push({h:T,p:n[0]});if(!D[0])return U(I);if(D.length>1){for(var c=!1,G=[],X=0,m=D.length;m>X;X++)d[X]=[];for(var X=0,m=D.length;m>X;X++){D[X];for(var W=b[X],Y=0;Y<W.length;Y++){for(var z=W[Y],u=!0,l=0;l<D.length;l++)E(z.p,D[l].p)&&(X!=l&&G.push({froms:X,tos:l,hole:Y}),u?(u=!1,d[l].push(z)):c=!0);u&&d[X].push(z)}}G.length>0&&(c||(b=d))}var V,y,Q;for(P=0,s=D.length;s>P;P++)for(B=D[P].s,S.push(B),V=b[P],y=0,Q=V.length;Q>y;y++)B.holes.push(V[y].h);return S};var pe=function(){pl.apply(this,arguments),this.holes=[]},Ql=pe.prototype=as(dn);Ql.getPointsHoles=function(C){var u,e=this.holes.length,I=[];for(u=0;e>u;u++)I[u]=this.holes[u].getTransformedPoints(C);return I},Ql.extractAllPoints=function(N){return{shape:this.getTransformedPoints(N),holes:this.getPointsHoles(N)}},Ql.extractPoints=function(Q){return this.extractAllPoints(Q)};var Zr={triangulateShape:function(D,v){function Q(X,A,p){return X.x!=A.x?X.x<A.x?X.x<=p.x&&p.x<=A.x:A.x<=p.x&&p.x<=X.x:X.y<A.y?X.y<=p.y&&p.y<=A.y:A.y<=p.y&&p.y<=X.y}function V(O,q,y,L,D){var c=1e-10,R=q.x-O.x,_=q.y-O.y,Y=L.x-y.x,J=L.y-y.y,N=O.x-y.x,i=O.y-y.y,m=_*Y-R*J,a=_*N-R*i;if(K(m)>c){var E;if(m>0){if(0>a||a>m)return[];if(E=J*N-Y*i,0>E||E>m)return[]}else{if(a>0||m>a)return[];if(E=J*N-Y*i,E>0||m>E)return[]}if(0==E)return!D||0!=a&&a!=m?[O]:[];if(E==m)return!D||0!=a&&a!=m?[q]:[];if(0==a)return[y];if(a==m)return[L];var P=E/m;return[{x:O.x+P*R,y:O.y+P*_}]}if(0!=a||J*N!=Y*i)return[];var x=0==R&&0==_,v=0==Y&&0==J;if(x&&v)return O.x!=y.x||O.y!=y.y?[]:[O];if(x)return Q(y,L,O)?[O]:[];if(v)return Q(O,q,y)?[y]:[];var r,F,S,W,B,o,l,X;return 0!=R?(O.x<q.x?(r=O,S=O.x,F=q,W=q.x):(r=q,S=q.x,F=O,W=O.x),y.x<L.x?(B=y,l=y.x,o=L,X=L.x):(B=L,l=L.x,o=y,X=y.x)):(O.y<q.y?(r=O,S=O.y,F=q,W=q.y):(r=q,S=q.y,F=O,W=O.y),y.y<L.y?(B=y,l=y.y,o=L,X=L.y):(B=L,l=L.y,o=y,X=y.y)),l>=S?l>W?[]:W==l?D?[]:[B]:X>=W?[B,F]:[B,o]:S>X?[]:S==X?D?[]:[r]:X>=W?[r,F]:[r,o]}function z(z,A,W,q){var Y=1e-10,y=A.x-z.x,x=A.y-z.y,v=W.x-z.x,Z=W.y-z.y,c=q.x-z.x,U=q.y-z.y,N=y*Z-x*v,$=y*U-x*c;if(K(N)>Y){var i=c*Z-U*v;return N>0?$>=0&&i>=0:$>=0||i>=0}return $>0}function d(M,x){function r(L,$){var x=k.length-1,U=L-1;0>U&&(U=x);var g=L+1;g>x&&(g=0);var A=z(k[L],k[U],k[g],F[$]);if(!A)return!1;var m=F.length-1,M=$-1;0>M&&(M=m);var y=$+1;return y>m&&(y=0),A=z(F[$],F[M],F[y],k[L]),A?!0:!1}function t(y,Y){var P,N,$;for(P=0;P<k.length;P++)if(N=P+1,N%=k.length,$=V(y,Y,k[P],k[N],!0),$.length>0)return!0;return!1}function I(c,w){var h,m,q,u,L;for(h=0;h<p.length;h++)for(m=x[p[h]],q=0;q<m.length;q++)if(u=q+1,u%=m.length,L=V(c,w,m[q],m[u],!0),L.length>0)return!0;return!1}for(var F,G,R,f,A,B,_,T,y,L,E,k=M.concat(),p=[],D=[],C=0,Q=x.length;Q>C;C++)p.push(C);for(var o=0,q=2*p.length;p.length>0&&(q--,!(0>q));)for(R=o;R<k.length;R++){f=k[R],G=-1;for(var C=0;C<p.length;C++)if(B=p[C],_=f.x+":"+f.y+":"+B,D[_]===j){F=x[B];for(var m=0;m<F.length;m++)if(A=F[m],r(R,m)&&!t(f,A)&&!I(f,A)){G=m,p.splice(C,1),T=k.slice(0,R+1),y=k.slice(R),L=F.slice(G),E=F.slice(0,G+1),k=T.concat(L).concat(E).concat(y),o=R;break}if(G>=0)break;D[_]=!0}if(G>=0)break}return k}for(var F,s,t,l,g,m,q={},Z=D.concat(),T=0,G=v.length;G>T;T++)Array.prototype.push.apply(Z,v[T]);for(F=0,s=Z.length;s>F;F++)g=Z[F].x+":"+Z[F].y,q[g]!==j,q[g]=F;var C=d(D,v),R=ad.Triangulate(C,!1);for(F=0,s=R.length;s>F;F++)for(l=R[F],t=0;3>t;t++)g=l[t].x+":"+l[t].y,m=q[g],m!==j&&(l[t]=m);return R.concat()},isClockWise:function(l){return ad.Triangulate.area(l)<0},b2p0:function(h,J){var K=1-h;return K*K*J},b2p1:function(S,Y){return 2*(1-S)*S*Y},b2p2:function(W,v){return W*W*v},b2:function(O,V,c,W){return this.b2p0(O,V)+this.b2p1(O,c)+this.b2p2(O,W)},b3p0:function(N,Z){var Y=1-N;return Y*Y*Y*Z},b3p1:function(h,X){var F=1-h;return 3*F*F*h*X},b3p2:function(u,t){var R=1-u;return 3*R*u*u*t},b3p3:function(Y,M){return Y*Y*Y*M},b3:function(O,b,C,B,P){return this.b3p0(O,b)+this.b3p1(O,C)+this.b3p2(O,B)+this.b3p3(O,P)}},ad={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var D=G.keys(this.faces);return D.length?D[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(I){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(Q){var u=Q.familyName.toLowerCase(),L=this;return L.faces[u]=L.faces[u]||{},L.faces[u][Q.cssFontWeight]=L.faces[u][Q.cssFontWeight]||{},L.faces[u][Q.cssFontWeight][Q.cssFontStyle]=Q,Q},drawText:function(o){var _,p=this.getFace(),V=this.size/p.resolution,y=0,H=String(o).split(""),I=H.length,e=[];for(_=0;I>_;_++){var K=new pl,z=this.extractGlyphPoints(H[_],p,V,y,K);z&&(y+=z.offset*this.spacing,e.push(z.path))}var R=y/2;return{paths:e,offset:R}},extractGlyphPoints:function($,g,M,h,z){var u,N,G,E,b,o,Y,C,J,l,m,n,j,s,w,O,t,S,R,r=[],T=g.glyphs[$]||g.glyphs["?"];if(T){if(T.o)for(E=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),o=E.length,Y=M,C=M,u=0;o>u;)switch(b=E[u++]){case"m":J=E[u++]*Y+h,l=E[u++]*C,z.moveTo(J,l);break;case"l":J=E[u++]*Y+h,l=E[u++]*C,z.lineTo(J,l);break;case"q":if(m=E[u++]*Y+h,n=E[u++]*C,w=E[u++]*Y+h,O=E[u++]*C,z.quadraticCurveTo(w,O,m,n),R=r[r.length-1])for(j=R.x,s=R.y,N=1,G=this.divisions;G>=N;N++){var e=N/G;Zr.b2(e,j,w,m),Zr.b2(e,s,O,n)}break;case"b":if(m=E[u++]*Y+h,n=E[u++]*C,w=E[u++]*Y+h,O=E[u++]*C,t=E[u++]*Y+h,S=E[u++]*C,z.bezierCurveTo(w,O,t,S,m,n),R=r[r.length-1])for(j=R.x,s=R.y,N=1,G=this.divisions;G>=N;N++){var e=N/G;Zr.b3(e,j,w,t,m),Zr.b3(e,s,O,S,n)}}return{offset:T.ha*M,path:z}}}};ad.generateShapes=function(C,z){z=z||{};var A=z.font;if(A===j&&(A=ad.getDefaultFont(),!A))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var R=z.size!==j?z.size:1,X=z.curveSegments!==j?z.curveSegments:4,u=z.spacing!==j?z.spacing:1,D=z.weight!==j?z.weight:"normal",I=z.style!==j?z.style:"normal";ad.size=R,ad.divisions=X,ad.face=A,ad.weight=D,ad.style=I,ad.spacing=u;for(var Z=ad.drawText(C),V=Z.paths,d=[],g=0,i=V.length;i>g;g++)Array.prototype.push.apply(d,V[g].toShapes());return d},function(Z){var l=1e-10,W=function(n,K){var _=n.length;if(3>_)return null;var S,z,L,y=[],P=[],f=[];if(v(n)>0)for(z=0;_>z;z++)P[z]=z;else for(z=0;_>z;z++)P[z]=_-1-z;var i=_,N=2*i;for(z=i-1;i>2;){if(N--<=0)return K?f:y;if(S=z,S>=i&&(S=0),z=S+1,z>=i&&(z=0),L=z+1,L>=i&&(L=0),B(n,S,z,L,i,P)){var x,M,D,A,s;for(x=P[S],M=P[z],D=P[L],y.push([n[x],n[M],n[D]]),f.push([P[S],P[z],P[L]]),A=z,s=z+1;i>s;A++,s++)P[A]=P[s];i--,N=2*i}}return K?f:y},v=function($){for(var T=$.length,K=0,V=T-1,s=0;T>s;V=s++)K+=$[V].x*$[s].y-$[s].x*$[V].y;return.5*K},B=function(S,t,E,y,u,H){var z,s,h,g,M,N,r,I,d;if(s=S[H[t]].x,h=S[H[t]].y,g=S[H[E]].x,M=S[H[E]].y,N=S[H[y]].x,r=S[H[y]].y,l>(g-s)*(r-h)-(M-h)*(N-s))return!1;var V,p,R,U,J,W,T,P,j,k,Q,f,x,o,C;for(V=N-g,p=r-M,R=s-N,U=h-r,J=g-s,W=M-h,z=0;u>z;z++)if(I=S[H[z]].x,d=S[H[z]].y,!(I===s&&d===h||I===g&&d===M||I===N&&d===r)&&(T=I-s,P=d-h,j=I-g,k=d-M,Q=I-N,f=d-r,C=V*k-p*j,x=J*P-W*T,o=R*f-U*Q,C>=-l&&o>=-l&&x>=-l))return!1;return!0};return Z.Triangulate=W,Z.Triangulate.area=v,Z}(ad),F._typeface_js={faces:ad.faces,loadFace:ad.loadFace};var Hg=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Pl=Hg.prototype={constructor:Hg,computeFaceNormals:function(){for(var y=new Fh,F=new Fh,z=0,B=this.faces.length;B>z;z++){var Q=this.faces[z],D=this.vertices[Q.a],E=this.vertices[Q.b],p=this.vertices[Q.c];y.subVectors(p,E),F.subVectors(D,E),y.cross(F),y.normalize(),Q.normal.copy(y)}},computeVertexNormals:function(D){var x,U,h,V,T,Z;for(Z=new Array(this.vertices.length),x=0,U=this.vertices.length;U>x;x++)Z[x]=new Fh;if(D){var e,J,F,k=new Fh,P=new Fh;for(h=0,V=this.faces.length;V>h;h++)T=this.faces[h],e=this.vertices[T.a],J=this.vertices[T.b],F=this.vertices[T.c],k.subVectors(F,J),P.subVectors(e,J),k.cross(P),Z[T.a].add(k),Z[T.b].add(k),Z[T.c].add(k)}else for(h=0,V=this.faces.length;V>h;h++)T=this.faces[h],Z[T.a].add(T.normal),Z[T.b].add(T.normal),Z[T.c].add(T.normal);for(x=0,U=this.vertices.length;U>x;x++)Z[x].normalize();for(h=0,V=this.faces.length;V>h;h++)T=this.faces[h],T.vertexNormals[0]=Z[T.a].clone(),T.vertexNormals[1]=Z[T.b].clone(),T.vertexNormals[2]=Z[T.c].clone()},mergeVertices:function(){var G,n,U,H,I,D,v,s,e={},S=[],u=[],M=4,y=h(10,M);for(U=0,H=this.vertices.length;H>U;U++)G=this.vertices[U],n=$(G.x*y)+"_"+$(G.y*y)+"_"+$(G.z*y),e[n]===j?(e[n]=U,S.push(this.vertices[U]),u[U]=S.length-1):u[U]=u[e[n]];var c=[];for(U=0,H=this.faces.length;H>U;U++){I=this.faces[U],I.a=u[I.a],I.b=u[I.b],I.c=u[I.c],D=[I.a,I.b,I.c];for(var r=0;3>r;r++)if(D[r]==D[(r+1)%3]){c.push(U);break}}for(U=c.length-1;U>=0;U--){var q=c[U];for(this.faces.splice(q,1),v=0,s=this.faceVertexUvs.length;s>v;v++)this.faceVertexUvs[v].splice(q,1)}var o=this.vertices.length-S.length;return this.vertices=S,o}},xb=function(N,I,A,f,t,p,d){this.aX=N,this.aY=I,this.xRadius=A,this.yRadius=f,this.aStartAngle=t,this.aEndAngle=p,this.aClockwise=d};xb.prototype=as(ro),xb.prototype.getPoint=function(k){var l,X=this.aEndAngle-this.aStartAngle;0>X&&(X+=m),X>m&&(X-=m),l=this.aClockwise===!0?this.aEndAngle+(1-k)*(m-X):this.aStartAngle+k*X;var p=this.aX+this.xRadius*D(l),N=this.aY+this.yRadius*w(l);return new fb(p,N)};var Xr=function(S,n){this.v1=S,this.v2=n},ds=Xr.prototype=as(ro);ds.getPoint=function(w){var F=this.v2.clone().sub(this.v1);return F.multiplyScalar(w).add(this.v1),F},ds.getPointAt=function(v){return this.getPoint(v)},ds.getTangent=function(){var v=this.v2.clone().sub(this.v1);return v.normalize()};var Nl=function(Y,B,u){this.v0=Y,this.v1=B,this.v2=u};Nl.prototype=as(ro),Nl.prototype.getPoint=function(G){var X,M;return X=Zr.b2(G,this.v0.x,this.v1.x,this.v2.x),M=Zr.b2(G,this.v0.y,this.v1.y,this.v2.y),new fb(X,M)};var Oc=function(s,T,K,h){this.v0=s,this.v1=T,this.v2=K,this.v3=h};Oc.prototype=as(ro),Oc.prototype.getPoint=function(O){var B,k;return B=Zr.b3(O,this.v0.x,this.v1.x,this.v2.x,this.v3.x),k=Zr.b3(O,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new fb(B,k)},So.create(function(r,j){this.v1=r,this.v2=j},function(n){var N=new Fh;return N.subVectors(this.v2,this.v1),N.multiplyScalar(n),N.add(this.v1),N});var Bl=So.create(function(c,W,d){this.v0=c,this.v1=W,this.v2=d},function(F){var y,t,I;return y=Zr.b2(F,this.v0.x,this.v1.x,this.v2.x),t=Zr.b2(F,this.v0.y,this.v1.y,this.v2.y),I=Zr.b2(F,this.v0.z,this.v1.z,this.v2.z),new Fh(y,t,I)}),Fl=So.create(function(F,M,A,y){this.v0=F,this.v1=M,this.v2=A,this.v3=y},function(v){var m,q,L;return m=Zr.b3(v,this.v0.x,this.v1.x,this.v2.x,this.v3.x),q=Zr.b3(v,this.v0.y,this.v1.y,this.v2.y,this.v3.y),L=Zr.b3(v,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Fh(m,q,L)}),Db=function(H,T,y,k,Z,W,Q,A){Hg.call(this),k=k!==j?k:.5,Z=Z!==j?Z:.5,A=A!==j?A:1,H=H||8,W=W||0,Q=Q||m;var t,K,q=1,r=A/2,e=[],n=[],b=this.vertices,O=this.faces,c=this.faceVertexUvs;for(K=0;q>=K;K++){var o=[],g=[],G=K/q,J=G*(Z-k)+k;for(t=0;H>=t;t++){var p=t/H,N=new Fh,B=-(p*Q+W);N.z=J*w(B),N.y=-G*A+r,N.x=J*D(B),b.push(N),o.push(b.length-1),g.push(new fb(p,G))}e.push(o),n.push(g)}var v,f,i=(Z-k)/A;for(t=0;H>t;t++)for(0!==k?(v=b[e[0][t]].clone(),f=b[e[0][t+1]].clone()):(v=b[e[1][t]].clone(),f=b[e[1][t+1]].clone()),v.setY(C(v.x*v.x+v.z*v.z)*i).normalize(),f.setY(C(f.x*f.x+f.z*f.z)*i).normalize(),K=0;q>K;K++){var d=e[K][t],$=e[K+1][t],P=e[K+1][t+1],R=e[K][t+1],X=v.clone(),I=v.clone(),E=f.clone(),a=f.clone(),Y=n[K][t].clone(),V=n[K+1][t].clone(),F=n[K+1][t+1].clone(),z=n[K][t+1].clone();O.push(new Kd(d,$,R,[X,I,a])),c[0].push([Y,V,z]),O.push(new Kd($,P,R,[I.clone(),E,a.clone()])),c[0].push([V.clone(),F,z.clone()])}if(T&&k>0)for(this.vertices.push(new Fh(0,r,0)),t=0;H>t;t++){var d=e[0][t],$=e[0][t+1],P=this.vertices.length-1,X=new Fh(0,1,0),I=new Fh(0,1,0),E=new Fh(0,1,0),Y=n[0][t].clone(),V=n[0][t+1].clone(),F=new fb(V.x,0);O.push(new Kd(d,$,P,[X,I,E],null,1));var u=t/H*m,l=D(u),h=w(u),s=(t+1)/H*m,S=D(s),L=w(s);c[0].push([new fb(.5+.5*l,.5+.5*h),new fb(.5+.5*S,.5+.5*L),new fb(.5,.5)])}if(y&&Z>0)for(this.vertices.push(new Fh(0,-r,0)),t=0;H>t;t++){var d=e[K][t+1],$=e[K][t],P=b.length-1,X=new Fh(0,-1,0),I=new Fh(0,-1,0),E=new Fh(0,-1,0),Y=n[K][t+1].clone(),V=n[K][t].clone();O.push(new Kd(d,$,P,[X,I,E],null,2));var u=t/H*m,l=D(u),h=w(u),s=(t+1)/H*m,S=D(s),L=w(s);c[0].push([new fb(.5+.5*S,.5-.5*L),new fb(.5+.5*l,.5-.5*h),new fb(.5,.5)])}};Db.prototype=as(Pl);var xg=function(U,E,r,W,I,f,i){Hg.call(this),i=i||.5,U=U||16,E=E||16,r=(r!==j?r:0)-b,W=W!==j?W:m,I=I!==j?I:0,f=f!==j?f:b;var n,t,$=[],X=[],J=this.vertices,H=this.faces,P=this.faceVertexUvs;for(t=0;E>=t;t++){var Z=[],O=[];for(n=0;U>=n;n++){var _=n/U,S=t/E,u=new Fh;u.x=-i*D(r+_*W)*w(I+S*f),u.y=i*D(I+S*f),u.z=i*w(r+_*W)*w(I+S*f),J.push(u),Z.push(J.length-1),O.push(new fb(_,S))}$.push(Z),X.push(O)}for(t=0;E>t;t++)for(n=0;U>n;n++){var d=$[t][n+1],C=$[t][n],s=$[t+1][n],N=$[t+1][n+1],Q=J[d].clone().normalize(),h=J[C].clone().normalize(),A=J[s].clone().normalize(),F=J[N].clone().normalize(),p=X[t][n+1].clone(),z=X[t][n].clone(),L=X[t+1][n].clone(),B=X[t+1][n+1].clone();K(J[d].y)===i?(p.x=(p.x+z.x)/2,H.push(new Kd(d,s,N,[Q,A,F])),P[0].push([p,L,B])):K(J[s].y)===i?(L.x=(L.x+B.x)/2,H.push(new Kd(d,C,s,[Q,h,A])),P[0].push([p,z,L])):(H.push(new Kd(d,C,N,[Q,h,F])),P[0].push([p,z,B]),H.push(new Kd(C,s,N,[h.clone(),A,F.clone()])),P[0].push([z.clone(),L,B.clone()]))}};xg.prototype=as(Pl);var Te=function(C,c,r,O,f,x){Hg.call(this),C=C||.33,c=c||.17,O=O||8,r=r||6,f=f||0,x=x||m;for(var y=new Fh,h=[],I=[],L=0;O>=L;L++)for(var a=L/O*m+b,B=0;r>=B;B++){var v=B/r*x+f;y.x=C*D(v),y.z=-C*w(v);var M=new Fh,l=C+c*D(a);M.x=l*D(v),M.z=-l*w(v),M.y=c*w(a),this.vertices.push(M),h.push(new fb(B/r,1-L/O)),I.push(M.clone().sub(y).normalize())}for(var L=1;O>=L;L++)for(var B=1;r>=B;B++){var U=(r+1)*L+B-1,z=(r+1)*(L-1)+B-1,H=(r+1)*(L-1)+B,g=(r+1)*L+B,t=new Kd(U,z,g,[I[U].clone(),I[z].clone(),I[g].clone()]);this.faces.push(t),this.faceVertexUvs[0].push([h[U].clone(),h[z].clone(),h[g].clone()]),t=new Kd(z,H,g,[I[z].clone(),I[H].clone(),I[g].clone()]),this.faces.push(t),this.faceVertexUvs[0].push([h[z].clone(),h[H].clone(),h[g].clone()])}this.computeFaceNormals()};Te.prototype=as(Pl);var Pg=function(S,f,r){return S?(Hg.call(this),S=S instanceof Array?S:[S],this.addShapeList(S,f),f.convertYZ!==!1&&Bj(this,r),this.computeFaceNormals(),void 0):(S=[],void 0)},Kr=Pg.prototype=as(Hg.prototype);Kr.addShapeList=function(L,d){for(var F=L.length,C=0;F>C;C++){var o=L[C];this.addShape(o,d)}},Kr.addShape=function(Y,V){function s(){if(V.bottom)for(var P=0;b>P;P++)g=N[P],h(g[2],g[1],g[0],!0);if(V.top)for(P=0;b>P;P++)g=N[P],h(g[0]+L*t,g[1]+L*t,g[2]+L*t,!1)}function I(){var c=0;for(q(J,c),c+=J.length,e=0,W=U.length;W>e;e++)i=U[e],q(i,c),c+=i.length}function q(x,g){for(var O,B,P=x.length;--P>=0;){O=P,B=P-1,0>B&&(B=x.length-1);var h=0,T=t;for(h=0;T>h;h++){var n=L*h,W=L*(h+1),N=g+O+n,u=g+B+n,R=g+B+W,C=g+O+W;S(N,u,R,C,x,h,T,O,B)}}}function O(N,Y,S){C.vertices.push(new Fh(N,Y,S))}function h(i,D,e,m){i+=F,D+=F,e+=F,C.faces.push(new Kd(i,D,e,null,null,m?2:1));var Q=m?d.generateBottomUV(C,Y,V,i,D,e):d.generateTopUV(C,Y,V,i,D,e);C.faceVertexUvs[0].push(Q)}function S(j,x,e,D,u,m,S,z,_){j+=F,x+=F,e+=F,D+=F,C.faces.push(new Kd(j,x,D)),C.faces.push(new Kd(x,e,D));var L=d.generateSideWallUV(C,Y,u,V,j,x,e,D,m,S,z,_);C.faceVertexUvs[0].push([L[0],L[1],L[3]]),C.faceVertexUvs[0].push([L[1],L[2],L[3]])}var K,y,p,w,l,a=V.amount,c=V.curveSegments||ui,t=V.steps||1,u=V.extrudePath,x=!1,d=new Vh(V.repeatUVLength);u&&(K=u.getSpacedPoints(t),x=!0,y=V.frames!==j?V.frames:new Oi.FrenetFrames(u,t,!1),p=new Fh,w=new Fh,l=new Fh);var i,e,W,C=this,F=this.vertices.length,G=Y.extractPoints(c),X=G.shape,U=G.holes,o=!Zr.isClockWise(X);if(o){for(X=X.reverse(),e=0,W=U.length;W>e;e++)i=U[e],Zr.isClockWise(i)&&(U[e]=i.reverse());o=!1}var N=Zr.triangulateShape(X,U),J=X;for(e=0,W=U.length;W>e;e++)i=U[e],X=X.concat(i);for(var B,g,L=X.length,b=N.length,z=0;L>z;z++)B=X[z],x?(w.copy(y.normals[0]).multiplyScalar(B.x),p.copy(y.binormals[0]).multiplyScalar(B.y),l.copy(K[0]).add(w).add(p),O(l.x,l.y,l.z)):O(B.x,B.y,0);var E;for(E=1;t>=E;E++)for(z=0;L>z;z++)B=X[z],x?(w.copy(y.normals[E]).multiplyScalar(B.x),p.copy(y.binormals[E]).multiplyScalar(B.y),l.copy(K[E]).add(w).add(p),O(l.x,l.y,l.z)):O(B.x,B.y,a/t*E);s(),I()};var Oi=function(n,t,B,A,x){function d(v,h,n){return U.vertices.push(new Fh(v,h,n))-1}Hg.call(this),t=t||64,B=B||1,A=A||8,x=x||!1;var Q,$,Y,c,o,X,J,f,W,R,S,l,L,O,g,v,P,Z,y,e,E=[],U=this,q=t+1,C=new Fh,s=new Oi.FrenetFrames(n,t,x),i=s.tangents,j=s.normals,b=s.binormals;for(this.tangents=i,this.normals=j,this.binormals=b,W=0;q>W;W++)for(E[W]=[],c=W/(q-1),f=n.getPointAt(c),Q=i[W],$=j[W],Y=b[W],R=0;A>R;R++)o=R/A*m,X=-B*D(o),J=B*w(o),C.copy(f),C.x+=X*$.x+J*Y.x,C.y+=X*$.y+J*Y.y,C.z+=X*$.z+J*Y.z,E[W][R]=d(C.x,C.y,C.z);for(W=0;t>W;W++)for(R=0;A>R;R++)S=x?(W+1)%t:W+1,l=(R+1)%A,L=E[W][R],O=E[S][R],g=E[S][l],v=E[W][l],P=new fb(W/t,R/A),Z=new fb((W+1)/t,R/A),y=new fb((W+1)/t,(R+1)/A),e=new fb(W/t,(R+1)/A),this.faces.push(new Kd(L,O,v)),this.faceVertexUvs[0].push([P,Z,e]),this.faces.push(new Kd(O,g,v)),this.faceVertexUvs[0].push([Z.clone(),y,e.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Oi.prototype=as(Pl),Oi.FrenetFrames=function(A,r,H){function n(){p[0]=new Fh,y[0]=new Fh,J=Number.MAX_VALUE,F=K(N[0].x),q=K(N[0].y),k=K(N[0].z),J>=F&&(J=F,I.set(1,0,0)),J>=q&&(J=q,I.set(0,1,0)),J>=k&&I.set(0,0,1),X.crossVectors(N[0],I).normalize(),p[0].crossVectors(N[0],X),y[0].crossVectors(N[0],p[0])}var i,J,F,q,k,B,E,I=new Fh,N=[],p=[],y=[],X=new Fh,C=new fp,Y=r+1,d=1e-4;for(this.tangents=N,this.normals=p,this.binormals=y,B=0;Y>B;B++)E=B/(Y-1),N[B]=A.getTangentAt(E),N[B].normalize();for(n(),B=1;Y>B;B++)p[B]=p[B-1].clone(),y[B]=y[B-1].clone(),X.crossVectors(N[B-1],N[B]),X.length()>d&&(X.normalize(),i=u(zs(N[B-1].dot(N[B]),-1,1)),p[B].applyMatrix4(C.makeRotationAxis(X,i))),y[B].crossVectors(N[B],p[B]);if(H)for(i=u(zs(p[0].dot(p[Y-1]),-1,1)),i/=Y-1,N[0].dot(X.crossVectors(p[0],p[Y-1]))>0&&(i=-i),B=1;Y>B;B++)p[B].applyMatrix4(C.makeRotationAxis(N[B],i*B)),y[B].crossVectors(N[B],p[B])};var Zp=function(n,Z,C,$){Hg.call(this),Z=Z||18,C=C||0,$=$==R?m:$;for(var v=1/(n.length-1),F=1/Z,E=0,O=Z;O>=E;E++)for(var X=C+E*F*$,H=D(X),J=w(X),u=0,s=n.length;s>u;u++){var V=n[u],Q=new Fh;Q.x=H*V.x-J*V.y,Q.y=J*V.x+H*V.y,Q.z=V.z,this.vertices.push(Q)}for(var r=n.length,E=0,O=Z;O>E;E++)for(var u=0,s=n.length-1;s>u;u++){var c=u+r*E,_=c,W=c+r,H=c+1+r,G=c+1,o=E*F,y=u*v,b=o+F,t=y+v;this.faces.push(new Kd(_,G,W)),this.faceVertexUvs[0].push([new fb(o,y),new fb(o,t),new fb(b,y)]),this.faces.push(new Kd(W,G,H)),this.faceVertexUvs[0].push([new fb(b,y),new fb(o,t),new fb(b,t)])}this.mergeVertices(),Bj(this),this.computeFaceNormals(),this.computeVertexNormals()};Zp.prototype=as(Pl);var nq=function(g,X){X=X||{};var s=ad.generateShapes(g,X);X.amount=X.amount!==j?X.amount:.5,X.convertYZ=!1,X.fill!==!1&&(X.bottom=!0,X.top=!0),Pg.call(this,s,X)};nq.prototype=as(Kr);var Pc=q.Node=function(){Id(Pc,this)},pn={X:vq,Y:$r,Z:Ni},Wl={X:0,Y:1,Z:2},Xq={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Bp="xzy",Ng=function(v,F,S){if(F){var t=F[0],L=F[1],W=F[2];"xzy"===S?($r(v,L),Ni(v,W),vq(v,t)):"xyz"===S?(Ni(v,W),$r(v,L),vq(v,t)):"yxz"===S?(Ni(v,W),vq(v,t),$r(v,L)):"yzx"===S?(vq(v,t),Ni(v,W),$r(v,L)):"zxy"===S?($r(v,L),vq(v,t),Ni(v,W)):"zyx"===S?(vq(v,t),$r(v,L),Ni(v,W)):($r(v,L),Ni(v,W),vq(v,t))}};pm("Node",ce,{ms_ac:["rotationMode","anchorElevation"],_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Bp,_64O:0,_rotationX:0,_53O:0,_host:R,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return $b},_22Q:function(){return qp},getX:function(){return this.p().x},setX:function(S){this.p(S,this.p().y)},getY:function(){return this.p().y},setY:function(A){this.p(this.p().x,A)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(Q){this.setAnchor(Q,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(p){this.setAnchor(this.getAnchor().x,p)},getScaleX:function(){return this.getScale().x},setScaleX:function(g){this.setScale(g,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(i){this.setScale(this.getScale().x,i)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(H,U){up(H,Vf(R,R,this.r3(),this.getRotationMode())),this.translate3d(H[0]*U,H[1]*U,H[2]*U)},translateFront:function(z){this.translate3dBy([0,0,1],z)},translateBack:function(v){this.translate3dBy([0,0,-1],v)},translateLeft:function(b){this.translate3dBy([-1,0,0],b)},translateRight:function(S){this.translate3dBy([1,0,0],S)},translateTop:function(P){this.translate3dBy([0,1,0],P)},translateBottom:function(F){this.translate3dBy([0,-1,0],F)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(B,V,W){1===arguments.length&&(V=B[1],W=B[2],B=B[0]),this.p(B,W),this.setElevation(V)},translate3d:function(T,u,E){1===arguments.length&&(u=T[1],E=T[2],T=T[0]),this.translate(T,E),this.setElevation(this._54O+u)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(h,T,G){1===arguments.length&&(T=h[1],G=h[2],h=h[0]),this.setSize(h,G),this.setTall(T)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(i,f,p){1===arguments.length&&(f=i[1],p=i[2],i=i[0]),this.setRotationX(i),this.setRotation(-f),this.setRotationZ(p)},setRotationY:function(I){this.setRotation(-I)},getRotationY:function(){return-this._64O},lookAtDirection:function(d,p){p=p||Vb;var N=this,c=Yi(d);p===Vb?(N.r3([-v(d[1]/c),-i(d[2],d[0])+s,0]),N.setRotationMode("xzy")):p===pp?(N.r3(0,-i(d[2],d[0]),v(d[1]/c)),N.setRotationMode("zyx")):p===Xf?(N.r3(0,-i(d[2],d[0])+b,-v(d[1]/c)),N.setRotationMode("zyx")):p===Cd?(N.r3([-v(d[1]/c)+s,-i(d[2],d[0])+s,0]),N.setRotationMode("xzy")):p===bn&&(N.r3([-v(d[1]/c)-s,-i(d[2],d[0])+s,0]),N.setRotationMode("xzy")),p===Lo&&(N.r3([-v(d[1]/c)+b,-i(d[2],d[0])+s,b]),N.setRotationMode("zxy"))},lookAt:function(Z,K){return this.lookAtDirection(jf(Z,this.p3()),K)},getLoopedEdges:function(){return this._45I},getEdges:function(){return this._70O},getAgentEdges:function(){return this._49I},getHost:function(){return this._host},setHost:function(R){var L=this;if(L!==R&&L._host!==R){var I=L._host;I&&I._removeAttach(L),L._host=R,L._host&&L._host._addAttach(L),L.fp("host",I,R),L.onHostChanged(I,R)}},getAttaches:function(){return this._69O},_addAttach:function(C){var g=this;g._69O||(g._69O=new ob),g._69O.add(C),g.fp("attaches",R,C)},_removeAttach:function(b){var Z=this;Z._69O.remove(b),Z._69O.isEmpty()&&delete Z._69O,Z.fp("attaches",b,R)},getSourceEdges:function(){return this._42I},getTargetEdges:function(){return this._43I},_2I:function(N){var $=this;$._44I||($._44I=new ob),$._42I||($._42I=new ob),$._44I.add(N),$._42I.add(N),$._20I()},_4I:function(O){var o=this;o._44I||(o._44I=new ob),o._43I||(o._43I=new ob),o._44I.add(O),o._43I.add(O),o._20I()},_16I:function(K){var u=this;u._44I.remove(K),u._42I.remove(K),u._44I.isEmpty()&&delete u._44I,u._42I.isEmpty()&&delete u._42I,u._20I()},_18I:function(O){var T=this;T._44I.remove(O),T._43I.remove(O),T._44I.isEmpty()&&delete T._44I,T._43I.isEmpty()&&delete T._43I,T._20I()},_20I:function(){var Y=this;if(delete Y._45I,!Y._44I||Y._44I.isEmpty())return delete Y._70O,void 0;var C;Y._44I.each(function(Z){Z.isLooped()&&(C||(C={}),C[Z._id]||(Y._45I||(Y._45I=new ob),Y._45I.add(Z),C[Z._id]=Z))}),C?(Y._70O=new ob,Y._44I.each(function(T){C[T._id]?"A"===C[T._id]||(C[T._id]="A",Y._70O.add(T)):Y._70O.add(T)})):Y._70O=Y._44I},hasAgentEdges:function(){return!!this._49I&&!this._49I.isEmpty()},getSourceAgentEdges:function(){return this._46I},getTargetAgentEdges:function(){return this._47I},_1I:function(O){var h=this;h._46I||(h._46I=new ob),h._48I||(h._48I=new ob),h._46I.add(O),h._48I.add(O),h._19I()},_3I:function(R){var r=this;r._47I||(r._47I=new ob),r._48I||(r._48I=new ob),r._47I.add(R),r._48I.add(R),r._19I()},_15I:function($){var O=this;O._46I.remove($),O._48I.remove($),O._46I.isEmpty()&&delete O._46I,O._48I.isEmpty()&&delete O._48I,O._19I()},_17I:function(g){var S=this;S._47I.remove(g),S._48I.remove(g),S._47I.isEmpty()&&delete S._47I,S._48I.isEmpty()&&delete S._48I,S._19I()},_19I:function(){var z=this;delete z._49I;var m=z._48I;if(m&&!m.isEmpty()){var g={};m.each(function(V){g[V._id]?z._49I||(z._49I=new ob):g[V._id]=V}),z._49I?m.each(function(s){g[s._id]&&(z._49I.add(s),delete g[s._id])}):z._49I=m}},getImage:function(){if(this._pendingCheckImageJSON){var o=d.getImage(this._image);o&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof eo&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(e){var M=this,H=M._image,Q=M.getWidth(),U=M.getHeight();M._image=e,M.fp("image",H,e)&&(null!=e&&(Eg(e)||gd(e)&&/\.json$/i.test(e))&&(this._pendingCheckImageJSON=!0),M.fp(Uj,Q,M.getWidth()),M.fp(ys,U,M.getHeight()))},getElevation:function(){return this._54O},setElevation:function(I){var $=this;if(!$._50O){$._50O=1;var J=$._54O;$._54O=I,$.fp(hp,J,I),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(K){var i=this;if(!i._49O){i._49O=1;var Q=i._64O;i._64O=K,i.fp(Yd,Q,K),delete i._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(N){var K=this;if(!K._51O){K._51O=1;var l=K._rotationX;K._rotationX=N,K.fp("rotationX",l,N),delete K._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(M){var Y=this;if(!Y._52O){Y._52O=1;var k=Y._53O;Y._53O=M,Y.fp("rotationZ",k,M),delete Y._52O}},getPosition:function(){return this._position},setPosition:function(T,m){var U=this;if(!U._50I){U._50I=1;var Q;if(Q=2===arguments.length?{x:T,y:m}:T,Q.x!==U._position.x||Q.y!==U._position.y){var V=U._position;U._position=Q,U.fp(Xc,V,Q)}delete U._50I}},translate:function(G,l){var Z=this._position;this.p(Z.x+G,Z.y+l)},getWidth:function(){var o=this;if(o._width>=0)return o._width;var h=o.getStyle("shape3d");if(h){var E=Qi(h);if(E&&E.rawS3)return E.rawS3[0];if("billboard"===h||"plane"===h){var B=ed(o.getStyle("shape3d.image"));return B?se(B,o):20}}var B=ed(o._image);return B?se(B,o):20},setWidth:function(t){var Z=this,L=Z._width;Z._width=t,Z.fp(Uj,L,t)},getHeight:function(){var s=this;if(s._height>=0)return s._height;var Q=s.getStyle("shape3d");if(Q){var J=Qi(Q);if(J&&J.rawS3)return J.rawS3[2];if("plane"===Q){var V=ed(s.getStyle("shape3d.image"));return V?Qo(V,s):20}if("billboard"===Q)return 2}var V=ed(s._image);return V?Qo(V,s):20},setHeight:function(k){var z=this,D=z._height;z._height=k,z.fp(ys,D,k)},getTall:function(){var t=this;if(t._tall>=0)return t._tall;var f=t.getStyle("shape3d");if(f){var S=Qi(f);if(S&&S.rawS3)return S.rawS3[1];if("billboard"===f){var I=ed(t.getStyle("shape3d.image"));return I?Qo(I,t):20}if("plane"===f)return 2}return 20},setTall:function(R){var W=this,Q=W._tall;W._tall=R,W.fp("tall",Q,R)},setSize:function(y,R){var H=this;2===arguments.length?(H.setWidth(y),H.setHeight(R)):(H.setWidth(y.width),H.setHeight(y.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(Z,w,U,j,u){var e=this,N=e.getAnchor(),X=e.getScale();arguments.length<=2&&(u=w,w=Z.y,U=Z.width,j=Z.height,Z=Z.x);var $=u&&X.x<0?1-N.x:N.x,s=u&&X.y<0?1-N.y:N.y;e.p(Z+U*$,w+j*s),u&&(U/=Math.abs(X.x),j/=Math.abs(X.y)),e.setWidth(U),e.setHeight(j)
},getMatrix:function(){var m=this,q=m._64O,B=m._position,w=m.getScale();return new Sn(q,B.x,B.y,w.x,w.y)},getAnchorRect:function(){var P=this,V=P.getWidth(),g=P.getHeight(),q=P.getAnchor();return{x:-V*q.x,y:-g*q.y,width:V,height:g}},toLocal:function(E){return this.getMatrix().tfi(E)},toGlobal:function(R){return this.getMatrix().tf(R)},isInRect:function(c){c=this.toLocal(c);var i=this.getWidth(),h=this.getHeight();return c.x+=i*this.getAnchorX(),c.y+=h*this.getAnchorY(),!(c.x<0||c.y<0||c.x>i||c.y>h)},getRect:function(){var o=this,A=o.getWidth(),i=o.getHeight(),W=o.getAnchor(),c={x:-A*W.x,y:-i*W.y,width:A,height:i},j=o.getMatrix();return c=_q([j.tf(c.x,c.y),j.tf(c.x+c.width,c.y),j.tf(c.x+c.width,c.y+c.height),j.tf(c.x,c.y+c.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var f=this,J=f.getAnchor(),T=f._anchorElevation;return{x:J.x,y:T,z:J.y}},setAnchorElevation:function(C){var g=this,r=g._anchorElevation;return r!==C?(g._anchorElevation=C,g.fp("anchorElevation",r,C),!0):!1},setAnchor3d:function(s,I,f,p){var h,O=this;"number"==typeof s?h={x:s,y:I,z:f}:(h=s.length?{x:s[0],y:s[1],z:s[2]}:s,p=I);var L=O.getDataModel();L&&L.beginTransaction();var b=O.getAnchor3d(),H=O.setAnchor(h.x,h.z);if(O.setAnchorElevation(h.y)&&(H=!0),H&&p&&!Vi){O.getAnchor3d();var V=Tr(O),o=up([h.x-b.x,h.y-b.y,h.z-b.z],V);O.p3(o)}return L&&L.endTransaction(),H},getAnchor:function(){var h=this;if(h.hasOwnProperty("_anchor"))return h._anchor;var I=ed(h._image);return I&&I.anchorX!==j?{x:I.anchorX,y:I.anchorY}:h._anchor},setAnchor:function(s,f,R){var W,T=this;"number"==typeof s?W={x:s,y:f}:(W=s.length?{x:s[0],y:s[1]}:s,R=f);var r=T.getAnchor();if(r.x!==W.x||r.y!==W.y){var J=T.getDataModel();if(J&&J.beginTransaction(),T._anchor=W,T.fp("anchor",r,W),R&&!Vi){var i=T.getPosition(),H=T.getSize(),y=T.getRotation(),k=T.getScale(),K=-H.width*(r.x-W.x)*k.x,I=-H.height*(r.y-W.y)*k.y,p=w(y),z=D(y);T.setPosition(i.x+z*K-p*I,i.y+p*K+z*I)}return J&&J.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(d,O){var Y,C=this;Y=2===arguments.length?{x:d,y:O}:d;var r=C.getScale();(r.x!==Y.x||r.y!==Y.y)&&(C._scale=Y,C.fp("scale",r,Y))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var H=this,c=H._scaleTall,z=H.getScale();return[z.x,c,z.y]},getFinalScale3d:function(){var u=this,x=u.s3(),n=u._dynamicScale3d,I=u.getScale3d();return x&&(I[0]*=x[0],I[1]*=x[1],I[2]*=x[2]),n&&(I[0]*=n[0],I[1]*=n[1],I[2]*=n[2]),I},getFinalRotation3d:function(){var b=this;return b._dynamicRotation||b.r3()},setScaleTall:function(z){var j=this,m=j._scaleTall;m!==z&&(j._scaleTall=z,j.fp("scaleTall",m,z))},setScale3d:function(n,M,X){var x,e=this;x="number"==typeof n?{x:n,y:M,z:X}:n.length?{x:n[0],y:n[1],z:n[2]}:n,e.setScaleTall(x.y),e.setScale(x.x,x.z)},getCorners:function(t,T){t==R&&(t=0),T==R&&(T=t);var h=this,i=h.getAnchor(),W=h.getWidth(),g=h.getHeight(),b=-W*i.x-t,s=-g*i.y-T,A=W+2*t,l=g+2*T,x=h.getMatrix();return[x.tf(b,s),x.tf(b,s+l),x.tf(b+A,s+l),x.tf(b+A,s)]},getEditControlPoints:function(J,A,x){A==R&&(A=0),x==R&&(x=A);var X=this,E=X.getAnchor(),C=X.getWidth(),o=X.getHeight(),u=-C*E.x-A,Q=-o*E.y-x,f=C+2*A,$=o+2*x;if(J)return[{x:u,y:Q},{x:u,y:0},{x:u,y:Q+$},{x:0,y:Q+$},{x:u+f,y:Q+$},{x:u+f,y:0},{x:u+f,y:Q},{x:0,y:Q}];var v=X.getMatrix();return[v.tf(u,Q),v.tf(u,0),v.tf(u,Q+$),v.tf(0,Q+$),v.tf(u+f,Q+$),v.tf(u+f,0),v.tf(u+f,Q),v.tf(0,Q)]},rotateAt:function(U,X,H){var e=this,p=e._position,c=e._64O,n=new Sn(c,p.x,p.y).tf(U,X),F=C(U*U+X*X),M=i(p.y-n.y,p.x-n.x)+H;e.setRotation(c+H),e.p(n.x+F*D(M),n.y+F*w(M))},onParentChanged:function(){Pc.superClass.onParentChanged.apply(this,arguments),this._8I()},_8I:function(){this._70O&&this._70O.each(function(j){j._7I()})},onPropertyChanged:function(){var M={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(v){M[v]=!0}),function(N){var Q=this;Pc.superClass.onPropertyChanged.call(Q,N),M[N.property]&&!Q._layoutUpdating&&Q.updateLayoutParameters(null,N.property),Q._69O&&Q._69O.each(function(u){u.handleHostPropertyChange(N)}),Q._49I&&Q._49I.each(function(N){N.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach()},handleHostPropertyChange:function(c){this.updateAttach(c)},onStyleChanged:function(u){Pc.superClass.onStyleChanged.apply(this,arguments),No[u]&&this.updateAttach()},updateAttach:function(y){var b=this;b._51I||Vi||(b._51I=1,b._71O(y),delete b._51I)},_71O:function(x){var e,u,o,m,J,K,T=this,L=T._host,A=x?x.property:R,s=x?x.oldValue:R,U=x?x.newValue:R;if(L instanceof q.Grid){if(A===hp)T.setElevation(T._54O+U-s);else if(!x||hq[A]){if(e=T.s("attach.row.index"),u=T.s("attach.column.index"),o=L.getCellRect(e,u),!o)return;m=T.s("attach.row.span"),J=T.s("attach.column.span"),(1!==m||1!==J)&&(o=$l(o,L.getCellRect(e+m-1,u+J-1))),cd(o,T,"attach.padding",1),T.setRect(o)}}else if(L instanceof bg&&(K=T.s("attach.index"))>=0&&(!x||Dg[A])){var n=T.s("attach.thickness");n!=R&&T.setHeight(L.getThickness()*n);var k=T.s("attach.offset"),v=L.getPoints(),w=v.size();if(w>K){var H=v.get(K),c=w===K+1?v.get(0):v.get(K+1),a=[c.x-H.x,c.y-H.y],d=Yi(a);if(d){T.s("attach.offset.relative")&&(k*=d),T.s("attach.offset.opposite")&&(k=d-k);var F={x:H.x+a[0]/d*k,y:H.y+a[1]/d*k},C=T.s("attach.gap");C&&(T.s("attach.gap.relative")&&(C*=L.getThickness()),F=wp(R,F,c,C)),T.p(F),T.setRotation(i(a[1],a[0]))}}}else x&&(A===Xc?T.translate(U.x-s.x,U.y-s.y):A===hp?T.setElevation(T._54O+U-s):qd[A]?T._11Q(L,A,U-s):("anchor"===A||"width"===A||"height"===A||"scale"===A)&&T.layout(L))},_11Q:function(){var L=new q.Math.Euler,D=q.Math.Euler.ReverseOrder,u=new q.Math.Vector2,I=new q.Math.Vector2;return function(Y,z,x){var $=this,n=Y.p3(),y=Y.r3(),l=$.p3(),S=$.r3();if(z===Yd&&(z="rotationY",x=-x),(z===Yd||"rotationY"===z)&&0===S[0]&&0===S[2]&&0===y[0]&&0===y[2]&&0===l[1]&&0===n[1])return $.setRotation(-S[1]-x),u.set(l[0],l[2]).rotateAround(I.set(n[0],n[2]),-x),$.p(u.x,u.y),void 0;var c=Xq[Y.getRotationMode()],b=c[0],W=c[1],X=c[2],_=pn[b],T=pn[W],e=pn[X],f=bj();z===Yd+b?(e(f,y[Wl[X]]),T(f,y[Wl[W]]),_(f,x),T(f,-y[Wl[W]]),e(f,-y[Wl[X]])):z===Yd+W?(e(f,y[Wl[X]]),T(f,x),e(f,-y[Wl[X]])):z===Yd+X&&e(f,x);var h=jf(l,n);up(h,f),$.p3(n[0]+h[0],n[1]+h[1],n[2]+h[2]);var A=$.getRotationMode();Ng(f,$.r3(),A),L.setFromRotationMatrix(f,D(A)),$.r3([L.x,L.y,L.z])}}(),isHostOn:function(Y){var u=this;if(u._host&&Y&&Y._69O)for(var N={},r=u._host;r&&r!==u&&!N[r._id];){if(r===Y)return!0;N[r._id]=r,r=r._host}return!1},isLoopedHostOn:function(u){return this.isHostOn(u)&&u.isHostOn(this)},getScaledSize:function(){var g=this.getSize(),Y=this.getScale();return g.width*=Math.abs(Y.x),g.height*=Math.abs(Y.y),g},layout:function(s){if(s=s||this.getHost()){var X=this,u=X.s("layout.h")||"center",M=X.s("layout.v")||"center";if("center"!==u||"center"!==M){var Y=new q.Math.Vector2,J=s.getPosition(),N=s.getAnchor(),c=s.getScaledSize();X.getPosition();var l,r,x,Q,E,P=1,G=1;switch(X._layoutUpdating=!0,u){case"left":Y.setX(X._layoutHValue-N.x*c.width);break;case"right":Y.setX((1-N.x)*c.width-X._layoutHValue);break;case"leftright":l=c.width-X._layoutHValue[2],x=X.getRotation()-s.getRotation(),Q=Math.abs(Math.sin(x)),E=Math.abs(Math.cos(x)),P+=E*l/X._layoutHValue[3],G+=Q*l/X._layoutHValue[4],Y.setX(X._layoutHValue[1]+(X._layoutHValue[5]-N.x)*c.width);break;case"center":Y.setX((.5-N.x)*c.width-X._layoutHValue);break;case"scale":x=X.getRotation()-s.getRotation(),Q=Math.abs(Math.sin(x)),E=Math.abs(Math.cos(x)),Y.setX((.5-N.x)*c.width-X._layoutHValue[1]*c.width/X._layoutHValue[0]),r=c.width/X._layoutHValue[2]-1,P+=E*r,G+=Q*r}switch(M){case"top":Y.setY(X._layoutVValue-N.y*c.height);break;case"bottom":Y.setY((1-N.y)*c.height-X._layoutVValue);break;case"topbottom":x||(x=X.getRotation()-s.getRotation(),Q=Math.abs(Math.sin(x)),E=Math.abs(Math.cos(x))),l=c.height-X._layoutVValue[2],P+=Q*l/X._layoutVValue[3],G+=E*l/X._layoutVValue[4],Y.setY(X._layoutVValue[1]+(X._layoutVValue[5]-N.y)*c.height);break;case"center":Y.setY((.5-N.y)*c.height-X._layoutVValue);break;case"scale":x||(x=X.getRotation()-s.getRotation(),Q=Math.abs(Math.sin(x)),E=Math.abs(Math.cos(x))),Y.setY((.5-N.y)*c.height-X._layoutVValue[1]*c.height/X._layoutVValue[0]),r=c.height/X._layoutVValue[2]-1,P+=Q*r,G+=E*r}(1!==P||1!==G)&&("leftright"===u||"scale"===u?X.setSize(X._layoutHValue[3]*P,X._layoutHValue[4]*G):X.setSize(X._layoutVValue[3]*P,X._layoutVValue[4]*G)),Y.rotateAround(null,s.getRotation()),this.setPosition(Y.x+J.x,Y.y+J.y),X._layoutUpdating=j}}},updateLayoutParameters:function(v,g){if(v=v||this.getHost()){var s=this,C=s.s("layout.h"),V=s.s("layout.v");if(C||V){var m,u,S,R,w,N,t=new q.Math.Vector2,c=v.getPosition(),P=v.getAnchor(),$=v.getScaledSize(),k=s.getPosition(),i=s.getSize();switch(t.set(k.x-c.x,k.y-c.y),t.rotateAround(null,-v.getRotation()),C){case"left":s._layoutHValue=t.x+P.x*$.width;break;case"right":s._layoutHValue=-t.x+(1-P.x)*$.width;break;case"center":s._layoutHValue=-t.x+(.5-P.x)*$.width;break;case"leftright":case"scale":"scale"===C?m=-t.x+(.5-P.x)*$.width:(u=s.getAnchor(),S=s.getRotation()-v.getRotation(),R=Math.cos(S),w=Math.sin(S),N=-Math.min(-u.x*R+u.y*w,-u.x*R-(1-u.y)*w,(1-u.x)*R+u.y*w,(1-u.x)*R-(1-u.y)*w),m=t.x-(N-P.x)*$.width),"position"===g&&"object"==typeof s._layoutHValue?(s._layoutHValue[0]=$.width,s._layoutHValue[1]=m):s._layoutHValue=[$.width,m,$.width,i.width,i.height,N]}switch(V){case"top":s._layoutVValue=t.y+P.y*$.height;break;case"bottom":s._layoutVValue=-t.y+(1-P.y)*$.height;break;case"center":s._layoutVValue=-t.y+(.5-P.y)*$.height;break;case"topbottom":case"scale":"scale"===V?m=-t.y+(.5-P.y)*$.height:(S||(u=s.getAnchor(),S=s.getRotation()-v.getRotation(),R=Math.cos(S),w=Math.sin(S)),N=-Math.min(-u.x*w-u.y*R,-u.x*w+(1-u.y)*R,(1-u.x)*w-u.y*R,(1-u.x)*w+(1-u.y)*R),m=t.y-(N-P.y)*$.height),"position"===g&&"object"==typeof s._layoutVValue?(s._layoutVValue[0]=$.height,s._layoutVValue[1]=m):s._layoutVValue=[$.height,m,$.height,i.width,i.height,N]}}}},getSerializableProperties:function(){var C=Pc.superClass.getSerializableProperties.call(this);return wg(C,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),C}});var zj=q.Edge=function(I,k){var R=this;Id(zj,R),R.setSource(I),R.setTarget(k)};pm("Edge",ce,{_icon:"edge_icon",getUIClass:function(){return Zg},_22Q:function(){return Aj},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},setSource:function(Q){var y=this;if(y._source!==Q){var o=y._source;y._source=Q,o&&o._16I(y),Q&&Q._2I(y),y._7I(),y.fp("source",o,Q)}},setTarget:function(b){var g=this;if(g._target!==b){var _=g._target;g._target=b,_&&_._18I(g),b&&b._4I(g),g._7I(),g.fp("target",_,b)}},isLooped:function(){var e=this;return e._source===e._target&&!!e._source&&!!e._target},_7I:function(){var S,D=this,n=$k(D);D._40I!==n&&(S=this._40I,S&&S._15I(D),D._40I=n,n&&n._1I(D),D.fp("sourceAgent",S,n),Sd(S,D._41I),Sd(n,D._41I));var f=Cl(D);D._41I!==f&&(S=D._41I,S&&S._17I(D),D._41I=f,f&&f._3I(D),D.fp("targetAgent",S,f),Sd(S,D._40I),Sd(f,D._40I))},_22I:function(e){this._52I=e,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var c=this;return c._52I&&c._52I.get(0)!==c&&!c.getStyle(ib)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var d=this,n=d._52I;return n&&!d.getStyle(ib)&&n.size()>1&&d===n.get(0)},toggle:function(){var M=this._52I,D=!this.s(ib);M&&M.size()>1&&(M.each(function(I){I.s(ib,D)}),M.getSiblings().each(function(T){T!==M&&T.each(function(X){X.fp("edgeGroup",R,T)})}))},setStyle:function(I,v){(I===ip||"edge.segments"===I)&&(v=Ec(v)),zj.superClass.setStyle.call(this,I,v)},onStyleChanged:function(L){zj.superClass.onStyleChanged.apply(this,arguments),hf[L]&&Sd(this._41I,this._40I)},getSerializableProperties:function(){var e=zj.superClass.getSerializableProperties.call(this);return wg(e,{source:1,target:1}),e}});var Ap=q.Group=function(){Id(Ap,this)};pm("Group",Pc,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return Wg},onChildAdded:function(){Ap.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Ap.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var k=this;if(!k._54I&&!Vi){var T=k.getChildrenRect();T&&(k._53I=1,k.p(pb(k.s("group.position"),T,k.getSize())),delete k._53I)}},getChildrenRect:function(){var t,F=this;return F.eachChild(function(N){t=$l(t,F.getChildRect(N))}),t},getChildRect:function(i){var q;return ei(i)&&i.s(Rb)&&(sq(i)&&i.isExpanded()&&i.eachChild(function(g){q=$l(q,i.getChildRect(g))}),!q&&i.getRect&&(q=i.getRect())),q},setPosition:function(t,j){var A=this;if(!A._54I){var K;K=2===arguments.length?{x:t,y:j}:t,Vi||A._53I||(A._54I=1,yp(A._children,K.x-A._position.x,K.y-A._position.y),delete A._54I),Ap.superClass.setPosition.call(this,K)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(X){var t=this;if(t._57O!==X){var I=t._57O;t._57O=X,t.fp("expanded",I,t._57O),t._8I()}},_8I:function(){Ap.superClass._8I.call(this),this.eachChild(function(W){ei(W)&&W._8I()})},onStyleChanged:function(z){Ap.superClass.onStyleChanged.apply(this,arguments),"group.position"===z&&this._81I()},getSerializableProperties:function(){var L=Ap.superClass.getSerializableProperties.call(this);return L.expanded=1,L}});var Gk=q.Block=function(){Id(Gk,this)};pm("Block",Pc,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return Ab},onChildAdded:function(){Gk.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Gk.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var l=this;if(!Vi&&!l._updatingToChildren&&l._syncSize&&!l._freezeSyncFromChildren){var _,N,t,E,d,r=[],V=l.getRotation();if(l.eachChild(function(L){ei(L)&&r.push.apply(r,L.getCorners())}),r.length){l._updatingFromChildren=1;var C=D(-V),b=w(-V),H=1/0,e=-1/0,Q=1/0,R=-1/0;for(E=0,d=r.length;d>E;E++)t=r[E],_=t.x,N=t.y,t.x=C*_-b*N,t.y=b*_+C*N,H=f(H,t.x),e=Z(e,t.x),Q=f(Q,t.y),R=Z(R,t.y);var M=l.getScale();l.setSize(K((e-H)/M.x),K((R-Q)/M.y));var J;M.x<0&&(J=H,H=e,e=J),M.y<0&&(J=Q,Q=R,R=J),C=D(V),b=w(V);var L=l.getAnchor();_=H+(e-H)*L.x,N=Q+(R-Q)*L.y,l.setPosition(C*_-b*N,b*_+C*N),delete l._updatingFromChildren}}},setPosition:function(_,l){var i=this;if(!i._updatingToChildren){var U;U=2===arguments.length?{x:_,y:l}:_,Vi||i._updatingFromChildren||(i._updatingToChildren=1,yp(i._children,U.x-i._position.x,U.y-i._position.y),delete i._updatingToChildren),Gk.superClass.setPosition.call(this,U)}},setWidth:function(F){return this.setSize(F,this.getHeight())},setHeight:function(j){return this.setSize(this.getWidth(),j)},setSize:function(G,B){1>G&&(G=1),1>B&&(B=1);var w=this;if(!w._updatingToChildren){2!==arguments.length&&(B=G.height,G=G.width);var u=w.getWidth(),n=w.getHeight();if(G!==u&&Gk.superClass.setWidth.call(w,G),B!==n&&Gk.superClass.setHeight.call(w,B),!Vi&&!w._updatingFromChildren){w._updatingToChildren=1;var c=G/u,A=B/n;w._adjustChildScaleOrSize(c,A,"size"),delete w._updatingToChildren,w.updateFromChildren()}}},_adjustChildScaleOrSize:function(Q,$,S){var K=this;if(K._syncSize){var t=K.getPosition(),p=K.getRotation();K.getScale(),K.eachChild(function(f){if(ei(f)){var K=f.getPosition(),j=f.getRotation(),H=f.getWidth(),O=f.getHeight(),l=f.getScale(),J=l.x*H,R=l.y*O,C=new Sn(j,K.x,K.y,J,R);C.translate(-t.x,-t.y),C.rotate(-p),j=i(C.b*Math.sign(J),C.a*Math.sign(J)),C.scale(Q,$);var m,c,g,a=D(j);if(Math.abs(a)<.001?(m=w(j),c=C.b/m,g=-C.c/m):(c=C.a/a,g=C.d/a),"scale"===S)f.setScale(c/H,g/O);else if("size"===S){var F=c/l.x,e=g/l.y;f.setScale(qg(c)*Math.abs(l.x),qg(g)*Math.abs(l.y)),f.setSize(Math.max(.1,Math.abs(F)),Math.max(.1,Math.abs(e)))}C.rotate(p),C.translate(t.x,t.y),f.setPosition(C.tx,C.ty)}})}},_calcChangeFactor:function(I,c,k,O){var N,e,q,r;return N=K(I),e=K(k),q=N>e?N/e:e/N,N=K(c),e=K(O),r=N>e?N/e:e/N,Z(q,r)},setAnchor:function(){var j=this;if(!j._updatingToChildren){var Y=j.getAnchor();if(Gk.superClass.setAnchor.apply(j,arguments),!Vi&&!j._updatingFromChildren&&j._syncSize){j._updatingToChildren=1;var d=j.getAnchor();j.getPosition();var u=j.getSize(),X=j.getScale(),P=j.getRotation(),R=-u.width*X.x*(Y.x-d.x),e=-u.height*X.y*(Y.y-d.y),I=w(P),v=D(P),m=v*R-I*e,Q=I*R+v*e;j.eachChild(function(c){if(ei(c)){var o=c.getPosition();c.setPosition(o.x-m,o.y-Q)}}),delete j._updatingToChildren}}},setRotation:function(V){var U=this;if(!U._updatingToChildren){var o=U.getRotation();if(Gk.superClass.setRotation.apply(U,arguments),!Vi&&!U._updatingFromChildren){U._updatingToChildren=1;var W=U.getPosition(),m=V-o;U.eachChild(function(r){if(ei(r)){var s=r.getMatrix();s.translate(-W.x,-W.y),s.rotate(m),s.translate(W.x,W.y);var H=Math.sign(r.getScale().x);r.setRotation(i(s.b*H,s.a*H)),r.setPosition(s.tx,s.ty)}}),delete U._updatingToChildren}}},setScale:function(p,d){var W=this;if(!W._updatingToChildren){null==d&&(d=p.y,p=p.x);var $=W.getScale();if(K(p)<.01&&(p=.01*(qg(p)||qg($.x))),K(d)<.01&&(d=.01*(qg(d)||qg($.y))),Gk.superClass.setScale.call(W,p,d),!Vi&&!W._updatingFromChildren){W._updatingToChildren=1;var s=p/$.x,x=d/$.y;W._adjustChildScaleOrSize(s,x,"size"),delete W._updatingToChildren,W.updateFromChildren()}}},getSerializableProperties:function(){var F=Gk.superClass.getSerializableProperties.call(this);return F.clickThroughEnabled=1,F.syncSize=1,F}});var ff=q.Grid=function(){Id(q.Grid,this)};pm("Grid",Pc,{IRotatable:!1,_icon:"grid_icon",_image:R,getUIClass:function(){return Mj},setRotation:function(){},getCellRect:function(S,r){var E=this,t=E.s("grid.row.count"),q=E.s("grid.column.count");if(0>=t||0>=q||0>S||S>=t||0>r||r>=q)return R;var x,k,P,d=E.getRect(),M=E.s("grid.row.percents"),v=E.s("grid.column.percents");if(cd(d,E,"grid.border",-1),M&&M._as&&(M=M._as),v&&v._as&&(v=v._as),M&&M.length===t){for(P=0,x=0;S>x;x++)P+=d.height*M[x];d.y+=P,d.height=d.height*M[S]}else d.height=d.height/t,d.y+=d.height*S;if(v&&v.length===q){for(k=0,x=0;r>x;x++)k+=d.width*v[x];d.x+=k,d.width=d.width*v[r]}else d.width=d.width/q,d.x+=d.width*r;return Qe(d,-E.s("grid.gap")),d}});var vf=q.Text=function(){Id(vf,this),this.setSize(100,50),this.s("text","TEXT")};pm("Text",Pc,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Yg},setWidth:function(Z){Z||(Z=.001),vf.superClass.setWidth.call(this,Z)},setHeight:function(N){N||(N=.001),vf.superClass.setHeight.call(this,N)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),ci("__text__",{width:{value:100,isSafeFunc:!0,func:function(Q){return Q._width}},height:{value:50,isSafeFunc:!0,func:function(v){return v._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var bg=q.Shape=function(){Id(bg,this),this._59O=new ob};bg.__de__=kg,pm("Shape",Pc,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return xf},_22Q:function(){return vh},getLength:function(i){return mh(Sq(this._59O,this._58O,i,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var z=this._58O;return z?new ob(z._as.slice(0)):z},setSegments:function(U){var $=this._58O;U=U?Sj(U)?new ob(U.slice(0)):new ob(U._as.slice(0)):null,($&&U&&$._as.join(",")!==U._as.join(",")||$!==U)&&(this._58O=U,this.fp("segments",$,U))},getPoints:function(){return this._59O},toPoints:function(){var g=this._59O;return new ob(g._as.slice(0))},setPoints:function(V,$){var h=this,C=h._59O;V=V?Sj(V)?new ob(V.slice(0)):new ob(V._as.slice(0)):new ob;var v,q,L,W,H,O;$&&(v=h.getPosition(),O=new Sn(h.getRotation(),0,0,h.getScale().x,h.getScale().y)),(C&&V&&C._as.join(",")!==V._as.join(",")||C!==V)&&(h._59O=V,h.fs(),h.fp("points",C,V)),$&&(q=h.getPosition(),L=q.x-v.x,W=q.y-v.y,H=O.tf(L,W),h.setPosition(q.x-L+H.x,q.y-W+H.y))},addPoint:function(h,v,c){var l=this.toPoints();l.add(h,v),this.setPoints(l,c)},setPoint:function($,c,u){var e=this.toPoints();e.set($,c),this.setPoints(e,u)},removePointAt:function(U){var c=this.toPoints();c.removeAt(U),this.setPoints(c)},setWidth:function(e){var W=this;if(1>e&&(e=1),!W._55I&&!Vi&&W.getWidth()){W._55I=1;var d=W._position.x,z=e/W.getWidth(),N=W.toPoints(),w=new ob;N.each(function(b){w.add({x:(b.x-d)*z+d,y:b.y,e:b.e})}),W.setPoints(w),yo(W,[z,0,0,1,d*(1-z),0]),W.fs(),delete W._55I}bg.superClass.setWidth.call(W,e)},setHeight:function(I){var h=this;if(1>I&&(I=1),!h._55I&&!Vi&&h.getHeight()){h._55I=1;var f=h._position.y,J=I/h.getHeight(),j=h.toPoints(),a=new ob;j.each(function(G){a.add({x:G.x,y:(G.y-f)*J+f,e:G.e})}),h.setPoints(a),yo(h,[1,0,0,J,0,f*(1-J)]),h.fs(),delete h._55I}bg.superClass.setHeight.call(h,I)},setAnchorElevation:function(q){var v=this;v._55I=!0;var I=v._updatingAnchor3d,r=!Vi&&!I;if(r){var H,E=q,T=v.getAnchorElevation(),e=v.getTall();H=e*(T-E),v.shiftPointsElevation(H)}var D=bg.superClass.setAnchorElevation.apply(v,arguments);return I||delete v._55I,D},getShapeElevation:function(){var c=this,Q=c._54O;return Q-(c.getTall()||0)*(c._anchorElevation-.5)},setAnchor3d:function(j,G,V,H){var p,Z=this;"number"==typeof j?p={x:j,y:G,z:V}:(p=j.length?{x:j[0],y:j[1],z:j[2]}:j,H=G),Z._55I=!0,Z._updatingAnchor3d=!0;var P=Z.getDataModel();if(P&&P.beginTransaction(),!Vi){var W=Z.getAnchor3d(),C=Z.getSize(),$=Z.getTall(),N=C.width*(W.x-p.x),t=C.height*(W.z-p.z),h=$*(W.y-p.y);H||Z.shiftPoints(N,t,h);var x=Z.p3()}var z=bg.superClass.setAnchor3d.apply(Z,arguments);if(!Vi&&H){var Y=Z.p3();Z.shiftPoints(Y[0]-x[0]+N,Y[2]-x[2]+t,Y[1]-x[1]+h)}return P&&P.endTransaction(),delete Z._updatingAnchor3d,delete Z._55I,z},setAnchor:function(H,X,o){var h=this;h._55I=!0;var l=h._updatingAnchor3d,w=!Vi&&!l;if(w){var G,N,S;"number"==typeof H?S={x:H,y:X}:(S=H.length?{x:H[0],y:H[1]}:H,o=X);var a=h.getAnchor(),J=h.getSize();G=J.width*(a.x-S.x),N=J.height*(a.y-S.y),o||h.shiftPoints(G,N);var s=h.getPosition()}var E=bg.superClass.setAnchor.apply(h,arguments);if(w){var c=h.getPosition();o&&h.shiftPoints(c.x-s.x+G,c.y-s.y+N)}return l||delete h._55I,E},shiftPoints:function(u,Q,d){var e=this,g=e.getElevation()||0,y=e.toPoints(),w=new ob;y.each(function(L){var j=L.e;d&&(j=(j==R?g:j)+d),w.add({x:L.x+u,y:L.y+Q,e:j})}),e.setPoints(w),e.fs()},shiftPointsElevation:function(e){return this.shiftPoints(0,0,e)},setPosition:function(M,s){var F,p=this;if(!p._28Q){if(p._28Q=1,!p._55I&&!Vi){F=2===arguments.length?{x:M,y:s}:M;var r=F.x-p._position.x,I=F.y-p._position.y;if(0===r&&0===I)return delete p._28Q,void 0;p._55I=1,p.shiftPoints(r,I),yo(p,[1,0,0,1,r,I]),delete p._55I}bg.superClass.setPosition.apply(p,arguments),delete p._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var s=this;if(2!==s._59O.size())return!1;var y=s._58O;return y?2===y.size()&&1===y.get(0)&&2===y.get(1)?!0:!1:!0},fireShapeChange:function(){var K=this;if(!K._55I&&!Vi){var S=_q(K._59O);S&&(K._55I=1,K.setRect(S),delete K._55I)}K.fp(ks,!1,!0)},getSerializableProperties:function(){var n=bg.superClass.getSerializableProperties.call(this);return n.segments=1,n.points=1,n.thickness=1,n.closePath=1,n}});var Zo=q.Polyline=function(){Id(Zo,this),this.s({"shape.background":null,"shape.border.width":2})};pm("Polyline",bg,{_icon:"polyline_icon",_22Q:function(){return $f},getUIClass:function(){return Wh},setClosePath:function(){},setTall:function(q){var r=this;if(!r._55I&&!r._24Q&&!Vi&&r.getTall()){r._24Q=1;var t=r._54O,p=q/r.getTall();r._59O.each(function(x){x.e=x.e==R?t:(x.e-t)*p+t}),r.fs(),delete r._24Q}Zo.superClass.setTall.call(r,q)},setElevation:function(J){var C=this;if(!C._55I&&!C._24Q&&!Vi){C._24Q=1;var W=J-C._54O;C._59O.each(function(M){M.e==R?M.e=J:M.e+=W}),C.fs(),delete C._24Q}Zo.superClass.setElevation.apply(C,arguments)},fireShapeChange:function(){var z=this,x=z._59O;if(!z._55I&&!z._24Q&&!Vi){var s=x.size();if(s){var u=1,k=x.get(0),t=z._54O;k.e==R&&(k.e=t);for(var $=k.e,G=0;s>u;u++){k=x.get(u),k.e==R&&(k.e=t);var M=f($,k.e),L=Z($+G,k.e);$=M,G=L-M}z._24Q=1,z.setTall(G),z.setElevation($+G*z._anchorElevation),delete z._24Q}}Zo.superClass.fireShapeChange.apply(z,arguments)}});var is=q.SubGraph=function(){Id(is,this)};pm("SubGraph",Pc,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){is.superClass._8I.call(this),this.eachChild(function(a){ei(a)&&a._8I()})}}),d.loadingRefGraph=0;var eo=q.RefGraph=function(){Id(eo,this)};pm("RefGraph",Gk,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(w){var R=this._ref;this._ref=w,this.fp("ref",R,w),this.updateRef()},_21I:function(){eo.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var p=this;if(d.loadingRefGraph++,p.clearChildrenFromDataModel(),d.loadingRefGraph--,p._ref&&p._dataModel){p._xhrLoadHandler&&(p._xhrLoadHandler.cancel=!0);var I=Vi,k=p._xhrLoadHandler=function(D){if(D&&p._dataModel){d.loadingRefGraph++;var W=p._pendingUpdateInfo={needToRestore:I};I&&(W.position=p.p(),W.width=p.getWidth(),W.height=p.getHeight(),W.rotation=p.getRotation(),W.anchor=p.getAnchor(),W.scale=p.getScale()),p.p(0,0),p.setAnchor(.5,.5),p.setRotation(0),p.setScale(1,1);var w=d.parse(D),R=p._dataModel.deserialize(w,p,{justDatas:!0});R.each(function(V){V._refGraph=p}),p.checkPendingUpdateInfo(),d.loadingRefGraph--,d.handleRefGraphLoaded(p,R,w)}};k.xhrLoadCalled=!1,d.load(p._ref,function(p){k.cancel||(k.xhrLoadCalled?k(p):Dq(function(){k(p)}))}),k.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var b=this,U=b._pendingUpdateInfo;if(!U)return b.onPendingUpdated&&(d.loadingRefGraph++,b.onPendingUpdated(),d.loadingRefGraph--),void 0;var _=!0;this.eachChild(function(G){(G._pendingCheckImageJSON||G._pendingUpdateInfo)&&(_=!1)}),_&&(d.loadingRefGraph++,b._pendingUpdateInfo=null,b.updateFromChildren(),U.needToRestore&&(b.setSize(U.width,U.height),b.setAnchor(U.anchor),b.setRotation(U.rotation),b.setScale(U.scale),b.p(U.position)),this.getParent()instanceof eo&&this.getParent().checkPendingUpdateInfo(),b.onPendingUpdated&&b.onPendingUpdated(),d.loadingRefGraph--)},getSerializableProperties:function(){var U=eo.superClass.getSerializableProperties.call(this);return U.ref=1,U}}),q.EdgeGroup=function(C,O){this._70O=C,this._siblings=O;for(var D,o,S=0,v=C.size(),u=c[ib];v>S;S++)if(D=C.get(S).getStyle(ib,!1),D!=R){u=D;break}u==R&&(u=!0);var I=d.edgeGroupAgentFunc;for(I&&(o=I(C),o&&o!==C.get(0)&&(C.remove(o),C.add(o,0))),S=0;v>S;S++)C.get(S).s(ib,u)},pm("EdgeGroup",G,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(p){return this._70O.get(p)},indexOf:function($){return this._70O.indexOf($)},each:function(s,j){this._70O.each(s,j)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(j,i){this._siblings.each(function(x){x._70O.each(j,i)})}});var Ef=function(e,Z,N){var I=qb[e]={type:e,action:Z};if(N)for(var _ in N)I[_]=N[_]};wg(d,{setConnectAction:Ef,getConnectAction:function(q,S){if(!S){if(!q)return null;S=q.getCurrentConnectActionType()}return qb[S]},doConnectAction:function(q,B,$,D){D=D||q.getCurrentConnectActionType();var Z=qb[D];if(!Z)return!1;var m=Z.action;return m?(B instanceof eq.Group?q.sm().getSelection().each(function(w){m.call(null,q,w,$)}):m.call(null,q,B,$),!0):!1},doDeleteConnectionAction:function(r,C,O){O=O||r.getCurrentConnectActionType();var N=qb[O];if(!N||!N.delete)return!1;var v=N.delete.action;return v?(C instanceof eq.Group?r.sm().getSelection().each(function(n){v.call(null,r,n)}):v.call(null,r,C),!0):!1}});var Sc=q.JSONSerializer=function(D,x){this.dm=this._dataModel=D,this._hierarchical=d.forceHierarchicalSerialization?!0:x==R?D.isHierarchicalRendering():x};pm("JSONSerializer",G,{ms_ac:["hierarchical"],serialize:function(h){return d.stringify(this.toJSON(),h)},toJSON:function(){var W=this,G=W.dm,u=G.getRoots(),U=W.json={v:d.getVersion(),p:{},a:{},d:[]},O=G.getSerializableAttrs();G.getInit()&&(U.init=G.getInit()),G.getName()&&(U.p.name=G.getName()),G.getBackground()&&(U.p.background=G.getBackground()),G.getLayers()&&(U.p.layers=G.getLayers()),G.getEnvmap()&&(U.p.envmap=G.getEnvmap()),U.p.autoAdjustIndex=G.isAutoAdjustIndex(),U.p.hierarchicalRendering=G.isHierarchicalRendering();for(var P in O){var q=G.a(P);q!==j&&W[Gm](P,q,U.a)}return Zi(U.a)&&delete U.a,W._hierarchical?u.each(W.serializeData,this):G.each(function(D){W.serializeData(D)}),W.dm.fp("serialize",null,U),G.getPostProcessingData()&&(U.p.postProcessingData=G.getPostProcessingData()),U},isSerializable:function(){return!0},getProperties:function(Z){return Z.getSerializableProperties()},getStyles:function(o){return o.getSerializableStyles()},getAttrs:function(O){return O.getSerializableAttrs()},serializeData:function(G){var B=this;if(B.isSerializable(G)&&!G._refGraph){var h,K,U,v,p=rg(G.getClassName())||G.getClass(),j=new p,_={c:G.getClassName(),i:G.getId(),p:{},s:{},a:{}};B.json.d.push(_),h=B.getProperties(G);for(K in h)/^_/.test(K)?(U=G[K],U!==j[K]&&B[Gm](K.substr(1),U,_.p)):(v=dg(K),G[v]&&(U=G[v](),U!==j[v]()&&B[Gm](K,U,_.p)));h=B.getStyles(G);for(K in h)U=G.s(K),U!==j.s(K)&&B[Gm](K,U,_.s);h=B.getAttrs(G);for(K in h)U=G.a(K),U!==j.a(K)&&B[Gm](K,U,_.a);Zi(_.p)&&delete _.p,Zi(_.s)&&delete _.s,Zi(_.a)&&delete _.a}B._hierarchical&&G.getChildren().each(B.serializeData,B)},serializeValue:function(R,r,x){Af(r)?r={__a:r._as}:r instanceof ce&&(r={__i:r.getId()}),x[R]=r},deserialize:function(r,O,x){var C=this;return gd(r)&&/.json$/.test(r)?(d.xhrLoad(r,function(b){C.deserializeImpl(b,O,x)}),void 0):C.deserializeImpl(r,O,x)},deserializeImpl:function(W,M,H){var y=this,J=y.dm;H=yf(H)?{setId:H}:cl(H)?{finishFunc:H}:H||{},W=y.json=gd(W)?d.parse(W):W,W.a&&W.a.onPreDeserialize&&!H.disableOnPreDeserialize&&W.a.onPreDeserialize(W,J,H.view),J.beginTransaction(),Vi++,y._82I={};var T=new ob,r=new ob,t=0,B=W.d.length;if(H.justDatas||(cl(W.init)&&W.init(J),J.setInit(W.init)),!H.justDatas){for(var q in W.a)J.a(q,y[we](W.a[q]));for(var u in W.p)J[bl(u)](W.p[u])}for(;B>t;t++){var G=W.d[t],V=rg(G.c),E=new V,D=G.i;H.setId&&D!=R&&(E._id=D),y._82I[D]=E,T.add(E),r.add(G)}for(t=0;B>t;t++)y.deserializeData(T.get(t),r.get(t));return T.each(function(A){M&&!A.getParent()&&A.setParent(M),J.add(A)}),J.fp("deserialize",null,W),Vi--,J.endTransaction(),W.a&&W.a.onPostDeserialize&&!H.disableOnPostDeserialize&&W.a.onPostDeserialize(W,J,H.view,T),H.finishFunc&&H.finishFunc(W,J,H.view,T),T},deserializeData:function(Q,H){for(var k in H.p)Q[bl(k)](this[we](H.p[k]));for(k in H.s)Q.s(k,this[we](H.s[k]));for(k in H.a)Q.a(k,this[we](H.a[k]))},deserializeValue:function(J){if(Eg(J)){var b=J.__i;if(b!=R)return this._82I[b];if(b=J.__a,Sj(b))return new ob(b)}return J}}),wg(_c,{serialize:function(e,B){return new Sc(this,B).serialize(e)},toJSON:function(T){return new Sc(this,T).toJSON()},deserialize:function(H,w,e){return new Sc(this).deserialize(H,w,e)}});var ur=q.OverlappingBox=function(_){this.gv=_,this.boxes={}};pm("OverlappingBox",G,{clear:function(){var F,n,Z=this.boxes;for(F in Z)n=Z[F],n.length=0},isOverlapping:function(Y,u){var r,g,Q=this,F=Q.boxes,E=F[Y];E?(r=E.rects,g=E.length):E=F[Y]={rects:r=[],length:g=0};var v,R,u;for(v=0;g>v;v++)if(R=r[v],R.x<u.x+u.w&&R.x+R.w>u.x&&R.y<u.y+u.h&&R.h+R.y>u.y)return!0;return r.length<=g?(r.push(u),E.length++):r[E.length++]=u,!1}}),wg(d,{fetch:function(a,N){var $="GET",K=!1,o=null,R="";N&&($=N.method||"GET",K=N.sync,R=N.url,o=N.data||null),a.open($,R,!K),N.responseType?a.responseType=N.responseType:N.overrideMimeType&&a.overrideMimeType(N.overrideMimeType),a.send(o)
},convertImageSrc:function(C,F){F&&"function"==typeof F||(F=function(){}),F(C)}});var Yj=q.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};pm("Request",G,{_responseType:null,_overrideMimeType:"text/plain",send:function(S){var Q=this._xhr,M=this.onload,y=this.onerror;this.getResponseType()?S.responseType=this.getResponseType():this.getOverrideMimeType()&&(S.overrideMimeType=this.getOverrideMimeType()),Q.onload=M,Q.onerror=y,d.fetch(Q,S)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(O){this._responseType=O},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(L){this._overrideMimeType=L},getResponseText:function(){var c=this._xhr;return c.response||c.responseText}}),rf.GraphView=function(L){var h=this;h._24I={},h._34I=new ob,h._25I={},h._56I={},h._view=jj(1,h),h._canvas=oe(h._view),h.dm(L?L:new _c),this._coreInteractor=new sb(this),h.setEditable(!1),h.setScrollBarVisible(d.graphViewScrollBarVisible)},Bn("GraphView",G,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Pd,of,ap,cq,"resettable","editInteractor",Vo,"pannable","rectSelectable","autoScrollZone",Xd,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_resettable:d.graphViewResettable,_pannable:d.graphViewPannable,_rectSelectable:d.graphViewRectSelectable,_autoScrollZone:d.graphViewAutoScrollZone,_rectSelectBackground:d.graphViewRectSelectBackground,_rectSelectBorderColor:d.graphViewRectSelectBorderColor,_editPointSize:d.graphViewEditPointSize,_editPointBorderColor:d.graphViewEditPointBorderColor,_editPointBackground:d.graphViewEditPointBackground,_scrollBarColor:ep,_scrollBarSize:Wd,_autoHideScrollBar:_l,_autoMakeVisible:rn,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(w){this._dataModel.setLayers(w)},setEditable:function(X){var c=this,K=c.__interactorMap__;if(!K){var n=rf.XEditInteractor;K=c.__interactorMap__={scrollBar:new yn(c),select:new Jb(c),edit:n?new n(c):new kd(c),move:new rd(c),"default":new Vd(c),touch:new bq(c,{editable:!1})}}X?(c._uieditable=!0,c.setInteractors([K.scrollBar,K.select,K.edit,K.move,K.default,K.touch])):(c._uieditable=!1,c.setInteractors([K.scrollBar,K.select,K.move,K.default,K.touch]))},getCanvas:function(){return this._canvas},_33I:function(i){var F=i.getUIClass();return F?new F(this,i):R},getDataUI:function(I){var v=this,B=v._25I[I._id];return B===j&&(B=v._33I(I),v._25I[I._id]=B),B},getNodeRect:function(F){return d.getNodeRect(this,F)},getEdgeInfo:function(A){var V=this.getDataUI(A);return V?(V._79o(),V._78o):null},getEdgeSourcePosition:function(h){var A=this,t=A.getDataUI(h),V=t.s,M=t._data._40I;return Lq(A,M,V("edge.source.position"),V("edge.source.offset.x"),V("edge.source.offset.y"),V("edge.source.anchor.x"),V("edge.source.anchor.y"))},getEdgeTargetPosition:function(l){var C=this,s=C.getDataUI(l),J=s.s,Q=s._data._41I;return Lq(C,Q,J("edge.target.position"),J("edge.target.offset.x"),J("edge.target.offset.y"),J("edge.target.anchor.x"),J("edge.target.anchor.y"))},invalidateAll:function(O){var f=this;if(O){for(var U in f._25I){var V=f._25I[U];V&&V.dispose()}f._25I={},f._56I={},f._24I={},f._34I.clear(),f.redraw()}else f.dm().each(function(v){f.invalidateData(v)})},invalidateSelection:function(){var k=this;k.sm().each(function(g){k.invalidateData(g)})},invalidateData:function(G){var M=this;M._24I[G._id]=G,M._21Q(G),M.iv()},_21Q:function(F){var m=this,v=m._24I;if(mm(F)&&ve[F.s(fo)]){var p=F.getSourceAgent();p&&p.getAgentEdges().each(function(u){v[u._id]=u}),p=F.getTargetAgent(),p&&p.getAgentEdges().each(function(o){v[o._id]=o}),m.iv()}},redraw:function(C){var M=this;M._32I||(C?M._34I.add(C):(M._32I=1,M._34I.clear()),M.iv())},each:function(M,g){var L,t,c,$=0,z=this.getLayers(),Z=this._dataModel,b=Z._datas._as,h=b.length;if(z){for(var C=z.length;C>$;$++)if(c=z[$],Eg(c)&&(c=c.name),Z.isHierarchicalRendering()){var A=function(i){return i._layer===c?g?M.call(g,i):M(i):void 0};if(this._dataModel.eachByHierarchical(A)===!1)return}else for(var G=0;h>G;G++)if(L=b[G],L._layer===c&&(t=g?M.call(g,L):M(L),t===!1))return}else if(Z.isHierarchicalRendering())this._dataModel.eachByHierarchical(M,null,g);else for(;h>$;$++)if(L=b[$],t=g?M.call(g,L):M(L),t===!1)return},reverseEach:function(Y,a){var s,W,j,o,X=this._dataModel,x=X._layers,C=X._datas._as,V=C.length;if(x){for(s=x.length-1;s>=0;s--)if(o=x[s],Eg(o)&&(o=o.name),X.isHierarchicalRendering()){var m=function(J){return J._layer===o?a?Y.call(a,J):Y(J):void 0};if(X.reverseEachByHierarchical(m)===!1)return}else for(var y=V-1;y>=0;y--)if(W=C[y],W._layer===o&&(j=a?Y.call(a,W):Y(W),j===!1))return}else if(X.isHierarchicalRendering())X.reverseEachByHierarchical(Y,null,a);else for(s=V-1;s>=0;s--)if(W=C[s],j=a?Y.call(a,W):Y(W),j===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var Q=this,e=Q._84I;if(!e){var s=this.dm().a("width"),d=this.dm().a("height");s>0&&d>0?Q._84I={x:0,y:0,width:s,height:d}:(Q.each(function(_){Q.isVisible(_)&&(e=$l(e,Q.getDataUIBounds(_)))}),Q._84I=e?e:lc)}return Q._84I},getScrollRect:function(){return $l(this.getContentRect(),this._29I)},makeCenter:function(T,r,m){var a=this;if(!a.getWidth()||!a.getHeight())return m||Dq(a.centerData,a,[T,r,!0],500),void 0;a.makeVisible(T),a.validate();var h=a.getDataUIBounds(T);if(h){var L=a.getWidth(),q=a.getHeight(),y=h.x+h.width/2,P=h.y+h.height/2,t=-y*a._zoom+L/2,_=-P*a._zoom+q/2;a.setTranslate(t,_,r)}},fitData:function(w,Z,B,k,f){var C=this;if(!C.getWidth()||!C.getHeight())return f||Dq(C.fitData,C,[w,Z,B,k,!0],500),void 0;var J=function(){C.makeVisible(w),C.validate();var r=C.getDataUIBounds(w);r&&(r=Pb(r),Qe(r,B==R?20:B),C.fitRect(r,Z,k))};Z?d.callWhenLoaded(J):J()},fitContent:function(C,E,V,h){var b=this;if(!b.getWidth()||!b.getHeight())return h||Dq(b.fitContent,b,[C,E,V,!0],500),void 0;var I=function(){b.validate();var M=Pb(b.getContentRect());Qe(M,E==R?20:E),b.fitRect(M,C,V)};C?d.callWhenLoaded(I):I()},fitRect:function(R,c,z){var W=this,Z=W.getWidth(),L=W.getHeight(),j=R.x+R.width/2,S=R.y+R.height/2,h=f(Z/R.width,L/R.height),X=W._zoom,Y=-j*X+Z/2,J=-S*X+L/2;0===h||isNaN(h)||(z&&(h=f(1,h)),c?(W._65I&&(delete W._65I.finishFunc,W._65I.stop(!0)),W._14o&&W._14o.stop(!0),W.setTranslate(Y,J,{finishFunc:function(){W.setZoom(h,c)}})):(W.setTranslate(Y,J),W.setZoom(h)))},toCanvas:function(X,B){B=B||this._zoom,this.validateImpl();var k=this,G=k.getContentRect();G.width||(G.width=10),G.height||(G.height=10);var Z=oe(),q=G.x*B,A=G.y*B,n=G.width*B,b=G.height*B;ul(Z,n,b,1);var c=Nf(Z);return X=X||this._dataModel.getBackground(),X&&wk(c,0,0,n,b,X),gm(c,-q,-A),c.scale(B,B),k._42(c),c.restore(),Z},toDataURL:function(u,f,e){return this.toCanvas(u,e).toDataURL(f||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(s,Y){var O=this;O._93db(s,Y),O.each(function(e){var r=O.getDataUI(e);if(r){var t=O._56I[e._id],o=r._htmlView;if(t){var S=r._79o();if(o=r._htmlView,q.HtmlNode&&e instanceof q.HtmlNode)r._42(s);else{var h=O.getViewRect(),Q=o&&o.layoutHTML;!Y||Ui(Y,S)?(Q&&(o.layoutHTML(),r.__outerLayout&&delete r.__outerLayout),r._42(s)):Ui(h,S)||!Q||r.__outerLayout||(o.layoutHTML(),r.__outerLayout=!0)}}o&&(o.getView&&(o=o.getView()),o.style.display=t?"block":Pi)}}),O._92db(s,Y)},validateImpl:function(){var V,v,b,R,k,I=this,j=I.tx(),Q=I.ty(),q=I._zoom,$=I._canvas,O=this.getWidth(),W=this.getHeight(),A=I._29I,G={x:-j/q,y:-Q/q,width:O/q,height:W/q},t={},D=I._34I,m=I._24I,r=I._32I,f=I._23I;I._24I={},(O!==$.clientWidth||W!==$.clientHeight)&&(ul($,O,W),r=1),r||cm(G,A)||(r=1),I._29I=G,I.each(function(X){v=X._id;var Y=t[v]=I.isVisible(X);Y!==I._56I[v]&&(m[v]=X,b=I.getDataUI(m[v]),b&&b._84o(Y),I._84o(X,Y))},I);for(v in m)b=I.getDataUI(m[v]),b&&(!r&&I._56I[v]&&(k=b._79o(),k&&D.add(k)),b.invalidate()),I._83I=1;if(I._56I=t,!r)for(v in m)t[v]&&(b=I.getDataUI(m[v]),b&&(k=b._79o(),k&&D.add(k)));if(r?R=G:(D.each(function(B){Ui(G,B)&&(R=$l(R,B))}),R&&(Qe(R,Z(1,1/q)),R.x=X(R.x*q)/q,R.y=X(R.y*q)/q,R.width=S(R.width*q)/q,R.height=S(R.height*q)/q,R=Vc(G,R))),I._74O=R,R){V=Nf($);var T=R.x,w=R.y,M=R.width,o=R.height;T=Math.floor((T*q+j)*xs),w=Math.floor((w*q+Q)*xs),M=Math.ceil(M*q*xs)+1,o=Math.ceil(o*q*xs)+1,V.beginPath(),V.rect(T,w,M,o),V.clip(),V.clearRect(T,w,M,o),qk(V,j,Q,q),I._42(V,R),V.restore(),delete I._74O}if(D.clear(),delete I._32I,f&&O>0&&W>0){var b=I.getDataUI(f);if(b){var k=b._79o(),i=I._29I,K=i.x,h=i.y,P=i.width,C=i.height,q=I._zoom;k&&!Ui(k,i)&&(k.x+k.width<K&&I.tx(-k.x*q),k.x>K+P&&I.tx(-(k.x+k.width-P)*q),k.y+k.height<h&&I.ty(-k.y*q),k.y>h+C&&I.ty(-(k.y+k.height-C)*q))}delete I._23I}I._83I&&(delete I._83I,delete I._84I),I._98O(),Zi(I._24I)||Dq(I.iv,I)},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(P){var K=this;P!==K.isScrollBarVisible()&&(P?(ke(K._view,K._79O=me()),ke(K._79O,K._27I=me()),ke(K._79O,K._28I=me())):(un(K._79O),delete K._79O,delete K._27I,delete K._28I),K.fp("scrollBarVisible",!P,P))},showScrollBar:function(){var w=this;w._79O&&(w._85I||(I(function(){w._86I()},vi),w.iv()),w._85I=new Date)},_86I:function(){var C=this;if(C._85I){var Q=new Date,h=Q.getTime();h-C._85I.getTime()>=vi?(delete C._85I,C.iv()):I(function(){C._86I()},vi)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var S=this,O=this._27I,h=this._28I;if(S._79O){if(S._autoHideScrollBar&&!S._85I)return O.style.visibility=Em,h.style.visibility=Em,void 0;var E=S.getScrollBarColor(),Y=S._zoom,b=S.getScrollBarSize(),Z=S.getViewRect(),u=S.getScrollRect(),q=Z.height*Y,H=u.height*Y,W=Z.width*Y-b-2,i=q*((Z.y-u.y)*Y/H),B=q*(q/H),A=O.style;H-.5>q?(oh>B&&(i=i+B/2-oh/2,0>i&&(i=0),i+oh>q&&(i=q-oh),B=oh),Zh(O,W,i,b,B),A.visibility=Wk,A.background=E,A.borderRadius=b/2+Rq):A.visibility=Em;var I=Z.width*Y,_=u.width*Y,i=Z.height*Y-b-2,W=I*((Z.x-u.x)*Y/_),g=I*(I/_),A=h.style;_-.5>I?(oh>g&&(W=W+g/2-oh/2,0>W&&(W=0),W+oh>I&&(W=I-oh),g=oh),Zh(h,W,i,g,b),A.visibility=Wk,A.background=E,A.borderRadius=b/2+Rq):A.visibility=Em}},setDataModel:function(V){var K=this,A=K._dataModel,q=K._selectionModel;A!==V&&(A&&(A.ump(K.handleDataModelPropertyChange,K),A.umm(K.handleDataModelChange,K),A.umd(K.handleDataPropertyChange,K),A.removeIndexChangeListener(K._75O,K),A.removeHierarchyChangeListener(K.handleHierarchyChange,K),q||A.sm().ums(K.handleSelectionChange,K)),K._dataModel=V,V.mp(K.handleDataModelPropertyChange,K),V.mm(K.handleDataModelChange,K),V.md(K.handleDataPropertyChange,K),V.addIndexChangeListener(K._75O,K),V.addHierarchyChangeListener(K.handleHierarchyChange,K),q?q._21I(V):V.sm().ms(K.handleSelectionChange,K),K.invalidateAll(!0),K.fp(Xp,A,V),K._canvas.style.background=V.getBackground()||"")},getLayersInfo:function(){if(this._layersInfo===j){var E=this.getLayers();E?(this._layersInfo={},E.forEach(function(r){var S=Eg(r)?r.name:r;this._layersInfo[S]=r},this)):this._layersInfo=null}return this._layersInfo},updateLayers:function(){this._layersInfo=j,this.invalidateSelection(),this.redraw()},handleDataModelPropertyChange:function(V){if("background"===V.property){var U=this._canvas.style.background,s=V.newValue||"";this._canvas.style.background=s,this.fp("canvasBackground",U,s)}else"a:width"===V.property||"a:height"===V.property?(this._83I=1,this.redraw()):"layers"===V.property?this.updateLayers():"hierarchicalRendering"===V.property&&this.redraw()},handleDataPropertyChange:function(o){this.dm().isHierarchicalRendering()&&"parent"===o.property&&o.data.hasChildren()&&this.redraw(),this.invalidateData(o.data)},onPropertyChanged:function(l){var M=this,b=l.property;if(M.redraw(),"zoom"===b){var s=M.sm().getSelection();s.size()&&s.each(function(Z){Z.invalidate()})}Hf[b]?M.showScrollBar():b===Vo&&M.onCurrentSubGraphChanged(l)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(i){var v=this,H=i.kind,x=i.data;if(v._83I=1,"add"===H)v.invalidateData(x),mm(x)&&x.getEdgeGroup()&&x.getEdgeGroup().eachSiblingEdge(v.invalidateData,v);else if(H===Mg){v._21Q(x);var W=x._id,A=v._25I[W];if(A){if(v._56I[W]){var Y=A._79o();Y&&v.redraw(Y)}A.dispose(),delete v._25I[W],delete v._24I[W],delete v._56I[W]}x===v._currentSubGraph&&v.setCurrentSubGraph(R)}else H===Oq&&(v.invalidateAll(!0),v.setCurrentSubGraph(R))},_75O:function(Y){this.invalidateData(Y.data)},handleHierarchyChange:function(f){this.dm().isHierarchicalRendering()&&f.data.hasChildren()&&this.redraw(),this.invalidateData(f.data)},adjustIndex:function(C){var u=this;if(u.isVisible(C)){u.dm().beginTransaction();for(var w=C;w._parent&&u.isVisible(w._parent);)w=w._parent;w&&w!==C&&u._dataModel.adjustIndex(w),u._dataModel.adjustIndex(C),u.dm().endTransaction()}},getImage:function(A){return A.getImage?A.getImage():j},getSelectWidth:function(V){var B=ed(this.getImage(V));return B&&li(B.disableSelectedBorder,V,this)?0:V.s("select.width")},getSelectColor:function(n){return n.s("select.color")},isSelectable:function(W,o){if(this.isSelected(W))return!0;if(!o&&W.getParent()instanceof Gk&&this.isSelectable(W.getParent(),!0)&&W.getParent().isSyncSize())return!1;var s=this.getLayersInfo();if(s){var h=s[W._layer];if(h&&h.selectable===!1)return!1}return W.s("2d.selectable")&&this.sm().isSelectable(W)},isMovable:function(a){var H=this;if(mm(a)&&a.getStyle(fo)!==Ue)return!1;var J=this.getLayersInfo();if(J){var h=J[a._layer];if(h&&h.movable===!1)return!1}return a.s("2d.movable")?H._movableFunc?H._movableFunc(a):!0:!1},isEditable:function(H){var Z=this;if(q._uiSerializing)return Z._uieditable;if(!Z._editInteractor||!Z.isSelected(H))return!1;if(sq(H)){var s=Z.getDataUI(H);if(!s||s._88I)return!1}if(mm(H)&&H.getStyle(fo)!==Ue)return!1;var N=this.getLayersInfo();if(N){var L=N[H._layer];if(L&&L.editable===!1)return!1}return H.s("2d.editable")?Z._editableFunc?Z._editableFunc(H):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(q){return ei(q)&&0!==q.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(q):!0},isRectEditable:function(c){return this._rectEditableFunc?this._rectEditableFunc(c):!0},isAnchorEditable:function(l){return this._anchorEditableFunc?this._anchorEditableFunc(l):!0},isRotationEditable:function(z){return z.setRotation&&z.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(z):!0:!1},getRotationPoint:function(o){var Q=o.getAnchor(),O=o.getScale(),P=this._zoom,c=vr(o.getRotation(),0,-o.getHeight()*O.y*Q.y-(O.y<0?-1:1)*(Ei?32:16)/P),G=o.p();return c.x+=G.x,c.y+=G.y,c},getLogicalPoint:function(w){var x=this;return lg(w,x._canvas,x.tx(),x.ty(),x._zoom,x._zoom)},getScreenPoint:function(t,L){var r,f=this;return"object"==typeof t?t.x!==j?(r=t.x,L=t.y):(r=t[0],L=t[1]):r=t,Fm(r,L,f._canvas,f.tx(),f.ty(),f._zoom,f._zoom)},getSelectedDataAt:function(E){var i=this;return this.getDataAt(E,function(I){return i.isSelected(I)})},getDataInfoAt:function(T,$,p){var P,y=this.lp(T),G=this.getDataAt(y,$,p);if(G){var U=this.getDataUI(G);P={data:G,ui:U,point:y};var z=U._38o;if(z){var w=z.icons;for(var A in w){var K=w[A],c=z.rects[A];if(c)for(var S=li(K.names,G,this),m=S?S.length:0,O=c.rotation,u=m-1;u>=0;u--){var L=S[u],j=c[u];if(oq(j,y,O))return P.part="icons",P.name=A,P.icon=L,P.rect=j,P.index=u,P.rotation=O,P}}}if(this.isNoteVisible(G)){if(U.note2Info&&oq(U.note2Info.clickRect,y,R,U.note2Info.scale))return P.part="note2",P;if(U.noteInfo&&oq(U.noteInfo.clickRect,y,R,U.noteInfo.scale))return P.part="note",P}if(this.isLabelVisible(G)){if(U.label2Info&&oq(U.label2Info.rect,y,U.label2Info.rotation,U.label2Info.scale))return P.part="label2",P;if(U.labelInfo&&oq(U.labelInfo.rect,y,U.labelInfo.rotation,U.labelInfo.scale))return P.part="label",P}if(G.isInRect&&G.isInRect(y))return P.part="body",P}return P},getDataAt:function(b,i,z){b.target&&(b=this.lp(b));var t,r=this._zoom;return this.reverseEach(function(I){return(i?i(I):this.isSelectable(I))&&this.rectIntersects(I,yj(b.x,b.y,z,r))?(t=I,!1):void 0},this),t},getIconInfoAt:function(b,H){var P=this;if(b.target&&(b=P.lp(b)),H||(H=P.getDataAt(b)),H){var k=P.getDataUI(H);if(k&&k._38o){var q,w=k._38o,d=new ob;for(q in w.icons)d.add(q);for(var Y=d.size()-1;Y>=0;Y--){q=d.get(Y);for(var A=w.rects[q],p=A.rotation,$=A.length-1;$>=0;$--){var g=A[$],X=g.width,c=g.height,f={x:b.x-g.x-X/2,y:b.y-g.y-c/2};p!=R&&(f=vr(-p,f.x,f.y));var g={x:-X/2,y:-c/2,width:X,height:c};if(oq(g,f))return{key:q,index:$,name:w.icons[q].names[$],rect:A[$],point:b,rotation:p,relativeRect:g,relativePoint:f,data:H}}}}}return R},getDatasInRect:function(p,F,z){z===j&&(z=1);var X=this,e=new ob;return X.reverseEach(function(T){z&&!X.isSelectable(T)||(F?X.rectIntersects(T,p):X.rectContains(T,p))&&e.add(T)}),e},moveSelection:function(M,x){var H=this;H.dm().beginTransaction(),yp(H.sm().toSelection(H.isMovable,H),M,x),H.dm().endTransaction()},moveDatas:function(s,V,D){var Y=this;Y.dm().beginTransaction(),s instanceof ob||(s=new ob(s)),yp(s,V,D),Y.dm().endTransaction()},getDataUIBounds:function(d){var v=this.getDataUI(d);return v?v._79o():R},drawData:function(H,M,s){var F=this.getDataUI(M);if(F){var p=F._79o();(!s||Ui(s,p))&&(F._42(H),M instanceof q.Block&&M.eachChild(function(I){this.drawData(H,I,s)},this))}},getBoundsForGroup:function(Z){return Z.s(Rb)?this.getDataUIBounds(Z):R},isPixelPerfect:function(Q){return Q.s("pixelPerfect")},rectIntersects:function(g,Y){this.validate();var b=R;if(this._56I[g._id]){var h=this._25I[g._id];if(h){var x=h._79o();if(El(Y,x))b=!0;else if((Y=Vc(Y,x))&&(h.rectIntersects&&(b=h.rectIntersects(Y)),b==R)){if(!this.isPixelPerfect(g))return!0;var C=Y.x,X=Y.y,Q=Y.width,M=Y.height,z=this._zoom,F=d.hitMaxArea,E=Q*M*z*z;if(E>F){var G=Math.sqrt(F/E);z*=G}Q*=z,M*=z,2>Q&&(Q=2),2>M&&(M=2),C*=z,X*=z;var i=xn(Q,M);gm(i,-C,-X),i.scale(z,z),this._drawForChecking=!0,this.drawData(i,g,Y),this._drawForChecking=!1;try{for(var v=0,k=i.getImageData(0,0,Q,M).data;v<k.length;v+=4)if(0!==k[v+3]){b=!0;break}i.restore()}catch(I){Fj=R,b=!1}}}}return b?!0:!1},rectContains:function(D,Y){if(this._56I[D._id]){var h=this._25I[D._id];if(h)return El(Y,h._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(k){if(!d.isInput(k.target)){var R=this,K=R._focusData,o=K&&R._25I[K._id],I=0,T=R._dataModel._datas;if(!(K&&K._enabled&&K._editable&&o&&o.onKeyDown&&o.onKeyDown(k)===!0))if(9===k.keyCode&&(K&&(I=T.indexOf(K),_h(k)?-1===--I&&(I=0):++I===T.size()&&(I=0)),R._focusData=K=T.get(I),R.sm().setSelection(K)),zn(k)?R.selectAll():wd(k)&&R.isResettable()&&R.reset(),R.sm().isEmpty()){if(R._editing)return;var n=R.tx(),B=R.ty(),l=!1,Y=_h()?100:10;Rc(k)&&(n-=Y,l=!0),Tg(k)&&(B-=Y,l=!0),Be(k)&&(n+=Y,l=!0),Tb(k)&&(B+=Y,l=!0),l&&R.setTranslate(n,B)}else{Um(k)&&R.handleDelete(k);var g=_h()?10:1;Rc(k)&&(R.moveSelection(-g,0),R.fi({kind:"moveLeft"})),Tg(k)&&(R.moveSelection(0,-g),R.fi({kind:"moveUp"})),Be(k)&&(R.moveSelection(g,0),R.fi({kind:"moveRight"})),Tb(k)&&(R.moveSelection(0,g),R.fi({kind:"moveDown"}))}}},handleScroll:function(W,t){if(bf(W),!this.getEditInteractor()){var g=this.getDataAt(W);if(g){var r=ed(this.getImage(g));if(r&&li(r.scrollable,g,this))return}}var x=this.lp(W);t>0?this.scrollZoomIn(x):0>t&&this.scrollZoomOut(x)},handlePinch:function(r,n,y){this._68I||(n>y?this.pinchZoomIn(r):this.pinchZoomOut(r))},checkDoubleClickOnNote:function(s,D){var O=this,E=O.lp(s),d=O.getDataUI(D),h=d.note2Info;return h&&D.s("note2.toggleable")&&oq(h.clickRect,E)?(D.s(Oe,!D.s(Oe)),O.fi({kind:"toggleNote2",event:s,data:D}),!0):(h=d.noteInfo,h&&D.s("note.toggleable")&&oq(h.clickRect,E)?(D.s(Hk,!D.s(Hk)),O.fi({kind:"toggleNote",event:s,data:D}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(f,Z){var p=this,o=p.getAutoScrollZone(),i=o/p.getZoom(),b=o/4,X=p._29I,R=p.lp(f),l={x:p.tx(),y:p.ty()};return R&&o>0&&X&&(R.x-X.x<i?p.translate(b,0):X.x+X.width-R.x<i&&p.translate(-b,0),R.y-X.y<i?p.translate(0,b):X.y+X.height-R.y<i&&p.translate(0,-b)),l.x=p.tx()-l.x,l.y=p.ty()-l.y,Z&&(Z.x+=l.x,Z.y+=l.y),l},getMoveMode:function(h,J){var R=J.s("2d.move.mode");return R?R:Do["88"]?"x":Do["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(B,w,_){var M=this;return"currentSubGraph"===w?{__i:B.getId()}:_.serializeProperty(B,w,M)},deserializeProperty:function(Q,w,z){var O=this;if("currentSubGraph"===w){var X=O.dm(),R=X.__idMap;return R[Q.__i]}return z.deserializeProperty(Q,w,O)},setDefaultCursor:function(m,h){this._defaultCursor=m,h!==!1&&this.setCursor(m)},setCursor:function(q){"default"===q&&(q=this._defaultCursor||q);var i=this.getView().style;i.cursor=q,i.cursor="-webkit-"+q,i.cursor="-moz-"+q},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(F){return F===R||d.getConnectAction(null,F)?(this._currentActionType=F,this.redraw(),!0):!1},isConnectActionVisible:function(_){var c=d.getConnectAction(this);if(!c)return!1;var I=c.visible;return cl(I)&&(I=I(this,_)),I},isInteractive:function(j){var D=ed(this.getImage(j));return D&&li(D.interactive,j,this)?!0:j.s("interactive")},appendHTML:function(d){var P=this.getView();if(!d||d.parentNode===P)return!1;var C=d.getView&&d.getView();if(C&&C.parentNode===P)return!1;if(d.isSelfViewEvent)return d.addToDOM(P),!0;d.getView&&(d=d.getView());var $=this.getCanvas().nextSibling;return $?P.insertBefore(d,$):ke(P,d),!0},layoutHTML:function(_,V,W){var x,z=this,A=z._zoom;if(V.getView&&(x=V,V=V.getView()),V.style.position="absolute",W){var X=_.getRect();Zh(x||V,z.tx()+X.x*A,z.ty()+X.y*A,X.width*A,X.height*A)}else{var B=new Hq,X=_.getAnchorRect(),J=_.getPosition(),q=_.getScale(),Q=V.style;Zh(x||V,X),B.appendTranslate(z.tx(),z.ty()),B.appendScale(A,A),B.append(new Hq(_.getRotation(),J.x,J.y,q.x,q.y)),ef(Q,"transform","matrix("+B.a.toFixed(5)+", "+B.b.toFixed(5)+", "+B.c.toFixed(5)+",\n    "+B.d.toFixed(5)+", "+B.tx.toFixed(5)+", "+B.ty.toFixed(5)+")"),ef(Q,"transformOrigin",(-X.x).toFixed(5)+"px "+(-X.y).toFixed(5)+"px"),V.maxtrixAppend=B.invert().translate(-X.x,-X.y)}}});var jq=function(Y,k){var S=this;S.gv=Y,S.s=function(W){return k.getStyle(W)},S._data=k,S._87I=new ob};Ci(jq,G,{_6I:R,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var B=this,O=B.gv.isSelected(B._data);return!O||B.isShadowed()?0:B.gv.getSelectWidth(B._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(m){var n=this._data,l=this.gv.getBodyColor(n);return l?l:m?n.getStyle(m):R},_2Q:function(x){return this.s(x)},_1Q:function(G,D,C,A){var K=this.s,r=K(D+".dash.color");G.strokeStyle=r,G.lineWidth=C,G.stroke(),K(D+".dash.3d")&&Ro(G,r,K(D+".dash.3d.color"),C,this.gv._zoom,K(D+".dash.3d.accuracy")),tj(G,A)},invalidate:function(){this._6I=R},_79o:function(){var h=this;if(!h._6I){var t=h._data,a=h.gv;h.labelInfo=h.label2Info=h.noteInfo=h.note2Info=h._38o=R,h._87I.clear(),h.interactiveInfo=a.isInteractive(t)?{}:R,h._3O(),h._55O=a.isEditable(t)?{_42O:a.isRectEditable(t),_43O:a.isPointEditable(t),_56O:a.isRotationEditable(t)}:R,h._6I=h._81o()}return h._6I},_3O:function(){},getPosition:function(){return lc},_68o:function(S,D){S&&this._87I.add(In(S,D))},_81o:function(){var Z=this,S=Z.s;Z._24O(Ym,"getLabel"),Z._24O(Vr,"getLabel2"),Z._26O(Gj,"getNote"),Z._26O(Sh,"getNote2"),Z._15O(),Z._55O&&Z._48O();var g;if(Z._87I.each(function(i){g=$l(g,i)}),g&&Z.isShadowed()){var k=Pb(g);k.x+=S("shadow.offset.x"),k.y+=S("shadow.offset.y"),Qe(k,S("shadow.blur")),g=$l(g,k)}return Z._87I.clear(),g},_42:function(p){var n=this,z=n._data,d=n.gv,O=n.s,j=O("opacity"),$=this.isShadowed();if($){var X=p.shadowOffsetX,q=p.shadowOffsetY,f=p.shadowBlur,F=p.shadowColor,U=d.getZoom();p.shadowOffsetX=O("shadow.offset.x")*U,p.shadowOffsetY=O("shadow.offset.y")*U,p.shadowBlur=O("shadow.blur")*U,p.shadowColor=n.getSelectColor()}if(j!=R){var V=p.globalAlpha;p.globalAlpha=j}n._80o(p),d.isLabelVisible(z)&&((!d._drawForChecking||O("label.selectable"))&&Pm(p,n.labelInfo),(!d._drawForChecking||O("label2.selectable"))&&Pm(p,n.label2Info)),d.isNoteVisible(z)&&(Hd(p,n.noteInfo),Hd(p,n.note2Info)),n._99O(p),j!=R&&(p.globalAlpha=V),$&&(p.shadowOffsetX=X,p.shadowOffsetY=q,p.shadowBlur=f,p.shadowColor=F)},_80o:function(){},_47O:function(){},_24O:function(A,E){var r=this,X=r._data,B=r.gv,D=r.s,V=B[E](X);if(V!=R){var n=D(A+".scale"),x=D(A+".max"),i=D(A+".position"),g=r[A+"Info"]={label:V,scale:n,color:B[E+"Color"](X),font:D(A+".font"),opacity:D(A+".opacity"),align:D(A+".align"),rotation:r.getRotation(D(A+".rotation"),!1,i),background:B[E+"Background"](X)},C=ol(g,V);x>0&&x<C.width&&(g.labelWidth=C.width,C.width=x),1!==n&&(C.width*=n,C.height*=n);var y=r.getPosition(i,D(A+".offset.x"),D(A+".offset.y"),C,D(A+".position.fixed"));if(C.x=y.x-C.width/2,C.y=y.y-C.height/2,r._68o(g.rect=C,g.rotation),1!==n){var Y=C.width/n,u=C.height/n;g.rect={x:y.x-Y/2,y:y.y-u/2,width:Y,height:u}}}},_26O:function(U,i){var e=this,d=e.gv,V=e._data,t=e.s,E=d[i](V);if(E!=R){var B,N,J=t(U+".scale"),l=e[U+"Info"]={note:E,scale:J,data:V,view:d,expanded:t(U+".expanded"),font:t(U+".font"),color:t(U+".color"),opacity:t(U+".opacity"),align:t(U+".align"),icon:t(U+".icon"),backgroundImage:t(U+".backgroundImage"),borderWidth:t(U+".border.width"),borderColor:t(U+".border.color"),background:d[i+"Background"](V)},M=e.getPosition(t(U+".position"),t(U+".offset.x"),t(U+".offset.y")),j=M.x,s=M.y;if(l.expanded){var y,G=t(U+".max"),c=t(U+".backgroundImage");c?(c=ed(c),y={width:se(c,V),height:Qo(c,V)}):y=ol(l,E),y.width+=6,y.height+=2,G>0&&G<y.width&&(l.labelWidth=y.width,y.width=G),B=y.width,N=y.height+8,l.clickRect={x:j-B*J/2,y:s-N*J,width:B*J,height:N*J*y.height/N}}else{var D=t(U+".icon");D?(D=ed(D),B=se(D,V),N=Qo(D,V)):(B=12,N=18),l.clickRect={x:j-B*J/2,y:s-N*J,width:B*J,height:N*J}}l.rect={x:j-B/2,y:s-N*J/2-N/2,width:B,height:N};var K=S(l.borderWidth/2)*J;e._68o({x:j-B*J/2-K,y:s-N*J-K,width:B*J+2*K,height:N*J+2*K})}},_48O:function(){},_99O:function(H){var c=this,Z=c._38o;if(Z){var Y=c.gv,P=c._data,s=Z.icons,O=c.interactiveInfo;O&&(O._38o={});for(var i in s){var n=s[i],M=Z.rects[i];if(M){O&&(O._38o[i]=[]);var y=li(n.opacity,P,Y),K=li(n.names,P,Y),A=K?K.length:0,f=M.rotation;if(y!=R){var d=H.globalAlpha;H.globalAlpha*=y}for(var o=0;A>o;o++){var m=K[o],B=ed(m),b=M[o];if(f){var X=b.x+b.width/2,I=b.y+b.height/2;H.save(),gm(H,X,I),hc(H,f),gm(H,-X,-I)}O&&O._38o[i].push(H.interactiveInfo={compInfos:[],matrix:f?new Hq(f,X,I).appendTranslate(-X,-I):new Hq}),jg(H,B,li(n.stretch,P,Y),b.x,b.y,b.width,b.height,c._data,c.gv),H.interactiveInfo=R,f&&H.restore()}y!=R&&(H.globalAlpha=d)}}}}});var $b=function(N,S){Id($b,this,[N,S])};Ci($b,jq,{_checkEmptyRect:!0,_40O:function(o,I){var t=this,n=t.s,p=o.rect;(o.borderColor=t.gv.getBorderColor(t._data))&&(o.borderType=n("border.type"),o.borderWidth=n("border.width"),o.borderPadding=n("border.padding"),I=Z(I,o.borderPadding+o.borderWidth/2));var h=t._data.getScale(),m=Z(1,Z(K(h.x),K(h.y)));if(o.selectWidth=t.getSelectWidth()){var L=t.gv._zoom;o.selectType=n("select.type"),o._97o=t.getSelectColor(),o.selectPadding=n("select.padding"),I=Z(I,(o.selectPadding+o.selectWidth/2/L)/m)}I>0&&(I*=m,p=Pb(p),Qe(p,I)),t._68o(p)},_39O:function(P,h){var w,W=this,p=h.rect;if(h.borderWidth>0&&(w=h.borderPadding,P.strokeStyle=h.borderColor,P.lineWidth=h.borderWidth,Rp(P,h.borderType,{x:p.x-w,y:p.y-w,width:p.width+2*w,height:p.height+2*w}),P.stroke()),h.selectWidth>0){var s=W.gv._zoom;if(w=h.selectPadding,P.strokeStyle=h._97o,P.lineWidth=h.selectWidth/s,h.rotation!=R){P.save(),P.translate(h.position.x,h.position.y),P.rotate(h.rotation);var Q=W._data,l=Q.getWidth(),$=Q.getHeight(),m=h.scale,I=h.anchor;p={x:m.x*-l*I.x,y:m.y*-$*I.y,width:m.x*l,height:m.y*$}}Rp(P,h.selectType,{x:p.x-w,y:p.y-w,width:p.width+2*w,height:p.height+2*w}),h.rotation!=R&&P.restore(),P.stroke()}},dispose:function(){var O=this,m=O._htmlView;$b.superClass._3O.call(O),m&&(m.onHTMLRemoved&&m.onHTMLRemoved(),un(m))},_3O:function(){var I=this,C=I.s,h=I._data,f=I.gv,k=h.getStyle(ks),W=I.getBodyColor(),e=I._83o=k?{shape:k,_53o:I.getBodyColor("shape.background"),_27Q:ed(C("shape.repeat.image"),W),shapeGradientPack:C("shape.gradient.pack"),_54o:C("shape.border.width"),_55o:C("shape.border.color"),_56o:C("shape.border.3d"),_57o:C("shape.border.3d.color"),_58o:C("shape.border.3d.accuracy"),shapeGradient:C("shape.gradient"),_59o:C("shape.gradient.color"),_60o:C("shape.border.pattern"),_61o:C("shape.border.cap"),_62o:C("shape.border.join"),shapeForeground:C("shape.foreground"),bodyColor:W}:{img:ed(f.getImage(h),W),bodyColor:W,stretch:C("image.stretch")};if(B&&!N);else{var D,y=e.img;y&&y.renderHTML?(I._htmlInfo&&I._htmlInfo.img!==y&&(I._htmlInfo=R),I._htmlInfo||(I._htmlInfo={img:y,cache:{}}),D=y.renderHTML(h,f,I._htmlInfo.cache)):I._htmlInfo=R,I._htmlView&&I._htmlView!==D&&(I._htmlView.onHTMLRemoved&&I._htmlView.onHTMLRemoved(),un(I._htmlView.getView?I._htmlView.getView():I._htmlView)),(I._htmlView=D)&&f.appendHTML(D)&&D.onHTMLAdded&&D.onHTMLAdded(),e.rect=h.getRect(),e.position=h.p(),e.scale=h.getScale(),e.anchor=h.getAnchor(),e.rotation=h.getRotation(),k===gq&&(e._63o=C("shape.depth"));var S=0;if(k)S=er(R,e._54o/2,e._62o),I.s("shape.dash")&&(S=Z(S,(I.s("shape.dash.width")||e._54o)/2));else if(y&&y.boundExtend)if(S=li(y.boundExtend,h,f),y.boundExtendAbsolute){var i=h.getScale();S/=f._zoom*Z(1,Z(K(i.x),K(i.y)))}else if(!li(y.fitSize,h,f)){var c=li(y.width,h,f),q=li(y.height,h,f);S*=Z(h.getWidth()/c,h.getHeight()/q)}I._40O(e,S);var U=C("clip.percentage");if(1>U&&(0>U&&(U=0),e.clipRect=oi(h.getAnchorRect(),C("clip.direction"),U)),k){var m=C("shape.fill.clip.percentage");1>m&&(0>m&&(m=0),e.shapeClipRect=oi(h.getAnchorRect(),C("shape.fill.clip.direction"),m));var G=C("shape.foreground.clip.percentage");1>G&&(0>G&&(G=0),e.shapeForegroundClipRect=oi(h.getAnchorRect(),C("shape.foreground.clip.direction"),G))}}},getPosition:function(p,J,b,o){var g=pb(p,this._83o.rect,o);return g.x+=J,g.y+=b,g},_80o:function(w){var D=this,v=D.s,K=D.gv,H=D._data,j=D._83o,S=j.rect,L=j.position,X=j.rotation,l=j.anchor,V=j.scale,g=j.shape,t=j.clipRect;if(!D._checkEmptyRect||S.width>0&&S.height>0){var i=H.getSize();if(i.x=-i.width*l.x,i.y=-i.height*l.y,w.save(),gm(w,L.x,L.y),hc(w,X),ic(w,V.x,V.y),t&&(w.beginPath(),w.rect(t.x,t.y,t.width,t.height),w.clip()),K._drawForChecking&&j.img&&li(j.img.pixelPerfect,H,K)===!1)wk(w,i.x,i.y,i.width,i.height,"#888888");else if(D.freeDraw)D.freeDraw(w,i,j);else if(g){var A,u,h,W,F=j._60o,T=lf(w,F),P=j._53o,m=j._27Q,y=j._54o,Q=j._55o,G=j.shapeGradientPack,M=w.lineJoin,J=w.lineCap;if("roundRect"===g?A=v("shape.corner.radius"):"polygon"===g?A=v("shape.polygon.side"):"arc"===g&&(A=v("shape.arc.from"),u=v("shape.arc.to"),h=v("shape.arc.close"),W=v("shape.arc.oval")),w.lineJoin=j._62o,w.lineCap=j._61o,P||m||G){var a=j.shapeClipRect;a&&(w.save(),w.beginPath(),w.rect(a.x,a.y,a.width,a.height),w.clip()),Rp(w,g,i,A,u,h,W),G?il(w,G):m?Kf(w,m,j.bodyColor,null,H,K):Zq(w,P,j.shapeGradient,j._59o,i),w.fill(),a&&w.restore(),G&&w.restore(),w!==T&&Rp(T,g,i,A,u,h,W)
}else Rp(T,g,i,A,u,h,W);var I=j.shapeForeground;if(I){w.save();var b=j.shapeForegroundClipRect;b&&(w.beginPath(),w.rect(b.x,b.y,b.width,b.height),w.clip()),Rp(w,g,i,A,u,h,W),Zq(w,I,v("shape.foreground.gradient"),v("shape.foreground.gradient.color"),i),w.fill(),w.restore()}if(y>0){var f=v("shape.border.width.absolute");f&&(w.save(),w.setTransform(1,0,0,1,0,0)),w.lineWidth=y,w.strokeStyle=Q,w.stroke(),f&&w.restore(),j._56o&&Ro(w,Q,j._57o,y,K._zoom,j._58o)}if(tj(w,F),v("shape.dash")){var o=v("shape.dash.width")||y;if(o>0){F=v("shape.dash.pattern");var T=lf(w,F,D._2Q("shape.dash.offset"));T!==w&&Rp(T,g,i,A,u,h,W),D._1Q(w,"shape",o,F)}}nd(w,P,j._63o,i),w.lineJoin=M,w.lineCap=J}else{var B=D.interactiveInfo;B&&(w.interactiveInfo=B.bodyInfo={compInfos:[],matrix:new Hq(X,L.x,L.y,V.x,V.y)}),jg(w,j.img,j.stretch,i.x,i.y,i.width,i.height,H,K,j.bodyColor),w.interactiveInfo=R}w.restore()}D._39O(w,j)},_48O:function(){},_47O:function(){}});var Zg=function(N,i){Id(Zg,this,[N,i])},xr=function(h,M,w,K){var d=Yi(h,M);return w=K?f(w,d):qm(w,d),d?w/=d:w=0,{x:h.x+(M.x-h.x)*w,y:h.y+(M.y-h.y)*w}};Ci(Zg,jq,{_3O:function(){var w,G=this,X=G._data,n=G.gv,N=G.s,Y=N(fo),m=X.isLooped(),L=N("edge.width"),A=N("edge.center"),l=N("edge.offset"),V=n.getBorderColor(X),v=V?N("border.width"):0,T=G.getSelectWidth(),F=X._40I,z=X._41I,x=G._78o=F&&z?{looped:m,type:Y,width:L,center:A,color:G.getBodyColor("edge.color"),borderColor:V,borderWidth:v,_97o:T?G.getSelectColor():R,selectWidth:T,pattern:N("edge.pattern"),cap:N("edge.cap"),join:N("edge.join"),is3d:N("edge.3d"),_67o:N("edge.3d.color"),_66o:N("edge.3d.accuracy")}:R;if(x){var y=d.getEdgeType(Y);if(y){var u=y(X,Tp(G,n,X,m,Y),n,G._19Q);u.points&&u.points.size()>1?(x.edgeTypeInfo=u,w=_q(x.edgeTypeInfo.points)):u[Cg]&&u.rect&&(x.edgeTypeInfo=u,w=u.rect)}else{var f=N("edge.source.anchor.x"),B=N("edge.source.anchor.y"),s=N("edge.target.anchor.x"),e=N("edge.target.anchor.y"),a=Lq(n,F,N("edge.source.position"),N("edge.source.offset.x"),N("edge.source.offset.y"),f,B),D=Lq(n,z,N("edge.target.position"),N("edge.target.offset.x"),N("edge.target.offset.y"),s,e);if(Y===Ue){var k=x.points=N(ip)||Fb,I=k.size();x.segments=N("edge.segments");var S=f!==j||B!==j,W=s!==j||e!==j;if(!A)if(l)S||(a=xr(a,I?k.get(0):D,l,I)),W||(D=xr(D,I?k.get(I-1):a,l,I));else{var r;S||(r=ri(a,I?k.get(0):D,Nd(n,F)),r&&(a={x:r[0],y:r[1]})),W||(r=ri(I?k.get(I-1):a,D,Nd(n,z)),r&&(D={x:r[0],y:r[1]}))}w=$l(_q(x.points),_q(a,D))}else{var H=Tp(G,n,X,m,Y);if(G._19Q||(H=-H),m)a=Pb(a),a.x=n.getNodeRect(F).x,x.radius=H,w={x:a.x-H,y:a.y-H,width:2*H,height:2*H};else{var p=Yi(a,D),C=qm(l,p),$={x:C,y:H},Q={x:p-C,y:H},K=i(D.y-a.y,D.x-a.x),t=x.mat=new Sn(K);if(x.orienAngle=K,x.angle=D.x<a.x?K+b:K,x.rect={x:$.x,y:$.y,width:Q.x-$.x,height:0},x.origin=a,$=t.tf($),$.x+=a.x,$.y+=a.y,Q=t.tf(Q),Q.x+=a.x,Q.y+=a.y,A){var q={x:p,y:0};q=t.tf(q),q.x+=a.x,q.y+=a.y,w=_q([a,$,Q,q]),x.c1=a,x.c2=q}else w=_q($,Q);a=$,D=Q}}x.sourcePoint=a,x.targetPoint=D,X._lastSourcePoint=a,X._lastTargetPoint=D}var U=0;N("edge.dash")&&(U=N("edge.dash.width")||L);var g="square"===x.cap?.71:.5;er(w,Z(U*g,L*g+v+T),x.join),G._68o(w)}},getRotation:function(c,m,p){c=c||0;var e=this._78o;if(e){var T,v=e.angle,N=e.points,M=e.edgeTypeInfo;if(v!=R)return m?e.orienAngle+c:v+c;if(M&&M[Cg])return M.getRotation?M.getRotation(this,c,m,p):0;if(M&&M.points){var G=M.points;return T=G.size(),bb[p]?T&&0===T%2?vc(G.get(T/2-1),G.get(T/2),m,c):c:pk[p]?vc(G.get(0),G.get(1),m,c):vc(G.get(T-2),G.get(T-1),m,c)}if(N)return T=N.size(),bb[p]?T&&0===T%2?vc(N.get(T/2-1),N.get(T/2),m,c):c:pk[p]?vc(e.sourcePoint,T?N.get(0):e.targetPoint,m,c):vc(T?N.get(T-1):e.sourcePoint,e.targetPoint,m,c)}return c},getPosition:function(E,D,Z,g,C){var o=this._78o;if(o){var T,A=o.type,x=o.points,$=o.edgeTypeInfo,q=o.sourcePoint,w=o.targetPoint;if(!A)return o.looped?{x:q.x-o.radius+D,y:q.y+Z}:(C&&q&&w&&(q.x>w.x||q.x===w.x&&q.y>w.y)&&(E=Wf[E],Z=-Z),T=pb(E,o.rect,g),T.x+=D,T.y+=Z,T=o.mat.tf(T),T.x+=o.origin.x,T.y+=o.origin.y,T);if($&&$[Cg])return $.getPosition?$.getPosition(this,E,D,Z,g,C):{x:(q.x+w.x)/2,y:(q.y+w.y)/2};if(x){var T,i=x.size();if(bb[E]){if(i){var t=i%2;if(0===t)return Uc(x.get(i/2-1),x.get(i/2),E,D,Z,g,C);T=x.get((i-t)/2)}else T={x:(q.x+w.x)/2,y:(q.y+w.y)/2};return T=pb(E,{x:T.x,y:T.y,width:0,height:0},g),T.x+=D,T.y+=Z,T}return pk[E]?Uc(q,i?x.get(0):w,E,D,Z,g,C):Uc(i?x.get(i-1):q,w,E,D,Z,g,C)}if($){var J=$.points,i=J.size();if(bb[E]){var t=i%2;return 0===t?Uc(J.get(i/2-1),J.get(i/2),E,D,Z,g,C):(T=J.get((i-t)/2),T=pb(E,{x:T.x,y:T.y,width:0,height:0},g),T.x+=D,T.y+=Z,T)}return pk[E]?Uc(J.get(0),J.get(1),E,D,Z,g,C):Uc(J.get(i-2),J.get(i-1),E,D,Z,g,C)}}return lc},_42:function(m){this._78o&&Zg.superClass._42.call(this,m)},drawPath:function(T,H){T.beginPath();var k=H.type,C=H.points,z=H.segments,d=H.edgeTypeInfo;if(!k||C){var y=H.sourcePoint,E=y.x,B=y.y,q=H.targetPoint,f=q.x,u=q.y;if(k)if(z){var l=new ob({x:E,y:B});l.addAll(C),l.add({x:f,y:u}),sm(T,l,z)}else T.moveTo(E,B),C.each(function(G){T.lineTo(G.x,G.y)}),T.lineTo(f,u);else H.looped?T.arc(E,B,H.radius,0,m,!0):H.center?(T.moveTo(H.c1.x,H.c1.y),T.lineTo(E,B),T.lineTo(f,u),T.lineTo(H.c2.x,H.c2.y)):(T.moveTo(E,B),T.lineTo(f,u))}else d&&(d.points?sm(T,d.points,d.segments):d[Cg]&&d[Cg](T,d))},_80o:function(b){var W=this,E=W.s,p=W._78o,j=p.width,Q=p.selectWidth,s=p.borderWidth,H=p.color,o=b.lineJoin,G=b.lineCap,$=p.pattern;b.lineJoin=p.join,b.lineCap=p.cap,W.drawPath(lf(b,$),p);var P=E("edge.width.absolute");if(P&&(b.save(),b.setTransform(1,0,0,1,0,0)),Q&&(b.strokeStyle=p._97o,b.lineWidth=j+2*(s+Q),b.stroke()),s&&(b.strokeStyle=p.borderColor,b.lineWidth=j+2*s,b.stroke()),b.strokeStyle=H,b.lineWidth=j,b.stroke(),p.is3d&&Ro(b,H,p._67o,j,W.gv._zoom,p._66o),P&&b.restore(),tj(b,$),E("edge.dash")){$=E("edge.dash.pattern");var K=lf(b,$,W._2Q("edge.dash.offset"));K!==b&&W.drawPath(K,p),W._1Q(b,"edge",E("edge.dash.width")||j,$)}b.lineJoin=o,b.lineCap=G},_48O:function(){},_47O:function(){},_71o:function(L,z){var r=this,x=r._data;if(r._19Q=!0,!x.getEdgeGroup())return L?x.s("edge.gap"):0;var $,g=0,A=0,F=0;if(x.getEdgeGroup().getSiblings().each(function(v){v.each(function(V){if(r.gv.isVisible(V)&&V.s(fo)==z){var i=V.s("edge.gap");$?(A+=F/2+i/2,F=i):($=V,F=i),V===x&&(g=A)}})}),L)return A-g+F;var V=g-A/2;return $&&x._40I!==$._40I&&(r._19Q=!1),V}});var Wg=function(_,P){Id(Wg,this,[_,P])};Ci(Wg,$b,{_3O:function(){var l,I,p=this,u=p.s,d=p._data,T=p.gv;if(p._88I=R,d.isExpanded()&&d.eachChild(function(h){var s=T.getBoundsForGroup(h);s&&(I||(I=[]),I.push(s),l=$l(l,s))}),l){var L=T.getLabel(d),E=u("group.type");l=ho(E,I,l),cd(l,d,"group.padding",1);var j=p._88I={type:E,rect:l,_64o:l};if(!E&&L!=R){var Q,r=p.labelInfo={label:L,color:u("group.title.color"),font:u("group.title.font"),align:u("group.title.align")},f=ol(r,L),Z=f.width,Y=f.height,t=u("group.title.align"),W=u("group.title.orientation");if((W===Cd||W===bn)&&Z>l.width?l.width=Z:(W===Xf||W===pp)&&Z>l.height&&(l.height=Z),r.rect={y:l.y-Y,width:f.width,height:Y},Q=t===Xf?l.x:t===pp?l.x+l.width-Z:l.x+l.width/2-Z/2,r.rect.x=Q,W===bn)j.titleRect={x:l.x,y:l.y+l.height,width:l.width,height:Y},j.rect={x:l.x,y:l.y,width:l.width,height:l.height+Y},r.rect={x:Q,y:l.y+l.height,width:Z,height:Y};else if(W===Xf){var P=j.titleRect={x:l.x-Y,y:l.y,width:Y,height:l.height};j.rect={x:l.x-Y,y:l.y,width:l.width+Y,height:l.height},r.rect={x:P.x+Y/2-l.height/2,y:P.y+l.height/2-Y/2,width:l.height,height:Y},r.rotation=-Math.PI/2}else if(W===pp){var P=j.titleRect={x:l.x+l.width,y:l.y,width:Y,height:l.height};j.rect={x:l.x,y:l.y,width:l.width+Y,height:l.height},r.rect={x:P.x+Y/2-l.height/2,y:P.y+l.height/2-Y/2,width:l.height,height:Y},r.rotation=Math.PI/2}else j.titleRect={x:l.x,y:l.y-Y,width:l.width,height:Y+1},j.rect={x:l.x,y:l.y-Y,width:l.width,height:l.height+Y}}p._40O(j,u("group.border.width")/2)}else Wg.superClass._3O.call(p)},getPosition:function(j,X,m,i){var d=this._88I;if(d){var J=pb(j,d.rect,i);return J.x+=X,J.y+=m,J}return Wg.superClass.getPosition.apply(this,arguments)},_24O:function(Z,O){var f=this._88I;(!f||f.type||"label2"===Z)&&Wg.superClass._24O.call(this,Z,O)},_80o:function(Q){var O=this,i=O._88I;if(i){var g=O._data,s=O.s,o=O.gv,c=i.type,C=i.rect,z=i._64o,d=i.titleRect,T=O.getBodyColor(),G=ed(s("group.image"),T),D=s("group.image.stretch"),m=O.getBodyColor("group.background"),H=ed(s("group.repeat.image"),T),M=s("group.gradient.pack"),V=s("group.gradient"),y=s("group.gradient.color"),b=s("group.border.width"),r=s("group.border.color"),u=s("group.border.pattern"),$=s("group.title.orientation"),k=s("group.depth");if(c){var K=Q.lineJoin,R=Q.lineCap;if(Q.lineJoin=s("group.border.join"),Q.lineCap=s("group.border.cap"),G){if(Q.save(),Rp(Q,c,C),Q.clip(),jg(Q,G,D,C.x,C.y,C.width,C.height,g,o,T),Q.restore(),b>0){var a=lf(Q,u);Rp(a,c,C),Q.lineWidth=b,Q.strokeStyle=r,Q.stroke(),tj(Q,u)}}else{var a=lf(Q,u);m||H||M?(Rp(Q,c,C),M?il(Q,M):H?Kf(Q,H,T,null,g,o):Zq(Q,m,V,y,C),Q.fill(),M&&Q.restore(),Q!==a&&Rp(a,c,C)):Rp(a,c,C),b>0&&(Q.lineWidth=b,Q.strokeStyle=s("group.border.color"),Q.stroke()),tj(Q,u),c===gq&&nd(Q,m,k,C)}Q.lineJoin=K,Q.lineCap=R}else{var N=s("group.title.background"),t=s("group.border.radius");if(G)jg(Q,G,D,z.x,z.y,z.width,z.height,g,o,O.getBodyColor());else if(m||H)if(H?Kf(Q,H,T,null,g,o):Zq(Q,m,V,y,z),0===b)Rp(Q,gq,z),Q.fill(),nd(Q,m,k,z);else{switch(Q.beginPath(),$){case bn:le(Q,z.x,z.y,z.width,z.height,t,t,0,0);break;case Xf:le(Q,z.x,z.y,z.width,z.height,0,t,0,t);break;case pp:le(Q,z.x,z.y,z.width,z.height,t,0,t,0);break;case Cd:le(Q,z.x,z.y,z.width,z.height,0,0,t,t)}Q.fill()}if(d&&N)if(0===b)wk(Q,d.x,d.y,d.width,d.height,N),nd(Q,N,k,d);else{switch(Q.beginPath(),Q.fillStyle=N,$){case bn:le(Q,d.x,d.y,d.width,d.height,0,0,t,t);break;case Xf:le(Q,d.x,d.y,d.width,d.height,t,0,t,0);break;case pp:le(Q,d.x,d.y,d.width,d.height,0,t,0,t);break;case Cd:le(Q,d.x,d.y,d.width,d.height,t,t,0,0)}Q.fill()}if(b>0){var a=lf(Q,u);if(Rp(a,"roundRect",C,t),Q.lineWidth=b,Q.strokeStyle=r,d&&s("group.splitLine")){var J=d.x,U=d.y,A=d.width,P=d.height;$===bn?(Q.moveTo(J,U),Q.lineTo(J+A,U)):$===Xf?(Q.moveTo(J+A,U),Q.lineTo(J+A,U+P)):$===pp?(Q.moveTo(J,U),Q.lineTo(J,U+P)):(Q.moveTo(J,U+P),Q.lineTo(J+A,U+P))}Q.stroke(),tj(Q,u)}}O._39O(Q,i)}else Wg.superClass._80o.call(O,Q)}});var Ab=function(B,g){Id(Ab,this,[B,g])};Ci(Ab,$b,{_80o:function(v){this._39O(v,this._83o)}});var xf=function(Q,C){Id(xf,this,[Q,C])};Ci(xf,$b,{_3O:function(){var m=this,v=m._data,g=m.s,I=m.gv,d=v.getPoints(),t=I.getBorderColor(v),N=t?g("border.width"):0,$=m.getSelectWidth(),a=g("shape.border.width"),L=v.getRect(),s=I.getBodyColor(v),w=m._99o=d.isEmpty()?R:{rect:L,rotation:v.getRotation(),fillRule:g("shape.fill.rule"),scale:v.getScale(),position:v.p(),points:d,segments:v.getSegments(),bodyColor:s,borderColor:t,borderWidth:N,_94o:g("shape.border.3d"),_95o:g("shape.border.3d.color"),_96o:g("shape.border.3d.accuracy"),_97o:$?m.getSelectColor():R,selectWidth:$,_53o:g("shape.background"),_27Q:ed(g("shape.repeat.image"),s),shapeGradientPack:g("shape.gradient.pack"),_54o:a,_55o:g("shape.border.color"),shapeGradient:g("shape.gradient"),_59o:g("shape.gradient.color"),_60o:g("shape.border.pattern"),_61o:g("shape.border.cap"),_62o:g("shape.border.join"),shapeForeground:g("shape.foreground")};if(w){var T=v.getScale(),J=Z(1,Z(K(T.x),K(T.y)));g("shape.dash")&&g("shape.dash.width")>a&&(a=g("shape.dash.width"));var f=a*("square"===w._61o?.71:.5)+N+$/m.gv._zoom/J;f&&(f*=J,L=Pb(L),er(L,f,w._62o)),m._68o(L);var p=g("clip.percentage");1>p&&(0>p&&(p=0),w.clipRect=oi(v.getAnchorRect(),g("clip.direction"),p));var B=g("shape.fill.clip.percentage");1>B&&(0>B&&(B=0),w.shapeClipRect=oi(v.getAnchorRect(),g("shape.fill.clip.direction"),B));var E=g("shape.foreground.clip.percentage");1>E&&(0>E&&(E=0),w.shapeForegroundClipRect=oi(v.getAnchorRect(),g("shape.foreground.clip.direction"),E))}},getPosition:function(Y,j,q,V){var r=this._99o;if(r){var l=pb(Y,r.rect,V);return l.x+=j,l.y+=q,l}return lc},_42:function(d){this._99o&&xf.superClass._42.call(this,d)},_80o:function(Y){var c,d=this,g=d.s,J=d._99o,v=J.position,_=J.scale,k=J.rotation,y=J.bodyColor,f=J.borderWidth,K=J.selectWidth/d.gv._zoom,N=J._53o,m=J._27Q,D=J.shapeGradientPack,B=J._54o,E=J.clipRect,b=J.shapeClipRect,w=J.points,z=J.segments,T=d._data.isClosePath(),$=J.fillRule,V=N||m||D;Y.save(),gm(Y,v.x,v.y),hc(Y,k),ic(Y,_.x,_.y),E&&(Y.beginPath(),Y.rect(E.x,E.y,E.width,E.height),Y.clip()),V&&b&&(Y.save(),Y.beginPath(),Y.rect(b.x,b.y,b.width,b.height),Y.clip()),gm(Y,-v.x,-v.y);var W=J._60o,h=lf(Y,W),G=Y.lineJoin,P=Y.lineCap;Y.lineJoin=J._62o,Y.lineCap=J._61o,V?(sm(Y,w,z,T),D?il(Y,D):m?Kf(Y,m,y,null,d._data,d.gv):(c=y?y:N,Zq(Y,c,J.shapeGradient,J._59o,J.rect)),Y.fill($),b&&(Y.restore(),gm(Y,-v.x,-v.y)),D&&Y.restore(),h!==Y&&sm(h,w,z,T)):sm(h,w,z,T);var l=J.shapeForeground;if(l){Y.save();var t=J.shapeForegroundClipRect;t&&(gm(Y,v.x,v.y),Y.beginPath(),Y.rect(t.x,t.y,t.width,t.height),Y.clip(),gm(Y,-v.x,-v.y)),sm(Y,w,z,T),Zq(Y,l,g("shape.foreground.gradient"),g("shape.foreground.gradient.color"),J.rect),Y.fill($),Y.restore()}var r=g("shape.border.width.absolute");if(r&&(Y.save(),Y.setTransform(1,0,0,1,0,0)),K&&(Y.strokeStyle=J._97o,Y.lineWidth=B+2*(f+K),Y.stroke()),f&&(Y.strokeStyle=J.borderColor,Y.lineWidth=B+2*f,Y.stroke()),B&&(c=J._55o,!N&&y&&(c=y),Y.strokeStyle=c,Y.lineWidth=B,Y.stroke(),J._94o&&Ro(Y,c,J._95o,B,d.gv._zoom,J._96o)),r&&Y.restore(),tj(Y,W),g("shape.dash")){var e=g("shape.dash.width")||B;if(e>0){W=g("shape.dash.pattern");var h=lf(Y,W,d._2Q("shape.dash.offset"));h!==Y&&sm(h,w,z,T),d._1Q(Y,"shape",e,W)}}Y.lineJoin=G,Y.lineCap=P,Y.restore()},_48O:function(){},_47O:function(){}});var Wh=function(d,C){Id(Wh,this,[d,C])};Ci(Wh,xf,{getRotation:function(h,y,w){h=h||0;var I=this._data.getPoints(),m=I.size();return m>1?bb[w]?m&&0===m%2?vc(I.get(m/2-1),I.get(m/2),y,h):h:pk[w]?vc(I.get(0),I.get(1),y,h):vc(I.get(m-2),I.get(m-1),y,h):h},getPosition:function(K,c,j,P,w){var m=this._data.getPoints(),J=m.size();if(J>1){if(bb[K]){var Z=J%2;if(0===Z)return Uc(m.get(J/2-1),m.get(J/2),K,c,j,P,w);var y=m.get((J-Z)/2),h={x:y.x,y:y.y,width:0,height:0};return y=pb(K,h,P),y.x+=c,y.y+=j,y}return pk[K]?Uc(m.get(0),m.get(1),K,c,j,P,w):Uc(m.get(J-2),m.get(J-1),K,c,j,P,w)}return lc}});var Mj=function(a,X){Id(Mj,this,[a,X])};Ci(Mj,$b,{_3O:function(){var r=this;Mj.superClass._3O.call(r);var i=r.s,T=r._83o;r._82o=T.img||T.shape?R:{background:r.getBodyColor("grid.background"),depth:i("grid.depth"),rect:T.rect,_88o:i("grid.cell.depth"),cellBorderColor:i("grid.cell.border.color"),_89o:i("grid.row.count"),_90o:i("grid.column.count"),block:i("grid.block"),_91o:i("grid.block.color"),_92o:i("grid.block.padding"),_93o:i("grid.block.width")}},_80o:function(I){var J=this,y=J._82o;if(!y)return Mj.superClass._80o.call(J,I),void 0;var a,j,l=J._data,K=y.background,U=y.rect,E=y.block,T=y._91o,Y=y._92o,O=y._93o,p=y._88o,W=y.cellBorderColor,s=y._89o,Z=y._90o;if(K)if(wk(I,U.x,U.y,U.width,U.height,K),nd(I,K,y.depth,U),p)for(a=0;s>a;a++)for(j=0;Z>j;j++)U=l.getCellRect(a,j),U&&nd(I,K,p,U);else if(W){for(I.beginPath(),a=0;s>a;a++)for(j=0;Z>j;j++)U=l.getCellRect(a,j),U&&I.rect(U.x,U.y,U.width,U.height);I.strokeStyle=W,I.lineWidth=1,I.stroke()}if("h"===E)for(a=0;s>a;a++)U=$l(l.getCellRect(a,0),l.getCellRect(a,Z-1)),Qe(U,Y),Jc(I,T,U.x,U.y,U.width,U.height,O);else if("v"===E)for(j=0;Z>j;j++)U=$l(l.getCellRect(0,j),l.getCellRect(s-1,j)),Qe(U,Y),Jc(I,T,U.x,U.y,U.width,U.height,O);J._39O(I,J._83o)}});var Yg=function(E,a){Id(Yg,this,[E,a])};Ci(Yg,$b,{_checkEmptyRect:!1,_81o:function(){var y=this._data,H=Yg.superClass._81o.call(this),Q=y.s("text");if(Q!=R){var p,X,d=y.s("text.font"),$=y.s("text.align"),W=y.s("text.vAlign"),k=gi(d,Q),s=k.width,M=k.height,f=y.getAnchor(),x=y.getWidth(),m=y.getHeight();"left"===$?p=-x*f.x:"center"===$?p=-x*f.x+(x-s)/2:"right"===$&&(p=x*(1-f.x)-k.width),"top"===W?X=-m*f.y:"middle"===W?X=-m*f.y+(m-M)/2:"bottom"===W&&(X=m*(1-f.y)-k.height);var S,J=y.getMatrix();if(S=_q([J.tf(p,X),J.tf(p+s,X),J.tf(p+s,X+M),J.tf(p,X+M)]),H=$l(H,S),H&&y.s("text.shadow")){var Y=Pb(H);Y.x+=y.s("text.shadow.offset.x"),Y.y+=y.s("text.shadow.offset.y"),Qe(Y,y.s("text.shadow.blur")),H=$l(H,Y)}}return H}});var ig=rf.Interactor=function(m){this.gv=this._graphView=m};Bn("Interactor",G,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(X){this.gv.fi(X)},setCursor:function(m){Ei||this.gv.setCursor(m)},startDragging:function(g){var q=this;q._lastClientPoint=Bm(g),q._lastLogicalPoint=q.gv.lp(g),Wr(q,g)},clearDragging:function(){var N=this;N._lastClientPoint=N._lastLogicalPoint=N._logicalPoint=R},autoScroll:function(M){return this.gv.autoScroll(M,this._lastClientPoint)}});var Kq=R,vp=function(n){Kq.handleWindowTouchMove(n)},Gg=function(a){Kq.handleWindowTouchEnd(a),F.removeEventListener(Xl,vp,y),F.removeEventListener(Ff,Gg,y),Kq=R},tr=function(x){Kq.handleWindowMouseMove(x)},wn=function(M){Kq.handleWindowMouseUp(M),F.removeEventListener(dk,tr,y),F.removeEventListener(ti,wn,y),Kq=R},Ck=function(Q,p){Q!==Kq&&(Kq?Ei?Kq.handleWindowTouchEnd(p):Kq.handleWindowMouseUp(p):Ei?(F.addEventListener(Xl,vp,y),F.addEventListener(Ff,Gg,y)):(F.addEventListener(dk,tr,y),F.addEventListener(ti,wn,y)),Kq=Q)},sb=function(I){var p=this;p.gv=I,p._is2d=I instanceof rf.GraphView,p._is2d&&(p.filter=function(z){return I.isSelectable(z)&&I.isInteractive(z)}),I.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",af].forEach(function(U){p.addListener(U)}),p.initImageResource()};Ci(sb,ig,{enableVR:function(w){var s=this;if(!!s._vrEnable!==w)if(s._vrEnable=w,w)s.gv.vr.mp(s.onVRControllerChange,s);else if(s.gv.vr.ump(s.onVRControllerChange,s),s._vrRayPolyline){var J=s.gv.dm();J.remove(s._vrRayPolyline),J.remove(s._vrRayHitPoint),s._vrRayPolyline=j,s._vrRayHitPoint=j}},onVRControllerChange:function(Y){var S=this,q=Y.property,n=Y.newValue,M=S.gv.vr.getController(n.id),X=M.getRay();X&&("gamepad.button.trigger"===q?"down"===n._62O?S.handle_mousedown(X):S.handleWindowMouseUp(X):"gamepad.pose"===q&&(S.handle_mousemove(X),S.handleWindowMouseMove(X)))},drawVRRay:function(a,f,B){var c,j=this,C=j.gv,Y=j._vrRayPolyline,G=!1;if(Y)c=j._vrRayHitPoint;else{var l=C.dm();j._vrRayPolyline=Y=new q.Polyline,j._vrRayHitPoint=c=new q.Node,c.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),c.setAnchor3d(.5,.5,.499);var M=.2/C.vr.measureOflength;c.s3(M,M,M),Y.s("intersect",!1),c.s("intersect",!1),l.add(Y),l.add(c),G=!0}if(f){var L=B.world,e=B.worldNormal,R=L.x,w=L.y,$=L.z;Y.s("shape.border.color","red"),Y.setPoints([{x:a.origin.x,y:a.origin.z,e:a.origin.y},{x:R,y:$,e:w}]),c.s("3d.visible",!0),c.p3(R,w,$),c.lookAtDirection([e.x,e.y,e.z],"front")}else{Y.s("shape.border.color","blue");var g=new q.Math.Vector3;g.copy(a.direction).setLength(1e3/j.gv.vr.measureOflength).add(a.origin),Y.setPoints([{x:a.origin.x,y:a.origin.z,e:a.origin.y},{x:g.x,y:g.z,e:g.y}]),c.s("3d.visible",!1)}C.fi({kind:"vrRayIntersect",ray:a,data:f,intersect:B,polyline:Y,hitNode:c,begin:G})},addListener:function(i){var _=this;_.gv.getView().addEventListener(i,function(y){d.preventDefault(y),_.disabled||_["handle_"+i](y)},y)},handleWindowTouchMove:function(u){this.handleWindowMouseMove(u)},handleWindowMouseMove:function(F){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",F):(this.handleDownInfo("onBeginDrag",F),this.isDragging=!0))},handleWindowTouchEnd:function(u){this.handleWindowMouseUp(u)},handleWindowMouseUp:function(U){if(this.isDragging&&(this.handleDownInfo("onEndDrag",U),this.isDragging=!1),this.downInfo){var V=this.handle("onUp",U);V&&V.data===this.downInfo.data?this.handleMissingUp(U):this.handleDownInfo("onUp",U),this.downInfo=R}},handle_mouseleave:function(K){var q=this,V=q.gv,o=q.currentInfo?q.currentInfo.data:R;if(o){o.s("onLeave")&&o.s("onLeave")(K,o,V),q.fire("data","onLeave",K,o);var G=q.currentInfo?q.currentInfo.hits:R;if(G)for(var u in G)q.handleLeave(K,u);q.currentInfo=R}},handle_mousewheel:function(J){J.scrollDelta=J.wheelDelta/40,this.handle("onScroll",J)},handle_DOMMouseScroll:function(b){b.scrollDelta=2===b.axis?-b.detail:0,this.handle("onScroll",b)},handle_touchstart:function(z){this.handle_mousedown(z)},handle_touchmove:function(C){this.handle("onMove",C)},handle_mousedown:function(m){this.isDragging&&(this.handleDownInfo("onEndDrag",m),this.isDragging=!1),this.downInfo=this.handle("onDown",m),this.downInfo&&Ck(this,m)},handle_mousemove:function(f){var C=this,n=C.gv;C._hoverTimer&&(E(C._hoverTimer),delete C._hoverTimer);var q,J,s,e=C.handle("onMove",f),o=this.currentInfo?this.currentInfo.data:R,h=this.currentInfo?this.currentInfo.hits:R;if(e&&(J=e.data,s=e.hits,C._hoverTimer=I(function(){E(C._hoverTimer),delete C._hoverTimer,C.handle("onHover",f,e)},n.getHoverDelay()||d.hoverDelay)),J!==o){if(o&&(o.s("onLeave")&&o.s("onLeave")(f,o,n),this.fire("data","onLeave",f,o)),J&&(J.s("onEnter")&&J.s("onEnter")(f,J,n),this.fire("data","onEnter",f,J)),h)for(q in h)this.handleLeave(f,q);if(s)for(q in s){var B=s[q];B.target.onEnter&&B.target.onEnter(f,J,n,B.point,B.width,B.height),this.fire(B.type,"onEnter",B.event,B.data,B.image,B.comp,B.point,B)}}else{if(h)for(q in h)s&&s[q]||this.handleLeave(f,q);if(s)for(q in s)if(!h||!h[q]){var B=s[q];B.target.onEnter&&B.target.onEnter(f,J,n,B.point,B.width,B.height),this.fire(B.type,"onEnter",B.event,B.data,B.image,B.comp,B.point,B)}}this.currentInfo=e},handle:function(G,d,I){var R,N=this,k=N.gv;if(N._is2d){if(I=I||k.getDataInfoAt(d,this.filter),!I)return;if(R=I.ui.interactiveInfo){var g,D=I.data;if(D.s(G)&&D.s(G)(d,D,k),this.fire("data",G,d,D),"body"===I.part&&R.bodyInfo)g="body",I.hits=this.handleImage(g,k.getImage(D),G,d,D,I.point,R.bodyInfo);else if("icons"===I.part&&R._38o){var Z=R._38o[I.name];Z&&Z[I.index]&&(g="icons|"+I.name+"|"+I.index,I.hits=this.handleImage(g,I.icon,G,d,D,I.point,Z[I.index]))}}return I}var D,n;if(!I)if(d&&d instanceof q.Math.Ray){var J=k.vr.intersectWorld(d);if(D=J.data,n=J.intersect,N.drawVRRay(d,D,n),!D)return;var o=k.getData3dUI(D);if(R=o.interactiveInfo,!R)return;I={data:D,part:n.part,ui:o}}else{if(I=k.getDataInfoAt(d),!I)return;I&&(I={data:I.data,part:I.part})}if(!n){D=I.data;var o=k.getData3dUI(D);if(I.ui=o,R=o.interactiveInfo,!R)return I;if(n=k.intersectObject(d,D),!n)return}D.s(G)&&D.s(G)(d,D,k),this.fire("data",G,d,D);var M,Q=n.part;return"body"!==Q&&(M=D.s(Q+".image")||D.s("shape3d."+Q+".image")),M||(M=D.s("all.image")||D.s("shape3d.image")),(R=R[M])?(I.part="body",I.interactiveInfo=R,I.point=n.uv.multiply({x:R.bodyInfo.rect.width,y:R.bodyInfo.rect.height}),I.image=M,I.hits=this.handleImage("body",M,G,d,D,I.point,R.bodyInfo),I):void 0},_handleLeaveOrMissing:function(A,w,V){var h="leave"===A?this.currentInfo:this.downInfo;if(h){var e=h.interactiveInfo||h.ui.interactiveInfo;if(e){var j,o,s=h.data;if(this._is2d){if(o=this.gv.lp(w),"body"===h.part&&e.bodyInfo)j="body","leave"===A?this.handleLeaveImage(V,j,this.gv.getImage(s),w,s,o,e.bodyInfo):this.handleMissingUpImage(j,this.gv.getImage(s),w,s,o,e.bodyInfo);else if("icons"===h.part&&e._38o){var E=e._38o[h.name];E&&E[h.index]&&(j="icons|"+h.name+"|"+h.index,"leave"===A?this.handleLeaveImage(V,j,h.icon,w,s,o,E[h.index]):this.handleMissingUpImage(j,h.icon,w,s,o,E[h.index]))}}else{var W=this.gv.intersectObject(w,s);o=W?W.uv.multiply({x:e.bodyInfo.rect.width,y:e.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===A?this.handleLeaveImage(V,"body",h.image,w,s,o,e.bodyInfo):this.handleMissingUpImage("body",h.image,w,s,o,e.bodyInfo)}}}},handleDownInfo:function(D,F){if(this.downInfo){var v=this.downInfo,q=this.gv,O=v.interactiveInfo||v.ui.interactiveInfo;if(O){var S,i=v.data;if(i.s(D)&&i.s(D)(F,i,q),this.fire("data",D,F,i),this._is2d){var W=q.lp(F);if("body"===v.part&&O.bodyInfo)S="body",this.handleDownInfoImage(S,q.getImage(i),D,F,i,W,O.bodyInfo);else if("icons"===v.part&&O._38o){var L=O._38o[v.name];L&&L[v.index]&&(S="icons|"+v.name+"|"+v.index,this.handleDownInfoImage(S,v.icon,D,F,i,W,L[v.index]))}}else{var B=q.intersectObject(F,i);if(!B)return;W=B.uv.multiply({x:O.bodyInfo.rect.width,y:O.bodyInfo.rect.height}),this.handleDownInfoImage("body",v.image,D,F,i,W,O.bodyInfo)}}}},fire:function(n,x,P,G,E,N,$,Q){this.gv.fi({kind:x,type:n,event:P,data:G,image:E,comp:N,view:this.gv,point:$,width:Q?Q.width:j,height:Q?Q.height:j})},handleImage:function(O,o,g,L,t,p,r){var U={};if(o&&(o=ed(o))){var v=this.gv,c=r.rect,B=this.convertPoint(p,r);B.inRect&&(o[g]&&o[g](L,t,v,B,c.width,c.height),this.fire("image",g,L,t,o,j,B,c),U[O+"|image"]={target:o,type:"image",image:o,data:t,event:L,point:B,width:c.width,height:c.height});for(var i=r.compInfos,n=o,N=i.length-1;N>=0;N--){var W=i[N],T=W.comp;B=this.convertPoint(p,W,n,T,v,t),B.inRect&&(c=W.rect,T[g]&&T[g](L,t,v,B,c.width,c.height),this.fire("comp",g,L,t,o,T,B,c),(o=c.image)&&(o[g]&&o[g](L,t,v,B,c.width,c.height),this.fire("image",g,L,t,o,j,B,c)),U[O+"|"+N]={target:T,type:"comp",comp:T,image:o,data:t,event:L,point:B,width:c.width,height:c.height},o&&(U[O+"|"+N+"|image"]={target:o,type:"image",image:o,data:t,event:L,point:B,width:c.width,height:c.height}))}}return U},handleLeave:function(i,h){return this._handleLeaveOrMissing("leave",i,h)},handleMissingUp:function(B){return this._handleLeaveOrMissing("missing",B)},handleLeaveImage:function(U,d,g,Q,S,C,Z){if(g&&(g=ed(g))){var K=this.gv,E=Z.rect,R=this.convertPoint(C,Z);U===d+"|image"&&(g.onLeave&&g.onLeave(Q,S,K,R,E.width,E.height),this.fire("image","onLeave",Q,S,g,j,R,E));for(var B=Z.compInfos,H=g,u=B.length-1;u>=0;u--){var Y=B[u],a=Y.comp;R=this.convertPoint(C,Y,H,a,K,S),E=Y.rect,U===d+"|"+u&&(a.onLeave&&a.onLeave(Q,S,K,R,E.width,E.height),this.fire("comp","onLeave",Q,S,g,a,R,E)),(g=E.image)&&U===d+"|"+u+"|image"&&(g.onLeave&&g.onLeave(Q,S,K,R,E.width,E.height),this.fire("image","onLeave",Q,S,g,j,R,E))}}},handleMissingUpImage:function(Q,n,Y,o,i,K){var M="onUp",D=this.downInfo.hits;if(D&&n&&(n=ed(n))){var e=this.gv,$=K.rect,g=this.convertPoint(i,K);!g.inRect&&D[Q+"|image"]&&(n[M]&&n[M](Y,o,e,g,$.width,$.height),this.fire("image",M,Y,o,n,j,g,$));for(var q=K.compInfos,P=n,z=q.length-1;z>=0;z--){var m=q[z],N=m.comp;g=this.convertPoint(i,m,P,N,e,o),g.inRect||($=m.rect,D[Q+"|"+z]&&(N[M]&&N[M](Y,o,e,g,$.width,$.height),this.fire("comp",M,Y,o,n,N,g,$)),(n=$.image)&&D[Q+"|"+z+"|image"]&&(n[M]&&n[M](Y,o,e,g,$.width,$.height),this.fire("image",M,Y,o,n,j,g,$)))}}},handleDownInfoImage:function(N,y,C,k,F,Q,b){var o=this.downInfo.hits;if(o&&y&&(y=ed(y))){var G=this.gv,E=b.rect,B=this.convertPoint(Q,b);o[N+"|image"]&&(y[C]&&y[C](k,F,G,B,E.width,E.height),this.fire("image",C,k,F,y,j,B,E));for(var M=b.compInfos,h=y,W=M.length-1;W>=0;W--){var I=M[W],v=I.comp;B=this.convertPoint(Q,I,h,v,G,F),E=I.rect,o[N+"|"+W]&&(v[C]&&v[C](k,F,G,B,E.width,E.height),this.fire("comp",C,k,F,y,v,B,E)),(y=E.image)&&o[N+"|"+W+"|image"]&&(y[C]&&y[C](k,F,G,B,E.width,E.height),this.fire("image",C,k,F,y,j,B,E))}}},initImageResource:function(){d.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(x,C,v,B,r,N){var I=C.rect,U=C.matrix.applyInverse(x).sub(I),i=U.x>=0&&U.y>=0&&U.x<=I.width&&U.y<=I.height;if(!i)return U;if(B&&li(B.pixelPerfect,N,r)){var I,X=1;this._is2d?(X=r.getZoom(),I=yj(x.x,x.y,j,X)):I=yj(x.x,x.y);var K=!1,_=I.x,Q=I.y,M=I.width,Y=I.height,g=d.hitMaxArea,t=M*Y*X*X;if(t>g){var G=Math.sqrt(g/t);X*=G}M*=X,Y*=X,2>M&&(M=2),2>Y&&(Y=2),_*=X,Q*=X;var c=xn(M,Y),$=new Hq(0,-_,-Q,X,X);$.append(C.matrix),r._drawForChecking=!0,B.transform=$;var D=v.comps;v.comps=[B],gf(c,v,0,0,M,Y,N,self),v.comps=D,delete B.transform,r._drawForChecking=!1;try{for(var A=0,E=c.getImageData(0,0,M,Y).data;A<E.length;A+=4)if(0!==E[A+3]){K=!0;break}c.restore()}catch(o){Fj=R,K=!1}U.inRect=K}else U.inRect=!0;return U}});var Vd=rf.DefaultInteractor=function(j){Id(Vd,this,[j])};Bn("DefaultInteractor",ig,{handle_mousedown:function(d){bf(d);var p=this,x=p.gv,f=x.getDataAt(d);!x.setFocus(d)||x._editing||x._scrolling||(Gn(d)?x.handleDoubleClick(d,f):x.handleClick(d,f),!wd()&&f&&(x.isMovable(f)||x.isInteractive(f))||!x.isPannable()||!Qk(d)||je(d)||(p._tx=x.tx(),p._ty=x.ty(),p.startDragging(d)))},handleWindowMouseUp:function(i){var x=this,L=x.gv;L._panning&&(delete L._panning,L.onPanEnded(),x.fi({kind:"endPan",event:i})),delete x._tx,delete x._ty,x.clearDragging()},handle_mousemove:function(n){var K=this,f=K.gv;K._hoverTimer&&(E(K._hoverTimer),delete K._hoverTimer),K._hoverTimer=I(function(){K.fi({kind:"hover",event:n}),E(K._hoverTimer),delete K._hoverTimer},f.getHoverDelay()||d.hoverDelay)},handle_touchmove:function(k){this.handle_mousemove(k)},handleWindowMouseMove:function(u){var x=this,h=x.gv,v=x._lastClientPoint;x.fi({kind:h._panning?"betweenPan":"beginPan",event:u}),h._panning=1,h.setTranslate(x._tx+u.clientX-v.x,x._ty+u.clientY-v.y)},handle_mousewheel:function(j){this.gv.handleScroll(j,j.wheelDelta)},handle_DOMMouseScroll:function(R){2===R.axis&&this.gv.handleScroll(R,-R.detail)},handle_keydown:function(W){this.gv.handleKeyDown(W)}});var Jb=rf.SelectInteractor=function(u){Id(Jb,this,[u])};Bn("SelectInteractor",ig,{_42:function(){var I=this,F=I.gv,z=F.getZoom(),o=I.mark,W=I.div;W||(W=I.div=me(),ke(I.getView(),W));var L={};L.x=o.x*z+F.tx(),L.y=o.y*z+F.ty(),L.width=o.width*z,L.height=o.height*z,Zh(W,L),this.intersects()?(W.style.border="",W.style.background=F.getRectSelectBackground()):(W.style.background="",W.style.border="1px solid "+F.getRectSelectBorderColor())},handle_mousedown:function(q){var O=this,W=O.gv;if(O._57I=R,O.pendingClickThrough=R,!(W._editing||W._scrolling||wd())){var g=W.getDataAt(q),V=W.sm();g?je(q)?V.co(g)?V.rs(g):V.as(g):V.co(g)?g instanceof Gk&&g.isClickThroughEnabled()&&(O.pendingClickThrough=Bm(q)):V.ss(g):je(q)||!W.isPannable()?Qk(q)&&(je(q)||V.cs(),W.isRectSelectable()&&(O.startDragging(q),W._77O=1)):Qk(q)&&(O._57I=Bm(q))}},handle_mouseup:function(U){var M=this,n=M.gv,P=M._57I;if(P&&(Yi(P,Bm(U))<=1&&n.sm().cs(),M._57I=R),M.pendingClickThrough){if(Yi(M.pendingClickThrough,Bm(U))<=1){var s=n.getDataAt(U);if(s instanceof Gk&&s.isClickThroughEnabled()){var g=n.getDataAt(U,function(C){var a=C.getParent()===s&&n.isSelectable(C,!0);return a});g&&(U.clickThrough=!0,n.sm().ss(g))}}M.pendingClickThrough=R}},handleWindowMouseUp:function(N){this.clear(N)},handleWindowMouseMove:function(v){var e=this,U=e.gv;e._logicalPoint=U.lp(v),e.mark?(e.fi({kind:"betweenRectSelect",event:v}),U.isPannable()&&e.autoScroll(v),e.redraw()):e.fi({kind:"beginRectSelect",event:v}),e.mark=_q(e._lastLogicalPoint,e._logicalPoint),e.redraw()},intersects:function(){var h=this,v=h._lastLogicalPoint,y=h._logicalPoint;return v.x>y.x||v.y>y.y},clear:function(o){var L=this,Q=L.gv,W=L.mark;if(L._57I=R,L.pendingClickThrough=R,L._lastLogicalPoint){if(W){if(0!==W.width&&0!==W.height){var K=Q.getDatasInRect(W,L.intersects());if(!K.isEmpty()){var B=Q.sm(),z=B.toSelection();K.each(function(h){B.co(h)?z.remove(h):z.add(h)}),B.ss(z)}}un(L.div),delete L.div,delete L.mark,L.redraw(),L.fi({kind:"endRectSelect",event:o}),Q.onRectSelectEnded()}L.clearDragging(),delete Q._77O}},redraw:function(){var a=this;a._draw||(a._draw=1,I(function(){a.mark&&a._42(),delete a._draw},16))}});var rd=rf.MoveInteractor=function(O){Id(rd,this,[O])};Bn("MoveInteractor",ig,{handle_mousedown:function(v){var H=this,X=H.gv;if(Qk(v)&&!X._editing&&!X._scrolling&&!wd()){var u=X.getSelectedDataAt(v);!u||X.isInteractive(u)&&!X.isMovable(u)?X._focusData=R:(H._data=u,X.handleMouseDown&&X.handleMouseDown(v,u),H.startDragging(v),X.isMovable(u)&&(X._moving=1))}},handleWindowMouseUp:function(e){var u=this,z=u.gv;z.handleMouseUp&&z.handleMouseUp(e,u._data),u.clear(e)},handleWindowMouseMove:function(P){var W=this,C=W._data,X=W.gv;if((!X._93O||!X._93O(P,C))&&X._moving){W._logicalPoint||W.fi({kind:"prepareMove",event:P});
var s=W._logicalPoint?"betweenMove":"beginMove",$={kind:s,event:P},S=W._logicalPoint=X.lp(P);"beginMove"!==s||W._alreadyBeginTransaction||(W._alreadyBeginTransaction=!0,X.getDataModel().beginTransaction());var G=W._calcShift(s,P),Q=G.x,e=G.y,p=W.gv.getMoveMode(P,C);p&&("x"===p?e=0:"y"===p?Q=0:"xy"!==p&&(Q=e=0)),X.moveSelection(Q,e),W._lastLogicalPoint=S,W.autoScroll(P),W.fi($)}},_calcShift:function(){var Z=this,y=Z._logicalPoint,G=Z._lastLogicalPoint,x=y.x-G.x,z=y.y-G.y;return{x:x,y:z}},clear:function(_){var i=this,s=i.gv;i._lastLogicalPoint&&(i._lastLogicalPoint=i._data=s._moving=R,i._logicalPoint&&(i.fi({kind:"endMove",event:_}),s.onMoveEnded()),i.clearDragging()),i._alreadyBeginTransaction&&(i._alreadyBeginTransaction=!1,s.getDataModel().endTransaction())}});var yn=rf.ScrollBarInteractor=function(K){Id(yn,this,[K])};Bn("ScrollBarInteractor",ig,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(l){var R=this.gv.getViewRect();return this._41o()&&(R.x+R.width-this.gv.lp(l).x)*this.gv.getZoom()<Bk},isH:function(x){var I=this.gv.getViewRect();return this._40o()&&(I.y+I.height-this.gv.lp(x).y)*this.gv.getZoom()<Bk},handle_mousemove:function(x){this.handle_touchmove(x)},handle_touchmove:function(k){if(!Am&&Qk(k)&&this.gv.isScrollBarVisible()){var r=this,A=r.isV(k),q=r.isH(k);(A||q)&&r.gv.showScrollBar(),r.gv._scrolling=A||q}},handleWindowMouseUp:function(I){this.handleWindowTouchEnd(I)},handleWindowTouchEnd:function(J){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=R,this.fi({kind:"endScroll",event:J})},handle_mousedown:function(q){this.handle_touchstart(q)},handle_touchstart:function(X){var z=this;if(z.gv.setFocus(X),bf(X),z.handle_touchmove(X),!(Hh(X)>1)&&z.gv._scrolling&&z.gv.isScrollBarVisible()){z._cp=Bm(X),z._tx=z.gv.tx(),z._ty=z.gv.ty();var V=z.isV(X);z._state=V?"vScroll":"hScroll",Wr(z,X),z.fi({kind:"beginScroll",event:X})}},handleWindowMouseMove:function(D){this.handleWindowTouchMove(D)},handleWindowTouchMove:function(m){var U=Bm(m),Q=this.gv.getViewRect(),K=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-U.y)*K.height/Q.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-U.x)*K.width/Q.width),this.fi({kind:"betweenScroll",event:m})}});var bq=rf.TouchInteractor=function(W,y){y=y||{},y.selectable===j&&(y.selectable=!0),y.movable===j&&(y.movable=!0),y.pannable===j&&(y.pannable=!0),y.pinchable===j&&(y.pinchable=!0),y.editable===j&&(y.editable=!0),this.params=y,Id(bq,this,[W])};Bn("TouchInteractor",ig,{ms_edit:1,setUp:function(){var A=this;bq.superClass.setUp.call(A),Ei&&A.params.editable&&A.gv.setEditInteractor(A)},tearDown:function(){var x=this;bq.superClass.tearDown.call(x),Ei&&x.params.editable&&x.gv.setEditInteractor(R)},clear:function(L){var b=this,v=b.gv;v._moving&&(b.fi({kind:"endMove",event:L}),delete v._moving,v.onMoveEnded(),v.dm().endTransaction()),v._panning&&(b.fi({kind:"endPan",event:L}),delete v._panning,v.onPanEnded()),v._pinching&&(b.fi({kind:"endPinch",event:L}),delete v._pinching,v.onPinchEnded()),v._editing&&(b._46O(L),b._77I=b._node=b._edge=b._shape=b._rect=b._89I=b._index=v._editing=R),b._moving=b._panning=b._pinching=b._editing=b._57I=b._data=b._beginHistory=R,b.clearDragging()},handle_touchstart:function(t){var c=this;if(!c.gv._editing){bf(t),c._57I=R;var E=c.params,W=c.gv,Z=W.sm(),U=W.getDataAt(t),I=Hh(t);if(1===I){if(Gn(t))return W.handleDoubleClick(t,U),void 0;W.handleClick(t,U),U&&(W.handleMouseDown&&W.handleMouseDown(t,U),c._data=U),E.selectable||(U=R),U?(Z.co(U)||Z.ss(U),E.editable&&W.isEditable(U)&&c._79I(t,U,!0)?(c._editing=1,c.startDragging(t)):E.movable&&W.isMovable(U)&&(c._moving=1,c.startDragging(t))):(c._57I=Bm(t),E.pannable&&W.isPannable()&&(c._panning=1,c.startDragging(t),c._translate={x:W.tx(),y:W.ty()}))}else if(E.pinchable&&2===I){c._pinching=1,c.startDragging(t);var P=W.getView(),f=W.getZoom(),g=P.getBoundingClientRect(),A=t.touches[0],T=t.touches[1],n={x:(A.clientX+T.clientX)/2-g.left,y:(A.clientY+T.clientY)/2-g.top};n.x-=W.tx(),n.y-=W.ty(),n.x/=f,n.y/=f,c._p=n,c._d=Mn(t)}}},handle_touchend:function(C){var $=this,P=$.gv,M=$._57I,_=$._data;M&&(Yi(M,Bm(C))<=1&&P.sm().cs(),$._57I=R),_&&P.handleMouseUp&&P.handleMouseUp(C,_)},handleWindowTouchEnd:function(S){this.clear(S)},handleWindowTouchMove:function(f){var R=this,u=R.gv,Z=Hh(f);if(1===Z){if(R._editing&&(R._beginHistory||(R._beginHistory=1,u.dm().beginTransaction()),u._editing=1,R._78I(f)),R._moving)R._beginHistory||(R._beginHistory=1,u.dm().beginTransaction()),R.handleMove(f);else if(R._panning){var I=Bm(f);u.setTranslate(R._translate.x+I.x-R._lastClientPoint.x,R._translate.y+I.y-R._lastClientPoint.y),R.fi({kind:u._panning?"betweenPan":"beginPan",event:f}),u._panning=1}}else if(2===Z&&R._pinching){var j=Mn(f);u.handlePinch(R._p,j,R._d),R._d=j,R.fi({kind:u._pinching?"betweenPinch":"beginPinch",event:f}),u._pinching=1}},handleMove:function(O){var q=this,A=q.gv,H=A.lp(O);A._93O&&A._93O(O,q._data)||(A.moveSelection(H.x-q._lastLogicalPoint.x,H.y-q._lastLogicalPoint.y),q._lastLogicalPoint=H,q.autoScroll(O),q.fi({kind:A._moving?"betweenMove":"beginMove",event:O}),A._moving=1)}});var q=F.ht,eq=q.graph._editor={Math:q.Math,Guide:{}};eq.getStyle=function($){var t,s=eq.StyleMap;return s&&(t=s[$],t!==j)?t:eq.DefaultStyleMap[$]},eq.setStyle=function(q,E){var G=eq.StyleMap;G||(G=eq.StyleMap={}),G[q]=E},eq.inEdit=function(h){return h._inXEdit===!0},eq.startEdit=function(k){k._inXEdit=!0,eq.Inject.doInject(k)},eq._46O=function(E){E._inXEdit=!1,eq.Inject.undoInject(E)},eq.toScreenPosition=function(m,R){var l=m.tx(),t=m.ty(),W=m._zoom;return new eq.Math.Vector2(R.x*W+l,R.y*W+t)},eq.checkHit=function(g,o,K){return g.distanceTo(o)<K?!0:!1},eq.toWorldPosition=function(Y,S){var K=Y.tx(),n=Y.ty(),C=Y._zoom;return{x:(S.x-K)/C,y:(S.y-n)/C}},eq.setAntialias=function(E,S){for(var o,s=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],H=0,t=s.length;t>H&&(o=s[H],!(o in E));H++);E[o],E[o]=S},eq.getTargetCornersOnScreen=function(b,Z){if(!Z)return null;var L,x=[];if(xm(Z,b)){var P=Nd(b,Z);L=[{x:P.x,y:P.y},{x:P.x+P.width,y:P.y},{x:P.x+P.width,y:P.y+P.height},{x:P.x,y:P.y+P.height}]}else{if(!Z.getCorners)return null;L=Z.getCorners()}return L.forEach(function(E){var p=eq.toScreenPosition(b,E);x.push(p.x,p.y)}),x},eq.log=function(){};var Qh=eq.Inject={_modules:[]};Qh.registAsModule=function(z,m){var U={},X={};for(var Y in z){var $=m.prototype[Y];U[Y]=$}z.getBackup=function(f){return U[f]},z.getBackups=function(){return U},X.doInject=function(){for(var p in z)"getBackup"!==p&&(m.prototype[p]=z[p])},X.undoInject=function(){for(var T in z)"getBackup"!==T&&(m.prototype[T]=U[T])},Qh._modules.push(X)},Qh.doInject=function(A){for(var T,D=Qh._modules,z=0,X=D.length;X>z;z++)T=D[z],T.doInject(A)},Qh.undoInject=function(y){for(var f,N=Qh._modules,H=0,h=N.length;h>H;H++)f=N[H],f.undoInject(y)};var ig=q.graph.EditInteractor=function(Y){var R=this,b=k.createElement("canvas");b.className="editCanvas",b.style.position="absolute",R._styleMap={},R._canvas=b,R._context=b.getContext("2d"),ig.superClass.constructor.call(R,Y),eq.setAntialias(R._context,!1),R._subModules=[new eq.Anchor(R),new eq.RotateX(R),new eq.Rect(R),new eq.Curve(R),new eq.MoveHelper(R)],R._gridGuide=new eq.Guide.Grid(R),R._rectGuide=new eq.Guide.Rect(R)},kd=ig;q.Default.def(ig,q.graph.Interactor,{ms_edit:1,ms_fire:1}),G.defineProperties(ig.prototype,{editDetail:{get:function(){var O=!!this._editDetail;return O},set:function(J){var _=this,A=_._editDetail;A!==J&&(_._editDetail=J,_.gv._editing=J,_.fp("editDetail",A,J),_.fp("pointsEditingMode",A,J),_.fi({kind:J?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(d){(!this._editDetail||d)&&(this.gv._editing=d,d||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(d){this._editing=d,this.gvEditing=d}},pointsEditingMode:{get:function(){return this.editDetail},set:function(X){var j=this;j.editDetail!==X&&(X?j._tryEnterEditDetailMode():j._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var W=this._gridEnabled;if(!W)return!1;var X=this.gv;return X?!0:!0},set:function(C){C!==this._gridEnabled&&(this._gridEnabled=C,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(K){K!==this._agEnabled&&(this._agEnabled=K,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}}}),ig.prototype.getSubModule=function(m){var I,d,V,o=this._subModules;for(d=0,V=o.length;V>d;d++)if(I=o[d],I.catalog===m)return I},ig.prototype.invokeSubModule=function(b,s){var c=this,P=c._subModules;if(P)for(var F,B,x,p=Array.prototype.slice.call(arguments,2),v=0,k=P.length;k>v;v++)if(F=P[v],B=F[b],B&&(x=B.apply(F,p),x!=j&&s))return F},ig.prototype.invokeSubModuleInverse=function(O,h){var d=this,k=d._subModules;if(k)for(var U,u,Z,t=Array.prototype.slice.call(arguments,2),R=k.length-1;R>=0;R--)if(U=k[R],u=U[O],u&&(Z=u.apply(U,t),Z!=j&&h))return U},ig.prototype.setUp=function(){eq.log("setUp");var g=this,x=g.gv,X=x.getView(),C=g._canvas;ig.superClass.setUp.call(g),x.setEditInteractor(g),x._79O?X.insertBefore(C,x._79O):X.appendChild(C),eq.startEdit(x),g.invokeSubModule("setUp"),x.dm().mm(g._onDataModelChanged,g),x.dm().md(g._onDataPropertyChanged,g)},ig.prototype.tearDown=function(){eq.log("tearDown");var I=this,F=I.gv,u=F.getView();I._resetCustomCursorStyle(),ig.superClass.tearDown.call(I),F.dm().umm(I._onDataModelChanged,I),F.dm().umd(I._onDataPropertyChanged,I),F.setEditInteractor(null),u.removeChild(I._canvas),I._drawTimer&&(E(I._drawTimer),I._drawTimer=null),eq._46O(F),I.invokeSubModule("tearDown")},ig.prototype._onDataModelChanged=function(X){var l=this;("clear"===X.kind||"remove"===X.kind&&l.editDetail&&X.data===l.getSubModule("Curve").target)&&(l.editDetail=!1,l._42())},ig.prototype._onDataPropertyChanged=function(Y){var P=this;if(P.editDetail){var K=P.getSubModule("Curve"),M=Y.data;M===K.target&&(M._writing||K._handleDataChanged())}},ig.prototype.clear=function(){eq.log("clear")},ig.prototype.redraw=function(){this._42()},ig.prototype._42=function(){var j=this;j._drawTimer||(j._drawTimer=I(function(){j._drawTimer=null,j.drawImpl()},0))},ig.prototype.drawImpl=function(){var u;for(u in{_42:!0})break;return function(){var f=this,S=f._canvas,g=f.gv,E=g.getWidth(),n=g.getHeight(),L=f._context,t=q.Default.getInternal();(S.width!==E||S.height!==n)&&t.setCanvas(S,E,n),L.clearRect(0,0,S.width,S.height);var Q=f._getValidSelection();L.save();var R=q.Default.devicePixelRatio;L.scale(R,R),f._gridGuide._42(),f.invokeSubModuleInverse(u,!1,L,g,Q),f._rectGuide._42(),L.restore()}}(),ig.prototype._getValidSelection=function(){var y=this,S=y.gv,G=S.sm().getSelection(),Q=[];return G.each(function(P){S.isVisible(P)&&S.isEditable(P)&&Q.push(P)}),Q},ig.prototype.handle_touchmove=function(x){return this.handle_mousemove(x)},ig.prototype.handle_mousemove=function(x){if(!q.Default.isDragging()){var o=this;(o.editDetail||!wd())&&(o.gvEditing=!1,o._checkEdit(x)&&(o.gvEditing=!0))}},ig.prototype.handle_touchstart=function(f){return this.handle_mousedown(f)},ig.prototype.handle_mousedown=function(i){bf(i);var T=this;if(T.editDetail||!wd()){if(Gn(i)&&!i.clickThrough){if(T.editDetail){if(T._tryQuitEditDetailMode(i))return}else if(T._tryEnterEditDetailMode())return;T.gv.dm().beginTransaction();var M=T.invokeSubModule("handleDoubleClick",!0,i);if(T.gv.dm().endTransaction(),M)return}var x=T._checkEdit(i);x&&(T._downPosition=T._getLogicalPoint(i),T.gv.dm().beginTransaction(),x.startEdit(T,i),T.editing=!0)}},ig.prototype._checkEdit=function(S){var d=this,X=d.gv,g=d._getLogicalPoint(S),k=d.invokeSubModule("check",!0,X,S,g)||null;return d._editMod=k,k},ig.prototype.handleWindowTouchMove=function(H){return this.handleWindowMouseMove(H)},ig.prototype.handleWindowMouseMove=function(t){var J=this,_=J._downPosition;if(_){var p=J._getLogicalPoint(t);if(p.distanceTo(_)<J.getStyle("moveSensitivity"))return;delete J._downPosition}var r=J._editMod;r&&r.handleEdit(J.gv,t)},ig.prototype._getLogicalPoint=function(k){var W=this,G=q.Default.getLogicalPoint(k,W._canvas);return new eq.Math.Vector2(G)},ig.prototype.handleWindowTouchEnd=function(x){return this.handleWindowMouseUp(x)},ig.prototype.handleWindowMouseUp=function(){var n;for(n in{_46O:!0})break;return function(i){var m=this;m.editing=!1,m.setCursor("default"),m.invokeSubModule(n,!1,i),m._42(),m.gv.dm().endTransaction()}}(),ig.prototype.handle_mousewheel=function(e){var z=this;bf(e),z.invokeSubModule("preHandleScroll",!0)||z.gv.handleScroll(e,e.wheelDelta)},ig.prototype.handleDelete=function(){var y=this;if(!y.editDetail){y.gv.dm().beginTransaction();var p=y.invokeSubModule("handleNormalStateDelete",!0);return y.gv.dm().endTransaction(),p||y.gv.removeSelection(),void 0}y.gv.dm().beginTransaction(),y.invokeSubModule("handleDelete",!0),y.gv.dm().endTransaction(),y._42()},ig.prototype.handle_keydown=function(f){var K=this;if((f.metaKey||f.ctrlKey)&&K._42(),wd(f)&&!K.editing)return K.gvEditing=!1,K.setCursor("default"),K._42(),void 0;var D=En(f);return K.editDetail?((D||Re(f))&&(K.editDetail=!1,K._42()),K.gv.dm().beginTransaction(),K.invokeSubModule("handle_keydown",!0,f),K.gv.dm().endTransaction(),void 0):(K.gv.dm().beginTransaction(),K.invokeSubModule("handleNormalStateKeyDown",!0,f),K.gv.dm().endTransaction(),D&&K._tryEnterEditDetailMode(),void 0)},ig.prototype.handle_keyup=function(O){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,O),this.gv.dm().endTransaction()},ig.prototype._tryEnterEditDetailMode=function(){var M=this;return!M.editDetail&&M.invokeSubModule("canEnterEditDetailMode",!0)&&1===M._getValidSelection().length?(M.editDetail=!0,M._42(),!0):void 0},ig.prototype._tryQuitEditDetailMode=function(z){var C=this;if(C.editDetail){var p=C.gv,h=C.getSubModule("Curve").target;return z&&p.getDataAt(z)===h?void 0:(C.editDetail=!1,C._42(),!0)}},ig.prototype.setStyle=function(o,X,Y){var m=this;Y?eq.setStyle(o,X):m._styleMap[o]=X,m.fp("styleChanged",null,{key:o,value:X,base:Y}),m._42()},ig.prototype.getStyle=function(I){var F=this,c=F._styleMap[I];return c!==j?c:eq.getStyle(I)},ig.prototype.setCursor=function(H){this._resetCustomCursorStyle(),q.graph.EditInteractor.superClass.setCursor.call(this,H)},ig.prototype._resetCustomCursorStyle=function(){var E=this;if(E._customStyle){var W=this.gv.getView();W.classList&&W.classList.remove&&W.classList.remove(E._customStyle),E._customStyle=null}},ig.prototype._setRotateCursor=function(s){var _=this,$=_._cursorFactory;$||($=_._cursorFactory=new eq.CursorFactory(_));var N=$.getRotateCursor(s),O=_.gv.getView();_._resetCustomCursorStyle(),_._customStyle=N,O.classList&&O.classList.add&&O.classList.add(N)};var Sg=eq.Group=function(K){var m=this;m._entities=K,m._64O=0,m._position={x:0,y:0},m._scale={x:1,y:1},m._anchor={x:.5,y:.5},m._anchor2={x:.5,y:.5}};Sg.prototype={},Sg.prototype.constructor=Sg;var Iq=null;Sg.findOrCreateGroup=function(z){if(Iq&&Iq.checkIsMe(z))return Iq;var d=new eq.Group(z);return d.getKeyOb()?(Iq=d,d):void 0},Sg.prototype.checkIsMe=function(h){var P=this._entities;if(P.length!==h.length)return!1;var R,k={},Z=h.length;for(R=0;Z>R;R++)k[h[R]._id]=!0;for(R=0;Z>R;R++)if(!k[P[R]._id])return!1;return!0},Sg.prototype.getRotation=function(){return this._64O},Sg.prototype.getPosition=function(){return this._position},Sg.prototype.getAnchor=function(){return this._anchor},Sg.prototype.getWidth=function(){return this._width},Sg.prototype.getScale=function(){return this._scale},Sg.prototype.getSize=function(){return{width:this._width,height:this._height}},Sg.prototype.getHeight=function(){return this._height},Sg.prototype.getKeyOb=function(){for(var d=this._entities,o=d.length-1;o>=0;o--){var Z=d[o];if(this.isNode(Z))return Z}},Sg.prototype.getAnchor2=function(){var y=this,l=y.rotateCenter;if(l)return l;var N=y.getKeyOb();if(!N)return y._anchor;var O=y._anchor2,U=N.getMatrix();return U.tf({x:N.getWidth()*(O.x-N.getAnchor().x),y:N.getHeight()*(O.y-N.getAnchor().y)})},Sg.prototype.setAnchor2=function(o,O){var S=this,p=S.getKeyOb();if(p){var e,Z=p.getMatrix();e="number"==typeof o?{x:o,y:O}:o;var J=Z.tfi(e);S._anchor2={x:p.getAnchor().x+J.x/p.getWidth(),y:p.getAnchor().y+J.y/p.getHeight()}}},Sg.prototype.setRotation=function(){},Sg.prototype.beginRotate=function(e){this.rotateCenter=e.pos,this.rotateMode=e.groupRotateMode},Sg.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Sg.prototype.addRotation=function(D,F){return"batch"===F?this._addRotationInBatchMode(D):"block"===F?this._addRotationInBlockMode(D):void 0},Sg.prototype._addRotationInBlockMode=function(A){var b=this,x=b.rotateCenter||b.getPosition();b._entities.forEach(function(c){if(b.isNode(c)){var W=c.getMatrix();W.translate(-x.x,-x.y),W.rotate(A),W.translate(x.x,x.y);var o=Math.sign(c.getScale().x);c.setRotation(i(W.b*o,W.a*o)),c.setPosition(W.tx,W.ty)}})},Sg.prototype._addRotationInBatchMode=function(s){var T=this,G=T._anchor2;T._entities.forEach(function(x){if(T.isNode(x)){var M=x.getAnchor(),V=x.getMatrix(),_=V.tf({x:x.getWidth()*(G.x-M.x),y:x.getHeight()*(G.y-M.y)}),B=new eq.Math.Matrix2d;B.set(V.a,V.b,V.c,V.d,V.tx,V.ty),B.translate(-_.x,-_.y),B.rotate(s),B.translate(_.x,_.y);var E=Math.sign(x.getScale().x);x.setRotation(i(B.b*E,B.a*E)),x.setPosition(B.tx,B.ty)}})},Sg.prototype.setPosition=function(l){var v,n,z,R,s=this,q=s._position,B=l.x-q.x,h=l.y-q.y,g=s._entities;for(n=0,z=g.length;z>n;n++)v=g[n],ei(v)&&(R=v.getPosition(),v.setPosition(R.x+B,R.y+h));s._position=l},Sg.prototype.setScale=function(i,Y){var u=this,j=i/u._scale.x,O=Y/u._scale.y;u._adjustChildScaleOrSize(j,O,"size"),u._scale={x:i,y:Y}},Sg.prototype.getRect=function(){var b=this,o=b._position,n=b._width,Q=b._height;return{x:o.x-n/2,y:o.y-Q/2,width:n,height:Q}},Sg.prototype.setSize=function(Z,M){var b=this,Z=Math.max(1,Z),M=Math.max(1,M),T=Z/b._width,Y=M/b._height;b._adjustChildScaleOrSize(T,Y,"size"),b._width=Z,b._height=M},Sg.prototype._adjustChildScaleOrSize=function(A,G,O){var u,B,T,F,e,E,Y,d,K,l,p,L,k,c,J=this,w=J._position,m=J._entities,P=new eq.Math.Matrix2d;for(B=0,T=m.length;T>B;B++)if(u=m[B],J.isNode(u)){if(F=u.getPosition(),e=u.getRotation(),E=u.getWidth(),Y=u.getHeight(),d=u.getScale(),p=d.x*E,L=d.y*Y,P.identity().scale(p,L).rotate(e).translate(F.x,F.y).translate(-w.x,-w.y).rotate(-J._64O),e=i(P.b*Math.sign(p),P.a*Math.sign(p)),P.scale(A,G),K=Math.cos(e),l=Math.sin(e),Math.abs(K)<.001?(k=P.b/l,c=-P.c/l):(k=P.a/K,c=P.d/K),"scale"===O)u.setScale(k/E,c/Y);else if("size"===O){var h=k/d.x,x=c/d.y;u.setScale(qg(k)*Math.abs(d.x),qg(c)*Math.abs(d.y)),u.setSize(Math.max(.1,Math.abs(h)),Math.max(.1,Math.abs(x)))}P.rotate(J._64O).translate(w.x,w.y),u.setPosition(P.tx,P.ty)}},Sg.prototype.getMatrix=function(){var d=this,r=d._position,u=q.Default.getInternal(),Y=d._scale;return new u.Mat(d._64O,r.x,r.y,Y.x,Y.y)},Sg.prototype.toGlobal=function($){return this.getMatrix().tf($)},Sg.prototype.getCorners=function(){var s=this,k=s._width,w=s._height,H=s._anchor,i=-k*H.x,m=-w*H.y,K=s.getMatrix();return[K.tf(i,m),K.tf(i,m+w),K.tf(i+k,m+w),K.tf(i+k,m)]},Sg.prototype.calcInfo=function(){var V,z,k,S,g,C,Y=this,w=[],M=Y._entities,p=Y._64O;for(S=0,g=M.length;g>S;S++)C=M[S],Y.isNode(C)&&C.getCorners&&w.push.apply(w,C.getCorners());if(w.length){var c=Math.cos(-p),m=Math.sin(-p),N=1/0,q=-1/0,h=1/0,r=-1/0;for(S=0,g=w.length;g>S;S++)k=w[S],V=k.x,z=k.y,k.x=c*V-m*z,k.y=m*V+c*z,N=Math.min(N,k.x),q=Math.max(q,k.x),h=Math.min(h,k.y),r=Math.max(r,k.y);Y._width=(q-N)/Y._scale.x,Y._height=(r-h)/Y._scale.y,c=Math.cos(p),m=Math.sin(p);var X=Y._anchor;V=N+(q-N)*X.x,z=h+(r-h)*X.y,Y._position={x:c*V-m*z,y:m*V+c*z}}},Sg.prototype.isNode=function(u){return ei(u)?xm(u)?!1:!0:!1},Sg.prototype._42=function(r,a,x){var V,P,N,M,k,K,u,n,q=this,Y=q._entities,Q=q.rotateMode;for("batch"===Q&&(n=q.getKeyOb()),V=0,P=Y.length;P>V;V++)N=Y[V],q.isNode(N)&&(K=N.getRect(),M=eq.toScreenPosition(x,{x:K.x,y:K.y}),k=eq.toScreenPosition(x,{x:K.x+K.width,y:K.y+K.height}),u={min:M,max:k},N===n&&(u.isKeyOb=!0),eq.Icons.DrawIcon(r,a,eq.Icons.GroupSubEntityRect,u))};var an=eq.CurveActiving=function(w,y){this._curve=w,this._interactor=w._interactor;for(var e in y)this[e]=y[e]};an.prototype={},an.prototype.constructor=an,G.defineProperties(an.prototype,{point:{get:function(){return this._point},set:function(M){var f=this;f._point=M,f.editingCtrl||f._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(F){var Z=this;Z._pairs=F,Z.editingCtrl&&Z._firePointChange()}}}),an.prototype._firePointChange=function(){var a=this,K=a.getCurrentEditingPoint();if(!K)return L.fi({kind:"selectPoint"}),void 0;var L=a._interactor,l=this._curve.target;if(l){var E=eq.getDataMatrix(l).invert(),m=K.e;K=E.apply(eq.toWorldPosition(L.gv,K)),K.e=m;var V=a._lastFirePoint;V&&Math.abs(K.x-V.x)<1e-5&&Math.abs(K.y-V.y)<1e-5&&(K.e==j&&V.e==j||Math.abs(K.e-V.e)<1e-5)||(a._lastFirePoint=K,L.fi({kind:"selectPoint",x:K.x,y:K.y,e:K.e}))}},an.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},an.prototype.getCurrentEditingPoint=function(){var S=this,r=S.editingCtrl;if(r){var c=S.pairs;if(c){var D=c[r.pairId],k=D[r.type];if(k)return k}}return S._point};var $n=eq.CursorFactory=function(h){var d=this;d._interactor=h,d._rotateCursorStyles={}};$n.prototype={},$n.prototype.constructor=$n,$n.prototype.getRotateCursor=function(l){var i=this;0>l&&(l+=2*Math.PI);var s=i._interactor,E=s.getStyle("rotateCursorSize"),J=s.getStyle("rotateCursorRound"),q=Math.round(180*(l/Math.PI)/J);q*J>=360&&(q=0);var y=i._rotateCursorStyles,D="htCustomRotateStyle_"+E+"_"+J+"_"+q;return y[D]||(i._produceRotateCursor(D,E,J,q),y[D]=!0),D},$n.prototype._produceRotateCursor=function(e,y,$,o){var m=this;m._interactor;var L=m._canvas;L||(L=m._canvas=k.createElement("canvas")),L.width=L.height=y*devicePixelRatio,L.style.width=L.style.height=y+" px";var r=L.getContext("2d");eq.setAntialias(r,!1),r.scale(devicePixelRatio,devicePixelRatio);var q,w,f,b,G,z=Math.round(y/2),N=""+z+" "+z+",auto !important;";q=Math.PI/180*o*$,r.clearRect(0,0,y,y),r.save(),r.scale(y/32,y/32),r.translate(16,16),r.rotate(q+Math.PI/2),r.beginPath(),r.moveTo(-8,0),r.lineTo(-8,3),r.lineTo(-5,3),r.moveTo(8,0),r.lineTo(8,3),r.lineTo(5,3),r.moveTo(-8,3),r.quadraticCurveTo(0,-6,8,3),r.restore(),r.strokeStyle="white",r.lineWidth=4,r.stroke(),r.strokeStyle="black",r.lineWidth=2,r.stroke(),w=JSON.stringify(L.toDataURL()),b="cursor:url("+w+")"+N,1!==devicePixelRatio&&(f='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+y+'px" height="'+y+'px"><image xlink:href='+w+' width="'+y+'" height="'+y+'"/></svg>',b+="cursor:url(data:image/svg+xml;base64,"+btoa(f)+")"+N,b+="cursor:-webkit-image-set(url("+w+")"+devicePixelRatio+"x,url("+w+")1x)"+N),G=k.createElement("style"),G.textContent="body."+e+" *, ."+e+"{"+b+"}",k.head.appendChild(G)};var ff=eq.Guide.Grid=function(P){var W=this;W._interactor=P,W._alignmentGuideId=0,W._xAlignmentGuide=[],W._yAlignmentGuide=[]};ff.prototype={},ff.prototype.constructor=ff,G.defineProperties(ff.prototype,{gridBlockSize:{get:function(){var x=this;return x._gridBlockSize||x._interactor.getStyle("gridBlockSize")},set:function(R){this._gridBlockSize=R,this._interactor._42()}},gridThickLinesEvery:{get:function(){var t=this;return t._gridThickLinesEvery||t._interactor.getStyle("gridThickLinesEvery")},set:function(u){this._gridThickLinesEvery=u,this._interactor._42()}},gridEnabled:{get:function(){var F=this,L=F._interactor;return L.gridEnabled&&F.isValidGrid()}}}),ff.prototype._42=function(){var U=this,E=U._interactor;U.gridEnabled&&U.drawGrid(),E.alignmentGuideEnabled&&U.drawAlignmentGuide()},ff.prototype.makeMatrix=function(){var t=this,u=t._interactor.getStyle("gridAngle"),C=t._interactor.getStyle("gridRotation"),a=new eq.Math.Matrix2d,q=Math.sin(u),G=Math.cos(u);return a.set(1,0,G,q,0,0),a.rotate(C),a},ff.prototype.isValidGrid=function(){var A=this,j=Math.PI,X=A._interactor,e=X.gv;if(e._zoom<X.getStyle("gridZoomThreshold"))return!1;var a=X.getStyle("gridAngle"),G=Math.abs(180*(a%j/j)),S=1-1e-8;return S>G||G>180-S?!1:!0},ff.prototype.drawAlignmentGuide=function(){var p=this,$=p._interactor,y=$.gv,W=$._canvas,I=$._context,m=W.width,n=W.height,t=y.tx(),P=y.ty(),A=y._zoom;I.beginPath(),I.strokeStyle=$.getStyle("gridAlignmentGuideColor"),I.lineWidth=1,p._xAlignmentGuide.forEach(function(v){var k=v.p*A+t;I.moveTo(k,0),I.lineTo(k,n)}),p._yAlignmentGuide.forEach(function(F){var J=F.p*A+P;I.moveTo(0,J),I.lineTo(m,J)}),I.stroke()},ff.prototype.drawGrid=function(){function p(r,P,W,c){var B=eq.toScreenPosition(R,Z.apply({x:r,y:P})),j=eq.toScreenPosition(R,Z.apply({x:W,y:c}));E.moveTo(B.x,B.y),E.lineTo(j.x,j.y)}var v=this,B=v._interactor,I=v.gridBlockSize,H=v.gridThickLinesEvery,m=B.getStyle("gridThickColor"),i=B.getStyle("gridLightColor"),R=B.gv,X=B._canvas,E=B._context,C=X.width,L=X.height,Z=v.makeMatrix(),k=Z.applyInverse(eq.toWorldPosition(R,{x:0,y:0})),t=Z.applyInverse(eq.toWorldPosition(R,{x:C,y:0})),x=Z.applyInverse(eq.toWorldPosition(R,{x:0,y:L})),K=Z.applyInverse(eq.toWorldPosition(R,{x:C,y:L})),e=Math.min(k.x,t.x,x.x,K.x),s=Math.max(k.x,t.x,x.x,K.x),c=Math.min(k.y,t.y,x.y,K.y),l=Math.max(k.y,t.y,x.y,K.y);C=s-e,L=l-c;var z=Math.ceil(e/I),S=Math.floor(s/I),y=Math.ceil(c/I),D=Math.floor(l/I);R.tx(),R.ty(),R._zoom;var g,W,j;for(E.save(),E.lineWidth=1,E.beginPath(),E.strokeStyle=m,j=Math.ceil(z/H)*H;S>=j;j+=H)g=j*I,p(g,c,g,l);for(j=Math.ceil(y/H)*H;D>=j;j+=H)W=j*I,p(e,W,s,W);for(E.stroke(),E.beginPath(),E.strokeStyle=i,j=z;S>=j;j++)0!==j%H&&(g=j*I,p(g,c,g,l));for(j=y;D>=j;j++)0!==j%H&&(W=j*I,p(e,W,s,W));E.stroke(),E.restore()},ff.prototype.getAlignmentGuides=function(){var j=this;return{x:j._xAlignmentGuide,y:j._yAlignmentGuide}},ff.prototype.addAlignmentGuide=function(F,M,d){var q=this,C="x"===F?q._xAlignmentGuide:q._yAlignmentGuide,d=d?d:++q._alignmentGuideId,T={p:M,id:d};if(C.length){var H=q._findClosestAlignmentGuide(T.p,C);H.dis<0?C.splice(H.index+1,0,T):C.splice(H.index,0,T)}else C.push(T);return q._interactor._42(),d},ff.prototype.findClosest=function(h,L,W){var B=this,E=B._interactor,p=E.gv;W&&(h=eq.toWorldPosition(p,h));var G,P,z,C=1/0,c=1/0,S=h.x,s=h.y;if(B.gridEnabled){var o=B.gridBlockSize,y=B.makeMatrix(),q=y.applyInverse(h);q=y.apply({x:Math.round(q.x/o)*o,y:Math.round(q.y/o)*o}),C=q.x-S,c=q.y-s,z=!0}if(E.alignmentGuideEnabled&&(G=B._findClosestAlignmentGuide(S,B._xAlignmentGuide).dis,P=B._findClosestAlignmentGuide(s,B._yAlignmentGuide).dis,Math.abs(G)<Math.abs(C)&&(C=G,z=!0),Math.abs(P)<Math.abs(c)&&(c=P,z=!0)),z){z=!1;var v=p._zoom,I=E.getStyle("smartGuideSensitivity")/v,K={};if(Math.abs(C)<I&&"y"!==L&&(K.x=W?C*v:C,z=!0),Math.abs(c)<I&&"x"!==L&&(K.y=W?c*v:c,z=!0),z)return K}},ff.prototype._findClosestAlignmentGuide=function(N,u){if(!u.length)return{dis:1/0};for(var b,_=0,F=u.length-1;F-_>1;)b=Math.floor((_+F)/2),u[b].p<N?_=b:F=b;var x=u[_].p-N,T=u[F].p-N;return Math.abs(x)<=Math.abs(T)?{line:u[_],dis:x,index:_}:{line:u[F],dis:T,index:F}},ff.prototype.removeAllAlignmentGuide=function(a){var x=this;"y"!==a&&(x._xAlignmentGuide=[]),"x"!==a&&(x._yAlignmentGuide=[]),x._interactor._42()},ff.prototype.removeAlignmentGuide=function(F){for(var $,j,i,K=this,S=K._xAlignmentGuide,J=0;2>J;J++)for(S=0===J?K._xAlignmentGuide:K._yAlignmentGuide,$=0,j=S.length;j>$;$++)if(i=S[$],i.id===F)return S.splice($,1),K._interactor._42(),{axis:0===J?"x":"y",position:i.p};return!1},ff.prototype.adjustAlignmentGuide=function(I,M){var g=this,a=g.removeAlignmentGuide(I);return a?(g.addAlignmentGuide(a.axis,M,I),!0):!1};var lo=eq.Guide.Rect=function(C){var r=this;r._interactor=C};lo.prototype={},lo.prototype.constructor=lo,lo.prototype.gatherRects=function(){var D,U,b,T,c=this,V=c._interactor.gv,f=[],Y=[],E={x:f,y:Y},R={},G=V.getDataModel(),P=G.a("width"),x=G.a("height");P&&x&&(D=0,U=0,b=P,T=x,f.push({node:G,type:0,p:D},{node:G,type:1,p:D+b/2},{node:G,type:2,p:D+b}),Y.push({node:G,type:0,p:U},{node:G,type:1,p:U+T/2},{node:G,type:2,p:U+T}),R[G._id||0]={x:D,y:U,width:b,height:T}),G.each(function(G){if(ei(G)&&!V.isSelected(G)&&V.isVisible(G)){var L=!1;if(V.sm().getSelection().each(function(Q){L||(G.isHostOn(Q)?L=!0:G.isDescendantOf(Q)&&(L=!0))}),!L){var E=G.getRect();D=E.x,U=E.y,b=E.width,T=E.height,f.push({node:G,type:0,p:D},{node:G,type:1,p:D+b/2},{node:G,type:2,p:D+b}),Y.push({node:G,type:0,p:U},{node:G,type:1,p:U+T/2},{node:G,type:2,p:U+T}),R[G._id]=E}}}),f.sort(function(L,p){return L.p-p.p}),Y.sort(function(V,n){return V.p-n.p}),c._grid=E,c._87I=R},lo.prototype.gatherLines=function(f,V,q){var o,A,K,L,m,g,I,W,v,p,C,i,h=this,F=[h.findClosest({x:f.x,y:f.y},V),h.findClosest({x:f.x+f.w/2,y:f.y+f.h/2},V),h.findClosest({x:f.x+f.w,y:f.y+f.h},V)],e={},d=h._87I;q=q||255;var s,j;for(h._guideLine=[],o=0;2>o;o++)for(e={},0===o?(L="y",W=f.x,v=W+f.w):(L="x",W=f.y,v=W+f.h),A=0;3>A;A++)m=F[A],m&&isFinite(m[L])&&(s=1<<3*o+A,q&s&&(g=m[L+"Line"],I=g.node,j=I._id||0,e[j]||(e[j]=!0,i=d[j],"y"===L?(p=i.x,C=i.x+i.width):(p=i.y,C=i.y+i.height),K=g.p,h._guideLine.push({type:L,a:W,b:v,c:p,d:C,p:K,center:1===g.type}))))},lo.prototype._binarySearchClosest=function(l,N){if(!N.length)return{dis:1/0};for(var j,G=0,b=N.length-1;b-G>1;)j=Math.floor((G+b)/2),N[j].p<l?G=j:b=j;var y=N[G].p-l,V=N[b].p-l;return Math.abs(y)<=Math.abs(V)?{line:N[G],dis:y}:{line:N[b],dis:V}},lo.prototype.findClosest=function(Y,r,x){var T=this,E=T._interactor,j=E.gv,X=T._grid;x&&(Y=eq.toWorldPosition(j,Y));var t,Z=T._binarySearchClosest(Y.x,X.x),q=T._binarySearchClosest(Y.y,X.y),F=Z.dis,S=q.dis,s=j._zoom,U=E.getStyle("smartGuideSensitivity")/s,J={};return Math.abs(F)<U&&"y"!==r&&(J.x=x?F*s:F,J.xLine=Z.line,t=!0),Math.abs(S)<U&&"x"!==r&&(J.y=x?S*s:S,J.yLine=q.line,t=!0),t?J:void 0},lo.prototype._42=function(){var w=this,N=w._guideLine;if(N&&!q.Default.isCtrlDown()){var R,I,z,U,E,V,X,k,v,F,D,_,Q,B,r,A,Z,g=w._interactor,H=g.gv,S=g._context,h=H.tx(),u=H.ty(),i=H._zoom,x=g.getStyle("guideLineTextSpacing");for(R=0,I=N.length;I>R;R++)z=N[R],k=z.type,v=z.p,F=z.a,D=z.b,_=z.c,Q=z.d,B=Math.min(F,_),r=Math.max(D,Q),"x"===k?(U=v*i+h,E=B*i+u,V=U,X=r*i+u):(U=B*i+h,E=v*i+u,V=r*i+h,X=E),eq.Icons.DrawIcon(g,S,eq.Icons.MoveLineGuide,{rect:[U,E,V,X],center:z.center}),Q>=F&&D>=_||(B=F>Q?Q:D,r=F>Q?F:_,Z=r-B,"x"===k?(z.center2center||(U-=x,V=U),E=B*i+u,X=r*i+u,A=eq.Icons.MoveLineGuideDistanceV):"y"===k&&(z.center2center||(E-=x,X=E),U=B*i+h,V=r*i+h,A=eq.Icons.MoveLineGuideDistanceH),eq.Icons.DrawIcon(g,S,A,{x0:U,y0:E,x1:V,y1:X,dis:Z}))}},lo.prototype.clear=function(){this._guideLine=null},eq.DefaultStyleMap={pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideSensitivity:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,guideLineTextSpacing:0,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};
var Vg=eq.Icons={},Jo=1e4,Jp=null,so="rgb(51,153,255)",Di="rgb(183,232,135)",Uf="rgb(255,204,153)",Kj=6;q.Default.setImage("Icons.RectPoint",{width:Kj,height:Kj,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:so,rect:[0,0,Kj,Kj]}]});var jd="#e000e0";Vg.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var L=Vg.GroupSubEntityRect.data;if(!L)return[];var t=L.min,U=L.max;return[t.x,t.y,t.x,U.y,U.x,U.y,U.x,t.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Vg.GroupSubEntityRect.data.isKeyOb?jd:"#666666"}}}]},Vg.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Vg.Line.data.P1.x,Vg.Line.data.P1.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Vg.Line.data.P2.x,Vg.Line.data.P2.y],Kj,Kj]}}}]},Vg.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Vg.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Vg.Rect={comps:[{type:"shape",points:{func:function(){var K=Vg.Rect.data;if(!K)return[];var D=K.LT,B=K.LB,G=K.RB,m=K.RT;return[D.x,D.y,B.x,B.y,G.x,G.y,m.x,m.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:so},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},rect:{func:function(){return[[Vg.Rect.data.LT.x,Vg.Rect.data.LT.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},rect:{func:function(){return[[Vg.Rect.data.LB.x,Vg.Rect.data.LB.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},rect:{func:function(){return[[Vg.Rect.data.RB.x,Vg.Rect.data.RB.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},rect:{func:function(){return[[Vg.Rect.data.RT.x,Vg.Rect.data.RT.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},visible:{func:function(){return Vg.Rect.data.L?!0:!1}},rect:{func:function(){return[[Vg.Rect.data.L.x,Vg.Rect.data.L.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},visible:{func:function(){return Vg.Rect.data.R?!0:!1}},rect:{func:function(){return[[Vg.Rect.data.R.x,Vg.Rect.data.R.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},visible:{func:function(){return Vg.Rect.data.T?!0:!1}},rect:{func:function(){return[[Vg.Rect.data.T.x,Vg.Rect.data.T.y],Kj,Kj]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vg.Rect.data.rotation}},visible:{func:function(){return Vg.Rect.data.B?!0:!1}},rect:{func:function(){return[[Vg.Rect.data.B.x,Vg.Rect.data.B.y],Kj,Kj]}}}]};var Wc=16;q.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:so,borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:so,shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Vg.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Vg.Anchor.data.POS.x,Vg.Anchor.data.POS.y],Wc,Wc]}}}]},Vg.TipShiftX=12,Vg.TipShiftY=12;var Yr=[8,28];Vg.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Vg.TipHelper.data.helperPos.x,Vg.TipHelper.data.helperPos.y,Yr[0]*Vg.TipHelper.data.size,Yr[1]]}},background:{func:function(){return Jp.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Vg.TipHelper.data.text}},rect:{func:function(){return[Vg.TipHelper.data.helperPos.x,Vg.TipHelper.data.helperPos.y,Yr[0]*Vg.TipHelper.data.size,Yr[1]]}},color:{func:function(){return Jp.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var pf=7;Vg.ShapePoint={comps:[{type:"circle",rect:{func:function(){var t=Vg.ShapePoint.data.point;return[t,pf,pf]}},background:{func:function(){var c=Vg.ShapePoint.data.isEnd;return c?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:so}]},Vg.ShapeBgCurve={comps:[{type:"shape",points:{func:function(){return Vg.ShapeBgCurve.data.P}},segments:{func:function(){return Vg.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:so}]};var js=8;Vg.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var i=Vg.ShapeHighlighPoint.data;return[[i.x,i.y],js,js]}},background:{func:function(){return Jp.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var gn=10;Vg.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var K=Vg.ShapeHighlighRealPoint.data;return[[K.x,K.y],gn,gn]}},background:"#ffffff",borderWidth:2,borderColor:so}]};var Ob=8;Vg.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var E=Vg.ShapeHighlighCtrlPoint.data,s=E.x,f=E.y,L=Ob/2;return[s-L,f-L,s-L,f+L,s+L,f+L,s+L,f-L]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Jp.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return Jp.getStyle("shapeCtrlPointBorderColor")||so}}}]};var Ee=3;Vg.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Vg.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Ee,borderColor:{func:function(){return Jp.getStyle("curveHighlightColor")}}}]},Vg.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Vg.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Vg.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Vg.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Vg.MoveLineGuide.data.center?Di:Uf}}}]};var Ai=5;Vg.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var E=Vg.MoveLineGuideDistanceH.data,P=E.x0,o=E.y0;return[P,o-Ai,P,o+Ai]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Uf},{type:"shape",points:{func:function(){var k=Vg.MoveLineGuideDistanceH.data,$=k.x1,c=k.y1;return[$,c-Ai,$,c+Ai]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Uf},{type:"text",text:{func:function(){return Math.round(Vg.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var a=Vg.MoveLineGuideDistanceH.data;return[[(a.x0+a.x1)/2,a.y0-10],20,20]}},color:Uf,font:"12px Arial",align:"center"}]},Vg.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var B=Vg.MoveLineGuideDistanceV.data,r=B.x0,V=B.y0;return[r-Ai,V,r+Ai,V]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Uf},{type:"shape",points:{func:function(){var V=Vg.MoveLineGuideDistanceV.data,R=V.x1,z=V.y1;return[R-Ai,z,R+Ai,z]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Uf},{type:"text",text:{func:function(){return Math.round(Vg.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var L=Vg.MoveLineGuideDistanceV.data;return[[L.x0-10,(L.y0+L.y1)/2],20,20]}},color:Uf,font:"12px Arial",align:"center"}]},q.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Vg.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var E=Vg.EdgeElevationGuide.data,x=E.x,h=E.y,M=Jp.getStyle("curveElevationIntersectSize"),d=Jp.getStyle("curveElevationGuideShift");return x+=d[0],h+=d[1],[x-M,h-M,2*M,2*M]}}}]},q.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),q.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Vg.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Vg.ConnectGuide.data.rotation}},rect:{func:function(){var A=Vg.ConnectGuide.data.connect;A.x,A.y;var X=Jp.getStyle("connectGuideIntersectSize");return[[A.x,A.y],2*X,2*X]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var P=Vg.ConnectGuide.data.cursorPos||Vg.ConnectGuide.data.connect,S=Jp.getStyle("connectGuideIntersectSize");return[[P.x,P.y],2*S-2,2*S-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var q=Vg.ConnectGuide.data.connect,i=Vg.ConnectGuide.data.cursorPos||q;return[q.x,q.y,q.x+.5*(i.x-q.x),q.y,i.x+.5*(q.x-i.x),i.y,i.x,i.y]}}}]},q.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),q.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Vg.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var S=Vg.ConnectGuideGarbage.data.hover;return S?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var N=Vg.ConnectGuideGarbage.data,Z=Jp.getStyle("connectGuideGarbageIntersectsize");return N.hover&&(Z+=5),[[N.x,N.y],2*Z,2*Z]}}}]};var th=6;Vg.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Vg.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var r=Vg.ShapeActivingCtrl.data;return[r.point.x,r.point.y,r.c1.x,r.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:so},{type:"shape",visible:{func:function(){return Vg.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var j=Vg.ShapeActivingCtrl.data;return[j.point.x,j.point.y,j.c2.x,j.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:so},{type:"shape",visible:{func:function(){return Vg.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var $=Vg.ShapeActivingCtrl.data.c1,o=$.x,C=$.y,z=th/2;return"c1"===Vg.ShapeActivingCtrl.data.hl&&(z+=.5),[o-z,C-z,o-z,C+z,o+z,C+z,o+z,C-z]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Jp.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Vg.ShapeActivingCtrl.data.hl?Jp.getStyle("shapeCtrlPointHighlightBorder")||so:Jp.getStyle("shapeCtrlPointBorderColor")||so}}},{type:"shape",visible:{func:function(){return Vg.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var B=Vg.ShapeActivingCtrl.data.c2,M=B.x,U=B.y,Z=th/2;return"c2"===Vg.ShapeActivingCtrl.data.hl&&(Z+=.5),[M-Z,U-Z,M-Z,U+Z,M+Z,U+Z,M+Z,U-Z]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Jp.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Vg.ShapeActivingCtrl.data.hl?Jp.getStyle("shapeCtrlPointHighlightBorder")||so:Jp.getStyle("shapeCtrlPointBorderColor")||so}}}]},Vg.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:so,rect:{func:function(){return[[Vg.RoundPoint.data.x,Vg.RoundPoint.data.y],Kj,Kj]}}}]},eq.Icons.DrawIcon=function(Z,n,e,g){e.width=e.height=Jo,e.data=g,Jp=Z,q.Default.drawImage(n,e,0,0,Jo,Jo)},eq.Icons.MapPoints=function(H,l){for(var E=0,I=H.length;I>E;E++)H[E]/=l},eq.roundTo=function(s,I,x){var P=Math.abs(s%I);return x>P||x>I-P?I*Math.round(s/I):s},eq.toFixed=function(l){return Math.round(100*l)/100},eq.getDataMatrix=function(x){if(x instanceof q.Shape){var Q=new q.Math.Matrix2d,W=x.getPosition();return Q.translate(-W.x,-W.y).scale(x.getScale().x,x.getScale().y).rotate(x.getRotation()).translate(W.x,W.y),Q}return x.getMatrix?x.getMatrix():new q.Math.Matrix2d};var lb=eq.Math.Curve=function(){this._curves=[]};lb.prototype={},lb.prototype.constructor=lb,lb.prototype.createFromHtShape=function(W,w,F){w instanceof q.List&&(w=w.toArray());var _,I,l,z,X,C,E,e=this,T=null,p=null,a=0,t=eq.Math.Vector2,H=eq.Math.CubicBezier,J=function(d){return new t(W[d],W[d+1],F?F[d/2]:j)};for(I=0,l=w.length;l>I;I++){switch(z=w[I],X=null,z){case 1:p=J(a),T=p,a+=2;break;case 2:_=J(a),a+=2,X=new H(p,p.clone(),_.clone(),_),p=_;break;case 3:C=J(a),_=J(a+2),a+=4,X=new H(p,C.clone().sub(p).multiplyScalar(2/3).add(p),C.clone().sub(_).multiplyScalar(2/3).add(_),_),p=_;break;case 4:C=J(a),E=J(a+2),_=J(a+4),a+=6,X=new H(p,C,E,_),p=_;break;case 5:if(!T)break;X=new H(p,p.clone(),T.clone(),T),p=null,T=null}X&&(X._index=e._curves.length,e._curves.push(X))}},lb.prototype.checkPoint=function(r,c){var o,Y,C,D,M,O=this,u=O._curves;for(o=0,Y=u.length;Y>o;o++)if(D=u[o],M=D.intersectRect(r,c,c),M.length)return C=0,M.forEach(function(u){C+=u.t}),C/=M.length,r=D.getPointAt(C),r.t=C,{bezier:D,intersection:r}},lb.prototype.insertKnot=function(x,V){var O=x.insertKnot(V),n=this,B=n._curves;B.splice(x._index,1,O[0],O[1])},lb.prototype._isCloseEnough=function(S,Q){return Math.abs(S.x-Q.x)<1e-6&&Math.abs(S.y-Q.y)<1e-6},lb.prototype._isSamePoint=function(c,m){return c===m},lb.prototype.moveRealPoint=function(n,P){var V=this,Q=V._curves,w=P.clone().sub(n);Q.forEach(function(a){var p=a._p1;a._p2,a._p3;var I=a._p4;V._isSamePoint(p,n)&&(a._p2.add(w),a._p1=P),V._isSamePoint(I,n)&&(a._p3.add(w),a._p4=P)})},lb.prototype.moveCtrlDueToRealPointMovement=function(t,u){var n=this,W=n._curves,B=function(Z){Z.add(u),Z.e&&u.e&&(Z.e+=u.e)};W.forEach(function(z){var J=z._p1;z._p2,z._p3;var v=z._p4;n._isSamePoint(J,t)&&B(z._p2),n._isSamePoint(v,t)&&B(z._p3)})},lb.prototype.moveCtrlPoint=function(V,g,w){var o=V[w];if(o){o.e!==j&&(g.e=o.e);var E=this,P=E._curves;g.clone().sub(o),P.forEach(function(G){var j;"c2"===w?j="_p2":"c1"===w&&(j="_p3"),E._isSamePoint(G[j],o)&&(G[j]=g)}),V[w]=g}},lb.prototype.deleteRealPoint=function(P,h){var k,L,E,l,Z,A,$,O=this,M=O._curves,g={},V=[],D=eq.Math.CubicBezier;for(L=0,E=M.length;E>L;L++)k=M[L],l=k._p1,Z=k._p2,A=k._p3,$=k._p4,(g[L]||!O._isSamePoint(l,P))&&(O._isSamePoint($,P)?E>L+1&&O._isSamePoint(M[L+1]._p1,P)&&(h||V.push(new D(l,Z,M[L+1]._p3,M[L+1]._p4))):V.push(k));O._curves=V},lb.prototype.findPairs=function(X,o){var a,W,C,J,s,h,p,x,f=this,E=f._curves,n={},B=[];for(W=0,C=E.length;C>W;W++)a=E[W],J=a._p1,s=a._p2,h=a._p3,p=a._p4,!n[W]&&f._isSamePoint(J,X)&&(o?B.push({point:J,r2:p}):B.push({point:J,c2:s})),f._isSamePoint(p,X)&&(x=o?{point:p,r1:J}:{point:p,c1:h},C>W+1&&f._isSamePoint(E[W+1]._p1,X)&&(o?x.r2=E[W+1]._p4:x.c2=E[W+1]._p2,n[W+1]=!0),B.push(x));return B},lb.prototype.toHtShape=function(){var S=this,k=S._curves,e=[],G=[],P={x:1/0,y:1/0};return k.forEach(function(E){var U=E._p1,V=E._p2,g=E._p3,l=E._p4;return S._isCloseEnough(U,P)||(e.push(1),G.push(U.clone())),P=l,S._isCloseEnough(U,V)&&S._isCloseEnough(g,l)?(e.push(2),G.push(l.clone()),void 0):(e.push(4),G.push(V.clone(),g.clone(),l.clone()),void 0)}),{segments:e,points:G}};var gl=eq.Math.CubicBezier=function(V,C,W,e){var s=this;s._id=eq.Math.CubicBezier._globalId++,s._p1=V,s._p2=C,s._p3=W,s._p4=e};gl._globalId=1,gl.prototype={},gl.prototype.constructor=gl,gl.prototype.toString=function(){return this._id},gl.prototype.intersectRect=function(k,l,C){var $=l/2,j=C/2,U=k.x,S=k.y,Y=eq.Math.Vector2,F=new Y(-$+U,-j+S),c=new Y($+U,j+S),q=new Y(c.x,F.y),G=new Y(F.x,c.y),B=this,O=B.intersectLine(F,q),I=B.intersectLine(q,c),u=B.intersectLine(c,G),y=B.intersectLine(G,F),W=O.concat(I).concat(u).concat(y);return W},gl.prototype.intersectLine=function(D,p){var X,n,J,l,S,L,h,M,i,x,k,m,r,a=this,d=D.clone().min(p),G=D.clone().max(p);l=a._p1,S=a._p2,L=a._p3,h=a._p4,X=l.clone().multiplyScalar(-1),n=S.clone().multiplyScalar(3),J=L.clone().multiplyScalar(-3),k=X.add(n).add(J).add(h),X=l.clone().multiplyScalar(3),n=S.clone().multiplyScalar(-6),J=L.clone().multiplyScalar(3),x=X.add(n).add(J),X=l.clone().multiplyScalar(-3),n=S.clone().multiplyScalar(3),i=X.add(n),M=l.clone(),r=new eq.Math.Vector2(D.y-p.y,p.x-D.x),m=D.x*p.y-p.x*D.y;for(var $=a.getRoots(r.dot(k),r.dot(x),r.dot(i),r.dot(M)+m),N=new Array,f=0,b=$.length;b>f;f++){var E=$[f];if(!(0>E||E>1)){var B=l.clone().lerp(S,E),I=S.clone().lerp(L,E),y=L.clone().lerp(h,E),w=B.lerp(I,E),q=I.lerp(y,E),j=w.lerp(q,E);j.t=E,D.x==p.x?d.y<=j.y&&j.y<=G.y&&N.push(j):D.y==p.y?d.x<=j.x&&j.x<=G.x&&N.push(j):j.x>=d.x&&j.y>=d.y&&j.x<=G.x&&j.y<=G.y&&N.push(j)}}return N},gl.prototype.solveTForPoint=function(S){var Y,D,l,y,H=this;Y=H._p1.x-S.x,D=H._p2.x-S.x,l=H._p3.x-S.x,y=H._p4.x-S.x;for(var v=H.getRoots(y-3*l+3*D-Y,3*l-6*D+3*Y,3*D-3*Y,Y),U=j,I=1/0,J=0,X=v.length;X>J;J++){var m=v[J];if(!(0>m||m>1)){var d=H._p1.clone().lerp(H._p2,m),R=H._p2.clone().lerp(H._p3,m),x=H._p3.clone().lerp(H._p4,m),b=d.lerp(R,m),f=R.lerp(x,m),t=b.lerp(f,m);t.t=m;var O=Math.abs(t.y-S.y);I>O&&(I=O,U=t)}}return U},gl.prototype.getPointAt=function(B){var K=this,L=K._p1,P=K._p2,Y=K._p3,r=K._p4,v=L.clone().lerp(P,B),X=P.clone().lerp(Y,B),D=Y.clone().lerp(r,B),A=v.lerp(X,B),U=X.lerp(D,B);return A.lerp(U,B)},gl.prototype.getRoots=function(V,E,R,F){var m,e,C,T,j,X=new Array;if(Math.abs(V)<1e-6){var m=E,e=R/m,C=F/m,T=e*e-4*C;if(T>0){var j=Math.sqrt(T);X.push(.5*(-e+j)),X.push(.5*(-e-j))}else 0==T&&X.push(.5*-e)}E/=V,R/=V,F/=V,m=(3*R-E*E)/3,e=(2*E*E*E-9*R*E+27*F)/27;var O=E/3,c=e*e/4+m*m*m/27,Q=e/2;if(Math.abs(c)<=1e-6&&(c=0),c>0){var n,Z,j=Math.sqrt(c);n=-Q+j,Z=n>=0?Math.pow(n,1/3):-Math.pow(-n,1/3),n=-Q-j,n>=0?Z+=Math.pow(n,1/3):Z-=Math.pow(-n,1/3),X.push(Z-O)}else if(0>c){var h=Math.sqrt(-m/3),y=Math.atan2(Math.sqrt(-c),-Q)/3,W=Math.cos(y),U=Math.sin(y),o=Math.sqrt(3);X.push(2*h*W-O),X.push(-h*(W+o*U)-O),X.push(-h*(W-o*U)-O)}else{var n;n=Q>=0?-Math.pow(Q,1/3):Math.pow(-Q,1/3),X.push(2*n-O),X.push(-n-O)}return X},gl.prototype._70I=function(){var g=this;return g._p1.distanceToSquared(g._p2)<1e-10&&g._p3.distanceToSquared(g._p4)<1e-10},gl.prototype.insertKnot=function(x){var V=this,L=V._p1,P=V._p2,h=V._p3,S=V._p4,Z=L.clone().lerp(P,x),C=P.clone().lerp(h,x),G=h.clone().lerp(S,x),Y=Z.clone().lerp(C,x),D=C.clone().lerp(G,x),m=Y.clone().lerp(D,x);return V._70I()?(L.clone().lerp(S,x),[new eq.Math.CubicBezier(L,L.clone(),m.clone(),m),new eq.Math.CubicBezier(m,m.clone(),S.clone(),S)]):[new eq.Math.CubicBezier(L,Z,Y,m),new eq.Math.CubicBezier(m,D,G,S)]};var Zg=q.Default.getInternal().ui().EdgeUI,hk={_47O:function(D){var X=this,$=hk.getBackups()._47O;eq.inEdit(X.gv)||$.call(X,D)}};eq.Inject.registAsModule(hk,Zg);var $b=q.Default.getInternal().ui().NodeUI,Qb={_47O:function(j){var B=this,v=Qb.getBackups()._47O;eq.inEdit(B.gv)||v.call(B,j)},getSelectWidth:function(){var X=this,c=X.gv,H=X._data;if(c.isEditable(H)&&eq.inEdit(c))return 0;var B=Qb.getBackup("getSelectWidth");return B.call(X)}};eq.Inject.registAsModule(Qb,$b);var Ln=q.graph.GraphView,Jk={_editPointSize:function(){var L=q.Default.isTouchable,E=eq.getStyle("pointSize");return E[L?0:1]}(),isPointEditable:function(E){var s=this;if(eq.inEdit(s))return s._pointEditableFunc?s._pointEditableFunc(E):!0;var W=Jk.getBackup("isPointEditable");W.call(s,E)},isEditable:function(Z){var G,f=this,s=Jk.getBackup("isEditable");if(G=Z instanceof eq.Group?!0:s.call(f,Z),!eq.inEdit(f))return G;if(!(Z instanceof q.Edge))return G;if(!Z.s("2d.editable"))return!1;var d=f.getEditableFunc();return d?d(Z):!0},_42:function(W,I){var w=this,Y=Jk.getBackups()._42;if(Y.call(w,W,I),eq.inEdit(w)){var J=w.getEditInteractor();J.drawImpl()}}};eq.Inject.registAsModule(Jk,Ln);var xf=q.Default.getInternal().ui().ShapeUI,To={_47O:function(J){var w=this,L=To.getBackups()._47O;eq.inEdit(w.gv)||L.call(w,J)}};eq.Inject.registAsModule(To,xf);var Vd=q.graph.DefaultInteractor,Sb={handle_mousewheel:function(x){var P=this,A=Sb.getBackup("handle_mousewheel");eq.inEdit(P.gv)||A.call(P,x)}};eq.Inject.registAsModule(Sb,Vd);var rd=q.graph.MoveInteractor,Rf={_calcShift:function(j,L){var J=this,n=Rf.getBackup("_calcShift"),d=J.gv;if(!eq.inEdit(d))return n.call(J,j,L);var u=d.getEditInteractor(),T=u.getSubModule("Move").calcShift(j,L,J);return T||n.call(J,j,L)},clear:function(o){var e=this,c=Rf.getBackup("clear");c.call(e,o);var Z=e.gv;if(eq.inEdit(Z)){var T=Z.getEditInteractor();T.getSubModule("Move").clear(o)}}};eq.Inject.registAsModule(Rf,rd);var lo=eq.Rect=function(T){this.catalog="Rect",this._interactor=T};lo.prototype={},lo.prototype.constructor=lo,lo.prototype.gatherInfo=function(H,I){var k=this;if(1===I.length){var Q=I[0];return Q instanceof q.Shape&&Q._70I()?k.gatherLine(H,Q):xm(Q,H)?!1:k.gatherSingleTarget(H,Q)}return I.length>1?k.gatherMultiTargets(H,I):!1},lo.prototype.gatherSingleTarget=function(S,K){if(K.getCorners){var M,f=this,r=f.info;f.target=K,M=f.screenInfo={};var E=K.getCorners();r.LT=new eq.Math.Vector2(E[0]),r.LB=new eq.Math.Vector2(E[1]),r.RB=new eq.Math.Vector2(E[2]),r.RT=new eq.Math.Vector2(E[3]),r.T=r.LT.clone().add(r.RT).divideScalar(2),r.B=r.LB.clone().add(r.RB).divideScalar(2),r.L=r.LT.clone().add(r.LB).divideScalar(2),r.R=r.RT.clone().add(r.RB).divideScalar(2);for(var P in r)M[P]=eq.toScreenPosition(S,r[P]);var Q=f._interactor,x=Q.getStyle("checkSize"),m=function(J,j,m){var r=j.clone().sub(J).setLength(-x),U=m.clone().sub(J).setLength(-x),p=r.add(U).add(J);return p};return M.rotLT=m(M.LT,M.RT,M.LB),M.rotLB=m(M.LB,M.LT,M.RB),M.rotRB=m(M.RB,M.LB,M.RT),M.rotRT=m(M.RT,M.LT,M.RB),M.rotT=M.rotLT.clone().add(M.rotRT).divideScalar(2),M.rotB=M.rotLB.clone().add(M.rotRB).divideScalar(2),M.rotL=M.rotLT.clone().add(M.rotLB).divideScalar(2),M.rotR=M.rotRT.clone().add(M.rotRB).divideScalar(2),M.rotation=K.getRotation(),f.gatherConnectInfo(),!0}},lo.prototype.gatherConnectInfo=function(){var l=this,Q=l.target,k=l._interactor,$=l.screenInfo,f=k.gv;if(f.isConnectActionVisible(Q)&&k.getStyle("connectGuideVisible")){var o;Q.s&&(o=Q.s("connectGuideShift")),o||(o=k.getStyle("connectGuideShift"));var P=Q.getAnchor(),K=Q.getSize(),w=Q.toGlobal({x:K.width*(o[0]-P.x),y:K.height*(o[1]-P.y)});w=eq.toScreenPosition(f,w),$.P1?w.add($.P2.clone().sub($.P1).setLength(o[2])):(w.add($.RT.clone().sub($.LT).setLength(o[2])),w.add($.LB.clone().sub($.LT).setLength(o[3]))),$.connect=w}},lo.prototype.gatherMultiTargets=function(q,Y){var Z=eq.Group.findOrCreateGroup(Y);if(!Z)return!1;var e=this;return e.editing&&"rotate"!==e.editing.mode||Z.calcInfo(),e.gatherSingleTarget(q,Z)},lo.prototype.gatherLine=function(X,h){this.target=h;var f=this.screenInfo={},w=h.getPoints(),W=eq.getDataMatrix(h);return f.P1=eq.toScreenPosition(X,W.apply(w.get(0))),f.P2=eq.toScreenPosition(X,W.apply(w.get(1))),this.gatherConnectInfo(),!0},lo.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],lo.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],lo.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],lo.prototype.check=function(P,f,D){if(q.Default.isLeftButton(f)){var z=this;if(z.editing=null,z.tipInfo=null,z.screenInfo){var M=z.target,S=P.isEditable(M),Q=z.screenInfo;if(S&&Q.connect){var U=z._checkConnect(D);if(U)return U}if(Q.P1)return z._checkLine(D);var e,t,a,J=null,c=z._interactor,i=c.getStyle("checkSize");if(S&&P.isRectEditable(M))for(t=0;t<eq.Rect.ResizeKeys.length;t++)if(a=eq.Rect.ResizeKeys[t],eq.checkHit(D,Q[a],i)){J=a,e="resize";break}if(!J&&S&&P.isRotationEditable(M)&&!c.getStyle("rotateAsClock")){var V=c.getStyle("rotateCheckSize");for(t=0;t<eq.Rect.RotateKeys.length;t++)if(a=eq.Rect.RotateKeys[t],eq.checkHit(D,Q[a],V)){J=a,e="rotate";break}}if(!J)return c.setCursor("default"),void 0;if("rotate"===e){var j,N=P.lp(f);if(M instanceof eq.Group){var C=c.getStyle("groupRotateModeKey");"string"==typeof C&&(C=[C]);for(var w=!1,Z=0,x=C.length;x>Z;Z++)if(f[C[Z]]){w=!0;break}var u=c.getStyle("groupRotateModeDefault");j=w?"batch"===u?"block":"batch":u}var O="batch"===j?M.getAnchor2():M.getPosition(),s=Math.atan2(N.y-O.y,N.x-O.x);c._setRotateCursor(s),z.editing={mode:e,key:J,pos:O,flipY:M.getScale().y<0,rotation:M.getRotation(),hitRot:s},j&&(z.editing.groupRotateMode=j)}else{var o=eq.Rect.ResizeKeys.indexOf(J),K=eq.Rect.ResizeDirection[o],Y=Math.cos(M.getRotation()),W=Math.sin(M.getRotation()),d=K.x*Math.sign(M.getScale().x),A=K.y*Math.sign(M.getScale().y),h=Math.atan2(-W*d-Y*A,Y*d-W*A),H=(Math.round(h/(Math.PI/4))+8)%8,R=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][H];this._interactor.setCursor(R);var _=M.getWidth(),r=M.getHeight(),I=M.getAnchor();z.editing={mode:e,key:J,rect:{x:-_*I.x,y:-r*I.y,width:_,height:r},anchor:I,matrix:M.getMatrix()}}return J}}},lo.prototype._checkLine=function(f){var j=this;j.screenInfo;var n,b=j._interactor.getStyle("checkSize");if(eq.checkHit(f,j.screenInfo.P1,b))n="P1";else{if(!eq.checkHit(f,j.screenInfo.P2,b))return this._interactor.setCursor("default"),void 0;n="P2"}return j.editing={mode:"line",key:n},n},lo.prototype._checkConnect=function(Q){var P=this,T=P.screenInfo,K=P._interactor,e=K.getStyle("connectGuideIntersectSize"),R=T.connect,p=Q.x,Y=R.x;if(Y>p&&e>Y-p&&Math.abs(R.y-Q.y)<e||p>=Y&&eq.checkHit(Q,R,e)){var k="connect",M=d.getConnectAction(K.gv);if(P.editing={mode:k},M&&M.delete)if(P.target instanceof eq.Group){var q=!0;K.gv.sm().getSelection().each(function(y){M.delete.visible.call(null,K.gv,y)||(q=!1)}),P.editing.hasDeleteAction=q}else M.delete.visible.call(null,K.gv,P.target)&&(P.editing.hasDeleteAction=!0);return K.setCursor("default"),k}},lo.prototype._fireEditEvent=function(k,f){var u=this._interactor,m=this.editing;if(m){var z=m.mode;z="rotate"===z?"Rotation":"connect"===z?"Connection":z[0].toUpperCase()+z.slice(1),u.fi({kind:k+"Edit"+z,event:f})}},lo.prototype.startEdit=function(C,z){C.startDragging(z);var K=this;K._interactor.fi({kind:"prepareEdit",event:z});var b=K.editing,A=K.target;if(b){if(K._fireEditEvent("begin",z),"rotate"===b.mode)return b.groupRotateMode&&A.beginRotate(b),void 0;if("connect"!==b.mode)("line"===b.mode||A&&0===A.getRotation())&&(K._inSmartGuide=!0,K._interactor.rectGuide.gatherRects());else if(b.hasDeleteAction){var Y=C.gv,W=K._interactor.getStyle("connectGuideGarbageShift");b.garbageInfo={x:Y.getWidth()*W[0]+W[2],y:Y.getHeight()*W[1]+W[3],size:K._interactor.getStyle("connectGuideGarbageIntersectsize")},C._42()}}},lo.prototype._46O=function(x){var A,m,t=this,M=t.editing,P=t.target;if(M){if("connect"===M.mode&&!M.canceled&&!M.deleted)try{M.garbageInfo&&M.garbageInfo.hover?d.doDeleteConnectionAction(t._interactor.gv,P):d.doConnectAction(t._interactor.gv,P,M.target)}catch(g){console.error(g)}m=M.freezeFlag,A=t.editing.groupRotateMode,t._fireEditEvent("end",x),t.editing=null}t.tipInfo=null,t._inSmartGuide&&(t._interactor.rectGuide.clear(),t._inSmartGuide=!1),A&&P&&P.endRotate(),P instanceof q.Block&&(m===j?delete P._freezeSyncFromChildren:P._freezeSyncFromChildren=m,P.updateFromChildren())},lo.prototype.handleNormalStateDelete=function(){var n=this,o=n.editing;if(o&&"connect"===o.mode&&!o.canceled&&!o.deleted){if(o.garbageInfo){try{d.doDeleteConnectionAction(n._interactor.gv,n.target)}catch(R){console.error(R)}o.garbageInfo=null}return o.cursorPos=null,o.targetCorners=null,o.deleted=!0,n._interactor._42(),!0}},lo.prototype.handleNormalStateKeyDown=function(_){var t=this,w=t.editing;return!w||"connect"!==w.mode||w.canceled||w.deleted?void 0:q.Default.isEsc(_)?(w.cursorPos=null,w.targetCorners=null,w.canceled=!0,t._interactor._42(),!0):void 0},lo.prototype.handleEdit=function(U,o){var b=this,d=b.editing;if(d){var H,E,s,I,u,n=b.target,p=d.key,j=d.mode,F=U.lp(o),J=b._interactor;if("connect"===j){if(d.canceled)return;if(d.deleted)return;d.cursorPos=J._getLogicalPoint(o);var K=d.garbageInfo;return K&&eq.checkHit(d.cursorPos,K,K.size)?(K.hover=!0,d.target=null,d.targetCorners=null):(K&&(K.hover=!1),d.target=U.getDataAt(F,function(v){return U.isSelectable(v)?ei(v)?!0:!1:!1})||null,d.targetCorners=eq.getTargetCornersOnScreen(U,d.target)),J._42(),void 0}if("rotate"===j){var Z,L,M=d.pos,x=Math.atan2(F.y-M.y,F.x-M.x);if(d.groupRotateMode?L=x-d.hitRot:(Z=x-d.hitRot,L=d.rotation+Z),L%=2*Math.PI,0>L&&(L+=2*Math.PI),!q.Default.isCtrlDown(o)){var c,C;_h(o)?(c=J.getStyle("shiftRotateRound"),C=c/2):(c=J.getStyle("rotateRound"),C=J.getStyle("rotateSensitivity")),L=eq.roundTo(L,c,C)}d.groupRotateMode?(Z=L-(d.lastRotation||0),0!==Z&&(n.addRotation(Z,d.groupRotateMode),d.lastRotation=L)):n.setRotation(L),J._setRotateCursor(x),L>Math.PI&&(L-=2*Math.PI);var B=180*(L/Math.PI);B=B.toFixed(2),H=""+B+"°"}else if("resize"===j){var G=d.rect;s=G.x,I=G.y;var V,h=G.width,z=G.height,A=d.anchor,W=d.matrix,i=n.s&&n.s("keepAspectRatio")||J.getStyle("keepAspectRatio");_h(o)&&(i=!i);var m=b._unionPointMode1,Y=b._unionPointMode2;if(b._inSmartGuide&&!q.Default.isCtrlDown(o)&&!i){var $;"L"===p||"R"===p?$="x":("T"===p||"B"===p)&&($="y"),b._adsorbedToClosest(F,$),u=!0}V=W.tfi(F);var y;"LT"===p?(G=m(V,{x:s+h,y:I+z},h,z,i),y=9):"T"===p?(G=Y({x:s,y:V.y},{x:s+h,y:I+z},h,z,i,"v"),y=1):"RT"===p?(G=m(V,{x:s,y:I+z},h,z,i),y=33):"L"===p?(G=Y({x:V.x,y:I},{x:s+h,y:I+z},h,z,i,"h"),y=8):"R"===p?(G=Y({x:s,y:I},{x:V.x,y:I+z},h,z,i,"h"),y=32):"LB"===p?(G=m(V,{x:s+h,y:I},h,z,i),y=12):"B"===p?(G=Y({x:s,y:I},{x:s+h,y:V.y},h,z,i,"v"),y=4):"RB"===p&&(G=m(V,{x:s,y:I},h,z,i),y=36);var f=W.tf(G.x+G.width*A.x,G.y+G.height*A.y);n instanceof q.Block&&(d.hasOwnProperty("freezeFlag")||(d.freezeFlag=n._freezeSyncFromChildren,n._freezeSyncFromChildren=!0)),n.setPosition(f),n.setSize(G.width,G.height),u&&(E=n.getRect(),J.rectGuide.gatherLines({node:n,x:E.x,y:E.y,w:E.width,h:E.height},$,y)),H=""+Math.round(G.width)+" * "+Math.round(G.height)}else if("line"===j){if(_h(o)){var l=n.getPoints(),N="P1"===p?l.get(1):l.get(0),e={x:F.x-N.x,y:F.y-N.y},t=J.getStyle("shiftLineRotateRound"),v=b._shiftDirList;if(!v||b._shiftRotateRound!==t){b._shiftRotateRound=t,b._shiftDirList=v=[];for(var r=0;r<Math.PI;r+=t)v.push({x:w(r),y:D(r)})}for(var k,X=0,Q=0,S=v.length;S>Q;Q++){var T=v[Q],P=T.x*e.x+T.y*e.y;Math.abs(P)>Math.abs(X)&&(X=P,k=T)}F={x:N.x+k.x*X,y:N.y+k.y*X},J.rectGuide.clear()}else b._inSmartGuide&&!q.Default.isCtrlDown(o)&&(b._adsorbedToClosest(F),u=!0);var R=eq.getDataMatrix(n).applyInverse(F);n.setPoint("P1"===p?0:1,R,!0);var g=n.getPoints(),_=g.get(0),a=g.get(1);s=_.x-a.x,I=_.y-a.y,H=" "+Math.round(Math.sqrt(s*s+I*I))+" ",u&&(E=n.getRect(),J.rectGuide.gatherLines({node:n,x:E.x,y:E.y,w:E.width,h:E.height}))
}if(H){var O=q.Default.getLogicalPoint(o,J._canvas);O.x+=eq.Icons.TipShiftX,O.y+=eq.Icons.TipShiftY,b.tipInfo={helperPos:O,text:H,size:H.length}}b._fireEditEvent("between",o)}},lo.prototype._unionPointMode1=function(n,T,h,F,r){if(r&&h&&F){var P=n.x-T.x,j=n.y-T.y;Math.abs(P*F)<Math.abs(j*h)?(j=Math.sign(j)*Math.abs(P*F/h),n.y=T.y+j):(P=Math.sign(P)*Math.abs(j*h/F),n.x=T.x+P)}return q.Default.unionPoint(n,T)},lo.prototype._unionPointMode2=function(P,D,z,J,o,N){var e=q.Default.unionPoint(P,D);if(o&&z&&J){var H;"v"===N?(H=e.x+e.width/2,e.width=z*e.height/J,e.x=H-e.width/2):(H=e.y+e.height/2,e.height=J*e.width/z,e.y=H-e.height/2)}return e},lo.prototype._adsorbedToClosest=function(j,I){var O=this,i=O._interactor,A=i.rectGuide.findClosest(j,I),$=i.gridGuide.findClosest(j,I),H=1/0,D=1/0;A&&(isFinite(A.x)&&(H=A.x),isFinite(A.y)&&(D=A.y)),$&&(isFinite($.x)&&Math.abs($.x)<Math.abs(H)&&(H=$.x),isFinite($.y)&&Math.abs($.y)<Math.abs(D)&&(D=$.y)),isFinite(H)&&(j.x+=H),isFinite(D)&&(j.y+=D)},lo.prototype._42=function(R,A,o){var l=this;l.info={},l.screenInfo=null;var T=l._interactor;if(!T.editDetail&&l.gatherInfo(A,o)){var E=l.editing,z=E?E.groupRotateMode:null,Z=l.screenInfo;"block"!==z&&(Z.P1?eq.Icons.DrawIcon(T,R,eq.Icons.Line,Z):eq.Icons.DrawIcon(T,R,eq.Icons.Rect,Z),Z.connect&&(eq.Icons.DrawIcon(T,R,eq.Icons.ConnectGuide,{rotation:Z.rotation,connect:Z.connect,cursorPos:E?E.cursorPos:null}),E&&(E.targetCorners&&eq.Icons.DrawIcon(T,R,eq.Icons.NodeHoverGuide,E.targetCorners),E.garbageInfo&&eq.Icons.DrawIcon(T,R,eq.Icons.ConnectGuideGarbage,E.garbageInfo))),l.tipInfo&&eq.Icons.DrawIcon(T,R,eq.Icons.TipHelper,l.tipInfo)),l.target instanceof eq.Group&&l.target._42(T,R,A)}};var ij=eq.Anchor=function(V){this.catalog="Anchor",this._interactor=V};ij.prototype={},ij.prototype.constructor=ij,ij.prototype.gatherInfo=function(U,a){var d=this;if(1===a.length){var i=a[0];if(!i.getAnchor)return;if(i instanceof q.Shape&&i._70I())return;if(xm(i,U))return;return d.gatherSingleTarget(U,a[0])}return a.length>1?d.gatherMultiTargets(U,a):!1},ij.prototype.gatherSingleTarget=function(X,t){var F=this;return F.info.POS=t.getPosition(),F.screenInfo.POS=eq.toScreenPosition(X,F.info.POS),F.target=t,!0},ij.prototype.gatherMultiTargets=function(h,N){var Y=this,L=eq.Group.findOrCreateGroup(N);return L?(Y.screenInfo.POS=eq.toScreenPosition(h,L.getAnchor2()),Y.target=L,!0):!1},ij.prototype.isVisible=function(){var b=this,P=b._interactor;if(P.getStyle("anchorVisible")===!1)return!1;var L=b.target;if(L){if(this.editing)return!0;var S=L.getAnchor(),H=P.getStyle("anchorOutsideVisibleThreshold");if(S.x<-H||S.x>1+H||S.y<-H||S.y>1+H)return!0;var o=L.getSize(),i=L.getScale(),T=Math.min(Math.abs(o.width*i.x),Math.abs(o.height*i.y));if(T*P.gv._zoom<P.getStyle("anchorHideThreshold"))return!1}return!0},ij.prototype.check=function(g,L,I){if(q.Default.isLeftButton(L)){var n=this,t=n._interactor;if(n.isVisible()&&t.getStyle("anchorMovable")!==!1){n.editing=null,n.tipInfo=null;var z=n.target;if(z&&g.isAnchorEditable(z)&&g.isEditable(z)){var f;if(n.screenInfo&&(f=n.screenInfo.POS)&&eq.checkHit(I,new eq.Math.Vector2(f),t.getStyle("checkSize"))){if(z instanceof eq.Group)return n.editing={},!0;var Y=z.getWidth(),w=z.getHeight(),_=z.getAnchor();return n.editing={rect:{x:-Y*_.x,y:-w*_.y,width:Y,height:w},anchor:_,matrix:z.getMatrix()},!0}}}}},ij.prototype.startEdit=function(Q,s){Q.startDragging(s),Q.fi({kind:"beginEditAnchor",event:s})},ij.prototype._46O=function(X){var U=this;U.editing&&(U.editing=null,U._interactor.fi({kind:"endEditAnchor",event:X})),U.tipInfo=null},ij.prototype.handleEdit=function(j,t){var Y=this,b=Y.target;if(b){var U=Y.editing;if(U){var $=j.lp(t),r=Y._interactor;if(b instanceof eq.Group)return b.setAnchor2($),r._42(),void 0;var E=U.matrix,I=E.tfi($),f=U.rect,d=(I.x-f.x)/f.width,_=(I.y-f.y)/f.height;if(!q.Default.isCtrlDown(t)){var k=r.getStyle("anchorRound"),v=r.getStyle("anchorSensitivity");d=eq.roundTo(d,k,v),_=eq.roundTo(_,k,v)}b.setAnchor(d,_,!0);var X=q.Default.getLogicalPoint(t,r._canvas);X.x+=eq.Icons.TipShiftX,X.y+=eq.Icons.TipShiftY;var p=""+d.toFixed(2)+", "+_.toFixed(2);Y.tipInfo={helperPos:X,text:p,size:p.length},r.fi({kind:"betweenEditAnchor",event:t})}}},ij.prototype._42=function(f,l,y){var S=this;S.info={},S.screenInfo={};var e=S._interactor;e.editDetail||S.gatherInfo(l,y)&&S.isVisible()&&(eq.Icons.DrawIcon(e,f,eq.Icons.Anchor,S.screenInfo),S.tipInfo&&eq.Icons.DrawIcon(e,f,eq.Icons.TipHelper,S.tipInfo))};var pr=eq.RotateX=function(S){this.catalog="RotateX",this._interactor=S};pr.prototype={},pr.prototype.constructor=pr,pr.prototype.gatherInfo=function(r,w){var t=this;if(1===w.length){var C=w[0];return C instanceof q.Shape&&C._70I()||xm(C,r)?!1:t.gatherSingleTarget(r,C)}return w.length>1?t.gatherMultiTargets(r,w):!1},pr.prototype.gatherSingleTarget=function(){var s=new q.Math.Vector2,W=new q.Math.Vector2,w=new q.Math.Vector2,$=new q.Math.Vector2,V=function(H,U){var S=H.x-U.x,R=H.y-U.y;return S*S+R*R};return function(d,j){if(j.getCorners){var K=this,O=j.getCorners(),R=15,_=j.getPosition();s.copy(O[0]),w.copy(O[1]),$.copy(O[3]),W.copy(s).add($).divideScalar(2).add(s.sub(w).setLength(R/d.getZoom()));var G=Math.max(V(_,O[0]),V(_,O[1]),V(_,O[2]),V(_,O[3]));return K.info.POS=W.clone(),K.screenInfo.POS=eq.toScreenPosition(d,K.info.POS),K.screenInfo.LEN=Math.sqrt(G)*d.getZoom()+R,K.screenInfo.CENTER=eq.toScreenPosition(d,_),K.target=j,!0}}}(),pr.prototype.gatherMultiTargets=function(n,J){var u=this,E=eq.Group.findOrCreateGroup(J);if(!E)return!1;var u=this;return u.gatherSingleTarget(n,E)},pr.prototype.isVisible=function(){var G=this._interactor;if(!G.getStyle("rotateAsClock"))return!1;var P=this.target;if(!P)return!0;var Q=G.gv;return Q.isEditable(P)&&Q.isRotationEditable(P)?!0:!1},pr.prototype.check=function(g,P,Y){var V=this,X=V._checkImpl(g,P,Y);return(X||V._clockPainted)&&V._interactor._42(),X},pr.prototype._checkImpl=function(x,v,U){if(q.Default.isLeftButton(v)){var O=this;O.editing=null,O.tipInfo=null;var z;if(O.screenInfo&&(z=O.screenInfo.POS)&&O.isVisible()){var A=O._interactor;if(eq.checkHit(U,z,A.getStyle("checkSize"))){var n=O.target,J=x.lp(v),t=n.getPosition(),N=Math.atan2(J.y-t.y,J.x-t.x);return A._setRotateCursor(N),O.editing={pos:t,rotation:n.getRotation(),hitRot:N,groupRotateMode:"block",screenInfo:{CENTER:O.screenInfo.CENTER,LEN:O.screenInfo.LEN}},!0}}}},pr.prototype.startEdit=function(I,b){I.startDragging(b),I.fi({kind:"beginEditRotation",event:b}),this.target instanceof eq.Group&&this.target.beginRotate(this.editing)},pr.prototype._46O=function(Y){var A=this;A.editing&&(A.editing=null,A._interactor.fi({kind:"endEditRotation",event:Y})),A.target instanceof eq.Group&&A.target.endRotate(),A.tipInfo=null},pr.prototype.handleEdit=function(E,e){var R=this,c=R.editing;if(c){var n,U,t=R.target,P=E.lp(e),$=R._interactor,g=c.pos,N=Math.atan2(P.y-g.y,P.x-g.x),X=t instanceof eq.Group;if(X?U=N-c.hitRot:(n=N-c.hitRot,U=c.rotation+n),U%=2*Math.PI,0>U&&(U+=2*Math.PI),!q.Default.isCtrlDown(e)){var y,L;_h(e)?(y=$.getStyle("shiftRotateRound"),L=y/2):(y=$.getStyle("rotateRound"),L=$.getStyle("rotateSensitivity")),U=eq.roundTo(U,y,L)}X?(n=U-(c.lastRotation||0),0!==n&&(t.addRotation(n,c.groupRotateMode),c.lastRotation=U)):t.setRotation(U),$._setRotateCursor(N),U>Math.PI&&(U-=2*Math.PI);var w=180*(U/Math.PI),J=""+w.toFixed(2)+"°",Q=q.Default.getLogicalPoint(e,$._canvas);Q.x+=eq.Icons.TipShiftX,Q.y+=eq.Icons.TipShiftY,R.tipInfo={helperPos:Q,text:J,size:J.length},$.fi({kind:"betweenEditRotation",event:e})}},pr.prototype._42=function(T,u,A){var f=this;f._clockPainted=!1,f.info={},f.screenInfo={};var L=f._interactor;L.editDetail||f.gatherInfo(u,A)&&f.isVisible()&&(eq.Icons.DrawIcon(L,T,eq.Icons.RoundPoint,f.screenInfo.POS),f.tipInfo&&eq.Icons.DrawIcon(L,T,eq.Icons.TipHelper,f.tipInfo),f.editing&&f.drawClock(T))},pr.prototype.drawClock=function(O){O.save();var x=this;x._clockPainted=!0;var _=x.editing||{},L=_.screenInfo||x.screenInfo,t=L.LEN,u=t+8,b=t+18;O.save(),O.translate(L.CENTER.x,L.CENTER.y),O.beginPath(),O.strokeStyle="rgb(150, 150, 150)";for(var M,q,Q,Z,r,y=0;360>y;y++)M=y*Math.PI/180,0===y%5&&(q=D(M)*t,Q=w(M)*t,Z=D(M)*u,r=w(M)*u,O.moveTo(q,Q),O.lineTo(Z,r)),0===y%45&&(q=D(M)*t,Q=w(M)*t,Z=D(M)*b,r=w(M)*b,O.moveTo(q,Q),O.lineTo(Z,r));O.stroke(),O.rotate(-s);var I=_.lastRotation||x.target.getRotation();O.beginPath(),O.fillStyle="rgba(255, 0, 0, 0.1)",O.strokeStyle="rgb(157, 157, 157)",O.moveTo(0,0),O.arc(0,0,b,0,I,!1),O.fill(),O.beginPath(),O.moveTo(0+b,0),O.arc(0,0,b,0,I,!1),O.stroke(),O.restore()};var lb=eq.Curve=function(m){this.catalog="Curve",this._interactor=m};lb.prototype={},lb.prototype.constructor=lb,G.defineProperties(lb.prototype,{activing:{get:function(){return this._activing},set:function(H){var B=this;if(H)B._activing=new eq.CurveActiving(this,H);else{var I=B._activing;I&&I.dispose(),B._activing=null}}}}),lb.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},lb.prototype.setUp=function(){var d=this,a=d._interactor;a&&a.gv.mp(d._onGraphviewPropertyChanged,d)},lb.prototype._onGraphviewPropertyChanged=function(s){("zoom"===s.property||"translateX"===s.property||"translateY"===s.property)&&this._handleDataChanged()},lb.prototype.tearDown=function(){var V=this,_=V._interactor;_&&_.gv.ump(V._onGraphviewPropertyChanged,V)},lb.prototype.canEnterEditDetailMode=function(){var n=this,J=n._interactor,R=J._getValidSelection();if(1===R.length){var l=R[0],T=l instanceof q.Edge;if(l instanceof q.Shape||T){if(T){var B=l.s("edge.type");if(B&&"points"!==B)return}var V=J.gv;if(V.isPointEditable(l)&&V.isEditable(l))return n.target=l,!0}}},lb.prototype.preHandleScroll=function(){var p=this.editing;return p&&p.inEdit?!0:void 0},lb.prototype.getCurrentSelectintStatus=function(){var D=this;if(D.activing&&!D.activing.selections){if(D.activing.status!=j)return D.activing.status;var Z=function(H){var j=D.activing.status;D.activing.status=H,D._interactor.fp("shapePointStatus",j,H)},x=eq.Curve.PointType,g=D.activing.point,F=D.activing.pairs;if(!F||1!==F.length)return Z(x.Mirrored);var T=F[0],l=T.c1&&T.c1.isNearEnough(g),W=T.c2&&T.c2.isNearEnough(g);if(!T.c1||!T.c2)return l||W?Z(x.Straight):Z(x.Disconnected);if(l&&W)return Z(x.Straight);if(l||W)return Z(x.Asymmetric);var a=T.c1.clone().sub(g),K=T.c2.clone().sub(g);return Math.abs(a.x*K.y-a.y*K.x)>1e-5||a.x*K.x>0?Z(x.Disconnected):Math.abs(a.length()-K.length())>1e-5?Z(x.Asymmetric):Z(x.Mirrored)}},lb.prototype.handle_keydown=function(E){var H=this;if(H._interactor.editDetail){var I=eq.Curve.PointType;"1"===E.key?H._setCurrentSelectionStatus(I.Straight):"2"===E.key?H._setCurrentSelectionStatus(I.Mirrored):"3"===E.key?H._setCurrentSelectionStatus(I.Disconnected):"4"===E.key&&H._setCurrentSelectionStatus(I.Asymmetric)}},lb.prototype.setCurrentSelectionStatus=function(k){var e=this,n=e._interactor;if(n){var M=n.gv;M.dm().beginTransaction(),this._setCurrentSelectionStatus(k),M.dm().endTransaction()}},lb.prototype._setCurrentSelectionStatus=function(K){var P=this,T=P.activing;if(T){var E=P.getCurrentSelectintStatus();if(null!==E&&E!==K){T.status=K;var Z=P.activing.point,N=P.activing.pairs;if(N&&1===N.length){var j=N[0],H=P.screenInfo.curve,l=eq.Curve.PointType,z=function(){P._writeToHt(),P._interactor.fp("shapePointStatus",E,K)};if(K===l.Straight)return H.moveCtrlPoint(j,Z,"c1"),H.moveCtrlPoint(j,Z,"c2"),z(),void 0;if(E===l.Straight){var h=H.findPairs(Z,!0),r=h[0],W=r.r1||Z,Q=r.r2||Z,w=Q.clone().sub(W).multiplyScalar(.25);return H.moveCtrlPoint(j,Z.clone().sub(w),"c1"),H.moveCtrlPoint(j,Z.clone().add(w),"c2"),z(),void 0}var U=j.c1,n=j.c2;if(U&&n){if(K===l.Mirrored)return H.moveCtrlPoint(j,Z.clone().multiplyScalar(2).sub(n),"c1"),z(),void 0;if(K===l.Asymmetric&&E===l.Disconnected){var q=U.clone().sub(Z).length(),w=Z.clone().sub(n).setLength(q).add(Z);return H.moveCtrlPoint(j,w,"c1"),z(),void 0}}T._firePointChange(),P._interactor.fp("shapePointStatus",E,K)}}}},lb.prototype._handleDataChanged=function(l){var f=this;if(f.screenInfo&&f.target){var U=f._interactor;f.gatherSingleTarget(U.gv,f.target,!0),f.check(U.gv,null,l?U._getLogicalPoint(l):new eq.Math.Vector2(U._lastClientPoint)),U._42()}},lb.prototype.gatherSingleTarget=function(R,z,f){var M,x,E=this;E.screenInfo&&E.screenInfo.curve&&(x=E.screenInfo.curve._curves);var l=E.editing;M=l?E.screenInfo:E.screenInfo={};var h,F,O=z instanceof q.Edge;O?(h=z.s("edge.segments"),F=z.s("edge.points")||new q.List):(h=z._58O,F=z._59O),M.S=h;var w,P=M.P=[],u=eq.getDataMatrix(z);if(z instanceof q.Polyline&&(w=z.getElevation()||0,M.E=[]),F.each(function(X){M.E&&M.E.push(X.e||w),X=u.apply(X);var K=eq.toScreenPosition(R,X);P.push(K.x,K.y)}),O){var g=eq.toScreenPosition(R,z._lastSourcePoint),V=eq.toScreenPosition(R,z._lastTargetPoint);P.splice(0,0,g.x,g.y),P.push(V.x,V.y)}if(!M.S||!M.S.size()){M.S=new q.List,M.S.add(1);for(var o=0;o<P.length/2-1;o++)M.S.add(2)}if((!l||f)&&E.convertToCubicBezier(x),E.activing&&(f||!E.editing||"realPoint"===E.editing.type)){var c=M.curve.findPairs(E.activing.point);E.activing.pairs=c}O&&"points"!==z.s("edge.type")&&E._writeToHt()},lb.prototype._convertToNewPoint=function(h,e,Z){var V,q,O;for(V=0,q=e.length;q>V;V++){if(O=e[V],O._p1.isNearEnough(h))return O._p1;if(O._p4.isNearEnough(h))return O._p4}if(Z)for(V=0,q=Math.min(Z.length,q);q>V;V++){if(O=Z[V],O._p1===h)return e[V]._p1;if(O._p4===h)return e[V]._p4}},lb.prototype.convertToCubicBezier=function(m){var v,O,V=this,N=new eq.Math.Curve,s=V.screenInfo;if(N.createFromHtShape(s.P,s.S,s.E),s.curve=N,V.activing){var M=N._curves;if(v=V.activing.point,O=V._convertToNewPoint(v,M,m),O&&(V.activing.point=O),V.activing.selections){var c=-1,U=V.activing.selections;U.forEach(function(e){c++,O=V._convertToNewPoint(e,M,m),O&&(U[c]=O)})}}},lb.prototype.check=function(p,e,O){if(!e||q.Default.isLeftButton(e)){var t=this;if(t._interactor.setCursor("default"),t.editing=null,t.highlight=null,t.tipInfo=null,t.screenInfo){if(wd())return t._interactor._42(),!0;if(t._checkEditCtrlPoint(O))return t._interactor._42(),!0;if(t._checkEditRealPoint(O))return t._interactor._42(),!0;if(t._checkEditElevation(O))return t._interactor._42(),!0;var N=t.screenInfo.curve,G=N.checkPoint(O,t._interactor.getStyle("curveIntersectSize"));if(G){var g=t.highlight={};g.type="insertKnot",g.bezier=G.bezier,g.point=G.intersection}return t._interactor._42(),!0}}},lb.prototype._checkEditRealPoint=function(g){var h,q,n,l,z,K,J=this,R=J.screenInfo.curve._curves,V=J._interactor.getStyle("curvePointIntersectSize"),T=1/0;for(V*=V,n=0,l=R.length;l>n;n++)h=R[n],z=h._p1,K=g.distanceToSquared(z),T>K&&(T=K,q=z),z=h._p4,K=g.distanceToSquared(z),T>K&&(T=K,q=z);if(T>V)return!1;var w=J.highlight={};return w.type="changeRealPoint",w.point=q,J.editing={type:"realPoint",point:q,shiftGuide:{point:q.clone(),dir:"x",limit:0}},J._interactor.setCursor("crosshair"),!0},lb.prototype._checkEditElevation=function(s){var g=this;if(!g._interactor.getStyle("curveElevationVisible"))return!1;var I=g.activing;if(!I)return!1;var w=I.getCurrentEditingPoint();if(!w)return!1;var T=g._interactor,Z=T.getStyle("curveElevationGuideShift"),n=T.getStyle("curveElevationIntersectSize"),v=s.distanceToSquared({x:w.x+Z[0],y:w.y+Z[1]});if(!(v>n*n)){var l=g.highlight={};l.type="elevation";var M=new eq.Math.Vector2(s.x,s.y,w.e);return g.editing={type:"elevation",startPoint:M},g._interactor.setCursor("crosshair"),!0}},lb.prototype._checkEditCtrlPoint=function(F){var I=this;if(I.activing&&!I.activing.selections){var B=I.getCurrentSelectintStatus();if(B!==eq.Curve.PointType.Straight){var J=I.activing.pairs;if(J){var i=I._interactor.getStyle("curvePointIntersectSize");i*=i;var s,U,V,h,w,_,e,r,z,f=1/0;for(e=0,z=J.length;z>e;e++)for(h=J[e],r=0;2>r;r++)w=0===r?"c1":"c2",h[w]&&(_=F.distanceToSquared(h[w]),f>_&&(f=_,s=h,U=e,V=w));if(f>i)return!1;I.activing.hlpair=s,I.activing.hltype=V;var D=I.highlight={};return D.type="changeCtrlPoint",D.point=s[V],I.editing={type:"ctrlPoint",pair:s,pairId:U,ctrlType:V,direction:s[V].clone().sub(I.activing.point).normalize()},I._interactor.setCursor("crosshair"),!0}}}},lb.prototype.startEdit=function(o,x){o.startDragging(x);var L=this;L.highlight&&"insertKnot"===L.highlight.type&&(L.insertKnot(),L.gatherSingleTarget(L._interactor.gv,L.target),L.activing=null,L._checkEditRealPoint(L._interactor._getLogicalPoint(x)));var B=L._activing;if(B){var W=L.editing?L.editing.type:null;"ctrlPoint"===W?B.editingCtrl={pairId:L.editing.pairId,type:B.hltype}:"realPoint"===W&&(B.editingCtrl=!1)}var K=L.highlight,m=q.Default.isCtrlDown(x);if(!K||wd()){var U=L._interactor.gv;if(!U.setFocus(x)||U._scrolling)return;return U.isPannable()&&Qk(x)&&!m&&(L._pan={tx:U.tx(),ty:U.ty()},o.fi({kind:"beginPan",event:x})),void 0}if("changeRealPoint"===K.type){var g,E=L.activing?L.activing.point:null,y=L.activing?L.activing.selections:null;if(m&&L.activing)E===K.point?(y?(L.activing={point:y[0]},y.length>1&&(y.splice(0,1),L.activing.selections=y)):L.activing=null,L.editing=null):y&&(g=y.indexOf(K.point))>=0?(y.length>1?y.splice(g,1):delete L.activing.selections,L.editing=null):y?(y.push(E),L.activing={point:K.point,selections:y}):L.activing={point:K.point,selections:[E]};else if(y)E===K.point||((g=y.indexOf(K.point))>=0?(y.splice(g,1,E),L.activing={point:K.point,selections:y}):L.activing={point:K.point});else{var N;E===K.point&&(N=L.activing.status),L.activing={point:K.point},N&&(L.activing.status=N)}o.fi({kind:"beginEditPoint",event:x})}},lb.prototype.insertKnot=function(){var Q=this,Z=Q.highlight,W=Q.screenInfo.curve;W.insertKnot(Z.bezier,Z.point.t),Q._writeToHt()},lb.prototype._writeToHt=function(){var T,m,B,G,L=this,Q=L.screenInfo.curve,R=Q.toHtShape(),s=R.points,E=[],A=R.segments,y=L._interactor.gv,V=L.target,g=V instanceof q.Edge,k=eq.getDataMatrix(V).invert();G=V instanceof q.Polyline,G&&(B=V.getElevation());for(var p=0,l=s.length;l>p;p++)T=s[p],m=eq.toWorldPosition(y,T),m=k.apply(m),T.e!=j&&T.e!==B&&(m.e=T.e),E.push(m);if(V._writing=!0,g){V.s("edge.type","points"),V.setStyle("edge.segments",A),V.setStyle("edge.points",E.slice(1,E.length-1)),V.setStyle("edge.source.offset.x",0),V.setStyle("edge.source.offset.y",0),V.setStyle("edge.target.offset.x",0),V.setStyle("edge.target.offset.y",0);var x=L._nextChangeEdgeHost;delete L._nextChangeEdgeHost,x&&("source"===x.type?V.setSource(x.host):V.setTarget(x.host)),L._writeEdgeHostAnchor("source",E[0]),L._writeEdgeHostAnchor("target",E[E.length-1])}else E.length?(V.setSegments(A),V.setPoints(E,!0)):V.removeFromDataModel();delete V._writing},lb.prototype._writeEdgeHostAnchor=function(J,o){var G=this,K=G.target,Y=G._calcHostAnchor(K,J,o);K.s("edge."+J+".anchor.x",Y.x),K.s("edge."+J+".anchor.y",Y.y)},lb.prototype._calcHostAnchor=function(t,g,h,d){d||(d="source"===g?t.getSource():t.getTarget());var e=d.getRotation(),E=d.getAnchor(),P=this._interactor.gv;if(xm(d,P)&&(e=0),e){var I=d.getMatrix(),b=I.tfi(h),F=d.getSize();return{x:b.x/F.width+E.x,y:b.y/F.height+E.y}}var T=Nd(P,d),w={x:(h.x-T.x)/T.width,y:(h.y-T.y)/T.height};return w},lb.prototype._handlePanning=function(C){var H=this,h=H._pan;if(h){h.started=!0;var D=H._interactor,e=D.gv,f=D._lastClientPoint,a=Bm(C);e.setTranslate(h.tx+a.x-f.x,h.ty+a.y-f.y),H.gatherSingleTarget(D.gv,H.target),D._42(),D.fi({kind:"betweenPan",event:C})}},lb.prototype.handleEdit=function(I,W){var Q=this,w=Q.editing;if(Q._pan)return Q._handlePanning(W),void 0;if(w){w.inEdit=!0;var T,m,k,i=Q._interactor._getLogicalPoint(W),O=q.Default.isCtrlDown(W),X=q.Default.isShiftDown(W),E=w.type,J=Q.activing;if(Q._guideInfo=null,"ctrlPoint"===E&&X){var v=Q.editing.direction.clone();T=J.point;var M=v.dot(i.clone().sub(T));i=v.setLength(M).add(T)}else if("ctrlPoint"===E||"realPoint"===E){var v;if("realPoint"===E&&X){var h=Q.editing.shiftGuide;m=h.point;var K=Math.abs(i.x-m.x),Z=Math.abs(i.y-m.y);K>Z&&K>h.limit&&"y"===h.dir&&(h.dir="x"),Z>K&&Z>h.limit&&"x"===h.dir&&(h.dir="y"),v=h.dir,"x"===v?(i.y=m.y,h.limit=Math.max(h.limit,K)):"y"===v&&(i.x=m.x,h.limit=Math.max(h.limit,Z))}var _=Q._isEditEdgeSourceTarget();if(_){var G=Q._editEdgeSourceTarget(_,i,O);G&&(k=G.tipText)}else if(!O){var u=Q._guidingToEdit(i,v),c="realPoint"===E?Q._interactor.gridGuide.findClosest(i,v,!0):null,a=1/0,D=1/0;c&&(c.x&&(a=c.x),c.y&&(D=c.y));var P=!1;u&&(u.xList&&(Math.abs(u.x)<=Math.abs(a)?(P=!0,a=u.x):delete u.xList),u.yList&&(Math.abs(u.y)<=Math.abs(D)?(P=!0,D=u.y):delete u.yList),P&&(Q._guideInfo=u)),isFinite(a)&&(i.x+=a),isFinite(D)&&(i.y+=D),P&&(u.v=i)}}var z=Q.screenInfo.curve;if("realPoint"===w.type){T=w.point,T.e!==j&&(i.e=T.e),z.moveRealPoint(T,i),w.point=i,Q.highlight.point=i;var f=J.status,V=J.selections;if(Q.activing={point:i,status:f},V){var b=i.clone().sub(T),L=0;V.forEach(function(s){var B=s.clone().add(b);z.moveRealPoint(s,B),V[L++]=B}),Q.activing.selections=V}}else if("ctrlPoint"===w.type){var F=J.pairs,p=F[w.pairId];z.moveCtrlPoint(p,i,w.ctrlType);var e=J.status,o=eq.Curve.PointType;if((e===o.Mirrored||e===o.Asymmetric)&&p.c1&&p.c2){var T=new eq.Math.Vector2(J.point),n="c1"===w.ctrlType?"c2":"c1";if(e===eq.Curve.PointType.Mirrored)z.moveCtrlPoint(p,T.clone().multiplyScalar(2).sub(i),n);else if(e===o.Asymmetric){var M=p[n].clone().sub(T).length(),S=T.clone().sub(p[w.ctrlType]).setLength(M).add(T);isNaN(S.x)||z.moveCtrlPoint(p,S,n)}}J._firePointChange()}else if("elevation"===w.type){m=w.startPoint;var U=m.e+(m.y-i.y)/I._zoom;Q._setCurrentPointImpl("e",U),J._firePointChange(),k="E: "+eq.toFixed(U)}var x=q.Default.getLogicalPoint(W,Q._interactor._canvas);if(x.x+=eq.Icons.TipShiftX,x.y+=eq.Icons.TipShiftY,!k){var $=eq.toWorldPosition(I,i);k=""+eq.toFixed($.x)+", "+eq.toFixed($.y)}Q.tipInfo={helperPos:x,text:k,size:k.length},Q._writeToHt(),Q._interactor.fi({kind:"betweenEditPoint",event:W})}},lb.prototype._setCurrentPointImpl=function(b,G){var c=this,x=c._activing;if(!x)return!1;var i=c.target;if(!i)return!1;var Q=x.getCurrentEditingPoint();if(!Q)return!1;var B=x.editingCtrl;if(!B)var S=Q.clone();if("e"===b)Q.e=G;else{var L;if("x"===b||"y"===b){var m=x._lastFirePoint;L="x"===b?{x:G,y:m?m.y:0}:{x:m?m.x:0,y:G}}else"object"==typeof b?(L=b,b.e!==j&&(Q.e=b.e)):(L={x:arguments[0],y:arguments[1]},arguments[2]!==j&&(Q.e=arguments[2]));var K=eq.getDataMatrix(i);L=eq.toScreenPosition(c._interactor.gv,K.apply(L)),Q.x=L.x,Q.y=L.y}if(!B){var _=S.multiplyScalar(-1).add(Q);Q.e&&S.e&&(_.e=Q.e-S.e),c.screenInfo.curve.moveCtrlDueToRealPointMovement(Q,_)}return!0},lb.prototype.setCurrentPoint=function(h,$){return this._setCurrentPointImpl(h,$)?(this._writeToHt(),!0):!1},lb.prototype._isEditEdgeSourceTarget=function(){var g=this,m=g.target;if(!(m instanceof q.Edge))return!1;var T=g.editing.point,$=g.screenInfo.curve._curves;return T===$[0]._p1?"source":T===$[$.length-1]._p4?"target":!1},lb.prototype._editEdgeSourceTarget=function(E,q,M){var u,T=this,d=T.target;if(u="source"===E?d.getSource():d.getTarget()){var G=T._interactor.gv,C=eq.toWorldPosition(G,q),f=T._calcHostAnchor(d,E,C,u);if(!M){var B=T._interactor.getStyle("anchorRound"),H=T._interactor.getStyle("anchorSensitivity");f.x=eq.roundTo(f.x,B,H),f.y=eq.roundTo(f.y,B,H)}if(T._interactor.getStyle("edgeHostDetectPerFrame")||f.x<0||f.x>1||f.y<0||f.y>1){var D=G.getDataAt(C,function(M){return G.isSelectable(M)?ei(M)?!0:!1:!1});if(D){var U=T._calcHostAnchor(d,E,C,D);u=D,T._nextChangeEdgeHost={type:E,host:D},f=U,M||(f.x=eq.roundTo(f.x,B,H),f.y=eq.roundTo(f.y,B,H))}}if(!M){var K=Lq(G,u,0,0,0,f.x,f.y),$=eq.toScreenPosition(G,K);q.x=$.x,q.y=$.y}return T._edgeHostGuideInfo=eq.getTargetCornersOnScreen(G,u),{host:u,anchor:f,tipText:""+f.x.toFixed(2)+", "+f.y.toFixed(2)}}},lb.prototype._guidingToEdit=function(T,B){var y,I,M=this;if(y=M.screenInfo.curve){I=y._curves;var O,X,p,f,g,s,m,J,t=1/0,Q=1/0,z=[];for(M.editing&&"realPoint"===M.editing.type&&(J=M.editing.point),g=0,s=2*I.length;s>g;g++)m=I[Math.floor(g/2)][g%2?"_p4":"_p1"],z.indexOf(m)>=0||(z.push(m),J&&J===m||(p=m.x-T.x,f=m.y-T.y,Math.abs(p)<Math.abs(t)?(t=p,O=[m]):p===t&&O.push(m),Math.abs(f)<Math.abs(Q)?(Q=f,X=[m]):f===Q&&X.push(m)));var G=M._interactor.getStyle("smartGuideSensitivity");if((Math.abs(t)>G||"y"===B)&&(O=null),(Math.abs(Q)>G||"x"===B)&&(X=null),O||X){var h=!1,v={};if(O&&(h=!0,v.xList=O,v.x=t),X&&(h=!0,v.yList=X,v.y=Q),h)return v}}},lb.prototype._46O=function($){var s=this;s.editing&&(s.editing=null,s._interactor.fi({kind:"endEditPoint",event:$})),s._guideInfo=null,s._edgeHostGuideInfo=null,s._pan&&(s._pan=null,s._interactor.fi({kind:"endPan",event:$})),s.tipInfo=null},lb.prototype._canDeletePoint=function(M,j){var H=this.target;if(!(H instanceof q.Edge))return!0;var N=M._curves[0],f=M._curves[M._curves.length-1];return N._p1===j||f._p4===j?!1:!0},lb.prototype.handleDelete=function(){var j=this;if(j.activing&&j.screenInfo){var d=q.Default.isShiftDown(),F=j.screenInfo.curve;j._canDeletePoint(F,j.activing.point)&&F.deleteRealPoint(j.activing.point,d),j.activing.selections&&j.activing.selections.forEach(function(N){j._canDeletePoint(F,N)&&F.deleteRealPoint(N,d)}),j.activing=null,delete j.editing,delete j.tipInfo,delete j._pan,j._writeToHt(),j._interactor.fp("deleteShapePoint",!1,!0)}},lb.prototype.handleDoubleClick=function(J){var i=this,Q=i._interactor._getLogicalPoint(J);if(i.screenInfo&&i._checkEditRealPoint(Q)){var H=i.getCurrentSelectintStatus(),A=eq.Curve.PointType;return H=H===A.Mirrored?A.Straight:A.Mirrored,i._setCurrentSelectionStatus(H),i._interactor._42(),!0}},lb.prototype._drawHighlight=function(B){var x=this,q=x.highlight;if(q){var s=q.bezier,K=x._interactor;s&&eq.Icons.DrawIcon(K,B,eq.Icons.ShapeHighlightCurve,[s._p1.x,s._p1.y,s._p2.x,s._p2.y,s._p3.x,s._p3.y,s._p4.x,s._p4.y]);var Y=q.point;Y&&"insertKnot"===q.type&&eq.Icons.DrawIcon(K,B,eq.Icons.ShapeHighlighPoint,Y)}},lb.prototype._drawGuide=function(M){var U=this,J=U._guideInfo;if(J){var X,S,n,D,l=J.v;for(X=0;2>X;X++)if(D=0===X?J.xList:J.yList)for(S=0,n=D.length;n>S;S++)eq.Icons.DrawIcon(U._interactor,M,eq.Icons.ShapeGuideLine,[l.x,l.y,D[S].x,D[S].y])}},lb.prototype._drawCurrentPoint=function(B){var V=this;if(V.activing){var l=V.activing,o=V.getCurrentSelectintStatus(),U=V._interactor;if(o!==eq.Curve.PointType.Straight){var D=l.pairs;l.hlpair,l.hltype;var q=l.selections,A=l.editingCtrl;if(D&&!q){var m,F,_;for(F=0,_=D.length;_>F;F++)m=D[F],A&&F===A.pairId&&m[A.type]?eq.Icons.DrawIcon(U,B,eq.Icons.ShapeActivingCtrl,{point:m.point,c1:m.c1,c2:m.c2,hl:A.type}):eq.Icons.DrawIcon(U,B,eq.Icons.ShapeActivingCtrl,m)}}eq.Icons.DrawIcon(U,B,eq.Icons.ShapeHighlighRealPoint,V.activing.point),q&&q.forEach(function(E){eq.Icons.DrawIcon(U,B,eq.Icons.ShapeHighlighRealPoint,E)})}},lb.prototype.clear=function(){var u=this;u.editing=null,u._guideInfo=null,u.activing=null,u.highlight=null},lb.prototype._42=function(N){var P=this;P.info={},P.editing||(P.screenInfo=null);var t=P._interactor;if(!t.editDetail)return P.clear(),void 0;if(!P.target||!P._interactor.gv.isSelected(P.target)||!P._interactor.gv.isVisible(P.target))return t.editDetail=!1,P.clear(),void 0;if(P.gatherSingleTarget(t.gv,P.target),eq.Icons.DrawIcon(t,N,eq.Icons.ShapeBgCurve,P.screenInfo),P._drawHighlight(N),P._drawCurrentPoint(N),P._getRealPoint().forEach(function(m){eq.Icons.DrawIcon(t,N,eq.Icons.ShapePoint,m)}),P._drawGuide(N),P.tipInfo&&eq.Icons.DrawIcon(t,N,eq.Icons.TipHelper,P.tipInfo),P._edgeHostGuideInfo&&eq.Icons.DrawIcon(t,N,eq.Icons.NodeHoverGuide,P._edgeHostGuideInfo),P._interactor.getStyle("curveElevationVisible")&&P.target instanceof q.Polyline&&P.activing){var Z=P.activing.getCurrentEditingPoint();Z&&eq.Icons.DrawIcon(t,N,eq.Icons.EdgeElevationGuide,Z)}},lb.prototype._getRealPoint=function(){var j,q=this.screenInfo,P=q.P,H=q.S,k=-1,z=[],p=-1,X=H.length;return H.each(function(F){p++;var u=1;if(3===F)u=2;else if(4===F)u=3;else if(5===F)return;k+=u,j=p+1>=X?!0:1===H.get(p+1)?!0:!1,z.push({point:{x:P[2*k],y:P[2*k+1]},isEnd:j})}),z};var Md=eq.MoveHelper=function(O){var f=this;f.catalog="Move",f._interactor=O};Md.prototype={},Md.prototype.constructor=Md,Md.prototype.calcShift=function(o,d,V){var X,t,T=this,y=T._interactor.gv,Z=y.lp(d);if("beginMove"===o&&T._gatherGridInfo(V._lastLogicalPoint||Z),X=T._target){var l=X.downPosition;if(l){var R=T._interactor.getStyle("moveSensitivity")/y._zoom;if(l.distanceTo(Z)<R)return{x:0,y:0};delete X.downPosition}var P;t=q.Default.isShiftDown(d),t&&(Z=T._dealShiftDown(Z),P=X.shiftGuide.dir);var c,a=X.rawPos={x:X.pos.x+Z.x-X.lp.x,y:X.pos.y+Z.y-X.lp.y};if(q.Default.isCtrlDown(d)){if(c=T._calcShiftByAddon(),T._target.node instanceof eq.Group){var N=T._target.node;N._position.x+=c.x,N._position.y+=c.y}return c}for(var j,s=X.x+a.x,G=X.y+a.y,E={x:s,y:G},A={x:s+X.w/2,y:G+X.h/2},e={x:s+X.w,y:G+X.h},K=T._interactor.rectGuide,I=T._interactor.gridGuide,H=[K.findClosest(E,P),K.findClosest(A,P),K.findClosest(e,P),I.findClosest(E,P),I.findClosest(A,P),I.findClosest(e,P)],u=1/0,f=1/0,Y=0,L=H.length;L>Y;Y++)j=H[Y],j&&(s=j.x,G=j.y,isFinite(s)&&Math.abs(s)<Math.abs(u)&&(u=s),isFinite(G)&&Math.abs(G)<Math.abs(f)&&(f=G));if(isFinite(u)||(u=0),isFinite(f)||(f=0),c=T._calcShiftByAddon(u,f),T._target.node instanceof eq.Group){var N=T._target.node;N._position.x+=c.x,N._position.y+=c.y}var k=X.node;if(!xm(k,y)){var _=a.x+u,h=a.y+f;T._interactor.rectGuide.gatherLines({node:k,x:X.x+_,y:X.y+h,w:X.w,h:X.h},P)}return c}},Md.prototype._calcShiftByAddon=function(i,L){var u=this._target,C=u.rawPos,Y=u.node.getPosition();return i=i||0,L=L||0,{x:C.x-Y.x+i,y:C.y-Y.y+L}},Md.prototype._dealShiftDown=function(z){var n=this,S=n._target.shiftGuide,e=n._target.lp,s=Math.abs(z.x-e.x),m=Math.abs(z.y-e.y);s>m&&s>S.limit&&"y"===S.dir&&(S.dir="x"),m>s&&m>S.limit&&"x"===S.dir&&(S.dir="y");var l=S.dir;return"x"===l?(z.y=e.y,S.limit=Math.max(S.limit,s)):"y"===l&&(z.x=e.x,S.limit=Math.max(S.limit,m)),z},Md.prototype._gatherGridInfo=function(X){var t,M=this,U=M._interactor,l=U._getValidSelection();if(1===l.length){if(t=l[0],!t.getRect)return M._target=null,void 0}else if(t=eq.Group.findOrCreateGroup(l),!t)return M._target=null,void 0;var n=t.getPosition(),G=t.getRect();M._target={node:t,x:G.x-n.x,y:G.y-n.y,w:G.width,h:G.height,lp:{x:X.x,y:X.y},pos:{x:n.x,y:n.y},shiftGuide:{dir:"x",limit:0},downPosition:new eq.Math.Vector2(X)},U.rectGuide.gatherRects()},Md.prototype.clear=function(){var s=this;s._interactor.rectGuide.clear(),s._interactor._42()};var rk="directional",Hi="point",Tl="spot",uq="light.color",ps=function(m,J){gd(J)&&ye.test(J)?ii(m,J):Eg(J)&&J.modelType?mr(m,J):Nq[m]=J},Qi=function(l){if(Eg(l))return l;var R=Nq[l];return l&&R===j&&ye.test(l)&&(es&&es[l]||ii(l,l)),R};wg(d,{graph3dViewAttributes:R,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:b/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:ws,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:b/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,setShape3dModel:ps,getShape3dModel:Qi,createMatrix:function(Y,c){Sj(Y)||(Y=[Y]);for(var O=Y.length-1;O>=0;O--){var z=Y[O];c=Vf(z.mat,z.s3,z.r3,z.rotationMode,z.t3,c)}return c},transformVec:function(M,X){return up(M,X)},createBoxModel:function(){return{vs:om,ns:oo,uv:Lf,is:mg}},createRoundRectModel:function(L,_){return Nh.roundRect(L,_)},createStarModel:function(R,O){return Nh.star(R,O)},createRectModel:function(P,R){return Nh.rect(P,R)
},createTriangleModel:function(q,R){return Nh.triangle(q,R)},createRightTriangleModel:function(W,u){return Nh.rightTriangle(W,u)},createParallelogramModel:function(E,d){return Nh.parallelogram(E,d)},createTrapezoidModel:function(S,L){return Nh.trapezoid(S,L)},createSmoothSphereModel:function(c,Y,_,r,n,L,F){return Cr(new xg(c,Y,_,r,n,L,F))},createSphereModel:function(g,C,U,e,p,F){return g?Yn(g,C,U,e,p,F):d.createSmoothSphereModel()},createSmoothConeModel:function(n,A,B,V,z){return hg(n,A,B,V,z)},createConeModel:function(L,W,l,b,V,Z){return L?Pq(L,W,l,b,V,Z):hg(Z)},createSmoothCylinderModel:function(d,n,T,x,N,b,X,g){return Cr(new Db(d,n,T,x,N,b,X,g))},createCylinderModel:function(b,d,t,S,f,l,u){return b?rl(b,d,t,S,f,l,u):oc(l,u)},createSmoothTorusModel:function(q,V,O,U,W,J){return Cr(new Te(q,V,O,U,W,J))},createTorusModel:function(N,X,D,o,r,H,z){return N?Hn(N,X,D,o,r,H,z):Dp(H,z)},createExtrusionModel:function(b,A,N,K,P,n,l,J){return xj(b,A,N,K,P,n,l,J)},createSmoothRingModel:function(j,L,p,y,q,z){for(var a=[],_=0;_<j.length-1;_+=2)a.push({x:j[_],y:j[_+1]});for(j=Sq(a,L,p)[0],a=[],_=0;_<j.length;_++){var $=j[_];a.push(new Fh($.x,0,$.y))}return Cr(new Zp(a,z,y,q))},createTextGeometry:function(m,g){return Cr(new nq(m,g))},loadFontFace:function(K,O){d.xhrLoad(K,function(E){if(!E)return O();var v;try{v=JSON.parse(E)}catch($){v=JSON.parse(E.substring(65,E.length-2))}ad.loadFace(v),O&&O(v.familyName.toLowerCase())},O?null:{sync:!0})},createRingModel:function(e,P,y,H,E,m,s,A,z,V){for(var r=[],Q=0;Q<e.length-1;Q+=2)r.push({x:e[Q],y:e[Q+1]});m=m||d.shapeSide,s=s||0,A=A||m;var K,Z,n,q,T,c,L,k,S,h,Q,f,t,o,O,W,G,M,l=[],F=[],u=z?[]:R,g=z?[]:R,X=V?[]:R,b=V?[]:R,$=H?[]:R,I=H?[]:R,v=E?[]:R,C=E?[]:R,e=Sq(r,P,y),N=mh(e),x=0,U=2*Math.PI/m;return e.forEach(function(y){if(n=y.length,n>1){if(q=y[0],H)for(c=q.x,k=q.y,Q=s;A>Q;Q++)f=Q+1,t=Q*U,o=f*U,O=D(t),W=w(t),G=D(o),M=w(o),$.push(O*c,k,-W*c,G*c,k,-M*c,0,k,0),I.push(.5-.5*O,.5-.5*W,.5-.5*G,.5-.5*M,.5,.5);for(h=0;n>h;h++){for(T=y[h],c=q.x,L=T.x,k=q.y,S=T.y,K=x/N,x+=Yi(q,T),Z=x/N,Q=s;A>Q;Q++)f=Q+1,t=Q*U,o=f*U,O=D(t),W=w(t),G=D(o),M=w(o),l.push(O*L,S,-W*L,G*L,S,-M*L,O*c,k,-W*c,G*L,S,-M*L,G*c,k,-M*c,O*c,k,-W*c),F.push(Q/m,Z,f/m,Z,Q/m,K,f/m,Z,f/m,K,Q/m,K),z&&Q===s&&(u.push(0,k,0,0,S,0,O*L,S,-W*L,O*L,S,-W*L,O*c,k,-W*c,0,k,0),g.push(0,.5-k,0,.5-S,2*L,.5-S,2*L,.5-S,2*c,.5-k,0,.5-k)),V&&f===A&&(X.push(0,k,0,G*L,S,-M*L,0,S,0,G*L,S,-M*L,0,k,0,G*c,k,-M*c),b.push(1,.5-k,1-2*L,.5-S,1,.5-S,1-2*L,.5-S,1,.5-k,1-2*c,.5-k));q=T}if(E)for(c=q.x,k=q.y,Q=s;A>Q;Q++)f=Q+1,t=Q*U,o=f*U,O=D(t),W=w(t),G=D(o),M=w(o),v.push(G*c,k,-M*c,O*c,k,-W*c,0,k,0),C.push(.5-.5*G,.5+.5*M,.5-.5*O,.5+.5*W,.5,.5)}}),{vs:l,uv:F,bottom_vs:v,bottom_uv:C,top_vs:$,top_uv:I,from_vs:u,from_uv:g,to_vs:X,to_uv:b}}},!0),wg(c,{"3d.move.mode":j,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":j,"edge.gradient.color":j,"edge.source.t3":j,"edge.target.t3":j,"light.type":Hi,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":b/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":rq,"wf.short":!1,"wf.mat":j,"wf.geometry":!1,batch:j,"transparent.mask":!1,brightness:j,"select.brightness":.7,"repeat.uv.length":j,alphaTest:.4,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","shape3d.vector.dynamic.maxsize":2048,"label.face":Vb,"label.t3":j,"label.r3":j,"label.texture.scale":2,"label.rotationMode":Bp,"label.light":!1,"label.blend":j,"label.reverse.flip":!1,"label.reverse.color":Yh,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Vb,"label2.t3":j,"label2.r3":j,"label2.texture.scale":2,"label2.rotationMode":Bp,"label2.light":!1,"label2.blend":j,"label2.reverse.flip":!1,"label2.reverse.color":Yh,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Vb,"note.t3":j,"note.r3":j,"note.texture.scale":2,"note.rotationMode":Bp,"note.light":!1,"note.blend":j,"note.reverse.flip":!1,"note.reverse.color":Yh,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Vb,"note2.t3":j,"note2.r3":j,"note2.texture.scale":2,"note2.rotationMode":Bp,"note2.light":!1,"note2.blend":j,"note2.reverse.flip":!1,"note2.reverse.color":Yh,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:j,"shape3d.color":rh,"shape3d.top.color":j,"shape3d.bottom.color":j,"shape3d.from.color":j,"shape3d.to.color":j,"shape3d.image":j,"shape3d.top.image":j,"shape3d.bottom.image":j,"shape3d.from.image":j,"shape3d.to.image":j,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":j,"shape3d.side.to":j,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":j,"shape3d.opacity":j,"shape3d.reverse.flip":!1,"shape3d.reverse.color":Yh,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":j,"shape3d.uv.scale":j,"shape3d.top.uv.offset":j,"shape3d.top.uv.scale":j,"shape3d.bottom.uv.offset":j,"shape3d.bottom.uv.scale":j,"shape3d.from.uv.offset":j,"shape3d.from.uv.scale":j,"shape3d.to.uv.offset":j,"shape3d.to.uv.scale":j,"shape3d.top.cap":j,"shape3d.bottom.cap":j,"shape3d.start.angle":0,"shape3d.sweep.angle":m,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":j,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":rh,"all.image":j,"all.blend":j,"all.opacity":j,"all.reverse.flip":!1,"all.reverse.color":Yh,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":j,"all.uv.offset":j,"all.uv.scale":j,"all.discard.selectable":!0,mat:j,"left.mat":j,"right.mat":j,"top.mat":j,"bottom.mat":j,"front.mat":j,"back.mat":j},!0);var sg,tg=!1,yc=[0,0,0,0],As={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:Xf,2:pp,3:Cd,4:bn,5:Vb,6:Lo}},xl=function(Z,U,S,A){if(U.getFaceVisible(Z,S)){jn(U,Tr(Z,U.getFaceMat(Z,S)||U.getMat(Z)));var c=U._26I;U.getFaceReverseCull(Z,S)?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),Xi(c,U._prg.uFixPickReverseColor,As[S]),Xk(c),Uq(c,A,6),Cp(c),Og(U)}},oj=function(a){return a instanceof nc},sf=function(o){return[o.x,o.e||0,o.y]},pg=function(N,d,p){for(var d=gr(d),s=d[0],U=d[1],l=d[2];p--;)N.push(s,U,l)},sc=function(X,F,t){for(var F=gr(F),D=F[0],U=F[1],n=F[2],Y=F[3];t--;)X.push(D,U,n,Y)},zr=function(k,Q,O){if(Q)for(var K,Y,r,q=Q[0],d=Q[1],p=Q[2],u=Q[4],A=Q[5],o=Q[6],e=Q[8],m=Q[9],M=Q[10],f=Q[12],c=Q[13],F=Q[14],W=O.length,N=0,N=0;W>N;N+=3)K=O[N],Y=O[N+1],r=O[N+2],k.push(q*K+u*Y+e*r+f,d*K+A*Y+m*r+c,p*K+o*Y+M*r+F);else Oj(k,O)},zb=function(q,p){var x=p.s("light.intensity"),u=gr(p.s(uq)),W=u[0],e=u[1],z=u[2];1!==x&&(W*=x,e*=x,z*=x),q.push(W,e,z,p.s("light.disabled")?1:0)},ec=function(U,b,r){Xi(b,r.uHeadlightRange,U._headlightRange);var H=U._headlightIntensity,c=gr(U._headlightColor);1!==H&&(c=[c[0]*H,c[1]*H,c[2]*H]),Xi(b,r.uHeadlightColor,[c[0],c[1],c[2],U._headlightDisabled?1:0]);var g=U._59O,T=U._spots,y=U._dirs;if(g.length){var o=[],x=[],a=[];g.forEach(function(V){zb(o,V),Oj(x,U._transformPointToViewSpace(V.p3())),a.push(V.s("light.range"))}),b.uniform4fv(r.uPointColor,o),b.uniform1fv(r.uPointRange,a),b.uniform3fv(r.uPointPosition,x)}if(T.length){var w=[],h=[],M=[],f=[],B=[],u=[];T.forEach(function(s){zb(w,s),Oj(h,U._transformPointToViewSpace(s.p3())),Oj(B,U._transformDirectionToViewSpace(s.p3(),s.s("light.center"))),M.push(s.s("light.range")),f.push(D(s.s("light.angle")/2)),u.push(s.s("light.exponent"))}),b.uniform4fv(r.uSpotColor,w),b.uniform1fv(r.uSpotRange,M),b.uniform1fv(r.uSpotAngle,f),b.uniform1fv(r.uSpotExponent,u),b.uniform3fv(r.uSpotPosition,h),b.uniform3fv(r.uSpotDirection,B)}if(y.length){var C=[],F=[];y.forEach(function(M){zb(C,M),Oj(F,U._transformDirectionToViewSpace(M.p3()))}),b.uniform4fv(r.uDirColor,C),b.uniform3fv(r.uDirDirection,F)}},Rl=function(L){return L>0&&0===(L-1&L)},zd=function(s){return s=Z(0,f(b,s)),s=Z(Yb,f(b-Yb,s))},rj=function(){return.05+x()/2},Bi=function(j,s,V,n){var B,i=j.getEye();return j.isOrtho()?(B=jf(j.getCenter(),i),B[0]+=n[0],B[1]+=n[1],B[2]+=n[2]):B=i,cr(s,V,n,B)},cr=function(C,Q,c,n){var t=Hr(C,Q),M=jf(n,c,!0),d=Hr(M,Q);if(K(d)<Yb)return R;var $=(t-Hr(c,Q))/d;return[c[0]+M[0]*$,c[1]+M[1]*$,c[2]+M[2]*$]},Qc=function(w,M){return{x:2*w.x-M.x,y:2*w.y-M.y}},wp=function(j,L,O,k){var F,o;if(!j)return F=i(L.y-O.y,O.x-L.x),{x:L.x+k*w(F),y:L.y+k*D(F)};if(!O)return F=i(j.y-L.y,L.x-j.x),{x:L.x+k*w(F),y:L.y+k*D(F)};var b=jf([j.x,j.y,0],[L.x,L.y,0],!0),G=jf([O.x,O.y,0],[L.x,L.y,0],!0),A=-(b[0]+G[0])/2,z=-(b[1]+G[1])/2,J=C(A*A+z*z);if(Yb>J)return F=i(j.y-L.y,L.x-j.x),{x:L.x+k*w(F),y:L.y+k*D(F)};var S=j.x-L.x,T=j.y-L.y,X=O.x-L.x,M=O.y-L.y,s=C(S*S+T*T),U=C(X*X+M*M);F=u(Hr(b,G))/2,o=b[1]*G[0]-b[0]*G[1]>0?-1:1,A/=J,z/=J;var p=k/w(F),N=Z(s,U)/D(F);J=Math.min(p,N);var d={x:L.x+o*J*A,y:L.y+o*J*z};return O.b&&p>U/D(F)&&(d.adjust=!0),d},ag=function(S){var o=S[1],Q=S[2],B=S[3],R=S[6],M=S[7],P=S[11];S[1]=S[4],S[2]=S[8],S[3]=S[12],S[4]=o,S[6]=S[9],S[7]=S[13],S[8]=Q,S[9]=R,S[11]=S[14],S[12]=B,S[13]=M,S[14]=P},We=function(E){var c=E[0],y=E[1],$=E[2],H=E[3],u=E[4],W=E[5],V=E[6],l=E[7],t=E[8],F=E[9],j=E[10],N=E[11],T=E[12],h=E[13],z=E[14],A=E[15],e=c*W-y*u,a=c*V-$*u,f=c*l-H*u,Z=y*V-$*W,G=y*l-H*W,b=$*l-H*V,U=t*h-F*T,P=t*z-j*T,Q=t*A-N*T,C=F*z-j*h,I=F*A-N*h,q=j*A-N*z,g=e*q-a*I+f*C+Z*Q-G*P+b*U;return g?(g=1/g,E[0]=(W*q-V*I+l*C)*g,E[1]=($*I-y*q-H*C)*g,E[2]=(h*b-z*G+A*Z)*g,E[3]=(j*G-F*b-N*Z)*g,E[4]=(V*Q-u*q-l*P)*g,E[5]=(c*q-$*Q+H*P)*g,E[6]=(z*f-T*b-A*a)*g,E[7]=(t*b-j*f+N*a)*g,E[8]=(u*I-W*Q+l*U)*g,E[9]=(y*Q-c*I-H*U)*g,E[10]=(T*G-h*f+A*e)*g,E[11]=(F*f-t*G-N*e)*g,E[12]=(W*P-u*C-V*U)*g,E[13]=(c*C-y*P+$*U)*g,E[14]=(h*a-T*Z-z*e)*g,E[15]=(t*Z-F*a+j*e)*g,void 0):R},wh=function(r,k){if(k){var a=k[0],n=k[1],D=k[2];r[12]=r[0]*a+r[4]*n+r[8]*D+r[12],r[13]=r[1]*a+r[5]*n+r[9]*D+r[13],r[14]=r[2]*a+r[6]*n+r[10]*D+r[14],r[15]=r[3]*a+r[7]*n+r[11]*D+r[15]}},zo=function(v,i){if(i){var U=i[0],B=i[1],y=i[2];v[0]=v[0]*U,v[1]=v[1]*U,v[2]=v[2]*U,v[3]=v[3]*U,v[4]=v[4]*B,v[5]=v[5]*B,v[6]=v[6]*B,v[7]=v[7]*B,v[8]=v[8]*y,v[9]=v[9]*y,v[10]=v[10]*y,v[11]=v[11]*y}},yd=function(m,N,V){var Z=N[0],Q=N[1],l=N[2],I=N[3],h=N[4],r=N[5],w=N[6],$=N[7],n=N[8],x=N[9],q=N[10],S=N[11],B=N[12],y=N[13],M=N[14],f=N[15],b=V[0],D=V[1],T=V[2],H=V[3];return m[0]=b*Z+D*h+T*n+H*B,m[1]=b*Q+D*r+T*x+H*y,m[2]=b*l+D*w+T*q+H*M,m[3]=b*I+D*$+T*S+H*f,b=V[4],D=V[5],T=V[6],H=V[7],m[4]=b*Z+D*h+T*n+H*B,m[5]=b*Q+D*r+T*x+H*y,m[6]=b*l+D*w+T*q+H*M,m[7]=b*I+D*$+T*S+H*f,b=V[8],D=V[9],T=V[10],H=V[11],m[8]=b*Z+D*h+T*n+H*B,m[9]=b*Q+D*r+T*x+H*y,m[10]=b*l+D*w+T*q+H*M,m[11]=b*I+D*$+T*S+H*f,b=V[12],D=V[13],T=V[14],H=V[15],m[12]=b*Z+D*h+T*n+H*B,m[13]=b*Q+D*r+T*x+H*y,m[14]=b*l+D*w+T*q+H*M,m[15]=b*I+D*$+T*S+H*f,m},Mh=function(h,J,v,X){var n,f,r,p,x,k,E,q,j,z,y=J[0],m=J[1],O=J[2],t=X[0],D=X[1],F=X[2],W=v[0],Y=v[1],P=v[2];return K(y-W)<Yb&&K(m-Y)<Yb&&K(O-P)<Yb?Ol(h):(E=y-W,q=m-Y,j=O-P,z=1/C(E*E+q*q+j*j),E*=z,q*=z,j*=z,n=D*j-F*q,f=F*E-t*j,r=t*q-D*E,z=C(n*n+f*f+r*r),z?(z=1/z,n*=z,f*=z,r*=z):(n=0,f=0,r=0),p=q*r-j*f,x=j*n-E*r,k=E*f-q*n,z=C(p*p+x*x+k*k),z?(z=1/z,p*=z,x*=z,k*=z):(p=0,x=0,k=0),h[0]=n,h[1]=p,h[2]=E,h[3]=0,h[4]=f,h[5]=x,h[6]=q,h[7]=0,h[8]=r,h[9]=k,h[10]=j,h[11]=0,h[12]=-(n*y+f*m+r*O),h[13]=-(p*y+x*m+k*O),h[14]=-(E*y+q*m+j*O),h[15]=1,h)},lq=function(c,Z,P,$,y){var i=1/g(Z/2),V=1/($-y);return c[0]=i/P,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=(y+$)*V,c[11]=-1,c[12]=0,c[13]=0,c[14]=2*y*$*V,c[15]=0,c},Hb=function(K,i,c,W,h,F,O){var D=1/(i-c),_=1/(W-h),I=1/(F-O);return K[0]=-2*D,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*_,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*I,K[11]=0,K[12]=(i+c)*D,K[13]=(h+W)*_,K[14]=(O+F)*I,K[15]=1,K},Bf=function(W,d){var H=d[0],g=d[1],E=d[2],f=d[3],z=H*H+g*g+E*E+f*f,Y=z?1/z:0;return W[0]=-H*Y,W[1]=-g*Y,W[2]=-E*Y,W[3]=f*Y,W},Rr=function(T,t){var N=t[0]+t[5]+t[10],J=0;return N>0?(J=2*Math.sqrt(N+1),T[3]=.25*J,T[0]=(t[6]-t[9])/J,T[1]=(t[8]-t[2])/J,T[2]=(t[1]-t[4])/J):t[0]>t[5]&t[0]>t[10]?(J=2*Math.sqrt(1+t[0]-t[5]-t[10]),T[3]=(t[6]-t[9])/J,T[0]=.25*J,T[1]=(t[1]+t[4])/J,T[2]=(t[8]+t[2])/J):t[5]>t[10]?(J=2*Math.sqrt(1+t[5]-t[0]-t[10]),T[3]=(t[8]-t[2])/J,T[0]=(t[1]+t[4])/J,T[1]=.25*J,T[2]=(t[6]+t[9])/J):(J=2*Math.sqrt(1+t[10]-t[0]-t[5]),T[3]=(t[1]-t[4])/J,T[0]=(t[8]+t[2])/J,T[1]=(t[6]+t[9])/J,T[2]=.25*J),T},hi=function(f,S,U){var J=S[0],M=S[1],j=S[2],Z=S[3],A=J+J,h=M+M,Q=j+j,p=J*A,E=J*h,x=J*Q,r=M*h,G=M*Q,t=j*Q,o=Z*A,u=Z*h,P=Z*Q;return f[0]=1-(r+t),f[1]=E+P,f[2]=x-u,f[3]=0,f[4]=E-P,f[5]=1-(p+t),f[6]=G+o,f[7]=0,f[8]=x+u,f[9]=G-o,f[10]=1-(p+r),f[11]=0,f[12]=U[0],f[13]=U[1],f[14]=U[2],f[15]=1,f},uc=function(){var N=[0,0,0],c=[0,0,0],B=[0,0,0],I=function(W,o,N){W[0]=o[1]*N[2]-o[2]*N[1],W[1]=o[2]*N[0]-o[0]*N[2],W[2]=o[0]*N[1]-o[1]*N[0]},C=function($){return $[0]*$[0]+$[1]*$[1]+$[2]*$[2]},v=function(k){var m=Math.sqrt(C(k));k[0]/=m,k[1]/=m,k[2]/=m},U=function(o,i,h){o[0]=i[0]-h[0],o[1]=i[1]-h[1],o[2]=i[2]-h[2]};return function(S,p,g){var b=bj();return U(B,S,p),0===C(B)&&(B[2]=1),v(B),I(N,g,B),0===C(N)&&(1===Math.abs(g[2])?B[0]+=1e-4:B[2]+=1e-4,v(B),I(N,g,B)),v(N),I(c,B,N),b[0]=N[0],b[4]=c[0],b[8]=B[0],b[1]=N[1],b[5]=c[1],b[9]=B[1],b[2]=N[2],b[6]=c[2],b[10]=B[2],b}}(),aj=function(u,e){if(u.vr.enable){var O=u.vr.getViewMatrix(e);if(O)return O}return Mh(e?e:bj(),u._eye,u._center,u._up)},bi=function(P){if(P.vr.enable){var d=P.vr.getProjectMatrix();if(d)return d}var U=P.getAspect(),D=P._near,u=P._far,Z=bj();if(P._ortho){var x=P._orthoWidth/2,A=x/U;Hb(Z,-x,x,-A,A,D,u)}else lq(Z,P._fovy,U,D,u);return Z},fn=function(G,W){if(!G)return R;var w=0,x=1,H=2,g=[],N=0,n=G.length,e=n/3;if(W){for(;n>N;N++)g[N]=0;for(N=0;N<W.length;N+=3){var M=[],i=[],D=[];M[w]=G[3*W[N+1]+w]-G[3*W[N]+w],M[x]=G[3*W[N+1]+x]-G[3*W[N]+x],M[H]=G[3*W[N+1]+H]-G[3*W[N]+H],i[w]=G[3*W[N+2]+w]-G[3*W[N+1]+w],i[x]=G[3*W[N+2]+x]-G[3*W[N+1]+x],i[H]=G[3*W[N+2]+H]-G[3*W[N+1]+H],D[w]=M[x]*i[H]-M[H]*i[x],D[x]=M[H]*i[w]-M[w]*i[H],D[H]=M[w]*i[x]-M[x]*i[w];for(var V=0;3>V;V++)g[3*W[N+V]+w]+=D[w],g[3*W[N+V]+x]+=D[x],g[3*W[N+V]+H]+=D[H]}}else for(N=0;e>N;N+=3){var M=[],i=[],D=[];M[w]=G[3*(N+1)+w]-G[3*N+w],M[x]=G[3*(N+1)+x]-G[3*N+x],M[H]=G[3*(N+1)+H]-G[3*N+H],i[w]=G[3*(N+2)+w]-G[3*(N+1)+w],i[x]=G[3*(N+2)+x]-G[3*(N+1)+x],i[H]=G[3*(N+2)+H]-G[3*(N+1)+H],D[w]=M[x]*i[H]-M[H]*i[x],D[x]=M[H]*i[w]-M[w]*i[H],D[H]=M[w]*i[x]-M[x]*i[w];for(var V=0;3>V;V++)g[3*(N+V)+w]=D[w],g[3*(N+V)+x]=D[x],g[3*(N+V)+H]=D[H]}for(N=0;n>N;N+=3){var E=[];E[w]=g[N+w],E[x]=g[N+x],E[H]=g[N+H];var l=C(E[w]*E[w]+E[x]*E[x]+E[H]*E[H]);0===l&&(l=Yb),E[w]=E[w]/l,E[x]=E[x]/l,E[H]=E[H]/l,g[N+w]=E[w],g[N+x]=E[x],g[N+H]=E[H]}return new pq(g)},bh=function(p,L,z,h){if(z||(z=p.createTexture()),L){var d=p.TEXTURE_2D,Q=p.REPEAT,g=p.CLAMP_TO_EDGE,F=p.TEXTURE_MIN_FILTER;h!==p.NEAREST&&(h=p.LINEAR),Nn(p,z),p.texImage2D(d,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,L),Ve(p,p.TEXTURE_MAG_FILTER,h);var N=L.naturalWidth||L.width,a=L.naturalHeight||L.height;Rl(N)&&Rl(a)&&!L.clampToEdge?(Ve(p,p.TEXTURE_WRAP_S,Q),Ve(p,p.TEXTURE_WRAP_T,Q),Ve(p,F,p.LINEAR_MIPMAP_LINEAR),p.generateMipmap(d)):(Ve(p,p.TEXTURE_WRAP_S,g),Ve(p,p.TEXTURE_WRAP_T,g),Ve(p,F,h)),Nn(p,R)}return z},bo=function(Y,t){var x=new Uint8Array(3);return t=t||Y.createTexture(),Nn(Y,t),Ve(Y,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texImage2D(Y.TEXTURE_2D,0,Y.RGB,1,1,0,Y.RGB,Y.UNSIGNED_BYTE,x),t},Tj=function(W){W._26I&&W._prg&&(W._26I.deleteProgram(W._prg),W._prg=R)},mq=function(T,B,c,o){var v=T.createShader(c);return T.shaderSource(v,o),T.compileShader(v),T.attachShader(B,v),v},fl=function(q){return q.createBuffer()},Nn=function(O,R){O.bindTexture(O.TEXTURE_2D,R)},Gp=function(j,y){j.bindFramebuffer(j.FRAMEBUFFER,y)},Ve=function(V,h,R){V.texParameteri(V.TEXTURE_2D,h,R)},_o=function(z,w){z.enable(z.POLYGON_OFFSET_FILL),z.polygonOffset(w[0],w[1])},$m=function(Q){Q.disable(Q.POLYGON_OFFSET_FILL)},yi=function(a,t){if(t){var t=gr(t);a.clearColor(t[0],t[1],t[2],t[3])}},bs=function(R,j){Xi(R,j.uFix,!0),Me(R,j.aNormal)},kh=function(g,w){Xi(g,w.uFix,!1),lp(g,w.aNormal)},Xo=function(K,g,L,F,J,H,E,x){K._picking||(L?(Xi(K,g.uBlend,!0),Xi(K,g.uBlendColor,L)):Xi(K,g.uBlend,!1),Xi(K,g.uLight,F==R?!0:F),Zl(J)&&1!==J&&Xi(K,g.uPartOpacity,J),Xi(K,g.uReverseFlip,H==R?!1:H),Xi(K,g.uFixPickReverseColor,E||Yh)),x?K.enable(K.CULL_FACE):K.disable(K.CULL_FACE)},Je=function(t,p){t._picking||Xi(t,p.uPartOpacity,1)},Xk=function(t,A,k,b,h,N,R,g,r){if(!k)return t.activeTexture(t.TEXTURE0),Nn(t,t._emptyTexture),t.activeTexture(t.TEXTURE1),Nn(t,t._emptyBlendTexture),void 0;Xi(t,A.uTexture,!0),Xi(t,A.uDiscardSelectable,yf(b)?b:!0),lp(t,A.aUv),ld(t,h,N,A.aUv,2),r?(Xi(t,A.uBlendTexture,!0),t.activeTexture(t.TEXTURE1),Nn(t,r),t.uniform1i(A.uBlendSampler,1)):(Xi(t,A.uBlendTexture,!1),t.activeTexture(t.TEXTURE1),Nn(t,t._emptyBlendTexture)),t.activeTexture(t.TEXTURE0),Nn(t,k),t.uniform1i(A.uSampler,0);var L=[0,0,1,1];R&&(L[0]=R[0],L[1]=R[1]),g&&(L[2]=g[0],L[3]=g[1]),Xi(t,A.uOffsetScale,L)},Cp=function(L,D,B){L.activeTexture(L.TEXTURE0),Nn(L,R),L.activeTexture(L.TEXTURE1),Nn(L,R),B&&(Me(L,D.aUv),Xi(L,D.uTexture,!1),Xi(L,D.uBlendTexture,!1))},Ek=function(x,L,u,N,H,q){!u||_||Kb||x.lineWidth(u),N&&!x._picking&&Xi(x,L.uFixPickReverseColor,N),H&&ld(x,H,q,L.aPosition)},dl=function(c,W,L,h){sg&&(h=c[sg]),c.drawArrays(h==R?c.TRIANGLES:h,W,L);var N=c._renderInfo;N&&(N.calls++,N.vertices+=L,(h==R||h===c.TRIANGLES)&&(N.faces+=L/3),h===c.LINES&&(N.lines+=L/2))},Uq=function(f,J,v,q){sg&&(q=f[sg]),f.drawElements(q==R?f.TRIANGLES:q,v,f.UNSIGNED_SHORT,J==R?0:2*J);var r=f._renderInfo;r&&(r.calls++,r.vertices+=v,(q==R||q===f.TRIANGLES)&&(r.faces+=v/3),q===f.LINES&&(r.lines+=v/2))},gk=function(J,l,z,F,s){var r=J.ARRAY_BUFFER;J.bindBuffer(r,l),z&&J.bufferData(r,z,J.STATIC_DRAW),F!=R&&J.vertexAttribPointer(F,s?s:3,J.FLOAT,!1,0,0)},ld=function(c,K,U,F,M){return U?(Fo(c,c.ARRAY_BUFFER,K,U),F!=R&&c.vertexAttribPointer(F,M?M:3,c.FLOAT,!1,0,0),void 0):gk(c,K,U,F,M)},yk=function(C,O,J){var T=C.ELEMENT_ARRAY_BUFFER;C.bindBuffer(T,O),J&&C.bufferData(T,J,C.STATIC_DRAW)},$g=function(o,b,W){Fo(o,o.ELEMENT_ARRAY_BUFFER,b,W)},Fo=function(b,v,_,J){var Q=J._bufId;Q||(Q=J._bufId=q.Math.generateIncreasingID());var _,h=b._bufPool;(_=h[Q])&&_._buf?b.bindBuffer(v,_._buf):(_=h[Q]={_buf:fl(b)},b.bindBuffer(v,_._buf),b.bufferData(v,J,b.STATIC_DRAW)),_._fid=b._renderInfo.frame},Xi=function(U,z,e){if(e!=R&&z!=R){e=gr(e);var I=e.length;3===I?U.uniform3fv(z,e):4===I?U.uniform4fv(z,e):16===I?U.uniformMatrix4fv(z,!1,e):yf(e)?U.uniform1i(z,e?1:0):2===I?U.uniform2fv(z,e):U.uniform1f(z,e)}},lp=function(L,T){T!=R&&T>=0&&L.enableVertexAttribArray(T)},Me=function(P,C){C!=R&&C>=0&&P.disableVertexAttribArray(C)},Og=function(f,x){var I=f.getGL(),z=f._prg;f._7O=f._8O.pop(),x&&(Xi(I,z.uMVMatrix,f._7O),f._6O=x,Xi(I,z.uNMatrix,x))},Hl=function(Q,B){return B||(B=bj()),hb(B,Q),We(B),ag(B),B},jn=function(Z,t){var l=Z.getGL(),K=Z._prg,z=Z._7O;t&&(Z._8O.push(Mk(z)),Xi(l,K.uMMatrix,t),yd(z,z,t),Z._7O=z),Xi(l,K.uMVMatrix,z),Xi(l,K.uNMatrix,Hl(z,Z._6O))},Sr=function(S,p,H,D,G,w){if(H){if(D){var z=H.value++,u=2147483648|z,R=[(255&u>>16)/255,(255&u>>8)/255,(255&u)/255,(255&u>>24)/255];H[z]={data:G,part:w}}else R=yc;return Xi(S,p.uFixPickReverseColor,R),R}},zl=function(){var t={center:function(C,p,V,X,e){var n=-p[1]/2,z={x:-p[0]/2,y:n,width:p[0],height:p[1]},o=pb(C,z,V);return[o.x+X,-o.y-e,rj()]},front:function(n,G,f,d,H){var b=-G[1]/2,B={x:-G[0]/2,y:b,width:G[0],height:G[1]},E=pb(n,B,f);return[E.x+d,-E.y-H,G[2]/2+rj()]},back:function(O,U,S,v,k){var c=-U[0]/2,i=-U[1]/2,Q={x:c,y:i,width:U[0],height:U[1]},y=pb(O,Q,S);return[-y.x-v,-y.y-k,-U[2]/2-rj()]},left:function(W,B,F,V,D){var k=-B[1]/2,C={x:-B[2]/2,y:k,width:B[2],height:B[1]},d=pb(W,C,F);return[-B[0]/2-rj(),-d.y-D,d.x+V]},right:function(x,o,j,T,C){var k=-o[2]/2,g=-o[1]/2,_={x:k,y:g,width:o[2],height:o[1]},L=pb(x,_,j);return[o[0]/2+rj(),-L.y-C,-L.x-T]},top:function(n,s,E,k,J){var U={x:-s[0]/2,y:-s[2]/2,width:s[0],height:s[2]},l=pb(n,U,E);return[l.x+k,s[1]/2+rj(),l.y+J]},bottom:function(J,q,F,w,L){var M=-q[2]/2,B={x:-q[0]/2,y:M,width:q[0],height:q[2]},b=pb(J,B,F);return[b.x+w,-q[1]/2-rj(),-b.y-L]}};return function(p,B,x,o,f,I){return t[o](p,B,x,f||0,I||0)}}(),ee=function(h,x,Q,y,v,i,E,e,l,t){if(v&&(x[0]+=v[0],x[1]+=v[1],x[2]+=v[2]),wh(h,Q),e){var p=bj();if(Ng(p,l,t),up(x,p),wh(h,x),h.auto=e,h.pos=up([0,0,0],h),i){var c=h.mat2=bj();Ng(c,i,E)}}else Ng(h,l,t),wh(h,x),y===Xf?$r(h,-s):y===pp?$r(h,s):y===Cd?vq(h,-s):y===bn?vq(h,s):y===Lo&&$r(h,b),Ng(h,i,E);return h},Fr=function(I,N){var G=N.auto,o=N.mat2,r=I.gv;if(G){var m,u=bj(),R=[0,0,0,0];m="string"==typeof G?[G.indexOf("x")<0?r._eye[0]:r._center[0],G.indexOf("y")<0?r._eye[1]:r._center[1],G.indexOf("z")<0?r._eye[2]:r._center[2]]:r._eye,Rr(R,Mh(bj(),m,r._center,r._up)),hi(u,Bf(R,R),N.pos),o&&yd(u,u,o),jn(r,u)}else jn(r,N)},ml=function(s,g,c,O,U){var d=s.s,T=s.gv,y=T.getGL(),q=T._prg,E=T._buffer,e=T._1O;bh(y,Fj,e),Fr(s,c),Xo(y,q,d(g+".blend"),d(g+".light"),d(g+".opacity"),d(g+".reverse.flip"),d(g+".reverse.color"),d(g+".reverse.cull")),Xk(y,q,e,U,E.uv,iq),ld(y,E.vs,O,q.aPosition),ld(y,E.ns,dc,q.aNormal),$g(y,E.is,fm),Uq(y,0,fm.length),Cp(y,q,e),Je(y,q),Og(T)},lh=function(D,P,E){var B=D.gv,Z=D.data,v=D[P]={blend:B.getBodyColor(Z)||B.getFaceBlend(Z,P),light:B.getFaceLight(Z,P),color:B.getFaceColor(Z,P),opacity:B.getFaceOpacity(Z,P),transparent:B.getFaceTransparent(Z,P),reverseFlip:B.getFaceReverseFlip(Z,P),reverseColor:B.getFaceReverseColor(Z,P),reverseCull:B.getFaceReverseCull(Z,P),texture:B.getFaceImage(Z,P),blendTexture:B.getFaceBlendImage(Z,P),discardSelectable:B.getFaceDiscardSelectable(Z,P)};if("csg"!==P){v.uv=B.getFaceUv(Z,P)||E&&E[P+"Uv"],v.uvScale=B.getFaceUvScale(Z,P)||E&&E[P+"UvScale"],v.uvOffset=B.getFaceUvOffset(Z,P)||E&&E[P+"UvOffset"];var I=B.getFaceMat(Z,P);I&&(v.mat=Tr(Z,I))}return v},am=function(o,I,M,J,t){if(J){if(!t(J.transparent))return;var l=o.data,V=o.gv,F=V._buffer,k=V.getTexture(J.texture,l),Z=V.getTexture(J.blendTexture,l);Xk(I,M,k,J.discardSelectable,F.uv,J.tuv,J.uvOffset,J.uvScale,Z),Xo(I,M,J.blend,J.light,J.opacity,J.reverseFlip,J.reverseColor,J.reverseCull),Xi(I,M.uDiffuse,J.color),ld(I,F.vs,J.vs,M.aPosition),ld(I,F.ns,J.ns,M.aNormal),dl(I,0,J.vs.length/3),Je(I,M),Cp(I,M,k)}},cs=function(J,P,p,n,Q,G){var m,V,c,C,S,D,X,e,o,k,g,s=[n-P,Q-p],z=J?J.length:0;for(c=0;z>c;c++){for(C=2,m=J[c],S=m[0],D=m[1];C+1<m.length;){if(X=m[C],e=m[C+1],V=Sm(P,p,n,Q,S,D,X,e,!0)){o=[X-S,e-D],k=Yi(o),o[0]/=k,o[1]/=k,k=Hr(s,o),k=k>0?G:-G,g=[o[0]*k,o[1]*k];break}S=X,D=e,C+=2}if(g)break}if(g)for(n=P+g[0],Q=p+g[1],c=0;z>c;c++)for(C=2,m=J[c],S=m[0],D=m[1];C+1<m.length;){if(X=m[C],e=m[C+1],V=Sm(P,p,n,Q,S,D,X,e,!0))return[0,0];S=X,D=e,C+=2}return g?g:[n-P,Q-p]},no=q.graph3d={},Jj=function(k,w,d){Ci(Y+".graph3d."+k,w,d)},tb="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",mf="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~<spmpd!>!eJ|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw<*yfusfWw.)f{jmbnspo!>!F!4dfw<*mbnspOw)f{jmbnspo!>!O!4dfw!gjeof$!<ftvggjEv!>!spmpd!ftmf$!~<ftvggjEv!>!spmpd|ftmf~<spmpDidubCw!>!spmpd|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!<spmpd!5dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";wg(d,{setBatchInfo:function(P,X){Ag[P]=X},getBatchInfo:function(y){return Ag[y]}},!0);var Mb=[1,1,1],kj=[1,0,0,0,0,1,0,1,1,1,1,0],_p=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],qe=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],Bh=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],uk=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Gc=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],hl=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],Wj=function(z,U){Bs(z,U,"_batchModelMap","_batchIndexMap"),eg(z,U,"_wireframeModelMap","_wireframeIndexMap"),eg(z,U,"_polylineModelMap","_polylineIndexMap"),eg(z,U,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),eg(z,U,"_polylineModelMapSwap","_polylineIndexMapSwap")},Bs=function(G,M,$,V){if(!M)return G[$]={},G[V]={},void 0;var p=M._id,j=G[V],f=j[p];if(f){var W=G[$],B=f.batch,T=W[B],O=T.ds,z=f.index;if(T.invalidate=!0,delete j[p],O.splice(z,1),Zm(O))return delete W[B],void 0;for(var F=f.begin,d=f.size,c=3*F,y=3*d,N=4*F,i=4*d,C=T.vs,X=T.ps,m=T.uv,a=T.cs,g=T.bs,w=T.rs,R=T.ns,K=T.ls;z<O.length;z++)f=j[O[z]._id],f.index--,f.begin-=d;C.splice(c,y),X.splice(N,i),m&&m.splice(2*F,2*d),a&&a.splice(N,i),g&&g.splice(c,y),w&&w.splice(F,d),R&&R.splice(c,y),K&&K.splice(F,d)}},eg=Bs,Nb=function(j,o,p,Q){if(!Q)return R;var n=o[Q];if(!n){var E=Ag[Q]||Dl,I=E.image?[]:R;n=o[Q]={vs:[],ns:[],uv:I,cs:I?R:E.color?R:[],bs:E.blend?[]:R,ps:[],rs:E.brightness?[]:R,ds:[]}}return n.invalidate=!0,j[p._id]={index:n.ds.length,begin:n.vs.length/3,batch:Q},n.ds.push(p),n
},wm=function(u,D){return D!=R&&1!==D?[u[0]*D,u[1]*D,u[2]*D,u[3]]:u},Ak=function(Z,E,K){var S=Z.getBrightness(E),R=gr(K.color||"white"),u=R[3]<1,s=Math.ceil(K.width)||1,y=(u?"T":"O")+s,V=Z._wireframeIndexMap,L=Z._wireframeModelMap,i=L[y];i||(i=L[y]={vs:[],cs:[],ps:[],ds:[],T:u,W:s});var W,N=Z.getData3dUI(E),q=Ld(N);if(K.geometry){if(!q)return;if(W=Xb(q),!W)return}else W=K.short?em:ae;i.invalidate=!0;var M=i.vs,J=i.cs,Q=i.ds,r=V[E._id]={index:Q.length,begin:M.length/3,batch:y};Q.push(E);var j=Tr(E,K.mat),a=N._calcAnchorMat(E);a&&yd(j,j,a),zr(M,j,W);var C=r.size=M.length/3-r.begin;sc(J,wm(R,S),C)},sp=function(i,B,N,K,L,u,h,w,d){var e=i.getBrightness(B);e==R&&(e=1);var _=wm(gr(K),e),m=_[3]<1;u=Math.ceil(u)||1;var G=(m?"T":"O")+u;if(h){var r=h[0],x=(h[1]||r)+r;G+="-"+r+"-"+x,d&&(G+="-"+uo(d)+"-"+e,d=wm(gr(d),e))}var S=i._polylineIndexMap,t=i._polylineModelMap,z=t[G];z||(z=t[G]={vs:[],cs:[],ps:[],ds:[],ls:h?[]:R,T:m,W:u},h&&(z.D=r,z.G=x,z.A=d)),z.invalidate=!0;var q,C=z.vs,c=z.cs,g=z.ds,T=z.ls,W=S[B._id]={index:g.length,begin:C.length/3,batch:G};g.push(B),Oj(C,N);var J,M=W.size=C.length/3-W.begin,A=N.length,p=0,j=[];if(h||L)for(q=0;A>q;q+=6)J=Yi([N[q],N[q+1],N[q+2]],[N[q+3],N[q+4],N[q+5]]),j.push(J),p+=J;if(p&&L){var V,k=wm(gr(L),e),D=[k[0]-_[0],k[1]-_[1],k[2]-_[2],k[3]-_[3]],H=0;for(q=0;A>q;q+=6)V=H/p,sc(c,[_[0]+D[0]*V,_[1]+D[1]*V,_[2]+D[2]*V,_[3]+D[3]*V],1),H+=j[q/6],V=H/p,sc(c,[_[0]+D[0]*V,_[1]+D[1]*V,_[2]+D[2]*V,_[3]+D[3]*V],1)}else sc(c,_,M);if(h)for(H=w||0,q=0;A>q;q+=6)T.push(H),H+=j[q/6],T.push(H)},Ii=function(D,e,q){if(e)for(var r=4*e.begin,G=q[e.batch].ps,z=0;z<e.size;z++)G[r++]=D[0],G[r++]=D[1],G[r++]=D[2],G[r++]=D[3]},yq=function(R,S){var X=S+["32"],h=R[S],u=R[X];h?u&&u.length===h.length?(u.set(h),u._bufId=null):R[X]=new pq(h):delete R[X]},ki=function(q,K,P,U,i,y,d,O,p){if(Sj(P))P.forEach(function(G){ki(q,K,G,U,i,y,d,O,p)});else if(gd(P))ki(q,K,Ld(U,P),U,i,y,d,O,p);else if(Eg(P)){var r,h=li(P.mat,K,q),l=li(P.s3,K,q),J=li(P.t3,K,q),Y=li(P.r3,K,q);if((l||Y||J||h)&&(r=Vf(h,l,Y,li(P.rotationMode,K,q),J),y.push(r)),P.shape3d)ki(q,K,P.shape3d,U,i,y,d,O,P);else{var c=U.s;p=p||Dl;var A=y[0],E=y.length,o=c("shape3d.color",P.color,p.color);if(i||(i=c("shape3d.blend",P.blend,p.blend)),E>1){A=Mk(A);for(var n=1;E>n;n++)yd(A,A,y[n])}P.vs&&c(ik,P.visible,p.visible)&&br(A,d,O,P.vs,P.uv,P.is,i,o),P.top_vs&&c(dj,P.topVisible,p.topVisible)&&br(A,d,O,P.top_vs,P.top_uv,P.top_is,i,c("shape3d.top.color",P.topColor,p.topColor)||o),P.bottom_vs&&c(Jl,P.bottomVisible,p.bottomVisible)&&br(A,d,O,P.bottom_vs,P.bottom_uv,P.bottom_is,i,c("shape3d.bottom.color",P.bottomColor,p.bottomColor)||o),P.from_vs&&c(ac,P.fromVisible,p.fromVisible)&&br(A,d,O,P.from_vs,P.from_uv,P.from_is,i,c("shape3d.from.color",P.fromColor,p.fromColor)||o),P.to_vs&&c(Nc,P.toVisible,p.toVisible)&&br(A,d,O,P.to_vs,P.to_uv,P.to_is,i,c("shape3d.to.color",P.toColor,p.toColor)||o)}r&&y.pop()}},br=function(L,n,C,l,F,z,r,s){var x,E=n.cs,D=n.uv,f=n.bs;if(z){x=z.length;for(var y=0;x>y;y++){var $=z[y];zr(C,L,[l[3*$],l[3*$+1],l[3*$+2]]),D&&Oj(D,[F[2*$],F[2*$+1]])}}else x=l.length/3,zr(C,L,l),D&&Oj(D,F);E&&sc(E,s,x),f&&(r?pg(f,r,x):Oj(f,Mb,x))},_b=function(Z,L,T,S){var W=[];S?ki(Z.gv,Z.data,S,Z,Z.getBodyColor(),[L],T,W):(fe(Z,Xf,L,T,W),fe(Z,pp,L,T,W),fe(Z,Vb,L,T,W),fe(Z,Lo,L,T,W),fe(Z,Cd,L,T,W),fe(Z,bn,L,T,W),fe(Z,"csg",L,T,W)),W.length&&(Oj(T.vs,W),Oj(T.ns,fn(W)))},fe=function(H,O,n,E,s){var L=H[O];if(L){var b=L.tuv;if(b){var S,g,l,i,t=L.uvScale,m=L.uvOffset;if(t)for(S=b.length,g=t[0],l=t[1],i=0;S>i;i+=2)b[i]*=g,b[i+1]*=l;if(m)for(S=b.length,g=m[0],l=m[1],i=0;S>i;i+=2)b[i]+=g,b[i+1]+=l}br(n,E,s,L.vs,b,R,L.blend,L.color)}},Er=function(y,Y,n,U,P,i,N,K){var t,Z=n.cs,o=n.uv,E=n.bs;if(y.getFaceVisible(Y,i)){var g=y.getFaceMat(Y,i);if(g&&(P=Tr(Y,g)),zr(N,P,K),Z&&sc(Z,y.getFaceColor(Y,i),6),o){var u=y.getFaceUv(Y,i)||U[i+"Uv"],A=y.getFaceUvScale(Y,i)||U[i+"UvScale"],C=y.getFaceUvOffset(Y,i)||U[i+"UvOffset"];u=u?[u[6],u[7],u[0],u[1],u[2],u[3],u[2],u[3],u[4],u[5],u[6],u[7]]:kj;var J=u[0],O=u[1],x=u[2],T=u[3],M=u[4],B=u[5],l=u[6],k=u[7],X=u[8],c=u[9],a=u[10],I=u[11];if(A){var L=A[0],j=A[1];J*=L,O*=j,x*=L,T*=j,M*=L,B*=j,l*=L,k*=j,X*=L,c*=j,a*=L,I*=j}if(C){var p=C[0],H=C[1];J+=p,O+=H,x+=p,T+=H,M+=p,B+=H,l+=p,k+=H,X+=p,c+=H,a+=p,I+=H}o.push(J,O,x,T,M,B,l,k,X,c,a,I)}E&&(t=y.getBodyColor(Y)||y.getFaceBlend(Y,i),t?pg(E,t,6):Oj(E,Mb,6))}},aq=function(C,K,e,y){var j=C.getGL(),t=C._prg,z=C._buffer;if(!C.drawFilter&&!Zi(K)){jn(C),bs(j,t);for(var m in K){var d=K[m];if(!(y&&!d.T||!y&&d.T)){d.invalidate?(d.invalidate=!1,yq(d,"vs"),yq(d,"cs"),yq(d,"ls"),yq(d,"ps")):e&&yq(d,"ps");var w=d.vs32,S=e?d.ps32:d.cs32;Ek(j,t,d.W,R,z.vs,w);var Y=d.D,b=!C._dashDisabled&&Y;Xi(j,t.uAlphaTest,c.alphaTest),b&&(Xi(j,t.uDash,!0),Xi(j,t.uDashDistance,Y),Xi(j,t.uDashGapDistance,d.G),lp(j,t.aLineDistance),ld(j,z.lineDistance,d.ls32,t.aLineDistance,1),Xi(j,t.uDiffuse,d.A||hd));var V=!C._batchColorDisabled;V&&(Xi(j,t.uBatchColor,!0),lp(j,t.aBatchColor),ld(j,z.batchColor,S,t.aBatchColor,4)),Xk(j),dl(j,0,w.length/3,j.LINES),Cp(j),V&&(Xi(j,t.uBatchColor,!1),Me(j,t.aBatchColor)),b&&(Xi(j,t.uDash,!1),Me(j,t.aLineDistance))}}kh(j,t)}},bc=function($,f,I){var H,X,e,A,L,C,n,Y,i,d,G,D=$.getGL(),F=$._prg,B=$._buffer,S=$._batchModelMap;if(!Zi(S)){jn($);for(H in S)if(X=Ag[H]||Dl,!(I&&!X.transparent||!I&&X.transparent)&&(e=S[H],f||!X.transparentMask)){var r=I&&X.autoSort!==!1&&($._33Q||e.invalidate);if(e.invalidate?(e.invalidate=!1,yq(e,"vs"),yq(e,"ns"),yq(e,"cs"),yq(e,"rs"),yq(e,"ps"),yq(e,"bs"),yq(e,"uv")):f&&yq(e,"ps"),L=e.vs32,C=f?e.ps32:e.cs32,i=e.uv32,n=e.bs32,Y=e.rs32,G=L.length/3,r&&(e.is=qn(L,$.getEye())),G){A=X.light,d=$.getTexture(X.image),Xo(D,F,R,X.light,X.opacity,X.reverseFlip,X.reverseColor,X.reverseCull),C?$._batchColorDisabled||(Xi(D,F.uBatchColor,!0),lp(D,F.aBatchColor),ld(D,B.batchColor,C,F.aBatchColor,4)):Xi(D,F.uDiffuse,X.color||hd);var m=X.alphaTest;Xi(D,F.uAlphaTest,m===j?c.alphaTest:m);var z=n&&!$._batchBlendDisabled;z&&(Xi(D,F.uBatchBlend,!0),lp(D,F.aBatchBlend),ld(D,B.batchBlend,n,F.aBatchBlend));var b=Y&&!$._batchBrightnessDisabled;b&&(Xi(D,F.uBatchBrightness,!0),lp(D,F.aBatchBrightness),ld(D,B.batchBrightness,Y,F.aBatchBrightness,1)),i?Xk(D,F,d,X.discardSelectable,B.uv,i,X.uvOffset,X.uvScale):Xk(D),ld(D,B.vs,L,F.aPosition),ld(D,B.ns,e.ns32,F.aNormal),e.is?(yk(D,B.is,e.is),Uq(D,0,G)):dl(D,0,G),i?Cp(D,F,d):Cp(D),C&&!$._batchColorDisabled&&(Xi(D,F.uBatchColor,!1),Me(D,F.aBatchColor)),z&&(Xi(D,F.uBatchBlend,!1),Me(D,F.aBatchBlend)),b&&(Xi(D,F.uBatchBrightness,!1),Me(D,F.aBatchBrightness)),Je(D,F)}}}},qn=function(S,h){for(var z=S.length/3,e=new Array(z),q=z/3,J=new Array(q),p=0;q>p;p++)J[p]=p;J.sort(function(B,E){var q=9*B,e=[(S[q]+S[q+3]+2*S[q+6])/4,(S[q+1]+S[q+4]+2*S[q+7])/4,(S[q+2]+S[q+5]+2*S[q+8])/4];q=9*E;var O=[(S[q]+S[q+3]+2*S[q+6])/4,(S[q+1]+S[q+4]+2*S[q+7])/4,(S[q+2]+S[q+5]+2*S[q+8])/4],K=Yi(h,e)-Yi(h,O);return K>0?-1:0>K?1:0});for(var p=0;q>p;p++){var F=3*p,K=3*J[p];e[F]=K,e[F+1]=K+1,e[F+2]=K+2}return new wf(e)},si={obj:function(r,W){var T={mat:r.mat,s3:r.s3,r3:r.r3,rotationMode:r.rotationMode,t3:r.t3,cube:r.cube==R?!0:r.cube,center:r.center==R?!0:r.center,ignoreMtls:r.ignoreMtls,ignoreTransparent:r.ignoreTransparent,ignoreColor:r.ignoreColor,ignoreImage:r.ignoreImage,ignoreNormal:r.ignoreNormal,prefix:r.prefix,flipY:r.flipY,flipFace:r.flipFace,reverseFlipMtls:r.reverseFlipMtls,finishFunc:function(k,t){if(k){var t=[];for(var H in k){var e=k[H];t.rawS3=e.rawS3,t.push(e),r.eachModel&&r.eachModel(H,e)}t.json=r,W(t)}else W()}};d.loadObj(r.obj,r.mtl,T)}};d.getModelTypeHandlers=function(){return si},d.setModelTypeHandler=function(p,o){si[p]=o},d.getModelTypeHandler=function(u){return si[u]},d.handleModelLoaded=function(){},d.handleUnfoundModel=function(){};var es=R,Mp=R,Eo=function(M){es&&!M._loadingModelView_&&(Mp||(Mp={}),Mp[M._loadingModelView_=qi()]=M)},ii=function(O,F){es||(es={});var t=es[O];if(t){if(t.url===F)return;t.request.onload=_i,t.request.onerror=_i}var I=new Yj;if(es[O]={request:I,url:F},F=d.beforeLoadURL(F),F.data){var U=d.parse(F.data);mr(O,U,F)}else{I.onload=function(j){if(200===this.status||0===this.status){var H=d.parse(j.target.response||j.target.responseText);mr(O,H,F)}else Uo(O,d.handleUnfoundModel(O,F)||R)},I.onerror=function(){Uo(O,d.handleUnfoundModel(O,F)||R)};var u={};u.url=encodeURI(F),u.sync=!1,I.send(u)}},mr=function(S,Z,n){var P=Z.modelType;if(!P)return Uo(S,Z),d.handleModelLoaded(S,Z),void 0;var j=d.getModelTypeHandler(P);if(j){var v=function(c){c?(Uo(S,c),d.handleModelLoaded(S,c)):Uo(S,d.handleUnfoundModel(S,n)||R)};j(Z,v)}else Uo(S,d.handleUnfoundModel(S,n)||R)},Uo=function(t,Y){if(Nq[t]=Y,delete es[t],Zi(es)&&(es=R,Mp)){for(var I in Mp){var u=Mp[I];u._2O&&(u._2O={}),u.invalidateAll&&u.invalidateAll(j,"modelLoaded",t),u.redraw&&u.redraw(),u.iv(),delete u._loadingModelView_}Mp=R}if(Y&&Mp)for(var I in Mp){var u=Mp[I];u.invalidateAll&&u.invalidateAll(j,"modelLoading",t),u.redraw&&u.redraw(),u.iv()}},iq=new pq([0,0,0,1,1,1,1,0]),dc=new pq([0,0,1,0,0,1,0,0,1,0,0,1]),fm=new wf([0,1,2,2,3,0]),om=new pq([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),mg=new wf([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Lf=new pq([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),oo=fn(om,mg),An=(new pq([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new wf([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[Xf,Vb,pp,Lo,Cd,bn]),ae=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],em=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Yn=function(i,p,z,E,k,S){S=S||16,i=i||16,p=p||0,z=z||i;var l,Q,W,v,h,U,g,M,f=.5,V=[],u=[],P=m/i,I=b/S;for(l=0;S>l;l++)for(h=l+1,v=l*I,M=h*I,Q=p;z>Q;Q++)U=Q+1,W=Q*P,g=U*P,V.push(f*w(v)*D(W),f*D(v),-f*w(v)*w(W),f*w(M)*D(g),f*D(M),-f*w(M)*w(g),f*w(v)*D(g),f*D(v),-f*w(v)*w(g),f*w(v)*D(W),f*D(v),-f*w(v)*w(W),f*w(M)*D(W),f*D(M),-f*w(M)*w(W),f*w(M)*D(g),f*D(M),-f*w(M)*w(g)),u.push(Q/i,l/S,U/i,h/S,U/i,l/S,Q/i,l/S,Q/i,h/S,U/i,h/S);if(E){var F=[],y=[];for(W=p*P,l=0;S>l;l++)h=l+1,v=l*I,M=h*I,F.push(0,0,0,f*w(M)*D(W),f*D(M),-f*w(M)*w(W),f*w(v)*D(W),f*D(v),-f*w(v)*w(W)),y.push(0,.5,p/i,h/S,p/i,l/S)}if(k){var $=[],T=[];for(W=z*P,l=0;S>l;l++)h=l+1,v=l*I,M=h*I,$.push(0,0,0,f*w(v)*D(W),f*D(v),-f*w(v)*w(W),f*w(M)*D(W),f*D(M),-f*w(M)*w(W)),T.push(1,.5,z/i,l/S,z/i,h/S)}return{vs:V,uv:u,from_vs:F,from_uv:y,to_vs:$,to_uv:T}},Dp=function(h,g,R){h=h||.17,g=g||12,R=R||18,0>h?h=0:h>.25&&(h=.25);var o,G,W,S,s,$,x,O=.5,t=[],P=[],j=[],B=m/R,H=m/g,q=O-h;for(G=0;g>=G;G++)for(S=-b+G*H,$=D(S),s=w(S),o=0;R>=o;o++)W=o*B,x=q+h*$,t.push(D(W)*x,s*h,-w(W)*x),P.push(o/R,1-G/g);for(G=0;g>G;G++){var A=G*(R+1),N=(G+1)*(R+1);for(o=0;R>o;o++)j.push(A+o,N+o+1,N+o,A+o,A+o+1,N+o+1)}return{vs:t,uv:P,is:j}},Hn=function(k,Y,$,A,G,T,H){H=H||12,k=k||18,Y=Y||0,$=$||k,T=T||.17,0>T?T=0:T>.25&&(T=.25);var P,O,F,o,c,M,q,y,S,K,R=.5,J=[],j=[],n=m/k,z=m/H,U=R-T;for(F=0;H>F;F++)for(o=F+1,q=-b+F*z,y=-b+o*z,P=Y;$>P;P++)O=P+1,c=P*n,M=O*n,S=U+T*D(q),K=U+T*D(y),J.push(D(c)*S,w(q)*T,-w(c)*S,D(M)*S,w(q)*T,-w(M)*S,D(M)*K,w(y)*T,-w(M)*K,D(c)*S,w(q)*T,-w(c)*S,D(M)*K,w(y)*T,-w(M)*K,D(c)*K,w(y)*T,-w(c)*K),j.push(P/k,1-F/H,O/k,1-F/H,O/k,1-o/H,P/k,1-F/H,O/k,1-o/H,P/k,1-o/H);if(A){var Z=[],p=[];for(F=0;H>F;F++)o=F+1,q=-b+F*z,y=-b+o*z,c=Y*n,S=U+T*D(q),K=U+T*D(y),Z.push(D(c)*S,w(q)*T,-w(c)*S,D(c)*K,w(y)*T,-w(c)*K,D(c)*U,0,-w(c)*U),p.push(.5+.5*D(q),.5-.5*w(q),.5+.5*D(y),.5-.5*w(y),.5,.5)}if(G){var x=[],i=[];for(F=0;H>F;F++)o=F+1,q=-b+F*z,y=-b+o*z,c=$*n,S=U+T*D(q),K=U+T*D(y),x.push(D(c)*S,w(q)*T,-w(c)*S,D(c)*U,0,-w(c)*U,D(c)*K,w(y)*T,-w(c)*K),i.push(.5-.5*D(q),.5-.5*w(q),.5,.5,.5-.5*D(y),.5-.5*w(y))}return{vs:J,uv:j,from_vs:Z,from_uv:p,to_vs:x,to_uv:i}},oc=function(j,a){for(var g,N,O,y=.5,_=16,Q=[],P=[],F=[],r=m/_,Y=0;_>=Y;Y++)g=Y*r,N=D(g)*y,O=w(g)*y,Q.push(N,-y,O,N,y,O),P.push(1-Y/_,1,1-Y/_,0);for(Y=0;_>Y;Y++)F.push(2*Y,2*Y+1,2*Y+3,2*Y,2*Y+3,2*Y+2);if(a){var H=[],e=[],n=[];for(H.push(0,-y,0),e.push(.5,.5),Y=0;_>=Y;Y++)g=Y*r,N=D(g),O=w(g),H.push(N*y,-y,-O*y),e.push(.5+.5*N,.5+.5*O);for(Y=0;_>Y;Y++)n.push(0,Y+2,Y+1)}if(j){var K=[],C=[],A=[];for(K.push(0,y,0),C.push(.5,.5),Y=0;_>=Y;Y++)g=Y*r,N=D(g),O=w(g),K.push(N*y,y,-O*y),C.push(.5+.5*N,.5-.5*O);for(Y=0;_>Y;Y++)A.push(0,Y+1,Y+2)}return{vs:Q,uv:P,is:F,bottom_vs:H,bottom_uv:e,bottom_is:n,top_vs:K,top_uv:C,top_is:A}},rl=function(M,n,G,F,o,N,J){M=M||12,n=n||0,G=G||M;for(var Q,x,B,r,I,k,L,E,Y=.5,f=[],U=[],V=m/M,h=n;G>h;h++)Q=h+1,x=h*V,B=Q*V,r=D(x)*Y,I=w(x)*Y,k=D(B)*Y,L=w(B)*Y,f.push(r,-Y,-I,k,-Y,-L,r,Y,-I,k,-Y,-L,k,Y,-L,r,Y,-I),U.push(h/M,1,Q/M,1,h/M,0,Q/M,1,Q/M,0,h/M,0);if(J){var y=[],d=[];for(h=n;G>h;h++)x=V*h,B=V*(h+1),r=D(x),I=w(x),k=D(B),L=w(B),y.push(r*Y,-Y,-I*Y,0,-Y,0,k*Y,-Y,-L*Y),d.push(.5+.5*r,.5+.5*I,.5,.5,.5+.5*k,.5+.5*L)}if(N){var R=[],H=[];for(h=n;G>h;h++)x=V*h,B=V*(h+1),r=D(x),I=w(x),k=D(B),L=w(B),R.push(r*Y,Y,-I*Y,k*Y,Y,-L*Y,0,Y,0),H.push(.5+.5*r,.5-.5*I,.5+.5*k,.5-.5*L,.5,.5)}if(F){var e=[],v=[];x=V*n,r=D(x)*Y,I=w(x)*Y,E=n/M,e.push(0,Y,0,0,-Y,0,r,-Y,-I,r,-Y,-I,r,Y,-I,0,Y,0),v.push(0,0,0,1,E,1,E,1,E,0,0,0)}if(o){var j=[],s=[];x=V*G,r=D(x)*Y,I=w(x)*Y,E=G/M,j.push(0,-Y,0,0,Y,0,r,Y,-I,r,Y,-I,r,-Y,-I,0,-Y,0),s.push(1,1,1,0,E,0,E,0,E,1,1,1)}return{vs:f,uv:U,bottom_vs:y,bottom_uv:d,top_vs:R,top_uv:H,from_vs:e,from_uv:v,to_vs:j,to_uv:s}},hg=function(s,F,S,k,Z){F=F||18,S=S||0,k=k==R?m:k,Z=Z==R?.5:Z;for(var C,U,h,t,j,J,Q=[0,.5,.75,.875,.9375],b=[],y=[],V=[],z=k/F,L=0;L<Q.length;L++){var M=0===L%2?0:.5;for(C=0;F>=C;C++)U=(C+M)*z+S,h=1-Q[L],b.push(D(U)*Z*h,-Z+2*Q[L]*Z,-w(U)*Z*h),y.push((C+M)/F,h)}for(L=0;L<Q.length-1;L++){var c=L*(F+1),e=(L+1)*(F+1);for(C=0;F>C;C++)V.push(c+C,e+C+1,e+C,c+C,c+C+1,e+C+1)}for(J=b.length/3-(F+1),C=0;F>C;C++)b.push(0,Z,0),y.push((C+.5)/F,0);for(C=0;F>C;C++)V.push(J+C,J+C+1,J+(F+1)+C);if(s){var d=[],B=[],E=[];for(d.push(0,-Z,0),B.push(.5,.5),C=0;F>=C;C++)U=C*z+S,t=D(U),j=w(U),d.push(t*Z,-Z,-j*Z),B.push(.5+.5*t,.5+.5*j);for(C=0;F>C;C++)E.push(0,C+2,C+1)}return{vs:b,uv:y,is:V,bottom_vs:d,bottom_uv:B,bottom_is:E}},Pq=function(d,p,H,v,K,j){d=d||16,p=p||0,H=H||d;for(var h=.5,S=[],b=[],F=m/d,B=p;H>B;B++){var n=B+1,s=F*B,q=F*n;S.push(D(s)*h,-h,-w(s)*h,D(q)*h,-h,-w(q)*h,0,h,0),b.push(B/d,1,n/d,1,(B+n)/2/d,0)}if(j){var x=[],J=[];for(B=p;H>B;B++){s=F*B,q=F*(B+1);var c=D(s),$=w(s),a=D(q),G=w(q);x.push(c*h,-h,-$*h,0,-h,0,a*h,-h,-G*h),J.push(.5+.5*c,.5+.5*$,.5,.5,.5+.5*a,.5+.5*G)}}if(v){var Q=[],N=[];s=F*p,Q.push(0,h,0,0,-h,0,D(s)*h,-h,-w(s)*h),N.push(0,0,0,1,p/d,1)}if(K){var y=[],t=[];s=F*H,y.push(0,-h,0,0,h,0,D(s)*h,-h,-w(s)*h),t.push(1,1,1,0,H/d,1)}return{vs:S,uv:b,bottom_vs:x,bottom_uv:J,from_vs:Q,from_uv:N,to_vs:y,to_uv:t}},xj=function(N,M,T,F,$,q,J,j){for(var X=[],_=0;_<N.length-1;_+=2)X.push({x:N[_],y:N[_+1]});return wq(X,M,T,F,$,q,J,j,!1)},Nh={roundRect:function(e,L){return xj([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],e,L,3)},star:function(k,Z){return xj([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],k,Z)},rect:function(o,d){return xj([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],o,d)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(Y,k){return xj([0,-.5,.5,.5,-.5,.5],[1,2,2,5],Y,k)},rightTriangle:function(H,O){return xj([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],H,O)},parallelogram:function(u,Q){return xj([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],u,Q)},trapezoid:function(W,B){return xj([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],W,B)}},cf={sphere:1,cylinder:1,cone:1,torus:1},Le={torus:1,sphere:1},Kl=wg(Pb(Nh),{cylinder:1}),rb=wg(Pb(Nh),{cylinder:1,cone:1}),Bq=function(B,t,H){var e,x=li(B.anchor3d,H,t),g=li(B.mat,H,t),G=li(B.s3,H,t),v=li(B.t3,H,t),w=li(B.r3,H,t),L=G||w||v||g;if(x||L){e=Mk(t._6O);var W=L?Vf(g,G,w,li(B.rotationMode,H,t),v):bj();x&&wh(W,[.5-x[0],.5-x[1],.5-x[2]]),jn(t,W)}return e},ih=function(C,T,k,m,f,S,o){if(Sj(k))k.forEach(function(P){ih(C,T,P,m,f,S,o)});else if(gd(k))ih(C,T,Ld(m,k),m,f,S,o);else if(Eg(k))if(k.shape3d){var Y=Bq(k,C,T);ih(C,T,k.shape3d,m,f,S,k),Y&&Og(C,Y)}else zc(C,T,k,m.s,f,S,o)},zc=function(o,k,b,J,N,H,T){if(T=T||Dl,!H||H(J("shape3d.transparent",b.transparent,T.transparent))){var w=Bq(b,o,k);Pj(b);var W=o._26I,m=o._prg,D=o._buffer,Y=J("shape3d.color",b.color,T.color);N||(N=J("shape3d.blend",b.blend,T.blend));var E,P=b.opacity==R?T.opacity:b.opacity,Z=J("shape3d.opacity");E=Z!=R&&P!=R?P*Z:P!=R?P:Z,Xo(W,m,N,J("shape3d.light",b.light,T.light),E,J("shape3d.reverse.flip",b.reverseFlip,T.reverseFlip),J("shape3d.reverse.color",b.reverseColor,T.reverseColor),J("shape3d.reverse.cull",b.reverseCull,T.reverseCull)),b.vs&&J(ik,b.visible,T.visible)&&jp(W,m,D,Y,o.getTexture(J("shape3d.image",b.image,T.image),k),J("shape3d.discard.selectable",b.discardSelectable,T.discardSelectable),b.vs,b.uv,b.ns,b.is,J("shape3d.uv.offset",b.uvOffset,T.uvOffset),J("shape3d.uv.scale",b.uvScale,T.uvScale),J("shape3d.polygonOffset",b.polygonOffset,T.polygonOffset)),b.top_vs&&J(dj,b.topVisible,T.topVisible)&&jp(W,m,D,J("shape3d.top.color",b.topColor,T.topColor)||Y,o.getTexture(J("shape3d.top.image",b.topImage,T.topImage),k),J("shape3d.top.discard.selectable",b.topDiscardSelectable,T.topDiscardSelectable),b.top_vs,b.top_uv,b.top_ns,b.top_is,J("shape3d.top.uv.offset",b.topUvOffset,T.topUvOffset),J("shape3d.top.uv.scale",b.topUvScale,T.topUvScale),J("shape3d.top.polygonOffset",b.topPolygonOffset,T.topPolygonOffset)),b.bottom_vs&&J(Jl,b.bottomVisible,T.bottomVisible)&&jp(W,m,D,J("shape3d.bottom.color",b.bottomColor,T.bottomColor)||Y,o.getTexture(J("shape3d.bottom.image",b.bottomImage,T.bottomImage),k),J("shape3d.bottom.discard.selectable",b.bottomDiscardSelectable,T.bottomDiscardSelectable),b.bottom_vs,b.bottom_uv,b.bottom_ns,b.bottom_is,J("shape3d.bottom.uv.offset",b.bottomUvOffset,T.bottomUvOffset),J("shape3d.bottom.uv.scale",b.bottomUvScale,T.bottomUvScale),J("shape3d.bottom.polygonOffset",b.bottomPolygonOffset,T.bottomPolygonOffset)),b.from_vs&&J(ac,b.fromVisible,T.fromVisible)&&jp(W,m,D,J("shape3d.from.color",b.fromColor,T.fromColor)||Y,o.getTexture(J("shape3d.from.image",b.fromImage,T.fromImage),k),J("shape3d.from.discard.selectable",b.fromDiscardSelectable,T.fromDiscardSelectable),b.from_vs,b.from_uv,b.from_ns,b.from_is,J("shape3d.from.uv.offset",b.fromUvOffset,T.fromUvOffset),J("shape3d.from.uv.scale",b.fromUvScale,T.fromUvScale),J("shape3d.from.polygonOffset",b.fromPolygonOffset,T.fromPolygonOffset)),b.to_vs&&J(Nc,b.toVisible,T.toVisible)&&jp(W,m,D,J("shape3d.to.color",b.toColor,T.toColor)||Y,o.getTexture(J("shape3d.to.image",b.toImage,T.toImage),k),J("shape3d.to.discard.selectable",b.toDiscardSelectable,T.toDiscardSelectable),b.to_vs,b.to_uv,b.to_ns,b.to_is,J("shape3d.to.uv.offset",b.toUvOffset,T.toUvOffset),J("shape3d.to.uv.scale",b.toUvScale,T.toUvScale),J("shape3d.to.polygonOffset",b.toPolygonOffset,T.toPolygonOffset)),Je(W,m),w&&Og(o,w)}},jp=function(L,T,p,l,G,u,c,P,v,E,r,b,o){c&&(o&&_o(L,o),Xi(L,T.uDiffuse,l),P?Xk(L,T,G,u,p.uv,P,r,b):Xk(L),ld(L,p.vs,c,T.aPosition),ld(L,p.ns,v,T.aNormal),E?($g(L,p.is,E),Uq(L,0,E.length)):dl(L,0,c.length/3),P?Cp(L,T,G):Cp(L),o&&$m(L))},Ld=function(G,T){var M=G.s;if(T||(T=M(jk)),!T)return R;var c=Qi(T);if(c)return c;if("text"===T){var K={amount:M("shape3d.text.amount"),size:M("shape3d.text.size"),font:M("shape3d.text.font"),style:M("shape3d.text.style"),weight:M("shape3d.text.weight"),fill:M("shape3d.text.fill"),curveSegments:M("shape3d.text.curveSegments"),spacing:M("shape3d.text.spacing")},N=G.gv.getShape3dText(G.data),f=N;for(var P in K)f+="_"+(K[P]===j?"U":K[P]);return G._cachedTextKey===f?G._cachedTextGeometry:(G._cachedTextKey=f,G._cachedTextGeometry=d.createTextGeometry(N,K))}var P=T;if(cf[T]){var Y=M("shape3d.side"),w=M("shape3d.side.from"),s=M("shape3d.side.to"),i=M(ac),W=M(Nc);3>Y?(Y=0,w=0,s=0,i=!1,W=!1):((w==R||0>w)&&(w=0),(s==R||s>Y)&&(s=Y),0===w&&s===Y&&(i=!1,W=!1)),P+="-"+Y+"-"+w+"-"+s+"-"+i+"-"+W}if(Kl[T]){var b=M(dj);P+="-"+b}if(rb[T]){var q=M(Jl);P+="-"+q}if("torus"===T){var D=M("shape3d.torus.radius");0>D?D=0:D>.25&&(D=.25),P+="-"+D}if(Le[T]){var X=M(yg);P+="-"+X}return c=rc[P],c||("box"===T?c=d.createBoxModel():Nh[T]?c=Nh[T](b,q):"sphere"===T?c=d.createSphereModel(Y,w,s,i,W,X):T===Rd?c=d.createCylinderModel(Y,w,s,i,W,b,q):"cone"===T?c=d.createConeModel(Y,w,s,i,W,q):"torus"===T&&(c=d.createTorusModel(Y,w,s,i,W,D,X)),rc[P]=c),c},Pj=function(){var B=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],a=["is","top_is","bottom_is","from_is","to_is"];return p=Oh(tb.substr(tb.indexOf("^#")+2)),ym(d[dg(Ib+B[15]+"n"+B[16])]())&&xh()?function(j){j&&!j._complete_&&(j._complete_=!0,j.vs&&Zm(j.ns)&&(j.ns=fn(j.vs,j.is)),j.top_vs&&Zm(j.top_ns)&&(j.top_ns=fn(j.top_vs,j.top_is)),j.bottom_vs&&Zm(j.bottom_ns)&&(j.bottom_ns=fn(j.bottom_vs,j.bottom_is)),j.from_vs&&Zm(j.from_ns)&&(j.from_ns=fn(j.from_vs,j.from_is)),j.to_vs&&Zm(j.to_ns)&&(j.to_ns=fn(j.to_vs,j.to_is)),B.forEach(function(c){var w=j[c];Sj(w)&&(j[c]=new pq(w))}),a.forEach(function(A){var n=j[A];Sj(n)&&(j[A]=new wf(n))}))}:void 0}(),tq=function(r,y){var H=r[y];Sj(H)&&(r[y]=new pq(H))};wg(od,{_25Q:function(g){g._16O=function(r,w,$,g,p,O,e,k,M){var A=this.info;if(A){var x,G,c,K,t,C,H=bj();if(bb[w]?(x=A.p3,G=A.c1,c=A.c2):pk[w]?(G=A.s1||A.c1,c=A.s2||A.c2):(G=A.t1||A.c1,c=A.t2||A.c2),x)C=zl(w,Jr,$,g,k,M);else{var n=jf(c,G),f=Yi(G,c);K=[0,-i(n[2],n[0]),v(n[1]/f)],t="zyx",x=[(G[0]+c[0])/2,(G[1]+c[1])/2,(G[2]+c[2])/2],C=zl(w,[f,0,0],$,g,k,M)}return ee(H,C,x,g,p,O,e,r,K,t)}return sh},g._80o=function(Y,k,U){var b=this,L=b.shapeModel;if(L){var l=b.gv;jn(l),ih(l,b.data,L,b,b.getBodyColor(),U)}},g.createLineModel=function(E,o,C,q,t){for(var r=this,L=r.s,V=ch(E,o,L(yg)),p=[],D=0;D<V.length;D++){var y=V[D],w=y.length;if(w>1){var h=y[0];p.push(h.x,h.y,h.z);for(var M=1;w-1>M;M++)h=y[M],p.push(h.x,h.y,h.z),p.push(h.x,h.y,h.z);h=y[w-1],p.push(h.x,h.y,h.z)}}var x,O,n,U=L(q+".color"),d=L(t),J=0;return d&&(O=L(t+".color"),x=L(t+".pattern"),J=L(t+".offset"),n=U),sp(r.gv,r.data,p,O||U,n?R:L(q+".gradient.color"),C,x||L(q+".pattern"),J,n),V},g.createTubeModel=function(X,C,q,t){for(var F=this,s=F.s,V=s("shape3d.side")||yb,W=s("shape3d.start.angle"),$=s("shape3d.sweep.angle"),z=s(dj)?s("shape3d.top.cap"):R,b=s(Jl)?s("shape3d.bottom.cap"):R,g="flat"===z,S="flat"===b,B=g&&(t?t.uv:s("shape3d.top.image")),D=S&&(t?t.uv:s("shape3d.bottom.image")),Y=t?t.uv:s("shape3d.image"),w={vs:[],uv:Y?[]:R,top_vs:g?[]:R,top_uv:B?[]:R,bottom_vs:S?[]:R,bottom_uv:D?[]:R},O=ch(X,C,s(yg),q),m=0,A=O.length;A>m;m++)Wm(w,O[m],s(rr),q,V,W,$,z,b);if(t){var h=[];ki(F.gv,F.data,w,F,F.getBodyColor(),[],t,h),h.length&&(Oj(t.vs,h),Oj(t.ns,fn(h)))}else F.shapeModel=w;return O},g.getCache=function(){var L=this.info;if(L){var t=L.list;if(t){var V=L.cache;return V||(V=L.cache=Gi(t)),V}}return R}}});var Vn=function(n,e){for(var c,b=0,$=n.length,r=0,p=$-1;p>=r;)if(b=X(r+(p-r)/2),c=n[b].length-e,0>c)r=b+1;else{if(!(c>0)){p=b;break}p=b-1}b=p;var L=n[b],t=L.point;return b===$-1||L.length===e||(t=(new Fh).subVectors(n[b+1].point,t).normalize().multiplyScalar(e-L.length).add(t)),{point:t,tangent:L.tangent}},Gi=function(X){for(var y,p,t=[],I=0,g=0;g<X.length;g++){for(var c=X[g],R=0;R<c.length;R++){y=c[R],p&&(I+=p.distanceTo(y));var l=new Fh,N=c[R+1];N?l.subVectors(N,y):p?l.subVectors(y,p):l.x=1,l.normalize(),t.push({point:y,length:I,tangent:l}),p=y}p=null}return t},ch=function(F,N,i,A){i=i||Qj;for(var k=[],y=0,r=F.size();r>y;y++){var s=F.get(y);k.push(new Fh(s.x,s.e||0,s.y))}N&&(Af(N)&&(N=N._as),N.length||(N=null));for(var Y,C,H,t,v,l=[],T=0,V=0,I=N?N.length:r;I>V;V++)if(v=N?N[V]:0===V?1:2,1===v)l.push(H=[]),H.push(k[T++]);else if(2===v||5===v)if(t=2===v?k[T++]:H[0],A){var o=N?N[V+1]:I>V+1?2:R;if(2===o||5===o){var P=H[H.length-1],D=2===o?k[T]:H[0],S=(new Fh).subVectors(P,t),d=(new Fh).subVectors(D,t),U=S.length(),X=d.length();if(U&&X)if(A>U/2&&A>X/2)H.push(t);else for(S.multiplyScalar(f(A,U/2)/U).add(t),d.multiplyScalar(f(A,X/2)/X).add(t),Y=new Bl(S,t,d).getPoints(i),C=0;i>=C;C++)H.push(Y[C])}else H.push(t)}else H.push(t);else if(3===v)for(Y=new Bl(H[H.length-1],k[T++],k[T++]).getPoints(i),C=1;i>=C;C++)H.push(Y[C]);else if(4===v)for(Y=new Fl(H[H.length-1],k[T++],k[T++],k[T++]).getPoints(i),C=1;i>=C;C++)H.push(Y[C]);return l},hs=function(e){for(var b,O,T=new Fh,o=[],w=[],G=[],j=0,D=e.length;D>j;j++)b=e[j],O=e[j+1],O?T.subVectors(O,b):T.subVectors(b,e[j-1]),o.push(T.normalize().clone());var H,v,x,I,z=new Fh,W=new Fh,E=new fp,c=1e-4,k=Number.MAX_VALUE,N=o[0],S=w[0]=new Fh,i=G[0]=new Fh;for(v=K(N.x),x=K(N.y),I=K(N.z),k>=v&&(k=v,z.set(1,0,0)),k>=x&&(k=x,z.set(0,1,0)),k>=I&&z.set(0,0,1),W.crossVectors(N,z).normalize(),S.crossVectors(N,W),i.crossVectors(N,S),j=1;D>j;j++)w[j]=w[j-1].clone(),G[j]=G[j-1].clone(),W.crossVectors(o[j-1],o[j]),W.length()>c&&(W.normalize(),H=u(zs(o[j-1].dot(o[j]),-1,1)),w[j].applyMatrix4(E.makeRotationAxis(W,H))),G[j].crossVectors(o[j],w[j]);return{B:G,T:o,N:w}},Wm=function(){var y=function(u){for(var H=1;H<arguments.length;H++){var O=arguments[H];u.push(O.x,O.y,O.z)}},G=function($){for(var d=1;d<arguments.length;d++){var g=arguments[d].uv;$.push(g[0],g[1])}},A=function(t,J,S,U,q){var e=-U*D(q),k=U*w(q);return new Fh(t.x+e*S.x+k*J.x,t.y+e*S.y+k*J.y,t.z+e*S.z+k*J.z)},d=function(O,$,C,D,P,b,o,n){o=o||m;for(var l=[],s=o/P,y=0;P>=y;y++){var T=A(O,$,C,D,y*s+b);l.push(T),n!=R&&(T.uv=[n,y/P])}return l},M=function(C,i,T,O,Y,Z,d,x,s){s=s||m;var $=i?C.top_vs:C.bottom_vs;if($)for(var e=i?C.top_uv:C.bottom_uv,M=s/d,F=0;d>F;F++){var v,j;i?(v=F*M+x,j=(F+1)*M+x):(j=F*M+x,v=(F+1)*M+x),y($,A(T,O,Y,Z,v),A(T,O,Y,Z,j),T),e&&e.push(.5-.5*D(v),.5-.5*w(v),.5-.5*D(j),.5-.5*w(j),.5,.5)}};return function(V,z,T,t,H,q,B,n,Y){var v=z.length;if(v>1){var X,Q,J,m,D,l,g,b=hs(z),_=b.T,E=b.N,f=b.B;"flat"===n&&M(V,!0,z[0],f[0],E[0],t,H,q,B),"flat"===Y&&M(V,!1,z[v-1],f[v-1],E[v-1],t,H,q,B);var W,N,P=[],L=S(H/2),K="round"===n,c="round"===Y,h=z[0],i=_[0],$=f[0],u=E[0],I=z[v-1],x=_[v-1],k=f[v-1],o=E[v-1];if(K){for(J=1;L>=J;J++)E.splice(0,0,u),f.splice(0,0,$),_.splice(0,0,i),N=-J/L*t,z.splice(0,0,i.clone().multiplyScalar(N).add(h)),P[L-J]=C(t*t-N*N);v+=L}if(c){for(J=1;L>=J;J++)E.push(o),f.push(k),_.push(x),N=J/L*t,z.push(x.clone().multiplyScalar(N).add(I)),P[z.length-1]=C(t*t-N*N);v+=L}if(V.uv){var a=0,A=0,U=[];for(T&&(a=T),D=z[0],U[0]=0,J=1;v>J;J++)m=z[J],U[J]=D.distanceTo(m),D=m,T||(a+=U[J]);for(W=[],J=0;v>J;J++)A+=U[J],W[J]=a?A/a:0}for(J=0;v>J;J++){if(m=z[J],l=f[J],g=E[J],X=d(m,l,g,P[J]===j?t:P[J],H,q,B,W?W[J]:R),Q)for(var e=0;H>e;e++){var F=Q[e],O=Q[e+1]||Q[0],p=X[e],s=X[e+1]||X[0];y(V.vs,O,F,p,p,s,O),V.uv&&G(V.uv,O,F,p,p,s,O)}Q=X}}}}();wg(d,{getLineLength:function(k){return k[k.length-1].length},getLineOffset:function(x,v){return Vn(x,v)},getLineCacheInfo:function(Z,s,y,E){return Gi(ch(Z,s,y,E))}});var al={},vk=new ArrayBuffer(0),On=al.Buffer=function(A,F,Q,y){this.gl=A,this.buffer=A.createBuffer(),this.type=F||A.ARRAY_BUFFER,this.drawType=y||A.STATIC_DRAW,this.data=vk,Q&&this.upload(Q)};On.prototype.upload=function(u,k,O){O||this.bind();var Z=this.gl;u=u||this.data,k=k||0,this.data.byteLength>=u.byteLength?Z.bufferSubData(this.type,k,u):Z.bufferData(this.type,u,this.drawType),this.data=u},On.prototype.bind=function(){var x=this.gl;x.bindBuffer(this.type,this.buffer)},On.createVertexBuffer=function(I,F,p){return new On(I,I.ARRAY_BUFFER,F,p)},On.createIndexBuffer=function(S,G,T){return new On(S,S.ELEMENT_ARRAY_BUFFER,G,T)},On.create=function(f,Q,Y,u){return new On(f,Q,u)},On.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var $o=al.Shader=function(S,H,U){this.gl=S,this.program=fs(S,H,U),this.attributes=Pp(S,this.program);var D=Dk(S,this.program);this.uniforms=Ar(S,D)};$o.prototype.bind=function(){this.gl.useProgram(this.program)},$o.prototype.destroy=function(){this.gl};var fs=function(b,F,x){var C=xq(b,b.VERTEX_SHADER,F),E=xq(b,b.FRAGMENT_SHADER,x);b.getShaderParameter(E,b.COMPILE_STATUS)||console.error(b.getError());var Y=b.createProgram();return b.attachShader(Y,C),b.attachShader(Y,E),b.linkProgram(Y),b.getProgramParameter(Y,b.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",b.getProgramParameter(Y,b.VALIDATE_STATUS)),console.error("gl.getError()",b.getError()),""!==b.getProgramInfoLog(Y)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",b.getProgramInfoLog(Y)),b.deleteProgram(Y),Y=null),b.deleteShader(C),b.deleteShader(E),Y},xq=function(M,A,$){var s=M.createShader(A);return M.shaderSource(s,$),M.compileShader(s),M.getShaderParameter(s,M.COMPILE_STATUS)?s:(console.log(M.getShaderInfoLog(s)),null)},Dk=function(N,q){for(var a={},n=N.getProgramParameter(q,N.ACTIVE_UNIFORMS),g=0;n>g;g++){var $=N.getActiveUniform(q,g),A=$.name.replace(/\[.*?\]/,""),l=or(N,$.type);a[A]={type:l,size:$.size,location:N.getUniformLocation(q,A),value:$e(l,$.size)}}return a},Pp=function(d,z){for(var Y={},Z=d.getProgramParameter(z,d.ACTIVE_ATTRIBUTES),C=0;Z>C;C++){var P=d.getActiveAttrib(z,C),K=or(d,P.type);Y[P.name]={type:K,size:Ej(K),gl:d,location:d.getAttribLocation(z,P.name),pointer:de}}return Y},de=function($,D,U,n,o){var E=this.gl;E.enableVertexAttribArray(this.location),E.bindBuffer($.type,$.buffer),E.vertexAttribPointer(this.location,this.size,D||E.FLOAT,U||!1,n||0,o||0)},Ej=function(S){return Fq[S]},Fq={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},or=function(m,k){if(!sj){var Y=G.keys(Zf);sj={};for(var K=0;K<Y.length;++K){var _=Y[K];sj[m[_]]=Zf[_]}}return sj[k]},sj=null,Zf={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},$e=function(y,t){switch(y){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return lm(2*t);case"bvec3":return lm(3*t);case"bvec4":return lm(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},lm=function(V){for(var i=new Array(V),j=0;j<i.length;j++)i[j]=!1;return i},Ar=function(V,a){var n={data:{}};n.gl=V;for(var Q=G.keys(a),v=0;v<Q.length;v++){var w=Q[v],d=w.split("."),g=d[d.length-1],J=Lm(d,n),H=a[w];J.data[g]=H,J.gl=V,G.defineProperty(J,g,{get:im(g),set:nf(g,H)})}return n},im=function(c){var Q=yh.replace("%%",c);return new Function(Q)},nf=function(k,r){var b,C=If.replace(/%%/g,k);return b=1===r.size?Nj[r.type]:Gf[r.type],b&&(C+="\nthis.gl."+b+";"),new Function("value",C)
},Lm=function(L,q){for(var p=q,M=0;M<L.length-1;M++){var o=p[L[M]]||{data:{}};p[L[M]]=o,p=o}return p},yh=["return this.data.%%.value;"].join("\n"),If=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Nj={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},Gf={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},nc=q.Light=function(){Id(nc,this),this.s(uq,c[uq]),this.s(jk,"sphere"),this.s3(20,20,20)};pm("Light",Pc,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(Q,u,d){nc.superClass.onStyleChanged.apply(this,arguments),Q===uq&&this.s("shape3d.color",d)}});var Gh=no.Graph3dView=function(n,g){var V=this;V._attributes=g||d.graph3dViewAttributes,V._25I={},V._view=jj(1,V);var r=V._canvas=oe(V._view);r.addEventListener("webglcontextlost",function(H){H.preventDefault(),Tj(V),V._26I&&V._doBufferGC(V._26I,!0),V._26I=R,V._1o.texture=R,V._35O=!0},y),r.addEventListener("webglcontextrestored",function(){V._35O=!1,V.iv()},y),V._batchIndexMap={},V._batchModelMap={},V._wireframeIndexMap={},V._wireframeModelMap={},V._wireframeIndexMapSwap={},V._wireframeModelMapSwap={},V._polylineIndexMap={},V._polylineIndexMap={},V._polylineIndexMapSwap={},V._polylineIndexMapSwap={},V._8O=[],V._7O=bj(),V._6O=bj(),V._1o=new co(V),V._30O=new Wo(V),V._31O=new Xn(V),V._32O=new Ke(V),V._raycaster=new op(V),V._highlightHelper=new Tn(V),V._postProcessing=new Se(V),V.vr=new Qr(V),V._33Q=!0,V._eye=Pb(d.graph3dViewEye),V._center=Pb(d.graph3dViewCenter),V._up=Pb(d.graph3dViewUp),V._lightChanged=!1,V._59O=[],V._spots=[],V._dirs=[],V._frameId=0,V.overlappingBox=new ur(V),V.dm(n?n:new _c),V._coreInteractor=new sb(this),V.setInteractors([new jr(V)])},Gl={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1},Rn=0;Jj("Graph3dView",G,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",Vo,ap,"firstPersonMode",Xd,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",wc,on,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:d.graph3dViewEditHelperDisabled,_devicePixelRatio:j,_boundaries:j,_moveStep:d.graph3dViewMoveStep,_rotateStep:d.graph3dViewRotateStep,_pannable:d.graph3dViewPannable,_rotatable:d.graph3dViewRotatable,_walkable:d.graph3dViewWalkable,_resettable:d.graph3dViewResettable,_zoomable:d.graph3dViewZoomable,_firstPersonMode:d.graph3dViewFirstPersonMode,_mouseRoamable:d.graph3dViewMouseRoamable,_gridVisible:d.graph3dViewGridVisible,_gridSize:d.graph3dViewGridSize,_gridGap:d.graph3dViewGridGap,_gridColor:d.graph3dViewGridColor,_originAxisVisible:d.graph3dViewOriginAxisVisible,_centerAxisVisible:d.graph3dViewCenterAxisVisible,_axisXColor:d.graph3dViewAxisXColor,_axisYColor:d.graph3dViewAxisYColor,_axisZColor:d.graph3dViewAxisZColor,_ortho:d.graph3dViewOrtho,_orthoWidth:d.graph3dViewOrthoWidth,_fovy:d.graph3dViewFovy,_near:d.graph3dViewNear,_far:d.graph3dViewFar,_headlightColor:d.graph3dViewHeadlightColor,_headlightIntensity:d.graph3dViewHeadlightIntensity,_headlightRange:d.graph3dViewHeadlightRange,_headlightDisabled:d.graph3dViewHeadlightDisabled,_rectSelectable:d.graph3dViewRectSelectable,_rectSelectBackground:d.graph3dViewRectSelectBackground,_editSizeColor:d.graph3dViewEditSizeColor,_autoMakeVisible:rn,_fogDisabled:d.graph3dViewFogDisabled,_fogColor:d.graph3dViewFogColor,_fogNear:d.graph3dViewFogNear,_fogFar:d.graph3dViewFogFar,_dashDisabled:d.graph3dViewDashDisabled,_batchColorDisabled:d.graph3dViewBatchColorDisabled,_batchBlendDisabled:d.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:d.graph3dViewBatchBrightnessDisabled,setEye:function(o,V,N){1===arguments.length&&(V=o[1],N=o[2],o=o[0]);var J=this._eye;J[0]=o,J[1]=V,J[2]=N,this.fp(wc,R,J)},setCenter:function(N,g,A){1===arguments.length&&(g=N[1],A=N[2],N=N[0]);var s=this._center;s[0]=N,s[1]=g,s[2]=A,this.fp(on,R,s)},setUp:function(u,z,D){1===arguments.length&&(z=u[1],D=u[2],u=u[0]);var p=this._up;p[0]=u,p[1]=z,p[2]=D,this.fp("up",R,p)},getDevicePixelRatio:function(){return this._devicePixelRatio||xs},isTransparentMask:function(l){return l.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var a=this,$=a._aspect;return $?$:($=a.getWidth()/a.getHeight(),$||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(X){var f=this,k=f._dataModel,K=f._selectionModel;k!==X&&(k&&(k.ump(f.handleDataModelPropertyChange,f),k.umm(f.handleDataModelChange,f),k.umd(f.handleDataPropertyChange,f),K||k.sm().ums(f.handleSelectionChange,f)),f._dataModel=X,X.mp(f.handleDataModelPropertyChange,f),X.mm(f.handleDataModelChange,f),X.md(f.handleDataPropertyChange,f),K?K._21I(X):X.sm().ms(f.handleSelectionChange,f),f._postProcessing.handleDataModleChange(k,X),f.invalidateAll(!0),f.invalidateLight(),f.fp(Xp,k,X),f._canvas.style.background=X.getBackground()||"")},handleDataModelPropertyChange:function(w){if("background"===w.property){var Y=this._canvas.style.background,S=w.newValue||"";this._canvas.style.background=S,this.fp("canvasBackground",Y,S)}else"envmap"===w.property&&this.iv()},handleDataPropertyChange:function(T){var z=T.data;this.invalidateData(z),oj(z)&&"s:light.type"===T.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(i){var Z=this,$=i.property;Z.iv(),Z._18Q=R,"eye"===$?Z._33Q=!0:"devicePixelRatio"===$?Z._42(R,Z.getDevicePixelRatio()):Gl[$]&&Tj(Z)},_5O:function(j){var D=j._22Q();return D?new D(this,j):R},getData3dUI:function(d){var a=this._25I[d._id];return a===j&&(a=this._5O(d),this._25I[d._id]=a),a},invalidateAll:function(d){var o=this;if(d){for(var V in o._25I){var M=o._25I[V];M&&M.dispose()}o._25I={},o.iv(),Wj(o)}else Wj(o),o.dm().each(function(Q){o.invalidateData(Q)})},invalidateSelection:function(){var B=this;B.sm().each(function(G){B.invalidateData(G)})},invalidateData:function(I){var c=this,F=c.getData3dUI(I);F&&(F.iv(),c.iv()),Wj(c,I)},getShape3dText:function(o){return o.getStyle("shape3d.text")||this.getLabel(o)},invalidateBatch:function(F){var o=this,w=o._batchModelMap,c=w[F],$=[],J={};if(c){c.ds.forEach(function(d){var C=o.getData3dUI(d);C&&C.iv(),delete o._batchIndexMap[d._id],$.push(d._id)}),delete w[F];for(var x,v,Q,s,X,Y,b,L,C,g=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],_=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],N=0;N<g.length;N++){var E=o[g[N]],e=o[_[N]];for(J={},L=0;L<$.length;L++){var A=e[$[L]];if(A){delete e[$[L]],C=A.batch,x=E[C];var M=A.begin,V=A.size,p=3*M,t=3*V,u=4*M,D=4*V;for(v=x.ds,Q=x.vs,s=x.cs,X=x.ps,Y=x.ls,b=A.index,x.invalidate=!0,v[b]=j,b=p;p+t>b;b++)Q[b]=j;for(b=u;u+D>b;b++)s[b]=j;for(b=u;u+D>b;b++)X[b]=j;if(Y)for(b=p;p+t>b;b++)Y[b]=j;J[C]=!0}}for(C in J){x=E[C],v=x.ds,Q=x.vs,s=x.cs,X=x.ps,Y=x.ls;var O=[];for(b=0;b<v.length;b++)v[b]!==j&&O.push(v[b]);if(0===O.length)delete E[C];else{for(x.ds=O,O=[],b=0;b<Q.length;b++)Q[b]!==j&&O.push(Q[b]);for(x.vs=O,O=[],b=0;b<s.length;b++)s[b]!==j&&O.push(s[b]);for(x.cs=O,O=[],b=0;b<X.length;b++)X[b]!==j&&O.push(X[b]);if(x.ps=O,Y){for(O=[],b=0;b<Y.length;b++)Y[b]!==j&&O.push(Y[b]);x.ls=O}}}}o.iv()}},handleDataModelChange:function(M){var c=this,s=M.kind,Q=M.data;if("add"===s)c.invalidateData(Q),mm(Q)&&Q.getEdgeGroup()&&Q.getEdgeGroup().eachSiblingEdge(c.invalidateData,c),oj(Q)&&c.invalidateLight();else if(s===Mg){var S=Q._id,K=c._25I[S];K&&(K.dispose(),delete c._25I[S],c.iv()),Q===c._currentSubGraph&&c.setCurrentSubGraph(R),Wj(c,Q),oj(Q)&&c.invalidateLight()}else s===Oq&&(c.invalidateAll(!0),c.setCurrentSubGraph(R),Wj(c),c.invalidateLight())},toCanvas:function(h,K,k){var Q=this,t=Q.getGL();if(Q.validate(),h){var y=t.getParameter(t.COLOR_CLEAR_VALUE);yi(t,h)}Q._42(R,1);var s=Q.getWidth(),v=Q.getHeight(),L=new Uint8Array(4*s*v),j=oe(),M=j.getContext("2d");t.readPixels(0,0,s,v,t.RGBA,t.UNSIGNED_BYTE,L),ul(j,s,v,1);for(var N=M.getImageData(0,0,s,v),B=N.data,u=0;u<B.length;u+=4){var E=u/4,z=X(E/s),S=E-z*s;E=4*((v-1-z)*s+S),B[E]=L[u],B[E+1]=L[u+1],B[E+2]=L[u+2],B[E+3]=L[u+3]}if(M.putImageData(N,0,0),h&&yi(t,y),Q._42(R,Q.getDevicePixelRatio()),K&&k){var I=oe(),w=I.getContext("2d");return K=K,k=k,ul(I,K,k,1),d.drawImage(w,j,0,0,K,k),I}return j},toDataURL:function(g,Z){var o=this,d=o.getGL();if(o.validate(),g){var X=d.getParameter(d.COLOR_CLEAR_VALUE);yi(d,g)}o._42(R,1);var e=o._canvas.toDataURL(Z||"image/png",1);return g&&yi(d,X),o._42(R,o.getDevicePixelRatio()),e},getGL:function(){var K=this,T=K._26I;if(K._prg,!T)try{K._2O={},T=K._26I=K._canvas.getContext("webgl",K._attributes)||K._canvas.getContext("experimental-webgl",K._attributes),T._emptyTexture=bo(T),T._emptyBlendTexture=bo(T),T._bufPool={},T._id=++Rn,K._buffer={vs:fl(T),ns:fl(T),is:fl(T),uv:fl(T),batchColor:fl(T),batchBlend:fl(T),batchBrightness:fl(T),lineDistance:fl(T)},K._1O=bh(T);var j=K._cube={vs:fl(T),ns:fl(T),is:fl(T),uv:fl(T)};gk(T,j.vs,om),gk(T,j.ns,oo),gk(T,j.uv,Lf),yk(T,j.is,mg)}catch(W){}return K.acquireProgram(),T},acquireProgram:function(){var l=this,i=l._26I;if(i){var d=q.Default.getImage(l.dm().getEnvmap())?!0:!1,A=l._prg&&l._prg.envMapFlag?!0:!1;if(!l._prg||d!==A){var G=l._prg=i.createProgram();if(!G)return R;G.envMapFlag=d;var k=l._dirs.length,C=l._spots.length,O=l._59O.length,I=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];k&&I.push("uDirColor","uDirDirection"),C&&I.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),O&&I.push("uPointColor","uPointRange","uPointPosition"),yi(i,[0,0,0,0]),i.clearDepth(1),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),tg||(tb=Oh(tb.substring(0,tb.indexOf("^#"))),mf=Oh(mf),tg=!0);var S=["#define MAX_DIR "+k,"#define MAX_SPOT "+C,"#define MAX_POINT "+O,l._fogDisabled?"":"#define FOG",l._dashDisabled?"":"#define DASH",d?"#define USE_ENVMAP":"",l._batchColorDisabled?"":"#define BATCHCOLOR",l._batchBlendDisabled?"":"#define BATCHBLEND",l._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),n=mq(i,G,i.VERTEX_SHADER,tb.replace("PREFIX",S));i.getShaderParameter(n,i.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",i.getShaderInfoLog(n));var m=mq(i,G,i.FRAGMENT_SHADER,mf.replace("PREFIX",S));i.getShaderParameter(m,i.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",i.getShaderInfoLog(m)),_?I.push("aPosition"):(G.aPosition=0,i.bindAttribLocation(G,0,"aPosition")),i.linkProgram(G),I.forEach(function(j){G[j]=/^u/.test(j)?i.getUniformLocation(G,j):i.getAttribLocation(G,j)}),i.useProgram(G),i.deleteShader(n),i.deleteShader(m)}}},getBrightness:function(h){var y=h.s("brightness"),E=this.isSelected(h)?h.s("select.brightness"):R;return y==R?E:E==R?y:y*E},bindEnvMap:function(I){var U=this,y=U._prg,t=5,K=U.dm().getEnvmap(),B=q.Default.getImage(K);if(B){if(K!==U._lastEnvMap){U._envMapTexture&&I.deleteTexture(U._envMapTexture);var E=U._envMapTexture=I.createTexture();I.bindTexture(I.TEXTURE_CUBE_MAP,E),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,B),I.bindTexture(I.TEXTURE_CUBE_MAP,null),U._lastEnvMap=K}I.activeTexture(I.TEXTURE0+t),I.bindTexture(I.TEXTURE_CUBE_MAP,U._envMapTexture),I.uniform1i(y.uEnvMap,t)}},getWireframe:function(h){var c=h.s("wf.visible"),R=h.s("wf.width");return c===!0||R>0&&"selected"===c&&this.isSelected(h)?{color:h.s("wf.color"),width:R,"short":h.s("wf.short"),mat:h.s("wf.mat")}:void 0},_transformPointToViewSpace:function(T){var h=[T[0],T[1],T[2]];return up(h,this._viewMatrix),h},_transformDirectionToViewSpace:function(r,l){var N=[r[0],r[1],r[2]];up(N,this._viewMatrix);var g=l?[l[0],l[1],l[2]]:[0,0,0];up(g,this._viewMatrix);var m=g[0]-N[0],E=g[1]-N[1],v=g[2]-N[2],n=Math.sqrt(m*m+E*E+v*v);return n?[m/n,E/n,v/n]:[m,E,v]},getWireframeGeometry:function($){return $.s("wf.geometry")?{color:$.s("wf.color"),width:$.s("wf.width"),mat:$.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(m){return m.s("body.color")},getMat:function(I){return I.getMat?I.getMat():I.s("mat")},getFaceMat:function(U,Q){return U.getFaceMat?U.getFaceMat(Q):U.s(Q+".mat")},getFaceBlend:function(L,J){return L.s(J+".blend")||L.s("all.blend")},getFaceColor:function(p,n){return p.s(n+".color")||p.s("all.color")},getFaceImage:function(U,w){return U.s(w+".image")||U.s("all.image")},getFaceBlendImage:function(W,m){return W.s(m+".blend.image")||W.s("all.blend.image")},getFaceDiscardSelectable:function(z,f){var F=z.s(f+".discard.selectable");return F==R?z.s("all.discard.selectable"):F},getFaceUv:function(V,z){return V.s(z+".uv")||V.s("all.uv")},getFaceUvOffset:function(h,G){return h.s(G+".uv.offset")||h.s("all.uv.offset")},getFaceUvScale:function(p,K){return p.s(K+".uv.scale")||p.s("all.uv.scale")},getFaceLight:function(F,s){var j=F.s(s+".light");return j==R?F.s("all.light"):j},getFaceVisible:function(G,C){var k=G.s(C+".visible");return k==R?G.s("all.visible"):k},getFaceOpacity:function(Y,U){var c=Y.s(U+".opacity");return c==R?Y.s("all.opacity"):c},getFaceTransparent:function(_,W){var e=_.s(W+".transparent");return e==R?_.s("all.transparent"):e},getFaceReverseColor:function(t,o){return t.s(o+".reverse.color")||t.s("all.reverse.color")},getFaceReverseFlip:function(M,p){var s=M.s(p+".reverse.flip");return s==R?M.s("all.reverse.flip"):s},getFaceReverseCull:function(y,U){var a=y.s(U+".reverse.cull");return a==R?y.s("all.reverse.cull"):a},getTextureMap:function(){return this._2O},deleteTexture:function(J){var j=this,b=j._2O[J];b&&(delete j._2O[J],j.getGL().deleteTexture(b))},invalidateShape3dCachedImage:function(C){var H=this.getData3dUI(C);H.invalidateCachedTexture(this.getGL())},isInteractive:function(K){return K.s("interactive")},getTexture:function(F,s){if(!F)return R;var a=this,Y=a.getGL(),D=a._2O[F];if(!D){var j=ed(F);if(j)if(j.tagName){if(j.dynamic)return bh(Y,j,a._1O);D=a._2O[F]=bh(Y,j)}else{var y,m=s&&s.s("shape3d.image.cache")&&!a.isInteractive(s),t=a.vr.isPresenting();t&&(s._textureUpdateFrame===Y._renderInfo.frame?m=!0:s._textureUpdateFrame=Y._renderInfo.frame),m&&(y=a.getData3dUI(s),D=y.getCachedTexture());var S;if(!D){var d=s&&s.s("shape3d.fixSizeOnScreen"),p=d?Y.NEAREST:Y.LINEAR;d||s&&s.s("shape3d.vector.dynamic")&&(y||(y=a.getData3dUI(s)),d=y.getVectorDynamicSize(),d&&(S=a.getDevicePixelRatio(),d[0]*=S,d[1]*=S));var M,B,J=s&&s.s("shape3d.texture.scale")||1;if(d?(S||(S=a.getDevicePixelRatio()),M=d[0]>0?d[0]:J*se(j,s)*S,B=d[1]>0?d[1]:J*Qo(j,s)*S):(M=J*se(j,s),B=J*Qo(j,s)),M>=1&&B>=1){var $=xn(M,B);if(!y&&s&&(y=a.getData3dUI(s)),y&&y.interactiveInfo){var E=y.interactiveInfo[F]={};$.interactiveInfo=E.bodyInfo={compInfos:[],matrix:new Hq,rect:{x:0,y:0,width:M,height:B}}}gf($,j,0,0,M,B,s,a),$.interactiveInfo&&($.interactiveInfo=null),$.restore(),(m||t)&&gb(j,s)?(D=bh(Y,Fj,null,p),y.setCachedTexture(D),Fj=null):D=bh(Y,Fj,a._1O,p)}}}}return D},redraw:function(){this.iv()},validateImpl:function(){var Y=this;if(Y._lightChanged){Y._lightChanged=!1;var $=[],B=[],p=[];Y.dm().each(function(Y){if(oj(Y)){var w=Y.s("light.type");w===Hi?$.push(Y):w===Tl?B.push(Y):w===rk&&p.push(Y)}}),($.length!==Y._59O.length||B.length!==Y._spots.length||p.length!==Y._dirs.length)&&Tj(Y),Y._59O=$,Y._spots=B,Y._dirs=p}Y._42(),Y._1o.iv()},getRenderInfo:function(){var C=this.getGL();return C?C._renderInfo:void 0},showDebugTip:function(){var U=this,D=U._debugDiv;if(!D){D=U._debugDiv=k.createElement("div"),D.style.position="absolute",D.style.overflow="hidden",D.style.backgroundColor="white",D.style.color="black";var r=U.getView();U._79O?r.insertBefore(D,U._79O):r.appendChild(D),U._debugTipTimerId=setInterval(function(){var j=U.getRenderInfo();if(j){var V=U.getGL()._validBufCount||0,I="Draw Calls: "+j.calls+"<br/>"+"Vertices: "+j.vertices+"<br/>"+"Faces: "+j.faces+"<br/>"+"Lines: "+j.lines+"<br/>"+"Buffer Count: "+V;U.vr.isPresenting()&&(I+="<br/>VR fps: "+U.vr.getFps()),D.innerHTML=I}},10)}},hideDebugTip:function(){var B=this,o=B._debugDiv;o&&(delete B._debugDiv,cancelAnimationFrame(B._debugTipTimerId),delete B._debugTipTimerId,B.getView().removeChild(o))},_42:function(h,I){var d=this;if(!d._35O&&(!dh||kl(dh))){var v,N;h&&(h instanceof Pc?N=h:v=h);var X=d._canvas,P=d.getGL(),r=d._prg;if(P){var p=d.getWidth(),j=d.getHeight();I?h||ul(X,p,j,I):(I=d.getDevicePixelRatio(),h||p===X.clientWidth&&j===X.clientHeight||ul(X,p,j,I)),P.clear(P.COLOR_BUFFER_BIT),P._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:h?d._frameId:++d._frameId};var e=function(){if(d.overlappingBox.clear(),d._81O=R,P.clear(P.DEPTH_BUFFER_BIT),Xi(P,r.uBrightness,1),Xi(P,r.uOpacity,1),Xi(P,r.uPartOpacity,1),P._picking=!!h,Xi(P,r.uPick,!!h),Xi(P,r.uTexture,!1),Xi(P,r.uBlendTexture,!1),Xi(P,r.uAlphaTest,c.alphaTest),Xi(P,r.uTransparent,!1),Xi(P,r.uFix,!1),Xi(P,r.uBatchColor,!1),Xi(P,r.uBatchBlend,!1),Xi(P,r.uBatchBrightness,!1),Xi(P,r.uReflectivity,d._envmapReflectivity||.5),Xi(P,r.uCameraPosition,d.getEye()),Xi(P,r.uPMatrix,d._projectMatrix=bi(d)),Xi(P,r.uViewMatrix,aj(d,d._7O)),d.bindEnvMap(P),d._viewMatrix=Mk(d._7O),h||(ec(d,P,r),d._fogDisabled||(Xi(P,r.uFogColor,d._fogColor),Xi(P,r.uFogNear,d._fogNear),Xi(P,r.uFogFar,d._fogFar))),lp(P,r.aPosition),lp(P,r.aNormal),Me(P,r.aUv),Me(P,r.aBatchColor),Me(P,r.aBatchBlend),Me(P,r.aBatchBrightness),Me(P,r.aLineDistance),N){var U=P.getParameter(P.COLOR_CLEAR_VALUE);P.clearColor(0,0,0,0),P.disable(P.BLEND),Me(P,r.aNormal),gk(P,d._cube.vs,R,r.aPosition),yk(P,d._cube.is),xl(N,d,Xf,0),xl(N,d,Vb,6),xl(N,d,pp,12),xl(N,d,Lo,18),xl(N,d,Cd,24),xl(N,d,bn,30),lp(P,r.aNormal),yi(P,U)}else if(v){v.value=2;var U=P.getParameter(P.COLOR_CLEAR_VALUE);P.clearColor(0,0,0,0),P.disable(P.BLEND),d._95I(P,r,v),bc(d,v),aq(d,d._polylineModelMap,v),aq(d,d._wireframeModelMap,v),Xi(P,r.uTransparent,!0),d._95I(P,r,v,!0),bc(d,v,!0),aq(d,d._polylineModelMap,v,!0),aq(d,d._wireframeModelMap,v,!0),Xi(P,r.uTransparent,!1),P.clear(P.DEPTH_BUFFER_BIT),d._swapLineMap(),d._95I(P,r,v,!1,!0),aq(d,d._polylineModelMap,v),aq(d,d._wireframeModelMap,v),d._swapLineMap(),d._swapLineMap(),d._95I(P,r,v,!1,!0),aq(d,d._polylineModelMap,v),aq(d,d._wireframeModelMap,v),Xi(P,r.uTransparent,!0),d._95I(P,r,v,!0,!0),aq(d,d._polylineModelMap,v,!0),aq(d,d._wireframeModelMap,v,!0),Xi(P,r.uTransparent,!1),d._swapLineMap(),P.disable(P.DEPTH_TEST),d.drawFilter||d._30O._42(P,r,v),P.enable(P.DEPTH_TEST),yi(P,U)}else P.disable(P.BLEND),d.drawSky(P,r),d._31O._42(P,r),d._95I(P,r),bc(d),aq(d,d._polylineModelMap),aq(d,d._wireframeModelMap),P.enable(P.BLEND),Xi(P,r.uTransparent,!0),P.depthMask(!1),d._95I(P,r,R,!0),bc(d,R,!0),aq(d,d._polylineModelMap,R,!0),aq(d,d._wireframeModelMap,R,!0),P.depthMask(!0),Xi(P,r.uTransparent,!1),P.clear(P.DEPTH_BUFFER_BIT),d._swapLineMap(),P.disable(P.BLEND),d._95I(P,r,R,!1,!0),aq(d,d._polylineModelMap),aq(d,d._wireframeModelMap),P.enable(P.BLEND),Xi(P,r.uTransparent,!0),P.depthMask(!1),d._95I(P,r,R,!0,!0),aq(d,d._polylineModelMap,R,!0),aq(d,d._wireframeModelMap,R,!0),P.depthMask(!0),Xi(P,r.uTransparent,!1),d._swapLineMap(),P.disable(P.DEPTH_TEST),P.disable(P.BLEND),d._32O._42(P,r),d._30O._42(P,r),d._highlightHelper._42(P,r),P.enable(P.DEPTH_TEST);gk(P,R),yk(P,R)},V=!1,S=p*I,K=j*I,U=d.vr;U.enable&&U._42(P,S,K,e)&&(V=!0);var G=d.envRenderer;G&&G.enable&&G._42(P,S,K,e)&&(V=!0);var D=d._postProcessing;D._42(P,S,K,e,h)&&(V=!0),V||(d.setViewport(P,0,0,p*I,j*I),e()),d._33Q=!1,d._doBufferGC(P)}}},enablePostProcessing:function(V,P){return this._postProcessing.enableModule(V,P)},getPostProcessingModule:function(o){return this._postProcessing.getModule(o)},setViewport:function(v,M,z,Q,X){this._viewport=[M,z,Q,X],v.viewport(M,z,Q,X)},getViewport:function(){return this._viewport},setBufferGCInterval:function(S){this._bufferGCInterval=S},_doBufferGC:function(D,n){var a,r,X=D._bufPool,u=0,B=0,R=D._renderInfo.frame,t=this._bufferGCInterval||10;for(a in X)u++,r=X[a],r&&(n||R-r._fid>t?(D.deleteBuffer(r._buf),r._buf=null,X[a]=null):B++);if(u/2>B&&u>128){var w={};for(a in X)X[a]&&(w[a]=X[a]);D._bufPool=w}D._validBufCount=B},_swapLineMap:function(){var w=this;H=w._polylineModelMap,w._polylineModelMap=w._polylineModelMapSwap,w._polylineModelMapSwap=H,H=w._wireframeModelMap,w._wireframeModelMap=w._wireframeModelMapSwap,w._wireframeModelMapSwap=H,H=w._polylineIndexMap,w._polylineIndexMap=w._polylineIndexMapSwap,w._polylineIndexMapSwap=H,H=w._wireframeIndexMap,w._wireframeIndexMap=w._wireframeIndexMapSwap,w._wireframeIndexMapSwap=H},_updateSkyBoxPosition:function(R){if(this._skyBox&&R&&"eye"===R.property){var P=R.newValue;this._skyBox.p3(P[0],P[1],P[2]),this.invalidateData(this._skyBox)}},setSkyBox:function(r){var w=this._skyBox;w&&this._skyBoxStyleMap&&(w.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null),this._skyBox=r,this.ump(this._updateSkyBoxPosition,this),r&&(r.dm()&&r.dm().remove(r),this._skyBoxStyleMap=q.Default.clone(r.getStyleMap()),r.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBoxPosition,this),this._updateSkyBoxPosition({property:"eye",newValue:this.getEye()})),this.fp("skyBox",w,r)},drawSky:function(u,y,l){var q=this,F=q._skyBox;if(F){var K=q._headlightIntensity,E=gr(q._headlightColor),y=q._prg;1!==K&&(E=[E[0]*K,E[1]*K,E[2]*K]),Xi(u,y.uHeadlightColor,[E[0],E[1],E[2],1]);var V=q.getData3dUI(F);V&&V._42(u,y,l,function(){return!0}),u.clear(u.DEPTH_BUFFER_BIT),Xi(u,y.uHeadlightColor,[E[0],E[1],E[2],q._headlightDisabled?1:0])}},_95I:function(x,j,C,O,b){function Y(p){if(!!p.s("shape3d.alwaysOnTop")==!!b&&s.isVisible(p)&&(!B||N)){if(!C&&s.isTransparentMask(p))return;var d=s.getData3dUI(p);d&&d._42(x,j,C,r)}}var s=this,r=function(I){return O?I:!I};s.sky&&x.clear(x.DEPTH_BUFFER_BIT);var n=s.drawFilter;n?s.dm().each(function(W){n(W)||Y(W)}):s.dm().each(function(F){Y(F)})},getLogicalPoint:function(M){return lg(M,this._canvas)},isRectOverlapping:function(E){var u=this.getData3dUI(E);return u._rectOverlapping},getHitFaceInfo:function(a){a.target&&(a=this.lp(a));var k=this.getDataInfoAt(a);if(k){var l=this._1o.face(k.data,yj(a.x,a.y));if(l)return{data:k.data,face:l}}return R},unproject:function(F,N){var S=this,T=S.getWidth(),n=S.getHeight(),K=F.target?S.lp(F):F,I=K.x-T/2,d=K.y-n/2,H=2*(I/T),v=2*(-1*d/n);N=N||0;var X=bj(),V=bi(S),P=aj(S);yd(X,V,P),We(X);var Y=Yo([H,v,N,1],X);return[Y[0]/Y[3],Y[1]/Y[3],Y[2]/Y[3]]},getDataAt:function(u){var S=this.getDataInfoAt(u);return S?S.data:R},getDataInfoAt:function(T,E){return T.target&&(T=this.lp(T)),this._1o.get(yj(T.x,T.y,E),!0)},getDatasInRect:function(p){return this._1o.get(p)},setEditable:function(R){var c=this,z=c._editable;c._editable=R,this.fp(Ac,z,R)},isEditable:function(P){var A=this;return A._editable?ei(P)?P.s("3d.editable")?A._editableFunc?A._editableFunc(P):!0:!1:!1:!1},isSelectable:function(S){return S.s("3d.selectable")&&this.sm().isSelectable(S)},isMovable:function(i){var P=this;return mm(i)&&i.getStyle(fo)!==Ue?!1:i.s("3d.movable")?P._movableFunc?P._movableFunc(i):!0:!1},isSizeEditable:function(c){return ei(c)?this._sizeEditableFunc?this._sizeEditableFunc(c):!0:!1},isRotationEditable:function(o){return ei(o)&&o.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(o):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(U){this.setZoom(Ji,U)},zoomOut:function(t){this.setZoom(1/Ji,t)},setZoom:function($,D){if(1!==$){var l=this;if(l._ortho)return l.setOrthoZoom($,D),void 0;l._14o&&l._14o.stop(!0);var P=1/$,B=l._eye,n=l._center,X=n[0]+(B[0]-n[0])*P-B[0],k=n[1]+(B[1]-n[1])*P-B[1],f=n[2]+(B[2]-n[2])*P-B[2];if(!(Yi(B,n)<l._moveStep&&1>P)){if(D=fq(D)){var G=Pb(B);return D.action=function(I){l.fi({kind:l._zooming?"betweenZoom":"beginZoom"}),l._zooming=1,B[0]=G[0]+X*I,B[1]=G[1]+k*I,B[2]=G[2]+f*I,l.fp(wc,R,B)},D._37o=function(){delete l._14o,delete l._zooming,l.fi({kind:"endZoom"}),l.onZoomEnded()},l._14o=Io(D)}B[0]+=X,B[1]+=k,B[2]+=f,l.fp(wc,R,B)}}},setOrthoZoom:function(B,j){if(1!==B){var A=this;A._14o&&A._14o.stop(!0);var X=A._orthoWidth,m=X/B-X;if(!(X<A._moveStep&&B>1))return(j=fq(j))?(j.action=function(l){A.fi({kind:A._zooming?"betweenZoom":"beginZoom"}),A._zooming=1,A.setOrthoWidth(X+m*l)},j._37o=function(){delete A._14o,delete A._zooming,A.fi({kind:"endZoom"}),A.onZoomEnded()},A._14o=Io(j)):(A.setOrthoWidth(X/B),void 0)}},getPositionInfo:function($){var q=this,d=q._eye,n=q._center,S=q.getAspect(),U=$?Hr(jf(n,d,!0),jf($,d)):Yi(d,n);if(q._ortho){var e=q._orthoWidth;return{length:U,height:e/S,width:e}}var s=2*g(q._fovy/2)*U;return{length:U,height:s,width:s*S}},getCenterInfo:function(){var B=this;return B._81O||(B._81O=B.getPositionInfo()),Pb(B._81O)},rotate:function(Z,g,I,x){var Q=this;if(Z||g){x==R&&(x=Q._firstPersonMode),Q._88O&&Q._88O.stop(!0);var V=Q._center,Y=Q._eye,c=Q.getCenterInfo().length,S=x?V:Y,W=x?Y:V,L=jf(S,W),E=i(L[0],L[2]),s=i(C(L[0]*L[0]+L[2]*L[2]),L[1]),m=x?on:wc;return x&&(g=-g),(I=fq(I))?(I.action=function(M){Q.fi({kind:Q._rotating?"betweenRotate":"beginRotate"}),Q._rotating=1;var h=E+Z*M,N=s+g*M;N=zd(N),L[0]=c*w(N)*w(h),L[1]=c*D(N),L[2]=c*w(N)*D(h),S[0]=W[0]+L[0],S[1]=W[1]+L[1],S[2]=W[2]+L[2],Q.fp(m,R,S)},I._37o=function(){delete Q._88O,delete Q._rotating,Q.fi({kind:"endRotate"}),Q.onRotateEnded()},Q._88O=Io(I)):(E+=Z,s+=g,s=zd(s),L[0]=c*w(s)*w(E),L[1]=c*D(s),L[2]=c*w(s)*D(E),S[0]=W[0]+L[0],S[1]=W[1]+L[1],S[2]=W[2]+L[2],Q.fp(m,R,S),void 0)}},pan:function(S,F,$,W){if(S||F){var T=this;W==R&&(W=T._firstPersonMode),T._89O&&T._89O.stop(!0);var l=aj(T),E=[l[0]*S,l[4]*S,l[8]*S],I=[l[1]*F,l[5]*F,l[9]*F],A=E[0]+I[0],b=E[1]+I[1],x=E[2]+I[2],a=T._center,L=T._eye;if(W){var O=cs(T.getBoundaries(),L[0],L[2],L[0]+A,L[2]+x,C(A*A+x*x));A=O[0],x=O[1]}if($=fq($)){var M=Pb(L),G=Pb(a);return $.action=function(U){T.fi({kind:T._panning?"betweenPan":"beginPan"}),T._panning=1,a[0]=G[0]+A*U,a[1]=G[1]+b*U,a[2]=G[2]+x*U,L[0]=M[0]+A*U,L[1]=M[1]+b*U,L[2]=M[2]+x*U,T.fp(wc,R,L),T.fp(on,R,a)},$._37o=function(){delete T._89O,delete T._panning,T.fi({kind:"endPan"}),T.onPanEnded()},T._89O=Io($)}a[0]+=A,a[1]+=b,a[2]+=x,L[0]+=A,L[1]+=b,L[2]+=x,T.fp(wc,R,L),T.fp(on,R,a)}},walk:function(J,S,O){if(J){var c=this;O==R&&(O=c._firstPersonMode),c._90O&&c._90O.stop(!0);var j=c._center,B=c._eye,X=jf(j,B,!0);if(O){var s=cs(c.getBoundaries(),B[0],B[2],B[0]+X[0]*J,B[2]+X[2]*J,K(J));if(J=Yi(s),!J)return;X=[s[0]/J,0,s[1]/J]}if(S=fq(S)){var $=Pb(B),d=Pb(j);return S.action=function(M){c.fi({kind:c._walking?"betweenWalk":"beginWalk"}),c._walking=1;var H=J*M;B[0]=$[0]+X[0]*H,B[1]=$[1]+X[1]*H,B[2]=$[2]+X[2]*H,j[0]=d[0]+X[0]*H,j[1]=d[1]+X[1]*H,j[2]=d[2]+X[2]*H,c.fp(wc,R,B),c.fp(on,R,j)},S._37o=function(){delete c._90O,delete c._walking,c.fi({kind:"endWalk"}),c.onWalkEnded()},c._90O=Io(S)}B[0]+=X[0]*J,B[1]+=X[1]*J,B[2]+=X[2]*J,j[0]+=X[0]*J,j[1]+=X[1]*J,j[2]+=X[2]*J,c.fp(wc,R,B),c.fp(on,R,j)}},handleScroll:function(c,A){c.preventDefault();var l=this,O=l._moveStep;l.isFirstPersonMode()?l.isPannable()&&l.pan(0,A>0?O:-O):l.isZoomable()&&l.setZoom(0>A?1/zp:zp)},handlePinch:function(T,N){this.isZoomable()&&this.setZoom(N>T?1/po:po)},reset:function(){this.setCenter(d.graph3dViewCenter),this.setEye(d.graph3dViewEye),this.setUp(d.graph3dViewUp)},moveSelection:function(Z,n,N){var S=this;S.dm().beginTransaction(),yp(this.sm().toSelection(this.isMovable,this),Z,n,N),S.dm().endTransaction()},getMoveMode:function(x,h){var L=h.s("3d.move.mode");if(L)return L;var e="88",K="89",R="90";return _h(x)||Do[e]&&Do[K]&&Do[R]?"xyz":Do[e]&&Do[K]?"xy":Do[e]&&Do[R]?"xz":Do[K]&&Do[R]?"yz":Do[e]?"x":Do[K]?"y":Do[R]?"z":"xz"},handleTick:function(){var Y=this,k=!1,A=Y._moveStep,r=A,j=!1,J=!0,m=Y._rotateStep*(J?-1:1);if(Y.isWalkable()||(r=0),Y.isPannable()||(A=0),Y.isRotatable()||(m=0),Y._32Q){var f=(Pk()-Y._32Q)/50;r*=f,A*=f,m*=f}Y._31Q&&(Ll(Y._31Q),delete Y._31Q,delete Y._32Q),Rm()&&(k=!0,Y.pan(-A,0,j,J)),md()&&(k=!0,Y.pan(A,0,j,J)),Ud()&&(k=!0,_h()?Y.pan(0,A,j,J):Y.walk(r,j,J)),Pr()&&(k=!0,_h()?Y.pan(0,-A,j,J):Y.walk(-r,j,J)),Rc()&&(k=!0,Y.rotate(-m,0,j,J)),Be()&&(k=!0,Y.rotate(m,0,j,J)),Tg()&&(k=!0,Y.rotate(0,-m/2,j,J)),Tb()&&(k=!0,Y.rotate(0,m/2,j,J)),k&&(Y._32Q=Pk(),Y._31Q=Dq(Y.handleTick,Y))},handleKeyDown:function(G){var b=this;!je(G)&&Ic[G.keyCode]?b.handleTick():zn(G)?b.selectAll():Um(G)?b.handleDelete(G):wd(G)&&this.isResettable()&&b.reset()},checkDoubleClickOnNote:function(F,L,n){var z=this;if(n===Gj){if(L.s("note.toggleable"))return L.s(Hk,!L.s(Hk)),z.fi({kind:"toggleNote",event:F,data:L,part:n}),!0}else if(n===Sh&&L.s("note2.toggleable"))return L.s(Oe,!L.s(Oe)),z.fi({kind:"toggleNote2",event:F,data:L,part:n}),!0;return!1},checkDoubleClickOnRotation:function(w,$,x){return x===sd?($.setRotationX(0),!0):x===lr?($.setRotationY(0),!0):x===Kk?($.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(T){var w=this;if(w.isOrtho())return w.getWidth()/w.getOrthoWidth();var D=w.getCenter(),W=w.getHeight(),s=w.getEye(),i=[D[0]-s[0],D[1]-s[1],D[2]-s[2]],z=[T[0]-s[0],T[1]-s[1],T[2]-s[2]],S=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),k=1/Math.tan(w.getFovy()/2);
return W*S*k/(z[0]*i[0]+z[1]*i[1]+z[2]*i[2])},inViewSpace:function(G){var V,q=this,F=q._transformPointToViewSpace(G),Q=q.getAspect(),N=q.getNear(),d=q.getFar();return-F[2]<N||-F[2]>d?!1:q.isOrtho()?(V=q.getOrthoWidth()/2,Math.abs(F[0])<=V&&Math.abs(F[1]*Q)<=V):(V=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2])*Math.tan(q.getFovy()/2),Math.abs(F[1]<=V)&&Math.abs(F[0])<=V*Q)},toViewPosition:function(V){var b=this,r=b.getWidth()/2,X=b.getHeight()/2,p=b._18Q;return p&&p._wh===r/X||(p=bi(b),b._18Q=yd(p,p,aj(b)),b._18Q._wh=r/X),V=Yo([V[0],V[1],V[2],1],p),{x:r+r*V[0]/V[3],y:X-X*V[1]/V[3]}},getHitPosition:function(Q,A,e){var d=this,T=d.getWidth(),u=d.getHeight(),$=Q.target?d.lp(Q):Q,Y=$.x-T/2,w=$.y-u/2,j=d.getCenterInfo(),g=aj(d);A=A?A:[0,0,0],e=e?e:[0,1,0],Y=Y/T*j.width,w=-1*w/u*j.height;var M=[g[0]*Y,g[4]*Y,g[8]*Y],s=[g[1]*w,g[5]*w,g[9]*w],R=[M[0]+s[0],M[1]+s[1],M[2]+s[2]],r=d.getCenter(),H=Bi(d,A,e,[R[0]+r[0],R[1]+r[1],R[2]+r[2]]);return H?H:[0,0,0]},intersectObject:function($,z){return this._raycaster.intersectObject($,z)},intersectObjects:function(r,K,j){return this._raycaster.intersectObjects(r,K,j)},getLineLength:function(j){this.validate();var C=this.getData3dUI(j);if(C&&C.getCache){var O=C.getCache();if(O)return O[O.length-1].length}return 0},getLineOffset:function(j,M){var H=this.getData3dUI(j);if(H&&H.getCache){var V=H.getCache();if(V)return Vn(V,M)}return R},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},flyTo:function(){function n(L,i,f){if(f instanceof q.Node){y.fromArray(Tr(f,i.getMat(f)));var J=f.getAnchor3d();L.push((new bd).set(0-J.x,0-J.y,0-J.z).applyMatrix4(y)),L.push((new bd).set(0-J.x,0-J.y,1-J.z).applyMatrix4(y)),L.push((new bd).set(0-J.x,1-J.y,0-J.z).applyMatrix4(y)),L.push((new bd).set(0-J.x,1-J.y,1-J.z).applyMatrix4(y)),L.push((new bd).set(1-J.x,0-J.y,0-J.z).applyMatrix4(y)),L.push((new bd).set(1-J.x,0-J.y,1-J.z).applyMatrix4(y)),L.push((new bd).set(1-J.x,1-J.y,0-J.z).applyMatrix4(y)),L.push((new bd).set(1-J.x,1-J.y,1-J.z).applyMatrix4(y))}}var I=new bd,R=new bd,V=new bd,O=new bd,y=new Ih,k=new q.Math.Quaternion,X=new kr;return function(D,H,v){var K=this;if(v!==j)H={animation:H,ratio:v};else{var i=typeof H;("boolean"===i||"object"===i&&H.duration)&&(H={animation:H})}H=H||{},I.fromArray(K.getEye()),R.fromArray(K.getCenter());var p,A,P=[],m=H.center,M=H.distance===j;if(m&&V.fromArray(m),D instanceof q.Node)m||V.fromArray(D.p3()),M&&(n(P,K,D),p=P.length);else{if(D||(D=K.dm().getDatas()),!D.length)return;if((M||!m)&&(P=[],D.forEach(function(v){n(P,K,v)}),p=P.length),!p)return;if(!m){for(V.set(0,0,0),A=0;p>A;A++)V.add(P[A]);V.multiplyScalar(1/p)}}if(K.setCenter(V.x,V.y,V.z),O.subVectors(I,R),H.direction||H.worldDirection){!H.worldDirection&&D instanceof q.Node?k.setFromEuler(X.set(D.r3(),D.getRotationMode(),!0)):k.set(0,0,0,1);var h=O.length();O.fromArray(H.worldDirection||H.direction).applyQuaternion(k).setLength(h)}if(M){for(var Z,l,e,Q,G,s=K.getNear(),f=10,v=H.ratio||.8;f--;){for(K._eye[0]=O.x+V.x,K._eye[1]=O.y+V.y,K._eye[2]=O.z+V.z,Z=bi(K),yd(Z,Z,aj(K)),Q=!0,G=-1/0,A=0;p>A;A++){if(e=P[A],l=Yo([e.x,e.y,e.z,1],Z),l[3]<s&&f){O.multiplyScalar(2),Q=!1;break}G=Math.max(G,Math.max(Math.abs(l[0]),Math.abs(l[1]))/v-l[3])}if(Q)break}O.setLength(G+O.length()).add(V)}else O.setLength(H.distance).add(V);K._flyAnim&&K._flyAnim.stop(!0);var b=fq(H.animation);if(b){K.setEye(I.x,I.y,I.z),K.setCenter(R.x,R.y,R.z);var t=(new bd).subVectors(O,I),z=(new bd).subVectors(V,R),E=new bd,T=new bd;return b.action=function(W){E.copy(I).addScaledVector(t,W),T.copy(R).addScaledVector(z,W),K.setCenter(T.x,T.y,T.z),K.setEye(E.x,E.y,E.z)},b._37o=function(){delete K._flyAnim},{lastEye:I,lastCenter:R,eye:O,center:V,animation:K._flyAnim=Io(b)}}return K.setEye(O.x,O.y,O.z),{lastEye:I,lastCenter:R,eye:O,center:V}}}(),getBoundingBox:function(){function S(J,V,X){Z.fromArray(Tr(X,V.getMat(X)));var F=X.getAnchor3d();J.push((new bd).set(0-F.x,0-F.y,0-F.z).applyMatrix4(Z)),J.push((new bd).set(0-F.x,0-F.y,1-F.z).applyMatrix4(Z)),J.push((new bd).set(0-F.x,1-F.y,0-F.z).applyMatrix4(Z)),J.push((new bd).set(0-F.x,1-F.y,1-F.z).applyMatrix4(Z)),J.push((new bd).set(1-F.x,0-F.y,0-F.z).applyMatrix4(Z)),J.push((new bd).set(1-F.x,0-F.y,1-F.z).applyMatrix4(Z)),J.push((new bd).set(1-F.x,1-F.y,0-F.z).applyMatrix4(Z)),J.push((new bd).set(1-F.x,1-F.y,1-F.z).applyMatrix4(Z))}var Z=new Ih;return function(m){if(m=m||this.sm().getSelection(),m instanceof q.Node&&(m=[m]),0===m.length)return R;var Y=[];m.forEach(function(J){S(Y,this,J)},this);var Z=[1/0,1/0,1/0],L=[-1/0,-1/0,-1/0];return Y.forEach(function(E){Z[0]=Math.min(E.x,Z[0]),Z[1]=Math.min(E.y,Z[1]),Z[2]=Math.min(E.z,Z[2]),L[0]=Math.max(E.x,L[0]),L[1]=Math.max(E.y,L[1]),L[2]=Math.max(E.z,L[2])}),{min:Z,max:L}}}()}),no.RenderEnv=function(f){this.gv=f,this.enable=!1},G.defineProperties(no.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(q){this._debugOn=q,this.capture&&this.capture()}}}),G.assign(no.RenderEnv.prototype,{renderEnvToCube:function(P,g,D,q){var v=this,M=v.gv;if(!P||!g||!D)return v.enable=!1,v._42=null,void 0;v.enable=!0;var x=Math.floor(q/P*g),z=M.getGL(),r=v._renderTargets;r?r.length<D&&(r=v._renderTargets=r.concat(new Array(D-r.length))):r=v._renderTargets=new Array(D);for(var u=0;D>u;u++)r[u]?r[u].setSize(z,q,x):r[u]=new no.RenderTarget(M,z,q,x);var Z=!1;v.capture=function(){Z=!0,M._42(),Z=!1};var E=new bd,a=new bd,O=new bd,B=new bd,N=(new bd).setY(0),j=2*Math.PI/D,e=P/2/Math.tan(Math.PI/D),Y=2*Math.atan2(g/2,e),C=P/g;v._42=function(d,z,K,Q){var P=v._debugOn;if(!Z&&!P)return!1;E.copy(M.getEye()),B.copy(M.getCenter()).sub(E);var x=Math.atan2(B.z,B.x),F=M.getNear(),W=M.getFovy(),l=M.getAspect();a.copy(M.getCenter());for(var T,b=0;D>b;b++)if(T=r[b],N.setZ(Math.cos(x)).setX(Math.sin(x)).multiplyScalar(e),x-=j,O.addVectors(E,N),M.setNear(e),M.setCenter([O.x,O.y,O.z]),M.setFovy(Y),M.setAspect(C),P){var h=Math.round(z/D);d.viewport(h*b,0,h,K),Q()}else Gp(d,T.frame),d.viewport(0,0,T.width,T.height),d.clear(d.COLOR_BUFFER_BIT),Q(),Gp(d,R),T.assureTexture();return M.setNear(F),M.setCenter([a.x,a.y,a.z]),M.setFovy(W),M.setAspect(l),!0},v.capture()},getTextureInfo:function(J){var I=this._renderTargets;if(!I)return null;var K=this._renderTargets[J];return K?{index:J,texture:K.texture,textureName:K.uuid}:null}}),G.assign(no.Graph3dView.prototype,{renderEnvToCube:function(B,R,z,F){var x=this;x.envRenderer||(x.envRenderer=new no.RenderEnv(x)),x.envRenderer.renderEnvToCube(B,R,z,F)}}),no.RenderTarget=function($,t,k,U,x){var o=this;x=x||{},o.uuid=q.Math.generateUUID(),o.gv=$,o.init($,t,x),o.setSize(t,k,U)},G.assign(no.RenderTarget.prototype,{init:function(j,Q,A){var a=this,M=a.texture=Q.createTexture();Q.activeTexture(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,M),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,A.minFilter||Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,A.magFilter||Q.LINEAR),Q.bindTexture(Q.TEXTURE_2D,null),a.render=Q.createRenderbuffer(),a.frame=Q.createFramebuffer(),j._2O[a.uuid]=M},assureTexture:function(){var L=this,n=L.uuid,s=L.gv._2O;s[n]||(s[n]=L.texture)},setSize:function(z,X,D){var A=this;if(A.width!==X||A.height!==D){var t=z.RGBA,b=z.TEXTURE_2D,r=z.RENDERBUFFER,P=z.FRAMEBUFFER;Nn(z,A.texture),z.texImage2D(b,0,t,X,D,0,t,z.UNSIGNED_BYTE,R),z.bindRenderbuffer(r,A.render),z.renderbufferStorage(r,z.DEPTH_COMPONENT16,X,D),Gp(z,A.frame),z.framebufferTexture2D(P,z.COLOR_ATTACHMENT0,b,A.texture,0),z.framebufferRenderbuffer(P,z.DEPTH_ATTACHMENT,r,A.render),Nn(z,R),z.bindRenderbuffer(r,R),Gp(z,R),A.width=X,A.height=D}},toCanvas:function(){var I=this,P=I.gv.getGL();P.bindFramebuffer(P.FRAMEBUFFER,I.frame);var c=I.width,e=I.height,B=new Uint8Array(4*c*e);P.readPixels(0,0,c,e,P.RGBA,P.UNSIGNED_BYTE,B),P.bindFramebuffer(P.FRAMEBUFFER,null);var z=k.createElement("canvas");z.width=c,z.height=e;var p=z.getContext("2d"),L=p.createImageData(c,e);return L.data.set(B),p.putImageData(L,0,0),z}});var jh=no.Interactor=function(t){this.gv=t};Jj("Interactor",G,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var jr=no.DefaultInteractor=function(M){Id(jr,this,[M])};Jj("DefaultInteractor",jh,{handle_contextmenu:function(z){bf(z)},handle_mousewheel:function(Q){this.gv.handleScroll(Q,Q.wheelDelta/40)},handle_DOMMouseScroll:function(r){2===r.axis&&this.gv.handleScroll(r,-r.detail)},handle_keydown:function(J){this.gv.handleKeyDown(J)},handle_mousedown:function(C){this.handle_touchstart(C)},handle_touchstart:function(n){bf(n);var N=this,y=N.gv,q=Qk(n),S=y.getDataInfoAt(n),B=S?S.data:R,E=S?S.part:R,L=y.sm(),$=Qm(n),G=Hh(n);y.setFocus(n)&&(N._62O=R,N._57I=R,B?je(n)?L.co(B)?L.rs(B):L.as(B):L.co(B)||L.ss(B):q&&(je(n)?y.isRectSelectable()&&(N._62O=Yl):N._57I=Bm(n)),N._31Q&&(Ll(N._31Q),delete N._31Q,delete N._32Q),N._62O||(y.isFirstPersonMode()&&(_h(n)||G>2?N._62O="pan":y.isMouseRoamable()||Ei?(N._62O="roaming",N.foward=$&&Qk(n),N._32Q=Pk(),N._31Q=Dq(N.tick,N)):q||(N._62O="roaming")),N._62O||(q&&$&&Ye[E]?(N._62O=E,N.p3=B.p3()):q&&$&&ei(B)&&y.isSelected(B)?y.isMovable(B)?(N._62O="move",N.p3=B.p3(),N.movedata=B):y.isInteractive(B)&&(N._62O="none"):Ei&&(G>2?N._62O="pan":2===G&&(N.dist=Mn(n),N._62O="pinch")))),N.point=y.lp(n),Wr(N,n),Gn(n)?y.handleDoubleClick(n,B,E):y.handleClick(n,B,E))},tick:function(){var V=this,P=V.gv,j=P._moveStep;V.point&&P.isWalkable()&&(V._32Q&&(j*=(Pk()-V._32Q)/50),P.walk(V.foward?j:-j),V._32Q=Pk(),V._31Q=Dq(V.tick,V))},handle_mouseup:function(R){this.handle_touchend(R)},handle_touchend:function(h){var j=this._57I;j&&(Yi(j,Bm(h))<=1&&this.gv.sm().cs(),this._57I=R)},handleWindowMouseMove:function(p){this.handleWindowTouchMove(p)},handleWindowTouchMove:function(O){var x,r,H=this,n=H.gv,z=H._62O,F=H.point,k=n.dm(),D=n.lp(O),h=D.x-F.x,S=D.y-F.y,s=n.getWidth(),f=n.getHeight();if(s&&f){var j=-m*h/s,b=-m*S/f;if("roaming"===z)H.rotate(O,j/2,b/2);else if(z===sd||z===lr||z===Kk)n._86O||k.beginTransaction(),n.fi({kind:n._86O?"betweenEditRotation":"beginEditRotation",event:O}),n._86O=1,n.sm().each(function(t){if(ei(t)&&n.isRotationEditable(t)){var L=K(j)>K(b)?j:b;z===sd?t.setRotationX(t.getRotationX()+L):z===lr?t.setRotationY(t.getRotationY()+L):z===Kk&&t.setRotationZ(t.getRotationZ()+L)}});else if("move"===z||Ye[z]){z===Rk||z===cn||z===Dh?(n._87O||k.beginTransaction(),n.fi({kind:n._87O?"betweenEditScale":"beginEditScale",event:O}),n._87O=1):(n._moving||k.beginTransaction(),n.fi({kind:n._moving?"betweenMove":"beginMove",event:O}),n._moving=1);var E,L=H.p3,c=n.getPositionInfo(L),e=aj(n);E=z===sl?"x":z===Ed?"y":z===ph?"z":z===Rk?"sx":z===cn?"sy":z===Dh?"sz":n.getMoveMode(O,H.movedata),h=h/s*c.width,S=-1*S/f*c.height;var T,l,o=[e[0]*h,e[4]*h,e[8]*h],I=[e[1]*S,e[5]*S,e[9]*S],X=o[0]+I[0],V=o[1]+I[1],d=o[2]+I[2],P=[L[0]+X,L[1]+V,L[2]+d],U=jf(n.getEye(),P,!0);if("xyz"===E?(T=P,n.moveSelection(X,V,d)):"xz"===E?(T=Bi(n,L,[0,1,0],P),T&&n.moveSelection(T[0]-L[0],0,T[2]-L[2])):"xy"===E?(T=Bi(n,L,[0,0,1],P),T&&n.moveSelection(T[0]-L[0],T[1]-L[1],0)):"yz"===E?(T=Bi(n,L,[1,0,0],P),T&&n.moveSelection(0,T[1]-L[1],T[2]-L[2])):"x"===E||"sx"===E?(U[0]=0,T=Bi(n,L,U,P),T&&(l=T[0]-L[0],"x"===E?n.moveSelection(l,0,0):n.sm().each(function(m){ei(m)&&n.isSizeEditable(m)&&(x=m.getScaleX()+l/100,r=x/m.getScaleX(),m.setScaleX(x),_h(O)&&(m.setScaleY(m.getScaleY()*r),m.setScaleTall(m.getScaleTall()*r)))}))):"y"===E||"sy"===E?(U[1]=0,T=Bi(n,L,U,P),T&&(l=T[1]-L[1],"y"===E?n.moveSelection(0,l,0):n.sm().each(function($){ei($)&&n.isSizeEditable($)&&(x=$.getScaleTall()+l/100,r=x/$.getScaleTall(),$.setScaleTall(x),_h(O)&&($.setScaleY($.getScaleY()*r),$.setScaleX($.getScaleX()*r)))}))):("z"===E||"sz"===E)&&(U[2]=0,T=Bi(n,L,U,P),T&&(l=T[2]-L[2],"z"===E?n.moveSelection(0,0,l):n.sm().each(function(i){ei(i)&&n.isSizeEditable(i)&&(x=i.getScaleY()+l/100,r=x/i.getScaleY(),i.setScaleY(x),_h(O)&&(i.setScaleX(i.getScaleX()*r),i.setScaleTall(i.getScaleTall()*r)))}))),!T)return;H.p3=T}else if(z===Yl){var y=H.div;y||(y=H.div=me(),ke(H.getView(),y),y.op=F,y.style.background=n.getRectSelectBackground()),n.fi({kind:n._rectSelecting?"betweenRectSelect":"beginRectSelect",event:O}),n._rectSelecting=1,y.rect=_q(y.op,D),Zh(y,y.rect)}else if("pinch"===z&&2===Hh(O)){n.fi({kind:n._pinching?"betweenPinch":"beginPinch",event:O}),n._pinching=1;var l=Mn(O);n.handlePinch(l,H.dist),H.dist=l}else"pan"===z||_h(O)?H.pan(O,h,S):"none"===z||n.isFirstPersonMode()||(Qk(O)?H.rotate(O,j,b):(H.pan(O,h,0),n.isWalkable()&&(n.fi({kind:n._walking?"betweenWalk":"beginWalk",event:O}),n._walking=1,n.walk(S/n.getHeight()*n.getCenterInfo().height))));H.point=D}},pan:function(V,g,H){var K=this.gv;if(K.isPannable()){var J=K.getWidth(),t=K.getHeight();if(!J||!t)return;var W=K.getCenterInfo(),E=g/J*W.width,l=-1*H/t*W.height;K.fi({kind:K._panning?"betweenPan":"beginPan",event:V}),K._panning=1,K.pan(-E,-l)}},rotate:function(u,p,b){var E=this.gv;E.isRotatable()&&(E.fi({kind:E._rotating?"betweenRotate":"beginRotate",event:u}),E._rotating=1,E.rotate(p,b))},handleWindowMouseUp:function(z){this.handleWindowTouchEnd(z)},handleWindowTouchEnd:function(w){var s=this,o=s.gv,u=o.dm(),v=s.div;if(v){var W=o.getDatasInRect(v.rect);if(!W.isEmpty()){var B=o.sm(),t=B.toSelection();W.each(function(h){B.co(h)?t.remove(h):t.add(h)}),B.ss(t)}un(v)}o._moving&&(delete o._moving,o.fi({kind:"endMove",event:w}),o.onMoveEnded(),u.endTransaction()),o._panning&&(delete o._panning,o.fi({kind:"endPan",event:w}),o.onPanEnded()),o._rotating&&(delete o._rotating,o.fi({kind:"endRotate",event:w}),o.onRotateEnded()),o._86O&&(delete o._86O,o.fi({kind:"endEditRotation",event:w}),u.endTransaction()),o._87O&&(delete o._87O,o.fi({kind:"endEditScale",event:w}),u.endTransaction()),o._pinching&&(delete o._pinching,o.fi({kind:"endPinch",event:w}),o.onPinchEnded()),o._rectSelecting&&(delete o._rectSelecting,o.fi({kind:"endRectSelect",event:w}),o.onRectSelectEnded()),o._walking&&(delete o._walking,o.fi({kind:"endWalk",event:w}),o.onWalkEnded()),s.dist=s.point=s._62O=s.p3=s.movedata=s.div=s._57I=s._32Q=s._31Q=s.foward=R}});var Mm=no.MapInteractor=function(v){Id(Mm,this,[v]),this._minPhi=0,this._maxPhi=5*b/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01};Jj("MapInteractor",jh,{handle_contextmenu:function(E){bf(E)},handle_mousewheel:function(C){this.gv.handleScroll(C,C.wheelDelta/40)},handle_DOMMouseScroll:function(n){2===n.axis&&this.gv.handleScroll(n,-n.detail)},handle_keydown:function(c){this.gv.handleKeyDown(c)},handle_mousedown:function(Y){this.handle_touchstart(Y)},handle_touchstart:function(n){bf(n);var u=this,l=u.gv;if(l.setFocus(n)){l.lp(n);var $=l.getDataInfoAt(n),e=$?$.data:R,q=$?$.part:R;if(!e||!l.isInteractive(e)){var B=u.editing={point:l.lp(n)};Ei?B.touch=!0:(B.touch=!1,B.pan=Qk(n)),Wr(u,n)}Gn(n)?l.handleDoubleClick(n,e,q):l.handleClick(n,e,q)}},handle_mouseup:function(y){this.handle_touchend(y)},handle_touchend:function(){},handleWindowMouseMove:function(A){this.handleWindowTouchMove(A)},handleWindowTouchMove:function(k){var L=this,e=L.gv,p=L.editing;if(p){var N=e.lp(k),l=p.point,g=N.x-l.x,W=N.y-l.y;if(!p.moved){if(Math.abs(g)<L.threshold&&Math.abs(W)<L.threshold&&!(k.touches&&k.touches.length>1))return;p.moved=!0}if(p.point=N,p.touch){var A=k.touches.length;if(2!==A)L.pan(k,g,W);else{if(1>=A)return;var i=k.touches,$={x:i[0].clientX,y:i[0].clientY},x={x:i[1].clientX,y:i[1].clientY},X={x:x.x-$.x,y:x.y-$.y},s=p.lastCenter,y=Math.atan2(X.y,X.x),O=p.theta,j=0;O==R?O=p.theta=y:(j=y-O,p.thetaStarted||Math.abs(j)>L.touchRotateThreshold?(p.thetaStarted=!0,p.theta=y):j=0);var J=b*($.y+x.y)/2/e.getHeight(),w=p.phi,P=0;w==R?w=p.phi=J:(P=J-w,p.phiStarted||Math.abs(P)>L.touchRotateThreshold?(p.phiStarted=!0,p.phi=J):P=0);var Z,E=Math.sqrt(X.x*X.x+X.y*X.y),S=p.vlen;if(S){var d=$.x-s.x,o=$.y-s.y,f=x.x-s.x,B=x.y-s.y,C=Math.sqrt(d*d+o*o),a=Math.sqrt(f*f+B*B),z=S/2,_=L._sign2(C-z),I=L._sign2(a-z);0>_*I||0===_&&0===I?(Z=1,p.vlen=E):(Z||(Z=E/S),p.scaleStarted||Math.abs(Z-1)>L.touchScaleThreshold?(p.vlen=E,p.scaleStarted=!0):Z=1)}else S=p.vlen=E,Z=1;1!==Z&&e.setZoom(Z),(P||j)&&L.rotate(k,j,-P),p.lastCenter={x:(x.x+$.x)/2,y:(x.y+$.y)/2}}}else if(p.pan)L.pan(k,g,W);else{var T=e.getWidth(),F=e.getHeight();if(!T||!F)return;var c=-m*g/T,r=-m*W/F;L.rotate(k,c,r)}}},_sign2:function(s){return Math.abs(s)<this._touchScaleCheckAccuracy?0:s>0?1:-1},handleWindowMouseUp:function(s){this.handleWindowTouchEnd(s)},handleWindowTouchEnd:function(K){var f=this,i=f.editing;if(f.editing=null,i){var N=f.gv;if(!i.moved&&i.pan){var w=N.getDataAt(K);w?N.sm().setSelection([w]):N.sm().clearSelection()}else N._panning=null,N._rotating=null,N.fi({kind:i.pan?"endPan":"endRotate",event:K})}},pan:function(W,X,i){var c=this,Q=c.gv;if(Q.isPannable()){var V=Q.getWidth(),Z=Q.getHeight();if(V&&Z){var e=Q.getCenterInfo(),z=-X/V*e.width,I=1*i/Z*e.height;Q.fi({kind:Q._panning?"betweenPan":"beginPan",event:W}),Q._panning=1;var M=c.keepHorizon,w=c.editing.touch;if((w&&W.touches&&W.touches.length>1||!w&&_h(W))&&(M=!M),!M)return Q.pan(z,I);if(z||I){var T=aj(Q),L=[T[0]*z,T[4]*z,T[8]*z],q=[T[1],0,T[9]],k=Math.sqrt(q[0]*q[0]+q[2]*q[2]);k&&(q=[q[0]/k*I,0,q[2]/k*I]);var v=L[0]+q[0],f=L[1]+q[1],l=L[2]+q[2],o=Q._center,N=Q._eye;o[0]+=v,o[1]+=f,o[2]+=l,N[0]+=v,N[1]+=f,N[2]+=l,Q.fp(wc,R,N),Q.fp(on,R,o)}}}},rotate:function(T,E,G){var X=this,L=X.gv;if(L.isRotatable()){var U=L._center,R=L._eye,r=jf(R,U),B=i(C(r[0]*r[0]+r[2]*r[2]),r[1]),K=B+G;K=Math.max(X.minPhi,Math.min(X.maxPhi,K)),G=K-B,L.fi({kind:L._rotating?"betweenRotate":"beginRotate",event:T}),L._rotating=1,L.rotate(E,G)}}}),G.defineProperties(Mm.prototype,{minPhi:{get:function(){return this._minPhi},set:function(j){this._minPhi=j}},maxPhi:{get:function(){return this._maxPhi},set:function(T){this._maxPhi=T}},keepHorizon:{get:function(){return this._keepHorizon},set:function(B){this._keepHorizon=B}},threshold:{get:function(){return this._threshold},set:function(r){this._threshold=r}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(n){this._touchScaleThreshold=n}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(T){this._touchRotateThreshold=T}}});var co=function(Y){this.gv=Y};Ci(co,G,{_iv:!0,iv:function(){this._iv=!0},face:function(D,z){var y=this,F=y.gv.getGL();if(!F||!ei(D))return R;var p=z.x,o=z.width,q=z.height,b=y.height-z.y-q,G=X(o/2),x=new Uint8Array(4*o*q),J=0;for(y.iv(),y.validate(D),Gp(F,y.frame),F.readPixels(p,b,o,q,F.RGBA,F.UNSIGNED_BYTE,x),Gp(F,R),y.iv();G>=J;J++)for(var U=G-J,E=G+J,V=U;E>=V;V++)for(var Z=U;E>=Z;Z++)if(V===U||V===E||Z===U||Z===E){var v=As.m[x[4*(V*o+Z)]];if(v)return v}},get:function(t,D){this.validate();var p=this,O=p.gv.getGL();if(!O)return R;var d,a,T=t.x,g=t.width,C=t.height,i=p.height-t.y-C,U=X(g/2),o=new Uint8Array(4*g*C),K=0,B=o.length,F=D?R:new ob,G=D?R:{};if(Gp(O,p.frame),O.readPixels(T,i,g,C,O.RGBA,O.UNSIGNED_BYTE,o),Gp(O,R),D){for(;U>=K;K++)for(var u=U-K,V=U+K,e=u;V>=e;e++)for(var J=u;V>=J;J++)if((e===u||e===V||J===u||J===V)&&(d=p.info(o,4*(e*g+J))))return d}else for(;B>K;K+=4)d=p.info(o,K),d&&(a=d.data,G[a._id]||(F.add(a),G[a._id]=a));return F},info:function(r,f){return this.colorMap[(r[f]<<16)+(r[f+1]<<8)+r[f+2]+((127&r[f+3])<<24)]},validate:function(L){var Q=this,D=Q.gv,u=D.getGL();if(u){var y=D.getWidth(),X=D.getHeight(),Y=u.RGBA,V=u.TEXTURE_2D,t=u.RENDERBUFFER,k=u.FRAMEBUFFER;Q.texture||(Q.texture=bh(u),Q.render=u.createRenderbuffer(),Q.frame=u.createFramebuffer()),(Q.width!==y||Q.height!==X)&&(Nn(u,Q.texture),u.texImage2D(V,0,Y,y,X,0,Y,u.UNSIGNED_BYTE,R),Ve(u,u.TEXTURE_MIN_FILTER,u.LINEAR),u.bindRenderbuffer(t,Q.render),u.renderbufferStorage(t,u.DEPTH_COMPONENT16,y,X),Gp(u,Q.frame),u.framebufferTexture2D(k,u.COLOR_ATTACHMENT0,V,Q.texture,0),u.framebufferRenderbuffer(k,u.DEPTH_ATTACHMENT,t,Q.render),Nn(u,R),u.bindRenderbuffer(t,R),Gp(u,R),Q.width=y,Q.height=X),Q._iv&&(Q._iv=!1,Gp(u,Q.frame),D._42(L||(Q.colorMap={}),1),Gp(u,R))}}});var Xn=function(Y){this.gv=Y};Ci(Xn,G,{gap:0,size:0,_42:function($,f){var r=this,d=r.gv,q=d._gridGap,F=d._gridSize;if(d._gridVisible){if(r.gap!==q||r.size!==F){for(var n=[],g=d._gridSize/2,x=q*g,T=0;2*g+1>T;T++){var i=6*T,O=6*(2*g+1)+i;n[i]=-x,n[i+1]=0,n[i+2]=-x+T*q,n[i+3]=x,n[i+4]=0,n[i+5]=-x+T*q,n[O]=-x+T*q,n[O+1]=0,n[O+2]=-x,n[O+3]=-x+T*q,n[O+4]=0,n[O+5]=x}r.vs=new pq(n),r.gap=q,r.size=F}jn(d),bs($,f),Xk($),Ek($,f,1,d._gridColor,d._buffer.vs,r.vs),dl($,0,r.vs.length/3,$.LINES),Cp($),kh($,f)}else r.vs=r.gap=r.size=R}});var Ke=function(z){this.gv=z};Ci(Ke,G,{_42:function(L,X){var t=this.gv,S=t._buffer.vs,J=t._axisXColor,j=t._axisYColor,s=t._axisZColor,Q=t._originAxisVisible,U=t._centerAxisVisible;if(Q||U){var M=_?L.TRIANGLES:L.TRIANGLE_FAN,A=L.LINES;if(jn(t),bs(L,X),Xk(L),Q){var p=t.getCenterInfo(),y=f(p.width,p.height)/5,T=.8*y,V=.05*y;Ek(L,X,1.5,J,S,new pq([0,0,0,y,0,0,T,V,0,T,0,V,T,-V,0,T,0,-V,T,V,0,0,0,0,0,y,0,V,T,0,0,T,V,-V,T,0,0,T,-V,V,T,0,0,0,0,0,0,y,V,0,T,0,V,T,-V,0,T,0,-V,T,V,0,T])),dl(L,0,2,A),dl(L,1,6,M),Ek(L,X,R,j),dl(L,7,2,A),dl(L,8,6,M),Ek(L,X,R,s),dl(L,14,2,A),dl(L,15,6,M)}if(U){var C=t._center,F=C[0],G=C[1],x=C[2],p=t.getPositionInfo(C);y=f(p.width,p.height)/20,Ek(L,X,1.5,J,S,new pq([F,G,x,F+y,G,x,F,G,x,F,G+y,x,F,G,x,F,G,x+y])),dl(L,0,2,A),Ek(L,X,R,j),dl(L,2,2,A),Ek(L,X,R,s),dl(L,4,2,A)}Cp(L),kh(L,X)}}});var Tn=function(O){this.gv=O,this.onMouseOver=this.onMouseOver.bind(this),this.mode=2};Tn.Mode={Disable:0,Selection:1,MouseOver:2},Ci(Tn,G,{onMouseOver:function(V){d.preventDefault(V);var K=this.gv.getDataAt(V);K!==this.mouseOverData&&(this.mouseOverData=K,this.gv.iv())},setFetchTargetFunc:function(K){this.fetchTargetFunc=K},_42:function(N,Q){var $,k=this,H=k._mode;if(H!==Tn.Mode.Disable&&(H===Tn.Mode.Selection?$=k.gv.sm().getSelection().toArray():H===Tn.Mode.MouseOver&&k.mouseOverData&&($=[k.mouseOverData]),k.fetchTargetFunc&&($=k.fetchTargetFunc($)),$&&$.length)){var z=k.gv,P=z.vr.isPresenting(),O=z.getWidth();if(P){var n=z.getWidth;O/=2,z.getWidth=function(){return O};var s=z.getViewport()}var Z,T=z.getDevicePixelRatio(),q=O*T,L=z.getHeight()*T;(Z=k._renderTarget)?Z.setSize(N,q,L):k._renderTarget=Z=new no.RenderTarget(z,N,q,L),Gp(N,Z.frame),z.drawFilter=function(g){return $.indexOf(g)<0?!0:void 0},z._42({}),z.drawFilter=null,Gp(N,R),P&&(z.getWidth=n,z.setViewport(N,s[0],s[1],s[2],s[3])),k.shader||(k.shader=new al.Shader(N,Aq.vs,Aq.fs));var V=k.shader;if(k.shader.bind(),N.enable(N.BLEND),N.activeTexture(N.TEXTURE0+0),N.bindTexture(N.TEXTURE_2D,Z.texture),V.uniforms.image=0,V.uniforms.textureSize=[q,L],V.uniforms.edgeWidth=c["highlight.width"],k.highlightColor!==c["highlight.color"]){var r=uo(k.highlightColor=c["highlight.color"]);k.highlightColorData=[r[0]/255,r[1]/255,r[2]/255,r[3]/255]}V.uniforms.edgeColor=k.highlightColorData,k.ibuffer?(k.ibuffer.upload(),k.vbuffer.upload()):(k.ibuffer=al.Buffer.createIndexBuffer(N,new Uint16Array([0,2,1,1,2,3])),k.vbuffer=al.Buffer.createVertexBuffer(N,new Float32Array([0,0,1,0,0,1,1,1]))),V.attributes.pos.pointer(k.vbuffer),N.drawElements(N.TRIANGLES,6,N.UNSIGNED_SHORT,0),N.disable(N.BLEND),N.bindTexture(N.TEXTURE_2D,null),N.useProgram(Q)}}}),G.defineProperties(Tn.prototype,{mode:{get:function(){return this._mode},set:function(j){var U=this._mode;j!==U&&(this._mode=j,j===Tn.Mode.MouseOver?this.gv.getView().addEventListener("mousemove",this.onMouseOver,!1):U===Tn.Mode.MouseOver&&this.gv.getView().removeEventListener("mousemove",this.onMouseOver))}}});var Aq={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Wo=function(q){this.gv=q},sl="edit_tx",Ed="edit_ty",ph="edit_tz",sd="edit_rx",lr="edit_ry",Kk="edit_rz",Rk="edit_sx",cn="edit_sy",Dh="edit_sz",Ye={};Ye[sl]=1,Ye[Ed]=1,Ye[ph]=1,Ye[sd]=1,Ye[lr]=1,Ye[Kk]=1,Ye[Rk]=1,Ye[cn]=1,Ye[Dh]=1,Ci(Wo,G,{_42:function(E,p,W){var j=this,M=j.gv,h=M.sm().ld();if(h&&M.isEditable(h)&&!M.isEditHelperDisabled()&&ei(h)&&(!M.isFirstPersonMode()||!M.isMouseRoamable()&&!Ei)){jn(M);var c,P,N=M.isMovable(h),T=M.isRotationEditable(h),K=M.isSizeEditable(h),t=M._axisXColor,e=M._axisYColor,D=M._axisZColor,G=M._editSizeColor,y=h.p3(),$=Yi(M.getEye(),y)/10,Z=$/(W?5:10),u=.7*$,l=.4*u,v=y[0],Y=y[1],F=y[2];c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],N&&j._17O(E,p,h,W,sl,t,c,[v,Y-Z,F,v+u,Y-Z,F,v+u,Y,F,v+u,Y,F,v,Y,F,v,Y-Z,F,v,Y-Z,F+Z,v+u,Y-Z,F+Z,v+u,Y-Z,F,v+u,Y-Z,F,v,Y-Z,F,v,Y-Z,F+Z]),P=v+u,K&&j._17O(E,p,h,W,Rk,G,c,[P,Y-Z,F,P+l,Y-Z,F,P+l,Y,F,P+l,Y,F,P,Y,F,P,Y-Z,F,P,Y-Z,F+Z,P+l,Y-Z,F+Z,P+l,Y-Z,F,P+l,Y-Z,F,P,Y-Z,F,P,Y-Z,F+Z]),P+=l,T&&j._17O(E,p,h,W,sd,t,c,[P,Y-Z,F,P+l,Y-Z,F,P+l,Y,F,P+l,Y,F,P,Y,F,P,Y-Z,F,P,Y-Z,F+Z,P+l,Y-Z,F+Z,P+l,Y-Z,F,P+l,Y-Z,F,P,Y-Z,F,P,Y-Z,F+Z]),c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],N&&j._17O(E,p,h,W,Ed,e,c,[v,Y,F,v,Y+u,F,v-Z,Y+u,F,v-Z,Y+u,F,v-Z,Y,F,v,Y,F,v,Y,F,v,Y,F-Z,v,Y+u,F-Z,v,Y+u,F-Z,v,Y+u,F,v,Y,F]),P=Y+u,K&&j._17O(E,p,h,W,cn,G,c,[v,P,F,v,P+l,F,v-Z,P+l,F,v-Z,P+l,F,v-Z,P,F,v,P,F,v,P,F,v,P,F-Z,v,P+l,F-Z,v,P+l,F-Z,v,P+l,F,v,P,F]),P+=l,T&&j._17O(E,p,h,W,lr,e,c,[v,P,F,v,P+l,F,v-Z,P+l,F,v-Z,P+l,F,v-Z,P,F,v,P,F,v,P,F,v,P,F-Z,v,P+l,F-Z,v,P+l,F-Z,v,P+l,F,v,P,F]),c=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],N&&j._17O(E,p,h,W,ph,D,c,[v,Y,F,v,Y,F+u,v,Y-Z,F+u,v,Y-Z,F+u,v,Y-Z,F,v,Y,F,v,Y-Z,F,v-Z,Y-Z,F,v-Z,Y-Z,F+u,v-Z,Y-Z,F+u,v,Y-Z,F+u,v,Y-Z,F]),P=F+u,K&&j._17O(E,p,h,W,Dh,G,c,[v,Y,P,v,Y,P+l,v,Y-Z,P+l,v,Y-Z,P+l,v,Y-Z,P,v,Y,P,v,Y-Z,P,v-Z,Y-Z,P,v-Z,Y-Z,P+l,v-Z,Y-Z,P+l,v,Y-Z,P+l,v,Y-Z,P]),P+=l,T&&j._17O(E,p,h,W,Kk,D,c,[v,Y,P,v,Y,P+l,v,Y-Z,P+l,v,Y-Z,P+l,v,Y-Z,P,v,Y,P,v,Y-Z,P,v-Z,Y-Z,P,v-Z,Y-Z,P+l,v-Z,Y-Z,P+l,v,Y-Z,P+l,v,Y-Z,P])}},_17O:function(i,H,U,I,w,W,E,x){var m=this.gv._buffer;Sr(i,H,I,!0,U,w),Xo(i,H,R,!0,R,!0,R,!1),Xi(i,H.uDiffuse,W),gk(i,m.vs,new pq(x),H.aPosition),gk(i,m.ns,new pq(E),H.aNormal),Xk(i),dl(i,0,12),Cp(i),Je(i,H)}});var op=q.Raycaster=function(j){this.gv=j,this.maxTriangleTest=1/0};pm("Raycaster",G,{intersect:function(L){var x=this,N=x.gv,M=N.getDataAt(L);return M?x.intersectObject(L,M):null},intersectObjects:function(m,f,x){var P,h,g,d,N=this,G=1/0,S=m.origin||(new bd).fromArray(N.gv.getEye()),J=N.maxTriangleTest,R=[];return f.forEach(function(k){x&&x(k)===!1||k.s("intersect")!==!1&&R.push(k)}),R.sort(function(r,E){return S.distanceToSquared2(r.p3())-S.distanceToSquared2(E.p3())}),N.countTriangles=0,R.forEach(function(o){N.countTriangles>J||(P=N.intersectObject(m,o),P&&(h=S.distanceToSquared(P.world),G>h&&(g=o,d=P,G=h)))}),N.countTriangles=0,{data:g,intersect:d}},intersectObject:function(U,m){if(U instanceof mj)return this._intersectObjectImpl(U,m);var z,p,R=this,L=R.gv;p=L.unproject(U);var K=L.getEye();L.isOrtho()?(z=jf(L.getCenter(),K),z[0]+=z[0],z[1]+=z[1],z[2]+=z[2]):z=K,z=new bd(z);var e=new bd(p).sub(z).normalize(),t=new q.Math.Ray(z,e);return R._intersectObjectImpl(t,m)},_intersectObjectImpl:function(){function g(){var h=new bd;return h.subVectors(k,H),_.subVectors(m,H),h.cross(_).normalize(),h}function N(R,m,u,C,N,Z,B){return _j.barycoordFromPoint(R,m,u,C,z),N.multiplyScalar(z.x),Z.multiplyScalar(z.y),B.multiplyScalar(z.z),N.add(Z).add(B),N.clone()}var $=new Ih,Y=new Ih,Z=new mj,u=new bd,E=new bd,v=new bd,s=new bd,t=new bd,m=new bd,H=new bd,k=new bd,M=new Uh,F=new Uh,x=new Uh,_=new bd,T={vs:om,is:mg,uv:Lf},z=new bd;return function(B,f){var o=this.gv.getData3dUI(f),w=f.mat||o.mat;if(w){$.fromArray(w),Y.getInverse($),Z.copy(B).applyMatrix4(Y);var C,y,i="body",W=o.shapeModel;if(W||(W=Ld(o)),W||(f instanceof q.Node&&!(f instanceof q.Shape)?(C=!0,W=T):(y=!0,W=[o.left,o.front,o.right,o.back,o.top,o.bottom])),!W)return console.log("Can not find shape model."),null;Sj(W)||(W=[W]);var j,z,O,e,I,R,U,b,n,K,P,l,a,L,V,S,G=1/0,h=["","top_","bottom_"],D=!1;for(j=0,z=W.length;z>j;j++)if(a=W[j])for(O=0,e=h.length;e>O;O++)if(L=h[O],U=a[L+"vs"],b=a[L+"is"],n=a[L+"uv"]||a[L+"tuv"],U){if(V=a[L+"boundingBox"]){var P=Z.intersectBox(V);if(!P)continue;if(Z.origin.distanceTo(P)>G)continue;S=!1}else a[L+"boundingBox"]=V=new q.Math.Box3,S=!0;for(I=0,R=b?b.length:U.length/3;R>I;I+=3)this.countTriangles++,b?(E.fromArray(U,3*b[I]),v.fromArray(U,3*b[I+1]),s.fromArray(U,3*b[I+2])):(E.fromArray(U,3*I),v.fromArray(U,3*(I+1)),s.fromArray(U,3*(I+2))),S&&(V.expandByPoint(E),V.expandByPoint(v),V.expandByPoint(s)),K=Z.intersectTriangle(E,v,s,!0,u),K&&(l=Z.origin.distanceTo(K),G>l&&(G=l,t.copy(K),m.copy(E),H.copy(v),k.copy(s),""!==L?i=L.slice(0,-1):C?i=An[Math.floor(I/6)]:y&&(i=An[j]),n&&(D=!0,b?(M.fromArray(n,2*b[I]),F.fromArray(n,2*b[I+1]),x.fromArray(n,2*b[I+2])):(M.fromArray(n,2*I),F.fromArray(n,2*(I+1)),x.fromArray(n,2*(I+2))))))}if(!isFinite(G))return null;var _,r=t.clone().applyMatrix4($);D&&(_=N(t,m,H,k,M,F,x));var c=g(m,H,k),A=g(m.applyMatrix4($),H.applyMatrix4($),k.applyMatrix4($)),Q=Z.direction.dot(c);return Q>0&&(c.multiplyScalar(-1),A.multiplyScalar(-1)),{world:r,local:t.clone(),worldNormal:A,normal:c,uv:_,part:i}}}}()});var Eq=function(v,U){this.gv=v,this.s=function(C,x,i){return x==R&&(x=i),x==R?U.getStyle(C):li(x,U,v)},this.data=U};Ci(Eq,G,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(E,B,d,W){var H=this,M=H.data;if(!(M instanceof Gk)){var p,t,A,h,l,O,C,N=H.gv,b=M._id,Q=H.s("shape3d.alwaysOnTop")?null:H.s("batch"),U=N._batchIndexMap,e=N._batchModelMap,x=N.isSelectable(M),w=N.getBrightness(M),q=w!=R&&1!==w;if(H.needValidate(E)){if(A=Nb(U,e,M,Q),H.validate(A,Q?Ag[Q]||Dl:R),A&&(h=U[b],l=h.size=A.vs.length/3-h.begin,C=A.rs))for(w=q?w:1,O=0;l>O;O++)C.push(w);if(ei(M)){var X=N.getWireframeGeometry(M);if(X)Ak(N,M,X);else{var S=N.getWireframe(M);S&&Ak(N,M,S)}}H.labelInfo=H.label2Info=H.noteInfo=H.note2Info=H._38o=R,H._24O(Ym,"getLabel"),H._24O(Vr,"getLabel2"),H._26O(Gj,"getNote"),H._26O(Sh,"getNote2"),H._15O(),H.interactiveInfo=N.isInteractive(M)?{}:R,H._iv=!1}q&&Xi(E,B.uBrightness,w),Xi(E,B.uAlphaTest,H.s("alphaTest")),Xi(E,B.uUseEnvMap,M.s("envmap")?!0:!1),Xi(E,B.uReflectivity,M.s("envmap")||.01),t=Sr(E,B,d,x,M,wj),t&&(Ii(t,U[b],e),Ii(t,N._polylineIndexMap[b],N._polylineModelMap),Ii(t,N._wireframeIndexMap[b],N._wireframeModelMap)),U[b]||H._80o(E,B,W),N.isLabelVisible(M)&&((p=H.labelInfo)&&(Sr(E,B,d,x,M,Ym),H._28O(p,Ym,W)),(p=H.label2Info)&&(Sr(E,B,d,x,M,Vr),H._28O(p,Vr,W))),N.isNoteVisible(M)&&((p=H.noteInfo)&&(Sr(E,B,d,x,M,Gj),H._29O(p,Gj,W)),(p=H.note2Info)&&(Sr(E,B,d,x,M,Sh),H._29O(p,Sh,W))),(p=H._38o)&&H._99O(E,B,p,d,x,W),q&&Xi(E,B.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return sh},_80o:function(){},dispose:function(){},_calcAnchorMat:function(P){if(P.hasOwnProperty("_anchor")||P.hasOwnProperty("_anchorElevation")){var B=P.getAnchor3d(),s={x:B.x-.5,y:B.y-.5,z:B.z-.5},z=bj();return wh(z,[-s.x,-s.y,-s.z]),z}},getBodyColor:function(s){var E=this.data,G=this.gv.getBodyColor(E);return G?G:s?E.getStyle(s):R},_24O:function(v,Z){var V=this,b=V.data,F=V.gv,P=V.s,s=F[Z](b);
if(s!=R){var G=P(v+".scale"),W=P(v+".max"),o=V[v+"Info"]={label:s,textureScale:P(v+".texture.scale"),color:F[Z+"Color"](b),font:P(v+".font"),align:P(v+".align"),background:F[Z+"Background"](b)},D=o.rect=ol(o,s);W>0&&W<D.width&&(o.labelWidth=D.width,D.width=W),D.x=D.y=0,D.width*=G,D.height*=G,o.mat=V._16O(P(v+".autorotate"),P(v+".position"),D,P(v+".face"),P(v+".t3"),P(v+".r3"),P(v+".rotationMode"));var L=D.width/2,x=D.height/2;o.vs=new pq([-L,x,0,-L,-x,0,L,-x,0,L,x,0]),D.width/=G,D.height/=G}},_26O:function(b,g){var y=this,S=y.data,E=y.gv,c=y.s,h=E[g](S);if(h!=R){var F=c(b+".scale"),T=this[b+"Info"]={note:h,textureScale:c(b+".texture.scale"),expanded:c(b+".expanded"),font:c(b+".font"),color:c(b+".color"),align:c(b+".align"),borderWidth:c(b+".border.width"),borderColor:c(b+".border.color"),background:E[g+"Background"](S)};if(T.expanded){var k=c(b+".max"),x=ol(T,h);x.width+=6,x.height+=2,k>0&&k<x.width&&(T.labelWidth=x.width,x.width=k);var M={x:-x.width/2,y:-8-x.height,width:x.width,height:x.height+8}}else M={x:-6,y:-18,width:12,height:18};T.mat=y._16O(c(b+".autorotate"),c(b+".position"),R,c(b+".face"),c(b+".t3"),c(b+".r3"),c(b+".rotationMode")),T.rect=M,1!==F&&(M=Pb(M),M.x*=F,M.height*=F,M.y=-M.height,M.width*=F);var B=M.x,A=M.y,z=M.width,P=M.height;T.vs=new pq([B,-A,0,B,-A-P,0,B+z,-A-P,0,B+z,-A,0])}},_28O:function(p,J,A){if(A(this.s(J+".transparent"))){var X=p.rect,s=p.textureScale,j=X.width*s,i=X.height*s;if(j>=1&&i>=1){var E=xn(j,i);1!==s&&(E.translate(E,X.x,X.y),E.scale(s,s),E.translate(E,-X.x,-X.y)),Pm(E,p),E.restore(),ml(this,J,p.mat,p.vs,!0)}}},_29O:function(H,S,h){if(h(this.s(S+".transparent"))){var Y=H.rect,x=H.textureScale,u=Y.x,i=Y.y,W=Y.width*x,d=Y.height*x;if(W>=1&&d>=1){Y.x=Y.y=0;var Z=xn(W,d);1!==x&&Z.scale(x,x),Hd(Z,H),Z.restore(),Y.x=u,Y.y=i,ml(this,S,H.mat,H.vs,!1)}}},_99O:function(L,N,w,C,Z,d){if(w){var m=this,P=m.gv,W=m.data,F=P._buffer,U=P._1O,l=w.icons;for(var u in l){var b=l[u],s=w.rects[u];if(s&&d(li(b.transparent,W,P))){Sr(L,N,C,Z,W,u);var _=li(b.shape3d,W,P),f=_?[_]:li(b.names,W,P),g=f?f.length:0,x=li(b.textureScale,W,P)||1,Q=li(b.light,W,P);Q==R&&(Q=_?!0:!1),Xo(L,N,li(b.blend,W,P),Q,li(b.opacity,W,P),li(b.reverseFlip,W,P),li(b.reverseColor,W,P),li(b.reverseCull,W,P));for(var X=0;g>X;X++){var p=f[X],n=s[X];if(Fr(m,n.mat),_)ih(P,W,Ld(m,_),m);else{var y=ed(p);if(y){var S=n.width*x,$=n.height*x;if(S>=1&&$>=1){var V=xn(S,$);jg(V,y,li(b.stretch,W,P),0,0,S,$,W,P),V.restore(),bh(L,Fj,U),Xk(L,N,U,li(b.discardSelectable,W,P),F.uv,iq),gk(L,F.vs,n.vs,N.aPosition),ld(L,F.ns,dc,N.aNormal),$g(L,F.is,fm),Uq(L,0,fm.length),Cp(L,N,U)}}}Og(P)}Je(L,N)}}}}});var qp=function(Y,d){Id(qp,this,[Y,d])};Ci(qp,Eq,{_16O:function(G,o,f,t,n,L,O,R,H){var j=this.data,K=j.getFinalScale3d(),b=zl(o,K,f,t,R,H);if(j.hasOwnProperty("_anchor")||j.hasOwnProperty("_anchorElevation")){var l=j.getAnchor3d();b[0]-=(l.x-.5)*K[0],b[1]-=(l.y-.5)*K[1],b[2]-=(l.z-.5)*K[2]}return ee(bj(),b,j.p3(),t,n,L,O,G,j.getFinalRotation3d(),j.getRotationMode())},clear:function(){var w=this;w.faceMat=w.mat=w.shapeModel=w.left=w.right=w.front=w.back=w.top=w.bottom=w.csg=R},needValidate:function(c){if(this._iv)return this._validateFrameId=c._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var k=c._renderInfo.frame;if(this._validateFrameId!==k)return this._validateFrameId=k,!0}return!1},validate:function(F,Q){var G=this,k=G.gv,C=G.data,_=Ld(G);G._updateAutoRotation(),G._updateFixSize2d(),G._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(eg(k,C,"_wireframeModelMap","_wireframeIndexMap"),eg(k,C,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var B=Tr(C,k.getMat(C),_?G.s("shape3d.scaleable"):!0),X=G._calcAnchorMat(C);if(X&&yd(B,B,X),C.mat=B,G.clear(),F){var S=[];_?ki(k,C,_,G,G.getBodyColor(),[B],F,S):(Er(k,C,F,Q,B,Xf,S,_p),Er(k,C,F,Q,B,pp,S,qe),Er(k,C,F,Q,B,Cd,S,Bh),Er(k,C,F,Q,B,bn,S,uk),Er(k,C,F,Q,B,Vb,S,Gc),Er(k,C,F,Q,B,Lo,S,hl)),S.length&&(Oj(F.vs,S),Oj(F.ns,fn(S)))}else G.mat=B,(G.shapeModel=_)||(G._cubeUvs=null,G.vf(Xf,0),G.vf(pp,16),G.vf(Vb,8),G.vf(Lo,24),G.vf(Cd,32),G.vf(bn,40))},_updateAutoRotation:function(){var P=new kr;return function(){var I=this,F=I.data,g=I.s("shape3d.autorotate");if(!g)return F._dynamicRotation&&delete F._dynamicRotation,void 0;var l,c=I.gv;l="string"==typeof g?[g.indexOf("x")<0?c._eye[0]:c._center[0],g.indexOf("y")<0?c._eye[1]:c._center[1],g.indexOf("z")<0?c._eye[2]:c._center[2]]:c._eye;var B=c._center,s=F.p3(),y=uc([s[0]+l[0]-B[0],s[1]+l[1]-B[1],s[2]+l[2]-B[2]],s,c._up),a=F.r3();P.set(0,0,0,F.getRotationMode(),!0).setFromRotationMatrix(y),Math.abs(a[0]-P.x)<1e-5&&Math.abs(a[1]-P.y)<1e-5&&Math.abs(a[2]-P.z)<1e-5||(F._dynamicRotation=[P.x,P.y,P.z])}}(),_updateFixSize2d:function(){var s=this,Z=s.data,C=s.s("shape3d.fixSizeOnScreen");if(!C)return Z._dynamicScale3d&&delete Z._dynamicScale3d,void 0;var e=s.gv;Z.getFinalScale3d();var u=Tr(Z,e.getMat(Z)),m=up([0,0,0],u),b=e.toViewPosition(m);if(!isNaN(b.x)&&!isNaN(b.y)){var I=up([1,0,0],u),S=e.toViewPosition(I),o=up([0,1,0],u),h=e.toViewPosition(o),r=S.x-b.x,q=h.y-b.y,T=Z._dynamicScale3d||[1,1,1],t=ed(Z.s("shape3d.image")),x=C[0]>0?C[0]:t?se(t,s):20,G=C[1]>0?C[1]:t?Qo(t,s):20,n=Math.abs(r/x),W=Math.abs(q/G);Math.abs(n-1)<.001&&Math.abs(W-1)<.001||(Z._dynamicScale3d=[T[0]/n,T[1]/W,T[2]])}},_updateOverlapping:function(){var Q=this,q=Q.s("hide.overlapping.group");if(!q)return Q._rectOverlapping&&(Q._rectOverlapping=j),void 0;var X,U,v,I=Q.gv,h=Q.data,s=Tr(h,I.getMat(h)),o=1/0,l=1/0,z=-1/0,d=-1/0,A=h.getAnchor3d(),T=A.x,E=A.y,k=A.z;for(X=0;8>X;X++){if(U=up([(X>>2)-T,(1&X>>1)-E,(1&X)-k],s),v=I.toViewPosition(U),isNaN(v.x)||isNaN(v.y))return;o=Math.min(o,v.x),z=Math.max(z,v.x),l=Math.min(l,v.y),d=Math.max(d,v.y)}var n={x:o,y:l,w:z-o,h:d-l};Q._rectOverlapping=I.overlappingBox.isOverlapping(q,n)},getVectorDynamicSize:function(){var C,s=this,a=s.s("shape3d"),v=s.data;if("billboard"===a||"plane"===a||(C=v._currentCubeElementId)!=R){var Q,q,H=s.gv,G=Tr(v,H.getMat(v)),J=v.getAnchor3d(),N=.5-J.x,F=.5-J.y,m=.5-J.z,B=s.s("shape3d.vector.dynamic.maxsize"),c=function(i,$){i[0]+=N,i[1]+=F,i[2]+=m,$[0]+=N,$[1]+=F,$[2]+=m;var p=H.toViewPosition(up(i,G)),D=H.toViewPosition(up($,G)),T=p.x-D.x,t=p.y-D.y;return Math.min(B,Math.sqrt(T*T+t*t))};if("billboard"===a)Q=c([-.5,0,0],[.5,0,0]),q=c([0,-.5,0],[0,.5,0]);else if("plane"===a)Q=c([-.5,0,0],[.5,0,0]),q=c([0,0,-.5],[0,0,.5]);else if(v._currentCubeElementId!=R){var w=3*mg[C+1],e=3*mg[C],k=3*mg[C+2];Q=c([om[w],om[w+1],om[w+2]],[om[k],om[k+1],om[k+2]]),q=c([om[w],om[w+1],om[w+2]],[om[e],om[e+1],om[e+2]])}return[Q,q]}},getCachedTexture:function(){var O=this,C=O.data,A=C._currentCubeElementId;return A!=R?O._cubeCachedImage?O._cubeCachedImage[A]:null:O._shape3dCachedImage},setCachedTexture:function(e){var Y=this,k=Y.data,C=k._currentCubeElementId;if(C!=R){if(!Y._cubeCachedImage)return Y._cubeCachedImage={};Y._cubeCachedImage[C]=e}else Y._shape3dCachedImage=e},invalidateCachedTexture:function(T){var S,v,q,k=this;if((q=k._shape3dCachedImage)&&(T.deleteTexture(q),k._shape3dCachedImage=null),v=k._cubeCachedImage){for(S in v)T.deleteTexture(v[S]);k._cubeCachedImage=null}},vf:function(M,n){var p=this;if(p.gv.getFaceVisible(p.data,M)){var W=lh(p,M);W.mat&&(p.faceMat=!0);var S=W.uv;if(S){var J=p._cubeUvs;J||(J=p._cubeUvs=new pq([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var Q=0;8>Q;Q++)J[n+Q]=S[Q]}return W}},_80o:function(i,h,y){var r=this;if(r._rectOverlapping)return!0;var $=r.gv,V=r.data,O=$._cube,A=r.shapeModel;jn($,r.mat),A?ih($,V,A,r,r.getBodyColor(),y):(gk(i,O.vs,R,h.aPosition),gk(i,O.ns,R,h.aNormal),yk(i,O.is),r._18O(i,h,r.left,0,y),r._18O(i,h,r.front,6,y),r._18O(i,h,r.right,12,y),r._18O(i,h,r.back,18,y),r._18O(i,h,r.top,24,y),r._18O(i,h,r.bottom,30,y)),Og($),r.faceMat&&(r._18O(i,h,r.left,0,y,!0),r._18O(i,h,r.front,6,y,!0),r._18O(i,h,r.right,12,y,!0),r._18O(i,h,r.back,18,y,!0),r._18O(i,h,r.top,24,y,!0),r._18O(i,h,r.bottom,30,y,!0))},_18O:function(L,v,K,s,e,u){if(K){if(!e(K.transparent))return;if(u&&!K.mat||!u&&K.mat)return;u&&jn(this.gv,K.mat);var H=this,Z=H.data;Z._currentCubeElementId=s;var m=H.gv,V=m.getTexture(K.texture,Z),X=K.uv,a=K.uvScale,r=K.uvOffset,l=K.discardSelectable;V?X?Xk(L,v,V,l,m._buffer.uv,H._cubeUvs,r,a):Xk(L,v,V,l,m._cube.uv,R,r,a):Xk(L),Xo(L,v,K.blend,K.light,K.opacity,K.reverseFlip,K.reverseColor,K.reverseCull),Xi(L,v.uDiffuse,K.color),Uq(L,s,6),Je(L,v),Cp(L,v,V),u&&Og(m),Z._currentCubeElementId=null}}});var Aj=function(Z,u){Id(Aj,this,[Z,u])};Ci(Aj,Eq,{_25Q:1,validate:function(X){var i=this,e=i.gv,l=i.data,F=i.s,q=F("edge.width"),n=l._40I,j=l._41I;if(i.shapeModel=i.info=R,n&&j){var s,k,H,g,a,y,p,x,u,E,t=l.isLooped(),N=F(fo),Y=d.getEdgeType(N);if(Y){var Z=Y(l,Tp(i,e,l,t,N),e,i._19Q);if(!Z.points||Z.points.isEmpty())return;y=i.info={},p=Z.segments,a=Z.points,x=a.size();for(var K=n.getElevation(),U=j.getElevation(),m=0;x>m;m++){var G=a.get(m);G.e==R&&(G.e=K+(U-K)*m/(x-1))}u=sf(a.get(0)),E=sf(a.get(x-1));var J=x%2;0===J?(y.c1=sf(a.get(x/2-1)),y.c2=sf(a.get(x/2))):y.p3=sf(a.get((x-J)/2)),y.s1=u,y.s2=sf(a.get(1)),y.t1=sf(a.get(x-2)),y.t2=E}else{a=new ob,y=i.info={};var r=F("edge.offset"),Q=F("edge.center"),$=F("edge.source.t3"),o=F("edge.target.t3"),C=n.p3(),I=j.p3();if($&&(C[0]+=$[0],C[1]+=$[1],C[2]+=$[2]),o&&(I[0]+=o[0],I[1]+=o[1],I[2]+=o[2]),N===Ue){p=F("edge.segments");var O=y.points=F(ip)||Fb;if(x=O.size()){u=sf(O.get(0)),E=sf(O.get(x-1)),!Q&&r&&(H=jf(u,C,!0),r=f(r,Yi(C,u)),C=[C[0]+H[0]*r,C[1]+H[1]*r,C[2]+H[2]*r],H=jf(I,E,!0),r=f(r,Yi(E,I)),I=[I[0]-H[0]*r,I[1]-H[1]*r,I[2]-H[2]*r]);var J=x%2;0===J?(s=sf(O.get(x/2-1)),k=sf(O.get(x/2))):y.p3=sf(O.get((x-J)/2)),y.s1=C,y.s2=u,y.t1=E,y.t2=I}else!Q&&r&&(H=jf(I,C,!0),g=Yi(C,I),r=qm(r,g),C=[C[0]+H[0]*r,C[1]+H[1]*r,C[2]+H[2]*r],I=[I[0]-H[0]*r,I[1]-H[1]*r,I[2]-H[2]*r]),s=C,k=I;a.add({x:C[0],y:C[2],e:C[1]}),a.addAll(O),a.add({x:I[0],y:I[2],e:I[1]})}else{var W=Tp(i,e,l,t,N);if(i._19Q||(W=-W),t){var c=C[0],M=C[1],b=C[2],v=n.getTall()/2+W;s=[c-W,M+v,b],k=[c+W,M+v,b],a.add({x:c-W,y:b,e:M}),a.add({x:c-W,y:b,e:M+v}),a.add({x:c+W,y:b,e:M+v}),a.add({x:c+W,y:b,e:M})}else{H=jf(I,C,!0),g=Yi(C,I);var z={x:C[0],y:C[2]},D={x:I[0],y:I[2]},L=wp(R,z,D,W),w=L.x-z.x,A=L.y-z.y;r=qm(r,g),H[0]*=r,H[1]*=r,H[2]*=r,s=[C[0]+H[0]+w,C[1]+H[1],C[2]+H[2]+A],k=[I[0]-H[0]+w,I[1]-H[1],I[2]-H[2]+A],Q?(a.add({x:C[0],y:C[2],e:C[1]}),a.add({x:s[0],y:s[2],e:s[1]}),a.add({x:k[0],y:k[2],e:k[1]}),a.add({x:I[0],y:I[2],e:I[1]})):(a.add({x:s[0],y:s[2],e:s[1]}),a.add({x:k[0],y:k[2],e:k[1]}))}}y.c1=s,y.c2=k}y.list=F(jk)===Rd?i.createTubeModel(a,p,q/2,X):i.createLineModel(a,p,q,"edge","edge.dash")}}});var vh=function($,d){Id(vh,this,[$,d])};Ci(vh,qp,{_80o:function(r,N,u){var w=this,y=w.gv,V=w.shapeModel;jn(y,w.mat),V?ih(y,w.data,V,w,w.getBodyColor(),u):(am(w,r,N,w.left,u),am(w,r,N,w.front,u),am(w,r,N,w.right,u),am(w,r,N,w.back,u),am(w,r,N,w.top,u),am(w,r,N,w.bottom,u)),Og(y)},validate:function(P,k){var B,r,v=this,b=v.s,s=v.data,x=s.p3(),e=s._thickness/2,Q=s.isClosePath(),p=s.getPoints(),H=s.getSegments(),q=b(yg),T=P&&P.uv;if(v.clear(),0>e)r=v.shapeModel=wq(p,H,b(dj),b(Jl),q,b(rr),s.getTall(),s.getShapeElevation(),Q),b(ik)?b("shape3d.image")||delete r.uv:(delete r.vs,delete r.ns,delete r.uv),b("shape3d.top.image")||delete r.top_uv,b("shape3d.bottom.image")||delete r.bottom_uv;else if(b(jk)===Rd)B=Sq(p,H,q,Q),r=v.shapeModel={vs:[]},b("shape3d.image")&&(r.uv=[],r.sum=b(rr)||mh(B)||1,r.len=0),b(dj)&&!Q&&(r.top_vs=[],b("shape3d.top.image")&&(r.top_uv=[])),b(Jl)&&!Q&&(r.bottom_vs=[],b("shape3d.bottom.image")&&(r.bottom_uv=[])),v._12O(B,e);else{var M,D,w,j,i,X,J,y,g,K;if(B=Sq(p,H,q,Q),i=v.vf(Vb,T,!1,k),e&&(X=v.vf(Lo,T,!1,k),J=Q?R:v.vf(Xf,T,!1,k),y=Q?R:v.vf(pp,T,!1,k),g=v.vf(Cd,T,!1,k),K=v.vf(bn,T,!1,k)),e){for(var z=0,O=B.length;O>z;z++)B[z]=v._tryRemoveBezierPoints(B[z],e);v._12O(B,e)}else i&&B.forEach(function(O){if(j=O.length,j>0)for(M=O[0],w=1;j>w;w++)D=O[w],v.addV(i.vs,M,D),M=D});v._20Q(B),P||(i&&(i.ns=fn(i.vs),tq(i,"vs"),tq(i,Jg)),e&&(X&&(X.ns=fn(X.vs),tq(X,"vs"),tq(X,Jg)),J&&(J.ns=fn(J.vs),tq(J,"vs"),tq(J,Jg)),y&&(y.ns=fn(y.vs),tq(y,"vs"),tq(y,Jg)),g&&(g.ns=fn(g.vs),tq(g,"vs"),tq(g,Jg)),K&&(K.ns=fn(K.vs),tq(K,"vs"),tq(K,Jg))))}var V=v.mat=bj();wh(V,x),Ng(V,s.getFinalRotation3d(),s.getRotationMode());var Z=s.getScale3d(),f=s._dynamicScale3d;f&&(Z[0]*=f[0],Z[1]*=f[1],Z[2]*=f[2]),zo(V,Z),wh(V,cp(x)),P&&(_b(v,V,P,r),v.clear())},_20Q:function(E){var H,o,C,c,z,T,p,s=this,r=s.front,k=s.back,F=s.top,d=s.bottom,b=r?r.tuv:R,y=k?k.tuv:R,U=F?F.tuv:R,t=d?d.tuv:R,Y=0;(b||y||U||t)&&(H=s.s(rr)||mh(E)||1,E.forEach(function(J){if(o=J.length,o>0)for(T=J[0],C=1;o>C;C++)p=J[C],c=Y/H,Y+=Yi(T,p),z=Y/H,s._14O(r,c,z),s._14O(k,1-z,1-c),s._14O(F,c,z),s._14O(d,c,z),T=p}))},_14O:function(G,B,k){if(G){var R=G.uv,e=G.tuv;if(e){if(R)var Z=R[0]+(R[6]-R[0])*B,T=R[1]+(R[7]-R[1])*B,M=R[2]+(R[4]-R[2])*B,p=R[3]+(R[5]-R[3])*B,L=R[2]+(R[4]-R[2])*k,F=R[3]+(R[5]-R[3])*k,C=R[0]+(R[6]-R[0])*k,z=R[1]+(R[7]-R[1])*k;else Z=B,T=0,M=B,p=1,L=k,F=1,C=k,z=0;e.push(M,p,L,F,C,z,C,z,Z,T,M,p)}}},_13O:function(h){var n=h.uv,y=h.tuv;y&&(n?y.push(n[2],n[3],n[4],n[5],n[6],n[7],n[6],n[7],n[0],n[1],n[2],n[3]):y.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(A,o){var V=A.length;if(4>V)return A;var S,v,$,r,c,l,D=!1,H=function(E){return A[E]},k=function(y){return A[V-1-y]};for(c=0;1>=c;c++)for(l=c?k:H,v=l(0),$=l(1),S=2;V-1>S;S++)if(r=l(S),!r.remove)if(r.b){var P=wp(v,$,r,o);P.adjust?(r.remove=!0,D=!0):(v=$,$=r)}else v=$,$=r;if(!D)return A;var R=[];for(S=0;V>S;S++)A[S].remove||R.push(A[S]);return R},_12O:function(G,X){var e,v,t,I,T,J=this;G.forEach(function(x){if(T=x.length,T>0)for(e={p:x[0],n:!0},I=1;T>I;I++)v=x[I],t=T-1>I?x[I+1]:R,J.addPoint(e,v,t,X,x)})},addPoint:function(N,F,K,Q,A){var $,u,T,s,S,Y,C,i,k,o=this,p=N.p,L=N.f,D=N.b,v=o.s("shape3d.side")||yb,V=o.s("shape3d.start.angle"),P=o.s("shape3d.sweep.angle"),U=o.shapeModel,j=o.data.isClosePath();if(N.n&&(N.n=!1,L=j&&A.length>2?wp(A[A.length-2],p,F,Q):wp(R,p,F,Q),D=Qc(p,L),U?U.top_vs&&o._10O(D,L,v,V,P,U.top_vs,U.top_uv):($=o.left)&&(o.addV($.vs,D,L),o._13O($))),u=K?wp(p,F,K,Q):j&&A.length>2?wp(p,F,A[1],Q):wp(p,F,R,Q),T=Qc(F,u),U){var y,h,G=U.vs,x=U.uv,l=U.sum;for(x&&(y=U.len/l,U.len+=Yi(p,F),h=U.len/l),Y=o._9O(D,L,v,V,P),C=o._9O(T,u,v,V,P),i=0;v>i;i++)k=i+1,Oj(G,Y[k]),Oj(G,C[i]),Oj(G,Y[i]),Oj(G,C[i]),Oj(G,Y[k]),Oj(G,C[k]),x&&(s=i/v,S=k/v,x.push(y,S,h,s,y,s,h,s,y,S,h,S));!K&&U.bottom_vs&&o._10O(T,u,v,V,P,U.bottom_vs,U.bottom_uv,!0)}else!K&&($=o.right)&&(o.addV($.vs,u,T),o._13O($)),($=o.front)&&o.addV($.vs,L,u),($=o.back)&&o.addV($.vs,T,D),($=o.top)&&o.addH($.vs,L,u,T,D,!0),($=o.bottom)&&o.addH($.vs,D,T,u,L);N.p=F,N.f=u,N.b=T},_10O:function(E,H,f,Z,W,x,L,U){var I,u,J=this,r=J.data,B=J._9O(E,H,f,Z,W),h=(E.x+H.x)/2,O=(E.y+H.y)/2,R=r.getShapeElevation(),b=0;for(b=0;f>b;b++)U?(Oj(x,B[b]),Oj(x,B[b+1])):(Oj(x,B[b+1]),Oj(x,B[b])),Oj(x,[h,R,O]),L&&(U?(I=m*(b+1)/f+Z,u=m*b/f+Z):(I=m*b/f+Z,u=m*(b+1)/f+Z),L.push(.5-.5*D(u),.5-.5*w(u),.5-.5*D(I),.5-.5*w(I),.5,.5))},_9O:function(Q,A,u,b,M){var E,O,g=this,p=g.data,P=[],r=(Q.x+A.x)/2,Z=(Q.y+A.y)/2,t=p.getTall()/2,n=p.getShapeElevation(),N=0;for(M=M||m;u>=N;N++)E=M*N/u+b,O=D(E),P.push([r+(Q.x-r)*O,n+t*w(E),Z+(Q.y-Z)*O]);return P},addV:function(L,c,B){var b=c.x,F=c.y,o=B.x,n=B.y,h=this.data,g=h.getShapeElevation(),U=h.getTall()/2;L.push(b,g-U,F,o,g-U,n,o,g+U,n,o,g+U,n,b,g+U,F,b,g-U,F)},addH:function(x,i,R,A,F,K){var b=this.data,Q=b.getTall()/2,B=b.getShapeElevation()+(K?Q:-Q);x.push(i.x,B,i.y,R.x,B,R.y,A.x,B,A.y,A.x,B,A.y,F.x,B,F.y,i.x,B,i.y)},vf:function(F,G,X,q){var E,e=this,y=e.gv.getFaceVisible(e.data,F);return(X||y)&&(E=lh(e,F,q),E.vs=[],E.tuv=y&&(E.texture||G)?[]:R,E.visible=y),E}});var $f=function(s,B){Id($f,this,[s,B])};Ci($f,Eq,{_25Q:1,validate:function(i){var N=this,D=N.data,F=N.s,r=D.getPoints(),d=r.size();if(N.shapeModel=N.info=R,d>1){var v=N.info={},M=D.getSegments(),L=D.getThickness(),W=sf(r.get(0)),G=sf(r.get(d-1)),H=d%2;0===H?(v.c1=sf(r.get(d/2-1)),v.c2=sf(r.get(d/2))):v.p3=sf(r.get((d-H)/2)),v.s1=W,v.s2=sf(r.get(1)),v.t1=sf(r.get(d-2)),v.t2=G,v.list=F(jk)===Rd?N.createTubeModel(r,M,L/2,i):N.createLineModel(r,M,L,"shape.border","shape.dash")}var C=D.p3(),P=N.mat=bj();wh(P,C),Ng(P,D.getFinalRotation3d(),D.getRotationMode());var q=D.getScale3d(),f=D._dynamicScale3d;f&&(q[0]*=f[0],q[1]*=f[1],q[2]*=f[2]),zo(P,q),wh(P,cp(C))},_80o:function(E,W,b){var O=this,o=O.shapeModel;if(o){var u=O.gv;jn(u,O.mat),ih(u,O.data,o,O,O.getBodyColor(),b),Og(u)}}});var Qr=q.graph3d.VR=function(r){var C=this;C.gv=r,C._controllers=[],C.switch=new zm(C),C._enable=!1,C._defaultCallLater=q.Default.callLater,C._defaultCancelLater=Ll,"undefined"!=typeof F&&"VRFrameData"in F&&(C._frameData=new F.VRFrameData),C.measureOflength=1,C.eyesOffset=[0,0,0],C._orientation=new q.Math.Quaternion,C._lastHeadPose=[0,0,0],C._offsetToBeAdd=[0,0,0],C._fpsInfo={time:0,fps:0,frames:0}};Ci(Qr,G,{ms_fire:!0,_42:function(j,e,U,M){var r=this,A=r.gv;if(!A.drawFilter&&r._deviceInAction){var i=r._device;if(i){var G=r._measureOflength;i.depthNear=A.getNear()*G,i.depthFar=A.getFar()*G;var H=r._offsetToBeAdd;if(r.eyesOffset[0]+=H[0],r.eyesOffset[1]+=H[1],r.eyesOffset[2]+=H[2],H[0]=0,H[1]=0,H[2]=0,i.isPresenting===!1)return r._controllers.forEach(function(K){K&&K.update()}),A.iv(),!1;var K=r._frameData;i.getFrameData(K);var J=K.pose.position;if(J){var L=r.toViewPosition(J);A.setEye(L),r._orientation.fromArray(K.pose.orientation);var k=new q.Math.Vector3(0,0,-10*r._scaleFactor);k.applyQuaternion(r._orientation),A.setCenter([L[0]+k.x,L[1]+k.y,L[2]+k.z])}r._controllers.forEach(function(o){o&&o.update()}),A.setViewport(j,0,0,e/2,U),r._viewMatrix=r._copyViewMatrix(K.leftViewMatrix),r._projectMatrix=r._copyProjectMatrix(K.leftProjectionMatrix),M(),A.setViewport(j,e/2,0,e/2,U),r._viewMatrix=r._copyViewMatrix(K.rightViewMatrix),r._projectMatrix=r._copyProjectMatrix(K.rightProjectionMatrix),M(),r._lastViewMatrix=r._viewMatrix,r._lastProjectMatrix=r._projectMatrix,r._viewMatrix=null,r._projectMatrix=null,r.submitFrame();var y=Date.now(),R=r._fpsInfo;return y-R.time>1e3?(R.fps=Math.round(1e3*(R.frames+1)/(y-R.time)),R.time=y,R.frames=0):R.frames++,!0}}},onVRDisplayPresentChange:function(){var p=this.isPresenting();this._injectGraphView(p),this.fp("present",!p,p)},getOrientation:function(){return this._orientation},addController:function(F){F=F||0;var Q=this,C=Q.getController(F);return C?C:(C=new ar(Q,F),Q._controllers.push(C),C)},getController:function(W){W=W||0;for(var G=this._controllers,U=0,Z=G.length;Z>U;U++)if(G[U]&&G[U].id===W)return G[U];return null},removeController:function(o){o=o||0;for(var B=this._controllers,R=0,d=B.length;d>R;R++)if(B[R]&&B[R].id===o)return B.splice(R,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(W,Q){var e=this,B=e._scaleFactor,l=e._eyesOffset,$=e._lastHeadPose;return $[0]=W[0]*B,$[1]=W[1]*B,$[2]=W[2]*B,Q?(Q[0]=$[0]+l[0],Q[1]=$[1]+l[1],Q[2]=$[2]+l[2],Q):[$[0]+l[0],$[1]+l[1],$[2]+l[2]]},addEyesOffset:function(D,f,u){var r=this._offsetToBeAdd;r[0]+=D,r[1]+=f,r[2]+=u},_copyViewMatrix:function(Y){var f=this.dup(Y),M=this._scaleFactor;f[12]*=M,f[13]*=M,f[14]*=M;var u=this._eyesOffset;if(u&&(u[0]||u[1]||u[2])){var l=u[0],r=u[1],B=u[2];f[12]-=f[0]*l+f[4]*r+f[8]*B,f[13]-=f[1]*l+f[5]*r+f[9]*B,f[14]-=f[2]*l+f[6]*r+f[10]*B}return f},shutdown:function(){var x=this._device;x&&x.isPresenting&&x.exitPresent()},isPresenting:function(){var K=this._device;return K&&K.isPresenting},_copyProjectMatrix:function(p){var r=this.dup(p),m=this._scaleFactor;return r[14]*=m,r},dup:function(M,D){for(var f=M.length,X=D||new Array(f);f--;)X[f]=M[f];return X},getViewMatrix:function(T){var P=this._viewMatrix;return P?this.dup(P,T):void 0},getProjectMatrix:function(){var H=this._projectMatrix;return H?this.dup(H):void 0},submitFrame:function(){var S=this;if(S._enable&&S._deviceInAction){var e=S._device;e&&e.isPresenting&&(e.submitFrame(),S.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(m){var G=this.gv;return G.intersectObjects(m,G.dm().getDatas())},setDevice:function(E){var C=this;C._device=E},_injectGraphView:function(){var p,F,U;return function(G){var b=this.gv;if(!G)return p&&(b.getWidth=p,b.getHeight=F,b.getDevicePixelRatio=U),void 0;var z=this._device,u=z.getEyeParameters("left"),E=u.renderWidth,Z=u.renderHeight;p=b.getWidth,F=b.getHeight,U=b.getDevicePixelRatio,b.getWidth=function(){return 2*E},b.getHeight=function(){return Z},b.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(l){var W=this;if(!l)return Dq=q.Default.callLater=W._defaultCallLater,Ll=q.Default.cancelLater=W._defaultCancelLater,void 0;var W=this;Dq=q.Default.callLater=function(d,Z,D,h){var q=W._device;return q&&q.isPresenting?h?I(function(){Dq(d,Z,D)},h):q.requestAnimationFrame(function(){W._deviceInAction=!0,d.apply(Z,D),W._deviceInAction=!1}):W._defaultCallLater(d,Z,D,h)},Ll=q.Default.cancelLater=function(a,I){var H=W._device;return H&&H.isPresenting?I?E(a):H.cancelAnimationFrame(a):W._defaultCancelLater(a,I)}}}),G.defineProperties(Qr.prototype,{enable:{get:function(){return this._enable},set:function(s){var m=this;m._enable!==s&&(m._enable=s,s?(m.switch.showButton(),m._injectCallLaterFunc(!0)):(m.shutdown(),m.switch.hideButton(),m._injectCallLaterFunc(!1)),m.fp("enable",!s,s))}},measureOflength:{get:function(){return this._measureOflength},set:function(K){this._measureOflength=K;var I=this._scaleFactor=1/K;this._controllers.forEach(function(z){z&&z._setScaleFactor(I)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(Q){this._eyesOffset=Q}},controllerModel:{get:function(){return this._controllerModel},set:function(B){var k;"object"==typeof B?(k=B.mtl,B=B.obj):(k=B+".mtl",B+=".obj");var G=this,h=G._controllerModel;h&&h.obj===B&&h.mtl===k||(h=G._controllerModel={obj:B,mtl:k},d.loadObj(B,k,{finishFunc:function(L,D){G._controllerModel===h&&d.setShape3dModel("vrControllerModel",D)}}))}},interactive:{get:function(){return!!this._interactive},set:function(f){!!f!=!!this._interactive&&(this._interactive=f,f&&this.addController(0),this.gv.getCoreInteractor().enableVR(f))}}});var ar=function(V,w){function n(d){var q=navigator.getGamepads&&navigator.getGamepads();if(q)for(var P=0,f=0,x=q.length;x>P;P++){var z=q[P];if(z){var H=z.id;if("OpenVR Gamepad"===H||"OpenVR Controller"===H||0===H.indexOf("Oculus Touch")||0===H.indexOf("Spatial Controller")){if(f===d)return z;f++}}}}function r(I,N,y){return Math.abs(I[0]-N[0])<y&&Math.abs(I[1]-N[1])<y&&Math.abs(I[2]-N[2])<y?!0:!1}var z=this;z.vr=V,z.id=w;var m,Q,q=[0,0],x=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],h=new Pc;h.s("shape3d","vrControllerModel"),h.isController=!0,h.s("intersect",!1),z.getGamepad=function(){return Q},z.isButtonPressed=function(l){for(var s,W=0,O=x.length;O>W;W++)if(s=x[W],s.id===l)return s.pressed;return!1},z.getNode=function(){return h};var O=.003;z.setRotationEpsilon=function(c){O=c};var U=5e-4,k=U;z.setPositionEpsilon=function(B){U=B,k=B*z.vr._scaleFactor},z._setScaleFactor=function(J){h.s3(J,J,J),k=U*J},z._setScaleFactor(z.vr._scaleFactor);var i,v=new Co,M=new Ih,y=[0,0,0],b=[0,0,0],p=new kr,L=new bd,g=new mj;z.getRay=function(){return i?(g.origin.fromArray(y),g.direction.copy(L),i=!1,g):g},z.update=function(){if(m=Q,Q=n(w),m!=Q&&console.log("gamepad changed",Q),!Q||Q.pose===j)return Q=null,h.s("3d.visible",!1),void 0;if(d.getShape3dModel("vrControllerModel")){h.dm()||V.gv.dm().add(h),h.s("3d.visible",!0);var I=Q.pose;if(null!==I){I.position&&(z.vr.toViewPosition(I.position,y),r(h.p3(),y,k)||(i=!0,h.p3(y))),I.orientation&&(v.fromArray(I.orientation),L.set(0,0,-1).applyQuaternion(v).normalize(),M.makeRotationFromQuaternion(v),p.set(0,0,0,h.getRotationMode(),!0).setFromRotationMatrix(M),b[0]=p.x,b[1]=p.y,b[2]=p.z,r(h.r3(),b,O)||(i=!0,h.r3(b))),i&&V.fp("gamepad.pose",null,{position:y,rotation:b,id:w});var o=Q.axes;(q[0]!==o[0]||q[1]!==o[1])&&(q=[o[0],o[1]],V.fp("gamepad.axes",null,{id:w,axes:q}));var K,B,P,l,S=Q.buttons;for(K=0,B=S.length;B>K;K++)if(P=S[K],l=P.pressed,l!==x[K].pressed){x[K].pressed=l;var c={id:w},W="state";c[W]=c._62O=l?"down":"up",V.fp("gamepad.button."+x[K].id,null,c)}}}}},zm=function(e){this.vr=e,this._button=null};Ci(zm,G,{showButton:function(){var q=this.assureButton();if(!q.parentNode){var k=this.vr.gv,B=k.getView();k._79O?B.insertBefore(q,k._79O):B.appendChild(q)}},hideButton:function(){var D=this._button;D&&D.parentNode&&D.parentNode.removeChild(D)},assureButton:function(){var M=this._button;return M?M:this._button=this.createButton(this.vr.gv)},createButton:function(P){function N(k,A){k.textContent=A&&A.isPresenting?"关闭 VR 显示":"开启 VR 显示"}function c(A){i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",N(i,A),i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){A.isPresenting?A.exitPresent():A.requestPresent([{source:P.getCanvas()}])},P.vr.setDevice(A)}function U(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",N(i,null),i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,P.vr.setDevice(null)}function q(D){D.style.position="absolute",D.style.bottom="20px",D.style.padding="12px 6px",D.style.border="1px solid #fff",D.style.borderRadius="4px",D.style.color="#000",D.style.font="normal 13px sans-serif",D.style.textAlign="center",D.style.opacity="0.5",D.style.outline="none",D.style.zIndex="999"}if("getVRDisplays"in navigator){var i=this._button=k.createElement("button");return i.style.display="none",q(i),F.addEventListener("vrdisplayconnect",function(z){c(z.display)},y),F.addEventListener("vrdisplaydisconnect",function(){U()},y),F.addEventListener("vrdisplaypresentchange",function(W){N(i,W.display),P.vr.onVRDisplayPresentChange()},y),navigator.getVRDisplays().then(function(S){S.length>0?c(S[0]):U()}),i}var C=k.createElement("a");return C.href="https://webvr.info",C.innerHTML="当前不支持 webvr",C.style.left="calc(50% - 90px)",C.style.width="180px",C.style.textDecoration="none",q(C),C}}),G.defineProperties(zm.prototype,{});var Se=q.graph3d.PostProcessing=function(X){function V(){if(!S){var q=X.getGL();S=new no.RenderTarget(X,q),Z=new al.Shader(q,H.vs,H.fs),h=al.Buffer.createIndexBuffer(q,new Uint16Array([0,2,1,1,2,3])),o=al.Buffer.createVertexBuffer(q,new Float32Array([0,0,1,0,0,1,1,1]))}}var S,Z,h,o,W=this,c={},f=!1;!function(){var L;for(L in Se)c[L]=new Se[L](X)}(),W.getModule=function($){return $?c[$]:c},W.getModuleList=function(){return G.keys(c)},W.handleDataModleChange=function(o,a){o&&(o.setPostProcessingData(W.serialize()),o.ump(W.onDataModelPropertyChange,W)),a&&(a.mp(W.onDataModelPropertyChange,W),W.deserialize(a.getPostProcessingData()))},W.onDataModelPropertyChange=function(N){"serialize"===N.property?X.dm().setPostProcessingData(W.serialize()):"deserialize"===N.property&&W.deserialize(X.dm().getPostProcessingData())},W.serialize=function(){var Z,B,O,L={};for(Z in c)B=c[Z],L[Z]={enable:B.enable},O=B.serializeProperties,O&&O.forEach(function(Q){L[Z][Q]=B[Q]});return L},W.deserialize=function(Z){if(Z){var o,C,U,i;for(o in Z){C=c[o],U=Z[o],W.enableModule(o,U.enable);for(i in U)"enable"!==i&&(C[i]=U[i])}}else{var o,C;for(o in c)C=c[o],C.enable=!1,C.resetProperties&&C.resetProperties()}},W.enableModule=function(l,A){var E,Q,N,W=l.split(",");for(E=0,Q=W.length;Q>E;E++)N=W[E].trim(),c[N]&&(c[N].enable=A);f=!1;for(N in c)if(c[N].enable){f=!0;break}f&&V()};var H={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};W._42=function(I,$,_,A,k){if(f&&!k){S.setSize(I,$,_),Gp(I,S.frame),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),X.setViewport(I,0,0,$,_),A();var i,m=S;for(i in c)m=c[i]._42(I,m)||m;return Gp(I,null),X.setViewport(I,0,0,$,_),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),Z.bind(),I.activeTexture(I.TEXTURE0+0),I.bindTexture(I.TEXTURE_2D,m.texture),Z.uniforms.image=0,h.upload(),o.upload(),Z.attributes.pos.pointer(o),I.drawElements(I.TRIANGLES,6,I.UNSIGNED_SHORT,0),I.bindTexture(I.TEXTURE_2D,null),I.useProgram(X._prg),!0}}},eh=q.graph3d.PostProcessing.Bloom=function(n){function E(){L=!0,y=[n.getWidth(),n.getHeight()];var t,k=n.getGL(),i=Math.round(y[0]/2),l=Math.round(y[1]/2);for(W=new no.RenderTarget(n,k,i,l),t=0;s>t;t++)j.push(new no.RenderTarget(n,k,i,l)),f.push(new no.RenderTarget(n,k,i,l)),i=Math.round(i/2),l=Math.round(l/2);N=new al.Shader(k,eh.highPassShader.vs,eh.highPassShader.fs);for(var t=0;s>t;t++)b[t]=new al.Shader(k,eh.blurShader.vs,eh.blurShader.fs.replace(/DEFINE_VALUE/g,q[t]));F=new al.Shader(k,eh.compositeShader.vs,eh.compositeShader.fs.replace(/NUM_MIPS/g,s)),c=new al.Shader(k,eh.finalShader.vs,eh.finalShader.fs),e=al.Buffer.createIndexBuffer(k,new Uint16Array([0,2,1,1,2,3])),V=al.Buffer.createVertexBuffer(k,new Float32Array([0,0,1,0,0,1,1,1]))}var t,J,M,e,V,H=this,d=!1,L=!1;this.serializeProperties="strength,threshold,radius".split(","),this.resetProperties=function(){t=1.5,J=.55,M=.4},G.defineProperties(H,{enable:{get:function(){return d},set:function(u){!!d!=!!u&&(d=u,u&&!L&&E())}},strength:{get:function(){return t},set:function(z){t=z}},threshold:{get:function(){return J},set:function(u){J=u}},radius:{get:function(){return M},set:function(s){M=s}}}),this.resetProperties();var W,N,F,c,y=[256,256],j=[],f=[],s=5,q=[3,5,7,9,11],b=[];H._42=function(A,H){function a(T,b,G,L){Gp(A,b.frame),n.setViewport(A,0,0,b.width,b.height),L?L(A):A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT),m!==T&&T.bind();var W=0;for(var P in G){var u=G[P];u instanceof WebGLTexture&&(A.activeTexture(A.TEXTURE0+W),A.bindTexture(A.TEXTURE_2D,u),u=W,W++),T.uniforms[P]=u}for(m!==T&&(e.upload(),V.upload(),T.attributes.pos.pointer(V),m=T),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0);W--;)A.activeTexture(A.TEXTURE0+W),A.bindTexture(A.TEXTURE_2D,null)}if(d){var m;a(N,W,{smoothWidth:.01,luminosityThreshold:J,tDiffuse:H.texture});var P,C=W,U=Math.round(y[0]/2),R=Math.round(y[1]/2);for(P=0;s>P;P++)a(b[P],j[P],{colorTexture:C.texture,direction:[1,0],texSize:[U,R]}),a(b[P],f[P],{colorTexture:j[P].texture,direction:[0,1],texSize:[U,R]}),U=Math.round(U/2),R=Math.round(R/2),C=f[P];return a(F,j[0],{blurTexture1:f[0].texture,blurTexture2:f[1].texture,blurTexture3:f[2].texture,blurTexture4:f[3].texture,blurTexture5:f[4].texture,bloomStrength:t,bloomRadius:M,bloomTintColor:[1,1,1]}),a(c,H,{image:j[0].texture},function(s){s.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.SRC_ALPHA,s.ONE)}),A.blendEquationSeparate(A.FUNC_ADD,A.FUNC_ADD),A.blendFuncSeparate(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA),H}}};eh.highPassShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D tDiffuse;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4(0.0, 0.0, 0.0, 0.0);","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},eh.blurShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D colorTexture;","uniform vec2 texSize;","uniform vec2 direction;","#define KERNEL_RADIUS DEFINE_VALUE","#define SIGMA DEFINE_VALUE","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float fSigma = float(SIGMA);","float weightSum = gaussianPdf(0.0, fSigma);","vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;","for( int i = 1; i < KERNEL_RADIUS; i ++ ) {","float x = float(i);","float w = gaussianPdf(x, fSigma);","vec2 uvOffset = direction * invSize * x;","vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;","vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;","diffuseSum += (sample1 + sample2) * w;","weightSum += 2.0 * w;","}","gl_FragColor = vec4(diffuseSum/weightSum, 1.0);","}"].join("\n")},eh.compositeShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D blurTexture1;","uniform sampler2D blurTexture2;","uniform sampler2D blurTexture3;","uniform sampler2D blurTexture4;","uniform sampler2D blurTexture5;","uniform sampler2D dirtTexture;","uniform float bloomStrength;","uniform float bloomRadius;","uniform vec3 bloomTintColor;","float lerpBloomFactor(const in float factor) {","float mirrorFactor = 1.2 - factor;","return mix(factor, mirrorFactor, bloomRadius);","}","void main() {","gl_FragColor = bloomStrength * ( lerpBloomFactor(1.0) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture1, vUv) + ","lerpBloomFactor(0.8) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture2, vUv) + ","lerpBloomFactor(0.6) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture3, vUv) + ","lerpBloomFactor(0.4) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture4, vUv) + ","lerpBloomFactor(0.2) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture5, vUv) );","}"].join("\n")},eh.finalShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};
var Ok=q.graph3d.PostProcessing.Fxaa=function(q){function y(){g=!0;var w=q.getGL();H=new al.Shader(w,Ok.ShaderSource.vs,Ok.ShaderSource.fs),Z=al.Buffer.createIndexBuffer(w,new Uint16Array([0,2,1,1,2,3])),r=al.Buffer.createVertexBuffer(w,new Float32Array([0,0,1,0,0,1,1,1])),V=new no.RenderTarget(q,w)}var Z,r,H,V,h=this,k=!1,g=!1;G.defineProperties(h,{enable:{get:function(){return k},set:function(V){!!k!=!!V&&(k=V,V&&!g&&y())}}}),h._42=function(M,j){function D(b,V,f,$){Gp(M,V.frame),q.setViewport(M,0,0,V.width,V.height),$?$(M):M.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),b.bind();var c=0;for(var A in f){var E=f[A];E instanceof WebGLTexture&&(M.activeTexture(M.TEXTURE0+c),M.bindTexture(M.TEXTURE_2D,E),E=c,c++),b.uniforms[A]=E}for(Z.upload(),r.upload(),b.attributes.pos.pointer(r),M.drawElements(M.TRIANGLES,6,M.UNSIGNED_SHORT,0);c--;)M.activeTexture(M.TEXTURE0+c),M.bindTexture(M.TEXTURE_2D,null)}if(k){var S=j.width,B=j.height;return V.setSize(M,S,B),D(H,V,{tDiffuse:j.texture,resolution:[1/S,1/B]}),V}}};Ok.ShaderSource={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},wg(d,{accordionViewExpandIcon:Cj(Zj),accordionViewCollapseIcon:Cj(Zj,!0),accordionViewLabelColor:Yq,accordionViewLabelFont:og,accordionViewTitleBackground:ai,accordionViewSelectBackground:rq,accordionViewSelectWidth:3,accordionViewSeparatorColor:j,splitViewDividerSize:1,splitViewDividerBackground:ai,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:De,rect:[2,2,12,12],background:Zj}]},propertyViewLabelColor:kn,propertyViewLabelSelectColor:Yq,propertyViewLabelFont:og,propertyViewExpandIcon:Cj(ni),propertyViewCollapseIcon:Cj(ni,!0),propertyViewBackground:Xm,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:dr,propertyViewColumnLineColor:dr,propertyViewSelectBackground:rq,listViewLabelColor:kn,listViewLabelSelectColor:Yq,listViewLabelFont:og,listViewRowLineVisible:!1,listViewRowLineColor:dr,listViewSelectBackground:rq,treeViewLabelColor:kn,treeViewLabelSelectColor:Yq,treeViewLabelFont:og,treeViewExpandIcon:Cj(cc),treeViewCollapseIcon:Cj(cc,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:dr,treeViewSelectBackground:rq,treeViewDoubleClickToToggle:!0,tableViewLabelColor:kn,tableViewLabelSelectColor:Yq,tableViewLabelFont:og,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:dr,tableViewColumnLineColor:dr,tableViewSelectBackground:rq,treeTableViewLabelColor:kn,treeTableViewLabelSelectColor:Yq,treeTableViewLabelFont:og,treeTableViewExpandIcon:Cj(cc),treeTableViewCollapseIcon:Cj(cc,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:dr,treeTableViewColumnLineColor:dr,treeTableViewSelectBackground:rq,tableHeaderLabelColor:kn,tableHeaderLabelFont:og,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:Rj,tableHeaderBackground:Xm,tableHeaderMoveBackground:Kh,tableHeaderInsertColor:rq,tableHeaderSortDescIcon:gg(ni,!0),tableHeaderSortAscIcon:gg(ni),tabViewTabGap:1,tabViewLabelColor:Yq,tabViewLabelFont:og,tabViewTabBackground:ai,tabViewSelectWidth:3,tabViewSelectBackground:rq,tabViewMoveBackground:Kh,tabViewInsertColor:rq,toolbarLabelColor:kn,toolbarLabelSelectColor:Yq,toolbarLabelFont:og,toolbarBackground:Xm,toolbarSelectBackground:rq,toolbarItemGap:8,toolbarSeparatorColor:rs},!0);
var Vm={translateX:1,sortColumn:1},xc={sortable:1,sortOrder:1,sortFunc:1},Ao={focusData:1},Th={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},vg={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},hj=function(r,p){p.add(r),r.hasChildren()&&r.eachChild(function(V){hj(V,p)})},te=function(k,y,j,_,w,C,o,O,F,D,b){var v,c=j.getValueType(D),I=j.getAlign(D);if(j.getEnumValues(D)){var $=j.toEnumLabel(y,D),r=fr||0,W=0,x=C,Q=d.getTextSize(_,$).width;return v=ed(j.toEnumIcon(y,D)),v&&(W=C+fr/2,"center"===I?W+=(O-(r+Q))/2:"right"===I&&(W=W+O-(r+Q)),vb(k,v,W,o+F/2,D,b),x=W+fr/2),$!=R&&(v?Im(k,$,_,w,x,o,O-(x-C),F):Im(k,$,_,w,C,o,O,F,I)),void 0}return y=j.formatValue(y),y!=R?c===He?(wk(k,C,o,O,F,y),void 0):c===Fn||!c&&yf(y)?(v=ed(y?Of:Lg),vb(k,v,C+O/2,o+F/2,D,b),void 0):(Im(k,y,_,w,C,o,O,F,I),void 0):void 0},ue=function(T,S){var l=S.view,k=Lb(T),H=S.column||S.property;l.getDataModel().beginTransaction(),S.editor=T,T.info=S,l.setCurrentEditor(T),l.getView().insertBefore(k,l._79O),Zh(T,S.editorRect),T.setFocus?T.setFocus():ud(T),T.commitValue=function(W,R){T._17Q&&(T=T._17Q),R||l.setValue(S.data,H,T.getValue?T.getValue():T.value),T.close&&T.close(),un(k)},H.onEditorCreated&&H.onEditorCreated(S)},to=function(w,B,S,_,p){var F=Go(w,S),K=B.value,t=B.view,z=p.getValueType(B.data);return F.onblur=F.onchange=function(){t.endEditing()},"input"===w?(K=p.formatValue(K),K!=R&&(F.value=K),F.onkeydown=function(C){En(C)?t.endEditing():Re(C)&&t.endEditing(!0)},(z===Ib||z===uf)&&F.addEventListener(ng,d.numberListener,y)):w===Yl&&_.forEach(function(Q){var o=k.createElement("option");o.innerHTML=p.toEnumLabel(Q),o.value=Q,p.isEnumEqual(K,Q)&&(o.selected=!0),ke(F,o)}),ue(F,B),F},Wn=q.widget={},Mo=function(L,g,s){Ci(Y+".widget."+L,g,s)};wg(od,{ms_value:function(w){w.getValue=function(y){var j=this.getItemById(y),a=j.element;return gd(a)?a:a?a.getValue?a.getValue():a.value:j.selected},w.setValue=function(k,H){var c=this.getItemById(k);if(c){var N=c.element;N&&!gd(N)?N.setValue?N.setValue(H):N.value=H:yf(H)?(c.selected=H,this.iv()):(c.element=H,this.iv())}},w.v=function(L,H){var c=this;if(2===arguments.length)c.setValue(L,H);else{if(!Eg(L))return c.getValue(L);for(var s in L)c.setValue(s,L[s])}return c}},_46o:function(e){e._icon=R,e._accessType=R,e._valueType=R,e._editable=!1,e._batchEditable=!0,e._align=Xf,e._nullable=!0,e._emptiable=!1,e.setParent=Hm,e.formatValue=function(f){var N=this,I=N._valueType;return N.getEnumValues()?N.toEnumLabel(f):I===Fn?!!f:f!=R&&I===Ib?$(f):f},e.setEnum=function(w,Q,u,q,l,x,B){var n=this;w&&!Sj(w)&&w.values&&(q=w.editable,u=w.icons,Q=w.labels,l=w.strict,x=w.maxHeight,B=w.dropDownWidth,w=w.values),Af(w)&&(w=w._as),Af(Q)&&(Q=Q._as),Af(u)&&(u=u._as),n._enumValues=w,n._enumLabels=Q,n._enumIcons=u,n._enumEditable=q,n._enumStrict=l==R?!0:l,n._enumMaxHeight=x,n._enumDropDownWidth=B,w&&w.length&&Zl(w[0])&&(n._valueType=uf),n.fp("enum",!1,!0)},e.getEnumDropDownWidth=function(){return this._enumDropDownWidth},e.getEnumMaxHeight=function(){return this._enumMaxHeight},e.isEnumEditable=function(){return this._enumEditable},e.getEnumValues=function(){return this._enumValues},e.getEnumLabels=function(){return this._enumLabels},e.getEnumIcons=function(){return this._enumIcons},e.isEnumStrict=function(){return this._enumStrict},e.isEnumEqual=function(P,w){return this._enumStrict?P===w:P==w},e.toEnumLabel=function(Z,S){var j=this,v=j.getEnumValues(S),k=j.getEnumLabels(S);if(v&&k)for(var K=0;K<v.length;K++)if(j.isEnumEqual(Z,v[K]))return k[K];return Z},e.toEnumIcon=function(c,b){var Z=this,a=Z.getEnumValues(b),g=Z.getEnumIcons(b);if(a&&g)for(var $=0;$<a.length;$++)if(Z.isEnumEqual(c,a[$]))return g[$];return j}},_45o:function(a){a._87o=function(s,Q,l,Z,d,F){if(s){var L=this,p=L._90I,r=me(1);L._columnLineVisible&&(d-=1),L._rowLineVisible&&(F-=1),0>=d||0>=F||(L._90I||(p=L._90I={}),p[Q]||(p[Q]=new ob),Zh(r,L.tx()+l,L.ty()+Z,d,F),ke(r,s),L._view.insertBefore(r,L._79O),s.onParentAdded&&s.onParentAdded(r),p[Q].add(r))}},a._76o=function(){var L=this,F=L._90I;if(F){for(var E in F)F[E].each(function(H){un(H)});delete L._90I}},a._77o=function(c){var K=this;if(K._90I){var V=K._90I[c];V&&(V.each(function(l){un(l)}),delete K._90I[c])}}},_47o:function(h){h.getValue=function(Y,O){return O.getValue?O.getValue(Y,O,this):Ch(Y,O.getAccessType(),O.getName())},h.setValue=function(i,f,U){if(f.isEmptiable(i)||""!==U||(U=j),f.isNullable(i)||U!=R){var Q=this,O=f.getName(i),m=f.getAccessType(i),b=f.getValueType(i);b===Ib&&gd(U)?U=L(U):b===uf&&gd(U)?U=parseFloat(U):b===Fn&&gd(U)&&(U="true"===U),Q._batchEditable&&f._batchEditable&&Q.isSelected(i)?Q.sm().each(function(B){f.setValue?f.setValue(B,f,U,Q):Ij(B,m,O,U)}):f.setValue?f.setValue(i,f,U,Q):Ij(i,m,O,U)}},h.setCurrentEditor=function(n){this.endEditing(),this._currentEditor=n,this.redraw()},h.isEditing=function(r,p){var B=this,L=B._currentEditor;if(!L)return!1;if(p){var Y=L.info;return Y?(Y.column||Y.property)===p&&Y.data===r:!1}return!0},h.endEditing=function(q){var B=this,F=B._currentEditor;F&&(delete B._currentEditor,F.commitValue&&F.commitValue(F.info,q),B.redraw(),B.getDataModel().endTransaction())},h.beginEditing=function(y){this.endEditing();var C=this,n=y.column||y.property;if(n.beginEditing)n.beginEditing(y);else{var _=y.data,q=y.value,t=C.getSelectBackground(_),S=n.getEnumValues(_),k=n.getSlider(_),g=n.getColorPicker(_);if(k){var s=Ur(Wn.Slider,k);return s.setValue(q),s.getView().onblur=function(){C.endEditing()},s.isInstant()&&(s.onValueChanged=function(){C.setValue(_,n,s.getValue())}),ue(s,y),void 0}if(g||n.getValueType(_)===He){var l=Ur(Wn.ColorPicker,g);return l.setValue(q),l.onClosed=function(){C.endEditing()},l.isInstant()&&(l.onValueChanged=function(k,o){C.setValue(_,n,o)}),ue(l,y),l.open(),void 0}if(S){if(Wn.ComboBox){var p=new Wn.ComboBox;p.setValue(q),p.setValues(S),p.setLabels(n.getEnumLabels(_)),p.setIcons(n.getEnumIcons(_)),p.setEditable(n.isEnumEditable(_)),p.setStrict(n.isEnumStrict(_)),p.setMaxHeight(n.getEnumMaxHeight(_)),p.setDropDownWidth(n.getEnumDropDownWidth(_)),p.onClosed=function(){C.endEditing()},ue(p,y),p.open()}else to(Yl,y,t,S,n);return}var z=n.getValueType(_);if(z===Fn||yf(q))return C.setValue(_,n,!q),void 0;if(n.getItemEditor(_)){var H=rg(n.getItemEditor(_)),T=new H(_,n,C,y),M=T.getView();return M._17Q=T,T.setValue(q),ts(M),ue(M,y),T.editBeginning&&T.editBeginning(),void 0}to("input",y,t,R,n)}}},_44o:function(u){u.init=function(h){var w=this,o=w.th=new Mr(h),Z=w._view=jj(1,w);w.tv=w._tableView=h,ke(Z,o.getView()),ke(Z,h.getView()),o.mp(function(D){D.property===ys&&w.iv()}),w.iv()},u.getTableView=function(){return this.tv},u.getTableHeader=function(){return this.th},u.getDataModel=function(){return this.tv.dm()},u.getColumnModel=function(){return this.tv.getColumnModel()},u.setColumns=function(G){this.tv.setColumns(G)},u.addColumns=function(P){this.tv.addColumns(P)},u.endEditing=function(){this.tv.endEditing()},u.validateImpl=function(){var r=this,W=r.th,S=Yk(W),P={x:0,y:0,width:r.getWidth(),height:S};Zh(W,P),P.y=S,P.height=Z(0,r.getHeight()-S),Zh(r.tv,P)}},ms_vs:function(s){s._41o=function(){return this._29I.height<this._59I},s._43o=function(){var h=this;h._41o()&&(h._58I||(I(function(){h._94O()},vi),h.iv()),h._58I=new Date)},s._94O=function(){var x=this;if(x._58I){var w=new Date;w.getTime()-x._58I.getTime()>=vi?(delete x._58I,x.iv()):I(function(){x._94O()},vi)}},s._93I=function(){var D=this,E=D._27I;if(D._58I||!D._autoHideScrollBar){E||ke(D._79O,E=D._27I=me());var B=D._29I,p=B.height,$=D._59I,J=D.getScrollBarSize(),d=B.width-J-2,A=p*(-D.ty()/$),X=p*(p/$),W=E.style;$>p?(oh>X&&(A=A+X/2-oh/2,0>A&&(A=0),A+oh>p&&(A=p-oh),X=oh),W.visibility=Wk,W.background=D.getScrollBarColor(),W.borderRadius=J/2+Rq,Zh(E,d,A,J,X)):W.visibility=Em}else E&&(E.style.visibility=Em)}},ms_hs:function(m){m._40o=function(){return this._29I.width<this._91I},m._42o=function(){var $=this;$._40o()&&($._95O||(I(function(){$._94I()},vi),$.iv()),$._95O=new Date)},m._94I=function(){var C=this;if(C._95O){var k=new Date;k.getTime()-C._95O.getTime()>=vi?(delete C._95O,C.iv()):I(function(){C._94I()},vi)}},m._92I=function(){var L=this,g=L._28I;if(L._95O||!L._autoHideScrollBar){g||ke(L._79O,g=L._28I=me());var Y=L._29I,J=Y.width,V=L._91I,Z=L.getScrollBarSize(),o=Y.height-Z-2,_=J*(-L.tx()/V),F=J*(J/V),O=g.style;V>J?(oh>F&&(_=_+F/2-oh/2,0>_&&(_=0),_+oh>J&&(_=J-oh),F=oh),O.visibility=Wk,O.background=L.getScrollBarColor(),O.borderRadius=Z/2+Rq,Zh(g,_,o,F,Z)):O.visibility=Em}else g&&(g.style.visibility=Em)}}}),ci(Of,Or(16,16,[{type:gq,rect:[1,1,14,14],background:rq},{type:rp,rect:[1,1,14,14],width:1,color:Ko},{type:ks,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),ci(Lg,Or(16,16,{type:rp,rect:[1,1,14,14],width:1,color:Ko})),ci(re,Or(16,16,[{type:Rh,rect:[2,2,12,12],borderWidth:1,borderColor:Ko,background:"#FFF"},{type:Rh,rect:[4,4,8,8],background:rq}])),ci(jc,Or(16,16,{type:Rh,rect:[2,2,12,12],borderWidth:1,borderColor:Ko})),od._15Q=function(U){U._29I=lc,U._59I=0,U._91I=0,U._5o=function(d){var j=this;j._30I=new ob,j._rows=new ob,j._rowMap={},j._31I=0,j._14I=0,j._view=jj(1,j),j._canvas=oe(j._view),ke(j._view,j._79O=me()),j.dm(d?d:new _c)},U.getCheckIcon=function(J){var B=this.sm(),Y=B.co(J);return B.sg()?ed(Y?re:jc):ed(Y?Of:Lg)},U.checkData=function(A){var W=this.sm(),B=W.co(A);W.sg()&&B||(this._32o=1,B?W.rs(A):W.as(A),delete this._32o)},U.getDataAt=function(f){f.target&&(f=this.lp(f));var i=X(f.y/this._rowHeight),d=this._rows;return 0>i||i>=d.size()?R:d.get(i)},U.onDataDoubleClicked=function(){},U.onDataClicked=function(){},U.adjustTranslateX=function(){return 0},U.adjustTranslateY=function(A){var p=this.getHeight()-this._59I;return p>A&&(A=p),A>0?0:$(A)},U.onPropertyChanged=function(G){var E=this,N=G.property;Th[N]?E.ivm():Ao[N]||E.redraw(),N===kf?E._42o():N===_m&&E._43o()},U.getLabel=function(M){return M.toLabel()},U.getLabelFont=function(){return this._labelFont},U.getLabelColor=function(R){var b=this;if(b.isCheckMode()){if(b._focusData===R)return b._labelSelectColor}else if(b.isSelected(R))return b._labelSelectColor;return b._labelColor},U.getStartRowIndex=function(){return this._31I},U.getEndRowIndex=function(){return this._14I},U.getRowDatas=function(){return this._rows},U.getRowIndex=function(X){return this._rowMap[X._id]},U.getRowSize=function(){return this._rows.size()},U.getViewRect=function(){return Pb(this._29I)},U.isVisible=function(b){return this._visibleFunc?this._visibleFunc(b):!0},U.getCurrentSortFunc=function(){return this._sortFunc},U.setDataModel=function(H){var t=this,e=t._dataModel,G=t._selectionModel;e!==H&&(e&&(e.umm(t.handleDataModelChange,t),e.umd(t.handleDataPropertyChange,t),e.umh(t.handleHierarchyChange,t),G||e.sm().ums(t.handleSelectionChange,t)),t._dataModel=H,H.mm(t.handleDataModelChange,t),H.md(t.handleDataPropertyChange,t),H.mh(t.handleHierarchyChange,t),G?G._21I(H):H.sm().ms(t.handleSelectionChange,t),t.fp("dataModel",e,H))},U.validateModel=function(){var c=this;c._rows.clear(),c._rowMap={},c.buildChildren(c._dataModel._roots);var G=c._rows=c._rows.toList(c.isVisible,c),n=0,C=c.getCurrentSortFunc(),h=G.size();for(C&&G.sort(C);h>n;n++)c._rowMap[G.get(n)._id]=n},U.buildChildren=function(a){var T=this;a.each(function(a){T._rows.add(a),T.buildChildren(a._children)})},U.handleDataModelChange=function(){this.ivm()},U.handleDataPropertyChange=function(K){"parent"===K.property?this.ivm():this.invalidateData(K.data)},U.handleHierarchyChange=function(){this.ivm()},U.handleSelectionChange=function(c){c.datas.each(this.invalidateData,this),this.onSelectionChanged(c)},U.onSelectionChanged=function(u){var j=this,L=j.sm();!j.isAutoMakeVisible()||1!==L.size()||"set"!==u.kind&&"append"!==u.kind||j._32o||j.makeVisible(L.ld())},U.handleBackgroundClick=function(I){Qk(I)&&!this.isCheckMode()&&this.sm().cs()},U.makeVisible=function(f){f&&(this._23I=f,this.iv())},U.scrollToIndex=function(R){var o=this,p=o._29I,N=p.height,c=o._rowHeight,Q=c*R;R>=0&&R<o._rows.size()&&N>0&&(Q+c>p.y+N?o.ty(-Q+N-c):Q<p.y&&o.ty(-Q))},U.autoScroll=function(O,s){var W=this,J=W._rowHeight,D=J,P=J/4,V=W._29I,H=W.lp(O),g={x:W.tx(),y:W.ty()};return J>0&&V&&(H.x-V.x<D?W.translate(P,0):V.x+V.width-H.x<D&&W.translate(-P,0),H.y-V.y<D?W.translate(0,P):V.y+V.height-H.y<D&&W.translate(0,-P)),g.x=W.tx()-g.x,g.y=W.ty()-g.y,s&&(s.x+=g.x,s.y+=g.y),g},U.getTopRowOrderSelection=function(){var k=this.sm().getTopSelection(),U={},N=new ob;return k.each(function(V){U[V._id]=V}),this._rows.each(function(m){U[m._id]&&N.add(m)}),N},U.getRowOrderSelection=function(){var K=new ob;return this._rows.each(function(D){this.isSelected(D)&&K.add(D)},this),K},U.ivm=function(){this.invalidateModel()},U.invalidateModel=function(){var O=this;O._96I||(O._96I=1,O._32I=1,delete O._24I),O.iv()},U.redraw=function(){var o=this;o._32I||(o._32I=1,delete o._24I,o.iv())},U.invalidateData=function(a){var u=this;t?u.redraw():u._32I||(u._24I||(u._24I={}),u._24I[a._id]=a,u.iv())},U.getFocusData=function(){return this._focusData},U.setFocusDataById=function(L){this.setFocusData(this.dm().getDataById(L))},U.setFocusData=function(t){var C=this,S=C._focusData;S!==t&&(C._focusData=t,C.fp("focusData",S,t),S&&C.invalidateData(S),t&&(C.invalidateData(t),C.isAutoMakeVisible()&&C.makeVisible(t)))},U.drawRowBackground=function(C,I,T,q,d,N,k){var $=this,v=$.isCheckMode();(I===$._focusData&&v||T&&!v)&&wk(C,q,d,N,k,$.getSelectBackground(I))},U.drawData=function(k,L,i){var U=this,Z=U._rowHeight,b=Z*i,R=U._29I,H=R.x,J=R.width;k.save(),k.beginPath(),k.rect(H,b,J,Z),k.clip(),U._87o(U.drawRow(k,L,U.isSelected(L),H,b,J,Z),i,H,b,J,Z),k.restore(),U._rowLineVisible&&wk(k,H,b+Z-1,J,1,U._rowLineColor)},U._12I=function(W){var F=this,q=F._31I,n=F._29I,H=n.x,z=n.y,E=n.width,R=n.height;for(W.beginPath(),W.rect(H,z,E,R),W.clip(),W.clearRect(H,z,E,R),F._76o(),F._93db(W);q<F._14I;q++)F.drawData(W,F._rows.get(q),q);F._92db(W)},U._13I=function(m){for(var O,Q=this,H=Q._rowHeight,p=Q._29I,o=p.x,y=p.width,k=Q._31I,C=Q._30I;k<Q._14I;k++)O=Q._rows.get(k),Q._24I[O._id]&&C.add({data:O,index:k});C.isEmpty()||(m.beginPath(),C.each(function(v){m.rect(o,v.index*H,y,H)}),m.clip(),C.each(function(k){m.clearRect(o,k.index*H,y,H)}),C.each(function(D){Q._77o(D.index)}),Q._93db(m),C.each(function(O){Q.drawData(m,O.data,O.index)}),Q._92db(m),C.clear())},U.preValidateModel=function(){this.endEditing&&this.endEditing()},U.validateImpl=function(){var z=this,A=z._canvas,C=z.getWidth(),E=z.getHeight(),M=z._rowHeight,H=z._32I;(C!==A.clientWidth||E!==A.clientHeight)&&(ul(A,C,E),H=1);var U=B&&!N;z._96I&&!U&&(z.preValidateModel(),z.validateModel());var F=z._29I,W={x:-z.tx(),y:-z.ty(),width:C,height:E},T=z._rows.size(),x=Nf(A),q=z._23I;H||cm(W,F)||(H=1),z._29I=W,z._59I=T*M+z.getScrollBarSize(),z._31I=X(W.y/M),z._14I=S((W.y+W.height)/M),z._31I<0&&(z._31I=0),z._14I>T&&(z._14I=T),z._99I&&H&&z._99I(),qk(x,z.tx(),z.ty(),1),H?z._12I(x):z._24I&&z._13I(x),z._93I(),z._92I(),x.restore(),z._32I=z._24I=z._96I=R,q&&(z.scrollToIndex(z.getRowIndex(q)),delete z._23I),z.tx(z.tx()),z.ty(z.ty())}},od._48o=function(x){x._rootVisible=!0,x._rootData=R,x._35o=function(){this._expandMap={},this._levelMap={}},x.validateModel=function(){var l=this,O=l._rootData;l._rows.clear(),l._levelMap={},l._rowMap={},l._currentLevel=0,O?l._rootVisible?l.isVisible(O)&&l.buildData(O):l.buildChildren(O):l.buildChildren(),delete l._currentLevel},x.buildData=function(B){var v=this,D=B._id,o=v._rows;v._rowMap[D]=o.size(),o.add(B),v._levelMap[D]=v._currentLevel,v.isExpanded(B)&&(v._currentLevel++,v.buildChildren(B),v._currentLevel--)},x.buildChildren=function(x){var O=this,N=x?x._children:O._dataModel._roots,u=O.getCurrentSortFunc();u&&O.isChildrenSortable(x)?N.toList(O.isVisible,O).sort(u).each(O.buildData,O):N.each(function(J){O.isVisible(J)&&O.buildData(J)})},x.getLevel=function(O){return this._levelMap[O._id]},x.getToggleIcon=function(n){var Q=this,H=Q._loader,C=Q._collapseIcon;return H&&!H.isLoaded(n)?C:n.hasChildren()?Q.isExpanded(n)?Q._expandIcon:C:R},x.isCheckMode=function(){return this._checkMode!=R},x.isChildrenSortable=function(){return!0},x.handleDataModelChange=function(y){var c=this;y.kind===Mg?delete c._expandMap[y.data._id]:y.kind===Oq&&(c._expandMap={}),c.ivm()},x.toggle=function(Y){var A=this;A.isExpanded(Y)?A.collapse(Y):A.expand(Y)},x.isExpanded=function(N){return 1===this._expandMap[N._id]},x.expand=function(t){var v=this,d=v._loader;v.isExpanded(t)||(d&&!d.isLoaded(t)&&d.load(t),v._expandMap[t._id]=1,v.ivm(),v.onExpanded(t))},x.onExpanded=function(){},x.collapse=function(I){var j=this;j.isExpanded(I)&&(delete j._expandMap[I._id],j.ivm(),j.onCollapsed(I))},x.onCollapsed=function(){},x.expandAll=function(n){if(n)this.expand(n),n.eachChild(function($){this.expandAll($)},this);else{var l=this;l._dataModel.each(function(H){H.hasChildren()&&(l._expandMap[H._id]=1)}),l.ivm()}},x.collapseAll=function(){this._expandMap={},this.ivm()},x.makeVisible=function(q){if(q){var p=this;if(!p._rootData||q.isDescendantOf(p._rootData)){for(var n=q._parent;n;)p.expand(n),n=n._parent;p._23I=q,p.iv()}}},x.checkData=function(f){var B,T=this,R=T._checkMode,g=T.sm(),Q=g.co(f);if(!g.sg()||!Q){if(T._32o=1,R===kb)Q?g.rs(f):g.as(f);else if(R===gp)B=new ob(f),B.addAll(f._children);else if("descendant"===R)B=new ob,hj(f,B);else if("all"===R&&(B=new ob,hj(f,B),!Q))for(var u=f._parent;u;)B.add(u),u=u._parent;B&&(Q?g.rs(B):g.as(B)),delete T._32o}},x._97I=function(l,Y,U,J,K,t,_){var N=this,R=N._indent,E=N._levelMap[Y._id],p=N.getIconWidth(Y),S=ed(N.getToggleIcon(Y));S?(J+=R*E,vb(l,S,J+R/2,K+_/2,Y,N),J+=R):J+=R*(E+1),N._checkMode&&(vb(l,N.getCheckIcon(Y),J+R/2,K+_/2,Y,N),J+=R),N.drawIcon(l,Y,J,K,p,_),N.drawLabel(l,Y,J+p,K,_)}},od._14Q=function(F){F.getIcon=function(k){return k.getIcon()},F.getIconWidth=function(Y){return this.getIcon(Y)?this._indent:0},F.drawIcon=function(i,C,o,B,G,R){if(G){var s=this,t=s.getBodyColor(C),D=ed(s.getIcon(C),t);D&&(R-=s.isRowLineVisible()?1:0,jg(i,D,hr,o,B,G,R,C,s,t),Jc(i,s.getBorderColor(C),o,B,G,R))}},F.drawLabel=function(t,D,n,m,W){var c=this;Im(t,c.getLabel(D),c.getLabelFont(D),c.getLabelColor(D),n,m,0,W)}},od._50o=function(w){w._98I=function(){var v=this,l=v._39o=new _c;v._60I=new ob,l.mm(v._17o,v),l.md(v._18o,v),l.mh(v._19o,v)},w.setColumns=function(w){this._39o.clear(),this.addColumns(w)},w.addColumns=function(b){var d=this._39o;b.forEach(function(a){if(!(a instanceof Zk)){var u=rg(a.className);a=Ur(u?u:Zk,a)}d.add(a)})},w.onColumnClicked=function(){},w.onCheckColumnClicked=function(){},w._3Q=function(e){for(var p,r=0,t=this._60I,h=t.size();h>r;r++)if(p=t.get(r),p.column===e)return p;return R},w.getColumnAt=function(V){var S=this._4Q(V);return S?S.column:R},w._4Q=function(k){for(var I=this,D=k.target?I.lp(k).x:k.x,m=I._60I,L=0;L<m.size();L++){var r=m.get(L),H=r.startX;if(D>=H&&D<H+r.column.getWidth())return r}return R},w.getToolTip=function(n){var W=this,X=W.getDataAt(n),u=W.getColumnAt(n);return X&&u?u.getToolTip(X,W):R},w.adjustTranslateX=function(E){var d=this.getWidth()-this._91I;return d>E&&(E=d),E>0?0:$(E)},w._99I=function(){var i=this,W=i._29I,B=i._60I;B.clear(),i._91I=0,i._39o._roots.each(function(S){if(S.isVisible()){var O=i._91I+S.getWidth();i._91I<=W.x+W.width&&O>=W.x&&B.add({column:S,startX:i._91I}),i._91I=O}}),i._91I+=i.getScrollBarSize()},w.drawData=function(u,k,d){var p=this,$=p._rowHeight,i=$*d,e=p.isSelected(k),P=p._29I,t=P.x,L=P.width;p.drawRowBackground(u,k,e,t,i,L,$),p._60I.each(function(L){var V=L.column,E=L.startX,o=V.getWidth();o>0&&!p.isEditing(k,V)&&(u.save(),u.beginPath(),u.rect(E,i,o,$),u.clip(),p._87o(p.drawCell(u,k,e,V,E,i,o,$),d,E,i,o,$),p._columnLineVisible&&wk(u,E+o-1,i,1,$,p._columnLineColor),u.restore())}),p._rowLineVisible&&wk(u,t,i+$-1,L,1,p._rowLineColor)},w.drawCell=function(j,$,v,P,s,Q,a,z){var u=this;if(P.drawCell)return P.drawCell(j,$,v,P,s,Q,a,z,u);var N=u.getValue($,P);te(j,N,P,u.getLabelFont($,P,N),u.getLabelColor($,P,N),s,Q,a,z,$,u)},w.getColumnModel=function(){return this._39o},w._17o=function(){this.redraw()},w._18o=function(W){var y=this;W.data===y._sortColumn&&xc[W.property]?y.ivm():(y._42o(),y.redraw())},w._19o=function(){this.redraw()},w.getCurrentSortFunc=function(){var e=this,l=e._sortColumn;if(l&&l.isSortable()){var b=l.getSortFunc(),N=ah===l.getSortOrder()?1:-1;return b||(b=vo),function(j,a){return b.call(e,e.getValue(j,l),e.getValue(a,l),j,a)*N}}return e._sortFunc},w.isCellEditable=function(y,u,o){return u.isEditable()&&this.isEditable()?u.isCellEditable?u.isCellEditable(y,u,o,this):!0:!1},w._37O=function(r,Z){if(Qk(Z))for(var i=this,Q=i.lp(Z),y=i._60I,h=i._rowHeight,E=i._29I,W=E.x,w=E.y,V=E.width,d=E.height,P=0;P<y.size();P++){var e=y.get(P),Y=e.startX,z=e.column,c=z.getWidth();if(z!==i._31o&&z!==i._4o&&Q.x>=Y&&Q.x<Y+c&&i.isCellEditable(r,z,Z)){var f={x:Y,y:i.getRowIndex(r)*h,width:c,height:h},u={x:f.x+i.tx(),y:f.y+i.ty(),width:f.width,height:f.height},U=0,R=0;return f.x<W?U=f.x-W:f.x+f.width>W+V&&(U=f.x+f.width-W-V),U&&(i.tx(i.tx()-U),u.x-=U),f.y<w?R=f.y-w:f.y+h>w+d&&(R=f.y+h-w-d),R&&(i.ty(i.ty()-R),u.y-=R),i.beginEditing({data:r,column:z,value:i.getValue(r,z),event:Z,rect:f,editorRect:u,view:i}),void 0}}}},Wn.BaseItemEditor=function(y,q,C,w){this._data=y,this._column=q,this._master=C,this._editInfo=w},Mo("BaseItemEditor",G,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var nn=q.Tab=function(){Id(nn,this)};pm("Tab",ce,{ms_ac:["view","closable","disabled"],_icon:R,_closable:!1,_disabled:!1,setParent:Hm});var Zk=q.Column=function(){Id(Zk,this)};pm("Column",ce,{_46o:1,ms_ac:["accessType","valueType",Wk,Ac,jb,Uj,"align",He,"sortOrder",Mf,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:ah,_sortFunc:R,_sortable:!0,_clickable:!0,setWidth:function(h){16>h&&(h=16);var g=this._width;this._width=h,this.fp(Uj,g,h)},getToolTip:function(S,z){return this.formatValue(z.getValue(S,this))}});var Jq=q.Property=function(){Id(Jq,this)};pm("Property",ce,{_46o:1,ms_ac:["accessType","valueType",Ac,jb,"categoryName",He,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:R,getToolTip:function(Z,M,m){var s=this;return M?s.formatValue(m.getValue(Z,s)):m.getPropertyName(s)}}),Wn.AccordionView=function(){var v=this;v._20o={},v._21o=new ob,v._10o=R,v._9o=R,v._11o=R,v._view=jj(0,v),v.iv()},Mo("AccordionView",G,{ms_v:1,ms_fire:1,ms_ac:[Cs,_k,"titleHeight",Kn,fi,"titleBackground","selectWidth",Al,"orientation","separatorColor"],_expandIcon:d.accordionViewExpandIcon,_collapseIcon:d.accordionViewCollapseIcon,_titleHeight:Ug,_labelColor:d.accordionViewLabelColor,_labelFont:d.accordionViewLabelFont,_titleBackground:d.accordionViewTitleBackground,_selectBackground:d.accordionViewSelectBackground,_selectWidth:d.accordionViewSelectWidth,_orientation:"v",_separatorColor:d.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(W,w,t,O){var Y=this,z=me();if(Y._20o[W])throw W+" already exists";z.onmousedown=bf,z.style.cursor=qs,z.addEventListener(Ei?fk:Zd,function(c){bf(c)},y),z.addEventListener(Ei?Ff:ti,function(X){bf(X),Qk(X)&&(Y._10o===W?Y.collapse():Y.expand(W))},y),ke(Y._view,z),Y._20o[W]={content:w,div:z,canvas:oe(z),icon:O},Y._21o.add(W),t&&Y.expand(W),Y.iv()},remove:function(z){var M=this,l=M._20o[z];l&&(un(l.div),delete M._20o[z],M._21o.remove(z),M.iv())},clear:function(){var X=this;X._21o.toArray().forEach(X.remove,X),X._20o={},X._21o.clear(),X.iv()},isExpanded:function(W){return this._10o===W},expand:function(Y){var d=this;d._20o[Y]&&d._10o!==Y&&(d._10o=Y,d.onExpanded(Y),d.iv())},onExpanded:function(){},collapse:function(){var p=this;p._10o&&(p.onCollapsed(p._10o),delete p._10o,p.iv())},onCollapsed:function(){},initCanvas:function(a,z,v){ul(a,z,v);var B=Nf(a);return qk(B,0,0,1),B.clearRect(0,0,z,v),B},drawTitle:function(B,g,N,R,m){var k=this,s=ed(m.icon),A=k.isExpanded(g),l=k._titleHeight,L=k._titleBackground,q=k._selectWidth,I=k._separatorColor,S=ed(A?k._expandIcon:k._collapseIcon),E=q+4;wk(B,0,0,N,R,L),A&&q&&wk(B,0,0,q,R,k._selectBackground),(A||k._21o.get(k._21o.size()-1)!==g)&&wk(B,0,R-1,N,1,I?I:ne(L)),s&&(vb(B,s,E+se(s)/2,l/2),E+=se(s)+2),Im(B,g,k.getLabelFont(g),k.getLabelColor(g),E,0,0,l),S&&vb(B,S,N-se(S)/2-4,l/2)},validateImpl:function(){var _=this,$=_._view,U=0,o=0,M=_.getWidth(),J=_.getHeight(),j=_._titleHeight,m=_._21o.size()*j,N=_._11o,u=_._9o;delete _._11o,delete _._9o,_._21o.each(function(q){var r,d,N=_._20o[q],I=N.content,B=_._10o===q;Ze(_)?(Zh(N.div,U,0,j,J),r=_.initCanvas(N.canvas,j,J),gm(r,0,J),hc(r,-s),_.drawTitle(r,q,J,j,N),r.restore(),B?(d=Z(0,M-m),I&&(_._11o=I,_._9o=Lb(I),Zh(I,U+j,0,d,J)),U+=j+d):U+=j):(Zh(N.div,0,o,M,j),r=_.initCanvas(N.canvas,M,j),_.drawTitle(r,q,M,j,N),r.restore(),B?(d=Z(0,J-m),I&&(_._11o=I,_._9o=Lb(I),Zh(I,0,o+j,M,d)),o+=j+d):o+=j)});var g=_._9o;N&&N!==_._11o&&N.endEditing&&N.endEditing(),g&&g!==u&&ke($,g),u&&u!==g&&un(u)}}),Wn.SplitView=function(o,L,B,z){var K=this,k=K._dividerDiv=me(),p=K._60O=oe(),i=K._61O=oe(),s=p.style,l=i.style;K._view=jj(1,K),ke(K._view,k),s.msTouchAction=Lp,s.pointerEvents=Lp,s.cursor=qs,l.msTouchAction=Lp,l.pointerEvents=Lp,l.cursor=qs,o&&K.setLeftView(o),L&&K.setRightView(L),B&&K.setOrientation(B),z!=R&&K.setPosition(z),K.setStatus(um),new kp(K)},Mo("SplitView",G,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:d.splitViewDividerSize,_dividerBackground:d.splitViewDividerBackground,_dragOpacity:d.splitViewDragOpacity,_toggleIcon:d.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(o,n){var G=this,x=G._position;isNaN(o)||(n||(G._82O=0>o?-1:o>1?1:0),G._position=o,G.fp(Xc,x,o))},getLeftView:function(){return this._leftView},setLeftView:function(m){var e=this,u=e._leftView,c=e._view;if(e._leftView!==m){if(u&&u!==e._rightView){var r=Lb(u);r.parentNode===c&&un(r)}if(e._leftView=m,m){var s=Lb(m);s.parentNode!==c&&c.insertBefore(s,e._dividerDiv)}e.fp("leftView",u,m)}},getRightView:function(){return this._rightView},setRightView:function(Z){var J=this,d=J._rightView,M=J._view;if(J._rightView!==Z){if(d&&d!==J._leftView){var m=Lb(d);m.parentNode===M&&un(m)}if(J._rightView=Z,Z){var T=Lb(Z);T.parentNode!==M&&M.insertBefore(T,J._dividerDiv)}J.fp("rightView",d,Z)}},validateImpl:function(){var D=this,J=D._draggable,t=D._position,x=D.getWidth(),R=D.getHeight(),V=D._dividerSize,Y=D._dividerBackground,I=Ei?18:8,m=D._dividerDiv,u=D._82O,y=D._60O,P=D._61O,W=D._toggleIcon,i=D._status,q=m.style,v=null,G=Ei?20:4,k=W.comps[0];V>=I||0===V?D._coverDiv&&(un(D._coverDiv),delete D._coverDiv):D._coverDiv||(D._coverDiv=me(),_&&(D._coverDiv.style.background=Fc),ke(m,D._coverDiv)),D._togglable?y.parentNode||(ke(m,y),ke(m,P)):(un(y),un(P));var T=D._coverDiv,O=D._leftView,z=D._rightView;if(Ze(D)){if(V>x&&(V=x),i===um)if(1===u)var r=f(t,x),l=Z(0,x-V-r);else-1===u?(l=f(-t,x),r=Z(0,x-V-l)):(r=$((x-V)*t),l=Z(0,x-V-r));else"cl"===i?(r=0,l=Z(0,x-V)):"cr"===i&&(l=0,r=Z(0,x-V));O&&Zh(O,0,0,r,R),z&&Zh(z,r+V,0,l,R),Zh(m,r,0,V,R),D._22o=r,T&&(Zh(T,V/2-I/2,0,I,R),T.style.cursor=J?Cc:""),m.style.cursor=J?Cc:"";var d=m.clientHeight/2,c=m.clientWidth;ul(y,c,c),Zh(y,0,d-c-G,c,c),v=Nf(y),qk(v,0,0,1),k.rotation=-s,gf(v,W,0,0,c,c),v.restore(),ul(P,c,c),Zh(P,0,d+G,c,c),v=Nf(P),qk(v,0,0,1),k.rotation=s,gf(v,W,0,0,c,c),v.restore()}else{if(V>R&&(V=R),i===um)if(1===u)var B=f(t,R),X=Z(0,R-V-B);else-1===u?(X=f(-t,R),B=Z(0,R-V-X)):(B=$((R-V)*t),X=Z(0,R-V-B));else"cl"===i?(B=0,X=Z(0,R-V)):"cr"===i&&(X=0,B=Z(0,R-V));O&&Zh(O,0,0,x,B),z&&Zh(z,0,B+V,x,X),Zh(m,0,B,x,V),D._22o=B,T&&(Zh(T,0,V/2-I/2,x,I),T.style.cursor=J?wb:""),q.cursor=J?wb:"";var o=m.clientWidth/2,c=m.clientHeight;ul(y,c,c),Zh(y,o-c-G,0,c,c),v=Nf(y),qk(v,0,0,1),k.rotation=0,gf(v,W,0,0,c,c),v.restore(),ul(P,c,c),Zh(P,o+G,0,c,c),v=Nf(P),qk(v,0,0,1),k.rotation=b,gf(v,W,0,0,c,c),v.restore()}q.background=Y}});var kp=function(X){this.sv=X,this.addListeners()};Ci(kp,G,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(_){var U=this,F=U.sv,Q=F._dividerDiv,H=F._60O,K=F._61O,A=F._status,q=_.target;if(q===H)A===um?F.setStatus("cl"):"cr"===A&&F.setStatus(um);else if(q===K)A===um?F.setStatus("cr"):"cl"===A&&F.setStatus(um);else if(Qm(_)&&(q===Q||q===F._coverDiv)&&(bf(_),F.isDraggable())){F.getLeftView(),F.getRightView();var k=U.maskDiv=me();if(k.style.left=0,k.style.top=0,k.style.width=F.getWidth()+"px",k.style.height=F.getHeight()+"px",F.getView().appendChild(k),!F.isContinuousLayout()){var E=U.resizeDiv=me();E.style.left=Q.style.left,E.style.top=Q.style.top,E.style.width=Q.style.width,E.style.height=Q.style.height,E.style.opacity=F.getDragOpacity(),E.style.background=F.getDividerBackground(),ke(U.getView(),E)}U._lastAbsPosition=F._22o,U._86o=Ze(F)?Bm(_).x:Bm(_).y,Wr(U,_)}},handleWindowTouchMove:function(I){Qm(I)&&this.update(I,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(b){var E=this;E.update(b,!0),E.sv.setStatus(um),E.maskDiv&&un(E.maskDiv),E.resizeDiv&&un(E.resizeDiv),E.maskDiv=E.resizeDiv=R},handle_mousedown:function(E){Qk(E)&&this.handle_touchstart(E)},handleWindowMouseMove:function(k){this.handleWindowTouchMove(k)},handleWindowMouseUp:function(E){this.handleWindowTouchEnd(E)},update:function(e,F){var Y=this,Q=Y.sv,o=Ze(Q)?Q.getWidth():Q.getHeight(),j=Q._dividerSize,W=Y._lastAbsPosition-Y._86o;Ze(Q)?(W+=Bm(e).x,W>o-j&&(W=o-j),0>W&&(W=0),Y.resizeDiv&&(Y.resizeDiv.style.left=W+Rq)):(W+=Bm(e).y,W>o-j&&(W=o-j),0>W&&(W=0),Y.resizeDiv&&(Y.resizeDiv.style.top=W+Rq)),F&&o!==j&&(1===Q._82O?Q.setPosition(W,1):-1===Q._82O?Q.setPosition(W-o+j,1):Q.setPosition(W/(o-j),1))}}),Wn.TabView=function(){var q=this,j=q._view=jj(1,q),a=q._91O=me(1),l=q._tabModel=new _c,X=l.sm(),w=q.invalidate;q._7o=new ob,q._canvas=oe(a),ke(j,a),ke(j,q._92O=me(1)),X.setSelectionMode(Cf),X.ms(q.handleSelectionChange,q),l.mm(w,q),l.md(w,q),l.mh(w,q),q._interactor=new Dn(q),q.iv()},Mo("TabView",G,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Kn,fi,"tabBackground","selectWidth",Al,"moveBackground","insertColor"],_tabPosition:Cd,_tabHeight:Ug,_tabGap:d.tabViewTabGap,_labelColor:d.tabViewLabelColor,_labelFont:d.tabViewLabelFont,_tabBackground:d.tabViewTabBackground,_selectWidth:d.tabViewSelectWidth,_selectBackground:d.tabViewSelectBackground,_moveBackground:d.tabViewMoveBackground,_insertColor:d.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(A,i,X){var u,Q=this._tabModel;return A instanceof nn?(u=A,i&&u.setView(i)):(u=new nn,u.setName(A),u.setView(i)),Q.add(u),X&&Q.sm().ss(u),u},getLabel:function(o){return o.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(d){this._23o=d,this.iv()},get:function(p){var w=this,_=w._tabModel;if(Zl(p))return _._roots.get(p);if(gd(p)){var Q;return _.each(function(u){p===w.getLabel(u)&&(Q=u)}),Q}return p instanceof nn?p:R},select:function(I){this._tabModel.sm().ss(this.get(I))},remove:function(C){var o=this;if(C=o.get(C)){var S=o._tabModel,F=S._roots.indexOf(C);o._tabModel.remove(C),o.selectByIndex(--F)}},getCurrentTab:function(){return this._8o},hideTabView:function(d,R){R.parentNode===this._92O&&(vs(R)?(R.style.display=Pi,R._tab_=d):un(R),$j())},showTabView:function(m,Z){vs(Z)&&(Z.style.display="block",Z._tab_=m),Z.parentNode!==this._92O&&(ke(this._92O,Z),$j())},_24o:function(){var X,Y=this,e=Y._8o,O=Y._9o,H=Y._tabModel.sm().ld();H&&(X=Lb(H.getView())),X!==O&&(O&&(e.getView()&&e.getView().endEditing&&e.getView().endEditing(),Y.hideTabView(e,O)),X&&Y.showTabView(H,X)),Y._8o=H,Y._9o=X,e!==H&&Y.onTabChanged(e,H)
},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(V,Q){this.selectByIndex(--Q)},selectByIndex:function(A){var t=this,b=t._tabModel,m=b.size();if(m&&!b.sm().ld()){A==R&&(A=0),A>=m&&(A=m-1),0>A&&(A=0);for(var V=A;V>=0;V--){var c=t.get(V);if(!c.isDisabled())return t.select(c),c}for(V=A+1;m>V;V++)if(c=t.get(V),!c.isDisabled())return t.select(c),c}},getTabWidth:function(E){var J=4,Y=ed(E.getIcon());Y&&(J+=se(Y,E)+4);var m=this.getLabel(E);return m&&(J+=gi(this.getLabelFont(E),m).width+4),E.isClosable()&&(J+=10),J},drawTab:function(R,A,P,W,U,r,O){var I,F=this,i=F._tabPosition,B=P+4,e=F._selectWidth,T=ed(A.getIcon()),o=A.isDisabled(),t=F.getLabelColor(A),c=F.getLabelFont(A),k=F.getLabel(A),H=F._selectBackground,Z=i===Xf+"-vertical",u=i===pp+"-vertical";(Z||u)&&(B=W+4),o&&(R.globalAlpha=bp),wk(R,P,W,U,r,O),A===F._8o&&e&&(i===Cd?wk(R,P,W+r-e,U,e,H):i===Xf?wk(R,P+U-e,W,e,r,H):i===pp?wk(R,P,W,e,r,H):Z?wk(R,P+U-e,W,e,r,H):u?wk(R,P,W,e,r,H):wk(R,P,W,U,e,H));var x=U/2;if(Z&&(gm(R,x,W+r/2),hc(R,b),gm(R,-x,-W-r/2)),T){var V=Qo(T,A),j=se(T,A);if(Z||u){var J=P+U/2,Q=B+V/2;gm(R,J,Q),hc(R,s),gm(R,-J,-Q),vb(R,T,P+U/2,B+V/2,A,F),gm(R,J,Q),hc(R,-s),gm(R,-J,-Q),B+=V+4}else vb(R,T,B+j/2,W+r/2,A,F),B+=j+4}return Z||u?(gm(R,U/2,B+U/2),hc(R,s),gm(R,-U/2,-B-U/2),Im(R,k,c,t,P,B,r,U),gm(R,U/2,B+U/2),hc(R,-s),gm(R,-U/2,-B-U/2)):Im(R,k,c,t,B,W,U,r),Z&&(gm(R,x,W+r/2),hc(R,-b),gm(R,-x,-W-r/2)),A.isClosable()&&(I=u?{x:P+U-12,y:W+r-12,width:12,height:12}:{x:P+U-12,y:W+2,width:12,height:12},this.drawCloseIcon(A,R,t,I)),o&&(R.globalAlpha=1),I},drawCloseIcon:function(b,n,B,f){var c=f.x,G=f.y;n.strokeStyle=B,n.lineWidth=1,n.beginPath(),n.moveTo(c+2,G+8),n.lineTo(c+8,G+2),n.moveTo(c+8,G+8),n.lineTo(c+2,G+2),n.stroke()},getTabAt:function(W){var m=this._interactor._8Q(W);return m?m.tab:null},validateImpl:function(){var m=this;m._24o();var E,T=m._canvas,F=m._tabPosition,y=m._91O,X=m._92O,S=m._tabModel,w=m.getWidth(),Q=m.getHeight(),I=m._tabHeight,V=m._7o,R=m._tabGap,d=F===Cd,o=F===Xf,l=F===pp,O=F===Xf+"-vertical",r=F===pp+"-vertical",c=m._23o,M=0;if((o||l)&&S._roots.each(function(y){M=Z(m.getTabWidth(y),M)}),d?(Zh(y,0,0,w,I),E={x:0,y:I,width:w,height:Z(0,Q-I)}):o?(Zh(y,0,0,M,Q),E={x:M,y:0,width:Z(0,w-M),height:Q}):l?(Zh(y,w-M,0,M,Q),E={x:0,y:0,width:Z(0,w-M),height:Q}):O?(Zh(y,0,0,I,Q),E={x:I,y:0,width:Z(0,w-I),height:Q}):r?(Zh(y,w-I,0,I,Q),E={x:0,y:0,width:Z(0,w-I),height:Q}):(Zh(y,0,Q-I,w,I),E={x:0,y:0,width:w,height:Z(0,Q-I)}),Zh(X,E),O||r){m._9o&&(E.x=0,Zh(m._8o.getView(),E)),ul(T,I,Q);var v=Nf(T),W=0;if(qk(v,0,m.ty(),1),v.clearRect(0,0,I,Q),V.clear(),S._roots.each(function(J){var F,w=m.getTabWidth(J);c&&c.tab===J||(F=m.drawTab(v,J,0,W,I,w,m._tabBackground)),V.add({_75o:F,tab:J,startY:W,endY:W+w,height:w}),W+=w+R}),m._23Q=Z(0,W-R),c){var k=c.position;m.drawTab(v,c.tab,0,c.startY,I,c.height,m._moveBackground),wk(v,0,k,I,1,m._insertColor)}if(v.restore(),m._selectionChanged){m._selectionChanged=!1;for(var e=m.ty(),K=0;K<V.size();K++){var N=V.get(K);if(N.tab===m._8o){if(N.endY+e<0){m.ty(-N.startY);break}if(N.startY+e>Q){m.ty(Q-N.endY);break}}}}m.ty(m.ty())}else if(o||l){m._9o&&(E.x=0,Zh(m._8o.getView(),E)),ul(T,M,Q);var v=Nf(T),W=0;if(qk(v,0,m.ty(),1),v.clearRect(0,0,M,Q),V.clear(),S._roots.each(function(z){var S;c&&c.tab===z||(S=m.drawTab(v,z,0,W,M,I,m._tabBackground)),V.add({_75o:S,tab:z,startY:W,endY:W+I,height:I}),W+=I+R}),m._23Q=Z(0,W-R),c){var k=c.position;m.drawTab(v,c.tab,0,c.startY,M,c.height,m._moveBackground),wk(v,0,k,M,1,m._insertColor)}if(v.restore(),m._selectionChanged){m._selectionChanged=!1;for(var e=m.ty(),K=0;K<V.size();K++){var N=V.get(K);if(N.tab===m._8o){if(N.endY+e<0){m.ty(-N.startY);break}if(N.startY+e>Q){m.ty(Q-N.endY);break}}}}m.ty(m.ty())}else{m._9o&&(E.y=0,Zh(m._8o.getView(),E)),ul(T,w,I);var v=Nf(T),L=0;if(qk(v,m.tx(),0,1),v.clearRect(0,0,w,I),V.clear(),S._roots.each(function($){var s,P=m.getTabWidth($);c&&c.tab===$||(s=m.drawTab(v,$,L,0,P,I,m._tabBackground)),V.add({_75o:s,tab:$,startX:L,endX:L+P,width:P}),L+=P+R}),m._64I=Z(0,L-R),c){var k=c.position;m.drawTab(v,c.tab,c.startX,0,c.width,I,m._moveBackground),xp(v,m._insertColor,k,0,I)}if(v.restore(),m._selectionChanged){m._selectionChanged=!1;for(var P=m.tx(),K=0;K<V.size();K++){var N=V.get(K);if(N.tab===m._8o){if(N.endX+P<0){m.tx(-N.startX);break}if(N.startX+P>w){m.tx(w-N.endX);break}}}}m.tx(m.tx())}for(var s=[],x=X.children,K=0;K<x.length;K++){var Y=x[K],b=Y._tab_;b&&!S.contains(b)&&s.push(Y)}s.forEach(function(y){X.removeChild(y)})}});var Dn=function(u){this.tv=u,this.addListeners()};Ci(Dn,G,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(y){this.handleScroll(y,10*(y.wheelDelta/40))},handle_DOMMouseScroll:function(i){this.handleScroll(i,10*-i.detail)},handleScroll:function(z,O){bf(z);var X=this.tv,u=X._tabPosition;!X._40o()||u!==Cd&&u!==bn||X.tx(this.tv.tx()+O),!X._41o()||u!==Xf&&u!==pp&&u!==Xf+"-vertical"&&u!==pp+"-vertical"||X.ty(this.tv.ty()+O)},_8Q:function(X){var B,j,Y=this.tv,M=Y._tabPosition,Z=Y._7o;if(M===Cd||M===bn){var _=Y.lp(X).x;for(B=0;B<Z.size();B++)if(j=Z.get(B),j.startX<=_&&_<=j.endX)return j}else if(M===Xf||M===pp||M===Xf+"-vertical"||M===pp+"-vertical"){var S=Y.lp(X).y;for(B=0;B<Z.size();B++)if(j=Z.get(B),j.startY<=S&&S<=j.endY)return j}return R},isClickable:function(v){var k=this.tv,Z=k._tabPosition,y=this._73o=this._8Q(v);return!k._40o()||Z!==Cd&&Z!==bn?!k._41o()||Z!==Xf&&Z!==pp&&Z!==Xf+"-vertical"&&Z!==pp+"-vertical"?y&&(!y.tab.isDisabled()||k.isMovable()):!0:!0},handle_mousemove:function(D){var A=this;Am?A._74o=A._8Q(D):A.getView().style.cursor=A.isClickable(D)?qs:""},handle_mousedown:function(j){this.handle_mousemove(j),this.handle_touchstart(j)},handle_touchstart:function(D){var B=this,U=B.tv,j=U._tabPosition;bf(D),Qk(D)&&B.isClickable(D)&&(j===Cd||j===bn?(B.x=Bm(D).x,B.lp=U.lp(D),B.tx=U.tx()):(B.y=Bm(D).y,B.lp=U.lp(D),B.ty=U.ty()),Wr(B,D))},handleWindowMouseMove:function(s){this.handleWindowTouchMove(s)},handleWindowTouchMove:function(N){var v,J=this,l=J.tv,M=l._tabPosition,d=J._73o;if(M===Cd||M===bn){if(v=Bm(N).x-J.x,!J._25o&&!J.moving&&K(v)>2&&(l._40o()&&!je(N)?J._25o=1:d&&l.isMovable()&&(J.moving=1)),J._25o)l.tx(J.tx+v);else if(J.moving){var u=J.lp.x+v,W=l._tabGap/2;l._7o.each(function(K){var P=K.endX,O=u-K.startX<P-u;u>=K.startX&&P>=u&&l._7Q({tab:d.tab,startX:d.startX+v,width:d.width,front:O,insertTab:K.tab,position:O?Z(0,K.startX-W):f(l._64I,P+W)})})}}else if(v=Bm(N).y-J.y,!J._25o&&!J.moving&&K(v)>2&&(l._41o()&&!je(N)?J._25o=1:d&&l.isMovable()&&(J.moving=1)),J._25o)l.ty(J.ty+v);else if(J.moving){var m=J.lp.y+v,W=l._tabGap/2;l._7o.each(function(V){var C=V.endY,N=m-V.startY<C-m;m>=V.startY&&C>=m&&l._7Q({tab:d.tab,startY:d.startY+v,height:d.height,front:N,insertTab:V.tab,position:N?Z(0,V.startY-W):f(l._23Q,C+W)})})}},handleWindowMouseUp:function(X){this.handleWindowTouchEnd(X)},handleWindowTouchEnd:function(){var h=this,k=h.tv,J=k._tabPosition,W=k.getTabModel(),$=W._roots,l=h._73o;if(h.moving){var r=k._23o;if(r&&r.insertTab!==r.tab){var O=r.tab,N=$.remove(O),B=$.indexOf(r.insertTab);B>=0&&(r.front||B++,B<=$.size()&&($.add(O,B),W._38I(O,N,B)))}k._7Q(R),delete h.moving}else if(!h._25o&&l){O=l.tab;var T=h._74o;if(!T||T.tab===O)if(!O.isDisabled()&&oq(l._75o,h.lp)){var Q=function(){var e=$.indexOf(O);W.remove(O),k.onTabClosed(O,e)};k.onTabClosing(O,Q)&&Q()}else O.isDisabled()||k._8o===O||W.sm().ss(O)}h._25o=h._73o=h._74o=J===Cd||J===bn?h.x=h.lp=h.tx=R:h.y=h.lp=h.ty=R}}),Wn.PropertyView=function(c){var V=this;V._view=jj(1,V),V._canvas=oe(V._view),ke(V._view,V._79O=me()),V._rows=new ob,V._28o=new ob,V._26o={},V._26Q={};var R=V._propertyModel=new _c,r=V.ivm;R.mm(r,V),R.md(r,V),R.mh(r,V),V.dm(c?c:new _c),new Qn(V)},Mo("PropertyView",G,{ms_ac:[Kn,sr,fi,Ac,jb,"categorizable",he,Mf,Xd,Cs,_k,Pd,of,cq,"selectRowIndex",Al,"background",Ae,ql,yr,xi,$i],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:lc,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:fr,_background:d.propertyViewBackground,_expandIcon:d.propertyViewExpandIcon,_collapseIcon:d.propertyViewCollapseIcon,_scrollBarColor:ep,_scrollBarSize:Wd,_autoHideScrollBar:_l,_selectBackground:d.propertyViewSelectBackground,_rowHeight:Yc,_rowLineVisible:d.propertyViewRowLineVisible,_rowLineColor:d.propertyViewRowLineColor,_10I:.5,_columnLineVisible:d.propertyViewColumnLineVisible,_columnLineColor:d.propertyViewColumnLineColor,_labelColor:d.propertyViewLabelColor,_labelSelectColor:d.propertyViewLabelSelectColor,_labelFont:d.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(h){0>h&&(h=0),h>1&&(h=1);var G=this,i=G._10I;G._10I=h,G.fp("columnPosition",i,h)},getPropertyName:function(b){return b.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(F,H,e){return e===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(f,s){return s===this._selectRowIndex?this._labelSelectColor:f.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(N){var D=this.getHeight()-this._59I;return D>N&&(N=D),N>0?0:$(N)},isExpanded:function(L){if(!L)return!0;var P=this._26o[L];return P?P.isExpanded:!(this._26Q[L]===!1)},toggle:function($){var g=this;g.isExpanded($)?g.collapse($):g.expand($)},expandAll:function(){this.validate();for(var d in this._26o)this.expand(d)},expand:function(J){if(J&&J!==Pi){var a=this,X=a._26o[J];X&&!X.isExpanded&&(X.isExpanded=!0,a.onExpanded(J),a.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var L in this._26o)this.collapse(L)},collapse:function(k){if(k&&k!==Pi){var V=this,G=V._26o[k];G&&G.isExpanded&&(G.isExpanded=!1,V.onCollapsed(k),V.ivm())}},onCollapsed:function(){},getCategoryName:function(c){if(!this.isCategorizable())return Pi;var o=c.getCategoryName();return o?o:Pi},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(B){var f=this,y=f._dataModel;y!==B&&(y&&(y.umd(f.handlePropertyChange,f),f._selectionModel||y.sm().ums(f.handleSelectionChange,f)),f._dataModel=B,B.md(f.handlePropertyChange,f),f._selectionModel?f._selectionModel._21I(B):B.sm().ms(f.handleSelectionChange,f),f.fp(Xp,y,B))},isVisible:function($){return this._visibleFunc?this._visibleFunc($):!0},onPropertyChanged:function(M){var E=this,N=M.property;vg[N]?E.ivm():E.iv(),N===_m&&E._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Fb},handlePropertyChange:function(G){this._27o===G.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var f=this;f._96I||(f.setSelectRowIndex(-1),f._96I=1,f.iv())},redraw:function(){this.iv()},validateModel:function(){var g=this,l=g._rows,Q=g._28o,I={},m=new ob,L=g._27o;g.updateCurrentData(),L!==g._27o&&g.endEditing(),l.clear(),Q.clear(),g.getRawProperties().each(function(G){if(g.isVisible(G)){m.add(G);var T=g.getCategoryName(G);I[T]||(Q.add(T,T===Pi?0:j),I[T]={isExpanded:g.isExpanded(T),properties:new ob})}}),g._sortFunc&&m.sort(g._sortFunc);for(var d in g._26o)g._26Q[d]=g.isExpanded(d);g._26o=I,Q.each(function(b){b!==Pi&&l.add(b);var R=I[b];R.isExpanded&&m.each(function(D){g.getCategoryName(D)===b&&(R.properties.add(D),l.add({property:D,data:g._27o}))},g)})},validateImpl:function(){var H=this;H._76o(),H._96I&&(H.validateModel(),delete H._96I);var N=H._canvas,c=H.getWidth(),w=H.getHeight(),W=-H.ty(),F=H._rowHeight,U=H._indent,O=c-U,l=H._rows,g=l.size(),i=H._9I=U+O*H._10I,Y=H._59I=g*F;ul(N,c,w),H._29I={x:0,y:W,width:c,height:w},H._31I=X(W/F),H._14I=S((W+w)/F),H._31I<0&&(H._31I=0),H._14I>g&&(H._14I=g);var v,f=Nf(N),z=H._background;qk(f,0,-W,1),f.beginPath(),f.rect(0,W,c,w),f.clip(),f.clearRect(0,W,c,w),H._93db(f),z&&wk(f,0,0,U,Y,z);for(var E=H._31I;E<H._14I;E++){var p=l.get(E),W=F*E;if(gd(p))z&&wk(f,U,W,O,F,z),v=ed(H.isExpanded(p)?H._expandIcon:H._collapseIcon),v&&jg(f,v,hr,0,W,U,F),f.save(),f.beginPath(),f.rect(U,W,O,F),f.clip(),H.drawCategoryName(f,p,E,U,W,O,F),f.restore();else{var s=p.property,h=p.data,v=ed(s.getIcon()),t=H._selectRowIndex===E?H.getSelectBackground():R;if(v&&jg(f,v,hr,0,W,U,F),t&&wk(f,U,W,O,F,t),f.save(),f.beginPath(),f.rect(U,W,i-U,F),f.clip(),H.drawPropertyName(f,s,E,U,W,i-U,F),f.restore(),!H.isEditing(h,s)){var G=i+1,o=c-i-1;f.save(),f.beginPath(),f.rect(G,W,o,F),f.clip(),H._87o(H.drawPropertyValue(f,s,H.getValue(h,s),E,G,W,o,F,h),E,G,W,o,F),f.restore()}}H._rowLineVisible&&wk(f,U,W+F-1,O,1,H._rowLineColor)}H._columnLineVisible&&(wk(f,i,0,1,Y,H._columnLineColor),wk(f,c-1,0,1,Y)),H._92db(f),H._93I(),f.restore(),H.ty(H.ty())},drawCategoryName:function($,k,w,L,A,b,x){Im($,k,this.getCategoryFont(k),this.getCategoryColor(k),L,A,b,x)},drawPropertyName:function(q,c,D,F,f,L,i){return c.drawPropertyName?(c.drawPropertyName(q,c,D,F,f,L,i,this),void 0):(Im(q,this.getPropertyName(c),this.getPropertyFont(c,D),this.getPropertyColor(c,D),F,f,L,i),void 0)},drawPropertyValue:function(S,n,Z,f,k,g,i,_,E){return n.drawPropertyValue?n.drawPropertyValue(S,n,Z,f,k,g,i,_,E,this):(te(S,Z,n,this.getLabelFont(n,Z,f),this.getLabelColor(n,Z,f),k,g,i,_,E,this),void 0)},isPropertyEditable:function(Z){return Z.isEditable()&&this.isEditable()},setProperties:function(r){this._propertyModel.clear(),this.addProperties(r)},addProperties:function(D){if(D){var f=this._propertyModel;D.forEach(function(q){if(!(q instanceof Jq)){var K=rg(q.className);q=Ur(K?K:Jq,q)}f.add(q)})}},getRowIndexAt:function(d){var Z=this,x=X(Z.lp(d).y/Z._rowHeight);return x>=0&&x<Z._rows.size()?x:-1},getPropertyAt:function(c){var x=this,E=x.getRowIndexAt(c);return E>=0?x._rows.get(E).property:R},getToolTip:function(A){var b=this,G=b.getPropertyAt(A),t=b._27o;return G&&t?G.getToolTip(t,b._9I<b.lp(A).x,b):R}});var Qn=function(w){this.pv=w,this.addListeners()};Ci(Qn,G,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(b){this.getView().style.cursor=b},clear:function(){var b=this;b._62O=b.cp=b.ty=b.p=R,b.setCursor(kb)},handle_mousedown:function(l){this.handle_touchstart(l)},handle_touchstart:function(B){var C=this,s=C.pv;bf(B),s.setFocus(B)&&(Qk(B)?(C.cp=Bm(B),C.ty=s.ty(),C.p=s.getColumnPosition(),C.handle_touchmove(B)):s.setSelectRowIndex(s.getRowIndexAt(B)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(u){this.handle_touchend(u)},handle_touchend:function(b){var W=this;if(W.cp&&!W._62O){var o=W.pv,Q=o.lp(b),f=Q.x,H=Q.y,m=o._indent,B=o.getRowIndexAt(b),S=o._9I;if(B>=0){var x=o._rowHeight,E=x*B,X=o._rows.get(B),U=X.property;if(gd(X))ed(o.isExpanded(X)?o._expandIcon:o._collapseIcon)&&f>=0&&m>=f&&H>=E&&E+x>=H?o.toggle(X):Gn(b)&&o.toggle(X);else if(f>S&&o.isPropertyEditable(U,b)){var P={x:S+1,y:E,width:o.getWidth()-S-1,height:x},w={x:P.x+o.tx(),y:P.y+o.ty(),width:P.width,height:P.height},i=0,Y=o._29I;P.y<Y.y?i=P.y-Y.y:P.y+x>Y.y+Y.height&&(i=P.y+x-Y.y-Y.height),i&&(o.ty(o.ty()-i),w.y-=i),o.beginEditing({data:X.data,property:U,value:o.getValue(X.data,U),event:b,rect:P,editorRect:w,view:o})}}o.setSelectRowIndex(B)}W.clear()},handleWindowMouseMove:function(E){this.handleWindowTouchMove(E)},handleWindowTouchMove:function(D){var v=this,q=v.pv,o=v.ty,V=v.cp,r=Bm(D),S=v._62O;if("p"===S)q.setTranslateY(o+r.y-V.y);else if("c"===S){var h=q.getWidth()-q._indent;if(h>16){var e=v.p-(V.x-r.x)/h,I=16/h;I>e&&(e=I),e>1-I&&(e=1-I),q.setColumnPosition(e)}}else"s"===S&&q.setTranslateY(o+(V.y-r.y)*q._59I/q._29I.height)},handle_mousemove:function(_){this.handle_touchmove(_)},handle_touchmove:function(a){if(!Am&&Qk(a)){var T=this,s=T.pv,z=K(s.lp(a).x-s._9I)<=(Ei?8:3);T.cp?T._62O||(z?(T._62O="c",Wr(T)):K(Bm(a).y-T.cp.y)>=2&&(T._62O=T.isV(a)?"s":"p",Wr(T))):(z?T.setCursor(Cc):T.setCursor(kb),T.isV(a)&&s._43o())}},isV:function(T){var _=this.pv,C=_._29I;return _._41o()&&C.x+C.width-_.lp(T).x<Bk},handle_mousewheel:function(M){this.handleScroll(M,M.wheelDelta/40)},handle_DOMMouseScroll:function(h){2===h.axis&&this.handleScroll(h,-h.detail)},handleScroll:function(q,j){var k=this.pv;bf(q),k.endEditing(),k.translate(0,j*k.getRowHeight())},handle_keydown:function(S){var C=this.pv,l=C._rows.size(),K=C._selectRowIndex+(Tg(S)?-1:1);(Tg(S)||Tb(S))&&(0>K&&(K=0),K>=l&&(K=l-1),C.setSelectRowIndex(K))}}),Wn.ListView=function(J){this._5o(J),new qr(this)},Mo("ListView",G,{ms_ac:[Kn,sr,fi,Ae,he,ql,yr,Mf,Xd,Pd,of,cq,ap,Al],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:fr,_rowHeight:Yc,_rowLineVisible:d.listViewRowLineVisible,_rowLineColor:d.listViewRowLineColor,_scrollBarColor:ep,_scrollBarSize:Wd,_autoMakeVisible:rn,_autoHideScrollBar:_l,_selectBackground:d.listViewSelectBackground,_labelColor:d.listViewLabelColor,_labelSelectColor:d.listViewLabelSelectColor,_labelFont:d.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(x){var n=this,c=n._checkMode;n._checkMode=x,n.fp(lj,c,x)},drawRow:function(x,i,D,u,_,d,t){var T=this,e=0,H=T._indent,B=T.getIconWidth(i);T.drawRowBackground(x,i,D,u,_,d,t),T._checkMode&&(vb(x,ed(T.getCheckIcon(i)),e+H/2,_+t/2,i,T),e+=H),T.drawIcon(x,i,e,_,B,t),T.drawLabel(x,i,e+B,_,t)}});var qr=function(l){this.list=l,this._lastSelectDataTime=Pk(),this.addListeners()};Ci(qr,G,{ms_listener:1,getView:function(){return this.list._view},clear:function(q){var r=this,c=r.list;q&&"d"===r._62O&&!r.dragCancel&&c.handleDragAndDrop(q,"end"),c.draggingData&&(c.draggingData=null,c.redraw()),r.dragCancel=r._62O=r._isV=r._isH=r.cp=r.tx=r.ty=R},handle_mousedown:function(f){this.handle_touchstart(f)},handle_touchstart:function(Y){var J=this,W=J.list;if(bf(Y),W.setFocus(Y)){var B=W.getDataAt(Y);J.cp=Bm(Y),J.tx=W.tx(),J.ty=W.ty(),Qk(Y)?B&&W.handleDragAndDrop&&!J.isV(Y)&&!J.isH(Y)&&(W.draggingData=B,W.redraw(),W.handleDragAndDrop(Y,"prepare")):(B&&J._33o(Y,B),J.clear(Y))}},handleWindowMouseUp:function(K){this.clear(K)},handleWindowTouchEnd:function(F){this.clear(F)},handle_mouseup:function(S){this.handle_touchend(S)},handle_touchend:function(p){var V=this,E=V.list;if(!V._isV&&!V._isH&&V.cp&&!V._62O){var r=E.getDataAt(p);r?(E.isCheckMode()?V._34o(p,r):V._33o(p,r),Gn(p)?E.onDataDoubleClicked(r,p):E.onDataClicked(r,p)):E.handleBackgroundClick(p)}V.clear(p)},handleWindowMouseMove:function(G){this.handleWindowTouchMove(G)},handleWindowTouchMove:function(Z){var w=this,j=w.list,n=w._62O,R=w.tx,W=w.ty,y=w.cp,G=Bm(Z),F=j._29I;"p"===n?j.setTranslate(R+G.x-y.x,W+G.y-y.y):"v"===n?j.ty(W+(y.y-G.y)*j._59I/F.height):"h"===n?j.tx(R+(y.x-G.x)*j._91I/F.width):"d"===n&&(w.dragCancel||j.handleDragAndDrop(Z,"between"))},handle_mousemove:function(q){this.handle_touchmove(q)},handle_touchmove:function(z){if(!Am&&Qk(z)){var k=this,n=k.list;if(k._isV=k.isV(z),k._isH=k.isH(z),k.cp){if(!k._62O){if(Yi(Bm(z),k.cp)<2)return;k._isV?k._62O="v":k._isH?k._62O="h":n.draggingData&&!this.dragCancel?(k._62O="d",n.handleDragAndDrop(z,"begin")):k._62O="p",k._62O&&"d"!==k._62O&&n.draggingData&&(n.draggingData=null,n.redraw()),Wr(k)}}else k._isV&&n._43o(),k._isH&&n._42o()}},isV:function(e){var y=this.list,x=y._29I;return y._41o()&&x.x+x.width-y.lp(e).x<Bk},isH:function(g){var z=this.list,S=z._29I;return z._40o()&&S.y+S.height-z.lp(g).y<Bk},handle_mousewheel:function(j){this.handleScroll(j,j.wheelDelta/40,j.wheelDelta!==j.wheelDeltaX)},handle_DOMMouseScroll:function(G){this.handleScroll(G,-G.detail,1)},handleScroll:function(n,d,M){var t=this.list;bf(n),t.endEditing&&t.endEditing(),M&&t._41o()?t.translate(0,d*t.getRowHeight()):t._40o()&&t.translate(10*d,0)},handle_keydown:function(O){if(!d.isInput(O.target)){var b,Z=this.list,V=Z.sm(),e=Z._rows,f=e.size();if(zn(O))Z.selectAll();else if(Um(O))Z.handleDelete&&Z.handleDelete(O);else if(Re(O))"d"!==this._62O||this.dragCancel||(Z.handleDragAndDrop(O,"cancel"),this.dragCancel=!0);else if(wd(O))Z.isCheckMode()&&(b=Z.getFocusData(),b&&Z.checkData(b));else if(Tg(O)||Tb(O)){var A=Z.isCheckMode();if(b=A?Z.getFocusData():V.ld()){var Y=Z.getRowIndex(b);Y>=0&&(Tg(O)?0!==Y&&(b=e.get(Y-1),A?Z.setFocusData(b):V.ss(b)):Y!==f-1&&(b=e.get(Y+1),A?Z.setFocusData(b):V.ss(b)))}else f>0&&(b=e.get(0),A?Z.setFocusData(b):V.ss(b))}}},_34o:function($,d){var l=this.list,b=l.lp($).x;return b>=0&&b<=l._indent?(l.checkData(d),void 0):(l.setFocusData(d),void 0)},_33o:function(N,J){var r=this.list,k=r.sm(),S=k.ld();if(je(N))r.isSelected(J)?k.rs(J):k.as(J);else if(_h(N))if(S)for(var x=r.getRowIndex(S),C=r.getRowIndex(J);x!==C;)x+=C>x?1:-1,k.as(r._rows.get(x));else k.ss(J);else if(Qk(N)){var M=Pk();if(k.contains(J)){var m=M-this._lastSelectDataTime;r.handleDataDoubleSelect&&m>500&&1500>m&&r.handleDataDoubleSelect(N,J)}k.ss(J),this._lastSelectDataTime=M}else k.contains(J)||k.ss(J)}}),Wn.TreeView=function(q){var J=this;J._35o(),J._5o(q),new nm(J)},Mo("TreeView",G,{ms_ac:[Kn,sr,fi,"rootVisible",lj,"rootData",Mf,Xd,Pd,of,cq,he,Ae,ql,yr,Cs,_k,ap,Al,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:R,_indent:fr,_rowHeight:Yc,_rowLineVisible:d.treeViewRowLineVisible,_rowLineColor:d.treeViewRowLineColor,_scrollBarColor:ep,_scrollBarSize:Wd,_autoHideScrollBar:_l,_expandIcon:d.treeViewExpandIcon,_collapseIcon:d.treeViewCollapseIcon,_autoMakeVisible:rn,_selectBackground:d.treeViewSelectBackground,_labelColor:d.treeViewLabelColor,_labelSelectColor:d.treeViewLabelSelectColor,_labelFont:d.treeViewLabelFont,_doubleClickToToggle:d.treeViewDoubleClickToToggle,drawRow:function(e,N,q,f,$,s,E){var v=this;v.drawRowBackground(e,N,q,f,$,s,E),v._97I(e,N,q,0,$,s,E)},isOnToggleIcon:function(l){var w=this.getDataAt(l);if(w){var C=this.getIndent(),I=this.lp(l).x;if(ed(this.getToggleIcon(w))){var h=C*this.getLevel(w);if(I>=h&&h+C>=I)return!0}}return!1}});var nm=function(k){Id(nm,this,[k])};Ci(nm,qr,{toggle:function(w,f,u,D){var z=this.list,d=z.lp(w).x;if(ed(z.getToggleIcon(f))){var q=u*D;if(d>=q&&q+u>=d)return z.toggle(f),!0}return z.isDoubleClickToToggle()&&Gn(w)?(z.toggle(f),!0):!1},_34o:function(p,c){var D=this.list,S=D.lp(p).x,P=D._levelMap[c._id],V=D._indent,A=V*(P+1);return S>=A&&A+V>=S?(D.checkData(c),void 0):(this.toggle(p,c,V,P)||D.setFocusData(c),void 0)},_33o:function(E,F){var u=this,T=u.list;u.toggle(E,F,T._indent,T.getLevel(F))||nm.superClass._33o.call(u,E,F)},handle_keydown:function(G){if(Rc(G)||Be(G)){var o=this.list,n=o._rows,$=o.isCheckMode(),r=o.sm(),F=$?o.getFocusData():r.ld();F?F.hasChildren()&&(Rc(G)?o.collapse(F):o.expand(F)):n.size()>0&&(F=n.get(0),$?o.setFocusData(F):r.ss(F))}else nm.superClass.handle_keydown.call(this,G)}});var Qg=Wn.TableView=function(j){this._98I(),this._5o(j),new Pe(this)};Mo("TableView",G,{ms_ac:[Kn,sr,fi,"sortMode",Ac,jb,Ae,ql,yr,xi,$i,"sortColumn",Mf,Xd,Pd,of,cq,ap,Al],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Po,_editable:!0,_batchEditable:!1,_rowHeight:Yc,_rowLineVisible:d.tableViewRowLineVisible,_rowLineColor:d.tableViewRowLineColor,_columnLineVisible:d.tableViewColumnLineVisible,_columnLineColor:d.tableViewColumnLineColor,_scrollBarColor:ep,_scrollBarSize:Wd,_autoHideScrollBar:_l,_autoMakeVisible:rn,_selectBackground:d.tableViewSelectBackground,_labelColor:d.tableViewLabelColor,_labelSelectColor:d.tableViewLabelSelectColor,_labelFont:d.tableViewLabelFont,getCheckColumn:function(){var m=this;if(!m._31o){var y=m._31o=new Zk;y.setEditable(!0),y.setWidth(40),y.getValue=m.getCheckColumValue,y.drawCell=m.drawCheckColumnCell}return m._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(b){var s=this,n=s._39o,v=s.getCheckColumn();b!==s.isCheckMode()&&(b?n.add(v,0):n.remove(v),s.fp(lj,!b,b))},getCheckColumValue:function(z,Z,R){return R.isSelected(z)},drawCheckColumnCell:function(T,k,N,u,l,C,V,U,M){vb(T,M.getCheckIcon(k),l+V/2,C+U/2,k,M)}});var Pe=function(c){Id(Pe,this,[c])};Ci(Pe,qr,{_34o:function(x,s){var h=this.list,D=h._31o;if(h.isCellEditable(s,D,x)){var j=h._3Q(D),J=h.lp(x).x;if(j&&J>=j.startX&&J<j.startX+D.getWidth())return h.checkData(s),void 0}h._37O(s,x),h.setFocusData(s)},_33o:function(R,p){this.list._37O(p,R),Pe.superClass._33o.apply(this,arguments)}});var vl=Wn.TreeTableView=function(i){var u=this,R=u._4o=new Zk;u._35o(),u._98I(),u._5o(i),R.setDisplayName("Name"),R.setEditable(!0),R.setWidth(180),R.drawCell=Ie,R.getValue=zk,u._39o.add(R),new Zb(u)},Ie=function(A,u,c,k,D,m,G,e,v){v._97I(A,u,c,D,m,G,e)},zk=function(U,N,$){return $.getLabel(U)};Mo("TreeTableView",G,{ms_ac:[Kn,sr,fi,"sortMode",Ac,jb,he,lj,"rootData","rootVisible",Mf,Xd,"sortColumn",Cs,_k,Pd,of,cq,ap,yr,Ae,ql,xi,$i,Al,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Po,_checkMode:R,_editable:!0,_batchEditable:!1,_indent:fr,_rowHeight:Yc,_rowLineVisible:d.treeTableViewRowLineVisible,_rowLineColor:d.treeTableViewRowLineColor,_columnLineVisible:d.treeTableViewColumnLineVisible,_columnLineColor:d.treeTableViewColumnLineColor,_expandIcon:d.treeTableViewExpandIcon,_collapseIcon:d.treeTableViewCollapseIcon,_scrollBarColor:ep,_scrollBarSize:Wd,_autoHideScrollBar:_l,_autoMakeVisible:rn,_selectBackground:d.treeTableViewSelectBackground,_labelColor:d.treeTableViewLabelColor,_labelSelectColor:d.treeTableViewLabelSelectColor,_labelFont:d.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Zb=function(S){Id(Zb,this,[S])};Ci(Zb,qr,{_34o:function($,q){var Q=this.list,e=Q._4o,o=Q._3Q(e),m=Q.lp($).x;if(o){var N=Q._indent,F=o.startX+N*Q.getLevel(q);if(ed(Q.getToggleIcon(q))&&m>=F&&F+N>=m)return Q.toggle(q),void 0;if(Q.isCellEditable(q,e)&&(F+=N,m>=F&&F+N>=m))return Q.checkData(q),void 0}Q._37O(q,$),Q.setFocusData(q)},_33o:function(C,r){var j=this.list,m=j.lp(C).x;if(ed(j.getToggleIcon(r))){var f=j._3Q(j._4o);if(f){var F=j._indent,i=f.startX+F*j.getLevel(r);if(m>=i&&i+F>=m)return j.toggle(r),void 0}}j._37O(r,C),Zb.superClass._33o.apply(this,arguments)}});var Mr=Wn.TableHeader=function($){var z=this,F=z._view=jj(1,z),n=z._39o=$.getColumnModel(),U=z.iv;z.tv=z._tableView=$,z._60I=new ob,z._canvas=oe(F),F.style.background=d.tableHeaderBackground||"",F.style.height=Xe+Rq,n.mm(U,z),n.md(U,z),n.mh(U,z),$.mp(function(D){Vm[D.property]&&z.iv()},z),new Gr(z),z.iv()};Mo("TableHeader",G,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Kn,fi,he,"moveBackground","insertColor",xi,$i,"resizable","movable"],_checkIcon:Lg,_movable:!0,_resizable:!0,_labelColor:d.tableHeaderLabelColor,_labelFont:d.tableHeaderLabelFont,_columnLineColor:d.tableHeaderColumnLineColor,_columnLineVisible:d.tableHeaderColumnLineVisible,_sortDescIcon:d.tableHeaderSortDescIcon,_sortAscIcon:d.tableHeaderSortAscIcon,_moveBackground:d.tableHeaderMoveBackground,_insertColor:d.tableHeaderInsertColor,_indent:fr,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(P){return P.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(J){return J.getColor()||this._labelColor},getLabelAlign:function(R){return R._align},onPropertyChanged:function(){this.iv()},_5Q:function(v){this._61I=v,this.iv()},getLogicalPoint:function(V){return lg(V,this._canvas,this.tv.tx())},validateImpl:function(){var B=this,G=B._canvas,N=B.getWidth(),z=B.getHeight(),$=B.tv,H=B._60I,t=B._61I,b=-$.tx(),l=0;(N!==G.clientWidth||z!==G.clientHeight)&&ul(G,N,z),H.clear(),B._39o._roots.each(function(s){if(s.isVisible()){var O=l+s.getWidth();b+N>=l&&O>=b&&H.add({column:s,startX:l}),l=O}});var w=Nf(G);if(qk(w,-b,0,1),w.beginPath(),w.rect(b,0,N,z),w.clip(),w.clearRect(b,0,N,z),H.each(function(M){var s=M.column,Y=M.startX,Q=s.getWidth();Q>0&&(w.save(),w.beginPath(),w.rect(Y,0,Q,z),w.clip(),t&&t.column===s||B.drawColumn(w,s,Y,0,Q,z),B._columnLineVisible&&wk(w,Y+Q-1,0,1,z,B._columnLineColor),w.restore())}),t){var O=t.column,l=t.startX,D=t.position,I=O.getWidth();w.save(),w.beginPath(),w.rect(l,0,I,z),w.clip(),w.fillStyle=B._moveBackground,w.fill(),B.drawColumn(w,O,l,0,I,z),w.restore(),xp(w,B._insertColor,D,0,z)}w.restore()},_6Q:function(S){var v=this.tv;return v._31o===S&&v.sm().getSelectionMode()===Fe},drawColumn:function(Z,V,Y,q,k,r){var X=this,$=X.tv,K=ed(V.getIcon()),b=X.getLabelAlign(V);if(X._6Q(V)){var H=ed(X._checkIcon);vb(Z,H,Y+k/2,q+r/2,V,X)}else{var P=X.getLabel(V),p=X.getLabelFont(V),N=X.getLabelColor(V),F=gi(p,P).width,C=K?X._indent:0;b===Xf?(K&&jg(Z,K,hr,Y,q,C,r),Im(Z,P,p,N,Y+C,q,k,r,Xf)):b===pp?(K&&jg(Z,K,hr,Y+k-F-C,q,C,r),Im(Z,P,p,N,Y,q,k,r,pp)):(K&&jg(Z,K,hr,Y+(k-F-C)/2,q,C,r),Im(Z,P,p,N,Y+(k-F+C)/2,q,0,r,Xf))}if(V.isSortable()&&$.getSortColumn()===V&&(K=ed(V.getSortOrder()===ah?X._sortAscIcon:X._sortDescIcon))){var f=se(K,V)/2+2;vb(Z,K,b===pp?Y+f:Y+k-f,q+r/2,V,$)}}});var Gr=function(p){var t=this;t.th=p,t.tv=p._tableView,t.addListeners()};Ci(Gr,G,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(P){this.getView().style.cursor=P},handle_mousemove:function(z){if(!Am){var J=this;delete J._29o,J.setCursor(kb);for(var m=J.th,f=m._60I,T=m.lp(z).x,s=f.size()-1;s>=0;s--){var Z=f.get(s),l=Z.column,C=Z.startX+l.getWidth();if(m.isResizable()&&K(C-T)<=(Ei?10:3))return J._29o=Z,J.setCursor(Cc),void 0;T>Z.startX&&C>T&&(J._29o=Z),(l.isClickable()||l.isSortable()||m.isMovable()||J.tv.getCheckColumn&&l===J.tv.getCheckColumn())&&T>Z.startX&&C>T&&J.setCursor(qs)}}},handle_mousedown:function(s){this.handle_touchstart(s)},handle_touchstart:function(K){var W=this;bf(K),W.tv.endEditing(),W.handle_mousemove(K),W._29o&&(W.x=Bm(K).x,W.lx=W.th.lp(K).x,W.w=W._29o.column.getWidth(),Wr(W,K))},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(h){var X=this,A=X.th,e=X.getView().style.cursor,F=X._29o,y=Bm(h).x-X.x;if(X.resizing||X.moving||(e===Cc?X.resizing=1:A.isMovable()&&e===qs&&K(y)>2&&(X.moving=1)),X.resizing)F.column.setWidth(X.w+y);else if(X.moving){var B=X.lx+y;A._60I.each(function(G){var k=G.startX,q=k+G.column.getWidth();if(B>=k&&q>=B){var J={column:F.column,startX:F.startX+y,front:q-B>B-k,insertColumn:G.column};J.position=J.front?k:q,A._5Q(J)}})}},_16Q:function(i,G){var E=this,x=E.tv,f=E.th,B=f._checkIcon;if(f._6Q(i)){var s=ed(B),D=E.lx,J=i.getWidth(),l=se(s,i);if(D>=G+J/2-l&&G+J/2+l>=D){f.setCheckIcon(B===Of?Lg:Of);var w=x.sm(),a=x._rows;return B===Of?w.rs(a):w.ss(a),x.onCheckColumnClicked(i),!0}}return!1},handleWindowMouseUp:function(z){this.handleWindowTouchEnd(z)},handleWindowTouchEnd:function(f){var $=this,Z=$.tv,g=$.th,N=$._29o;if($.moving){var E=g._61I;if(E&&E.insertColumn!==E.column){var S=E.column,u=Z.getColumnModel()._roots,_=u.remove(S),Y=u.indexOf(E.insertColumn);Y>=0&&(E.front||Y++,Y<=u.size()&&(u.add(S,Y),Z.getColumnModel()._38I(S,_,Y)))}g._5Q(R),delete $.moving}else if(!$.resizing&&N){S=N.column;var y=g.lp(f).x,F=N.startX,w=!0;if(g.onColumnClicked){var O=g.onColumnClicked(S,f,F);O===!1&&(w=!1)}if(w&&y>=F&&y<=F+S.getWidth()&&!$._16Q(S,F)){if(S.isSortable()){var V=Z.getSortMode(),U=S.getSortOrder();V===Po?Z.getSortColumn()===S?(U===Ir&&Z.setSortColumn(R),S.setSortOrder(U===ah?Ir:ah)):Z.setSortColumn(S):"bistate"===V&&(Z.getSortColumn()===S?S.setSortOrder(U===ah?Ir:ah):Z.setSortColumn(S))}Z.onColumnClicked(S,f,F)}}$._29o=$.resizing=$.x=$.lx=$.w=R}}),Wn.TablePane=function(A){this.init(new Qg(A))},Mo("TablePane",G,{ms_v:1,_44o:1}),Wn.TreeTablePane=function(W){this.init(new vl(W))},Mo("TreeTablePane",G,{ms_v:1,_44o:1}),Wn.Toolbar=function(j){var n=this,F=n._view=jj(1,n),X=F.style;X.background=d.toolbarBackground||"",X.height=Ug+Rq,n._canvas=oe(F),n._30o=new ob,n._90I=new ob,n.setItems(j||[]),F.handleGroupSelectedChanged=function(c){if(c.isSelected()){var B=c.getGroupId();null!=B&&n._items.forEach(function(G){var R=G.element;
R&&R!==c&&R.setSelected&&R.getGroupId&&R.getGroupId()===B&&R.setSelected(!1)})}},new rm(n)},Mo("Toolbar",G,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[ej,Kn,fi,sr,Al,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:d.toolbarLabelColor,_labelSelectColor:d.toolbarLabelSelectColor,_labelFont:d.toolbarLabelFont,_selectBackground:d.toolbarSelectBackground,_itemGap:d.toolbarItemGap,_separatorColor:d.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(w){var i=this.getItemInfoAt(w);return i?i.item.toolTip:R},getLabelColor:function(y){return y&&y.selected&&y.type!==Of&&y.type!==Gq?this._labelSelectColor:this._labelColor},onPropertyChanged:function(N){this.iv(),N.property===ej&&this._items.forEach(function(j){Jd(j)})},redraw:function(){this.iv()},addItem:function(M,j){var h=this._items;j==R?h.push(M):h.splice(j,0,M),this.fp(ej,R,h)},removeItem:function(i){if(i)for(var u=this._items,B=0;B<u.length;B++)i===u[B]&&(u.splice(B,1),this.fp(ej,R,u))},removeItemById:function(F){if(F!=R)for(var W=this._items,L=0;L<W.length;L++)if(F===W[L].id){var Q=W.splice(L,1)[0];return this.fp(ej,R,W),Q}},getItemById:function(J){if(J!=R)for(var j=this._items,n=0;n<j.length;n++){var m=j[n];if(J===m.id)return m}},setItemVisible:function(Z,U){var n=this.getItemById(Z);n&&(n.visible=U)},getItemInfos:function(){return this._30o},getItemInfoAt:function(u){var b=this,L=0,a=b._30o,P=b.lp(u),p=P.x,i=P.y;if(i>=0&&i<=b.getHeight())for(;L<a.size();L++){var l=a.get(L);if(l.startX<=p&&p<=l.endX)return l}return R},drawItem:function(z,l,N,$,G){if(l.visible===!1)return 0;if(cl(l.visible)&&!l.visible())return 0;var o=this,X=l.disabled;X&&(z.globalAlpha=bp);var S=o.drawItemImpl(z,l,N,$,G),D=o._itemGap;return X&&(z.globalAlpha=1),this._currentItem!==l||"separator"===l||l.separator===!0||l.unfocusable||Jc(z,o._separatorColor,N-D/2,0,S+D,$),S},drawItemImpl:function(y,A,e,O,I){var E=this,M=E._view,c=E._itemGap,J=O/2,k=A.type,G=A.element,b=A.label;gd(G)&&(b=G,G=R);var s,h=E.getLabelFont(A),i=E.getLabelColor(A),g=A.selected,K=ed(A.icon),z=se(K,A),L=0,P=z+(b?gi(h,b).width:0);if("separator"===A||A.separator===!0)return xp(y,E._separatorColor,e,O/4,J),1;if(G){K&&vb(y,K,e+z/2,J,A,E),Im(y,b,h,i,e+z,0,0,O);var n=Lb(G);I||E._90I.add(n),n.parentNode!==M&&ke(M,n),G.iv&&G.iv(),G.validate&&G.validate();var f=n.getBoundingClientRect(),F=f.width,q=n.style;return ts(n),q.left=E.tx()+e+P+Rq,q.top=(O-f.height)/2+Rq,P+F}return k===Gq?s=ed(g?re:jc):k===Of&&(s=ed(g?Of:Lg)),s?(L=se(s,A),vb(y,s,e+L/2,J,A,E),e+=L,P+=L):g&&wk(y,e-c/2,0,P+c,O,E.getSelectBackground(A)),K&&vb(y,K,e+z/2,J,A,E),Im(y,b,h,i,e+z,0,0,O),P},validateImpl:function(){var B=this,P=B._canvas,H=B.getWidth(),O=B.getHeight(),X=B._30o,R=B._items;ul(P,H,O);var n=Nf(P),$=B._itemGap,z=$/2;qk(n,B.tx(),0,1),n.clearRect(0,0,H,O);var p=B._90I;B._90I=new ob,X.clear(),R.forEach(function(Z){var P=B.drawItem(n,Z,z,O);X.add({item:Z,startX:z,endX:z+P,width:P}),P&&(z+=P+$)}),p.each(function(k){B._90I.contains(k)||un(k)});var l=B._64I;B._64I=Z(0,z),n.restore(),B._stickToRight?(B._65O=0,n=Nf(P),z=H-B._64I+$,qk(n,0,0,1),n.clearRect(0,0,H,O),X.clear(),R.forEach(function(V){var M=B.drawItem(n,V,z,O,!0);X.add({item:V,startX:z,endX:z+M,width:M}),M&&(z+=M+$)}),n.restore()):B.tx(B.tx()),l!==B._64I&&B.onSumWidthChanged(l,B._64I)},onSumWidthChanged:function(){},handleClick:function(F,B){var O=this,P=F.type,N=F.action,c=F.groupId,Q=F.selected;F.disabled||(c!=R?Q||(F.selected=!0,this._items.forEach(function(T){T.groupId===c&&F!==T&&(T.selected=!1)}),N&&F.action(F,O,B)):P===Of||"toggle"===P?(F.selected=!Q,N&&F.action(F,O,B)):N&&F.action(F,O,B)),$j(),O.iv()}});var rm=function(Z){this.tb=Z,this.addListeners()};Ci(rm,G,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(u){this.handleScroll(u,10*(u.wheelDelta/40))},handle_DOMMouseScroll:function(i){this.handleScroll(i,10*-i.detail)},handleScroll:function(E,z){bf(E);var j=this.tb;j.isScrollable()&&!j._stickToRight&&(j.tx(j.tx()+z),Zn())},handle_mousemove:function(O){var U=this;Am||U.setItem(O)},handle_mouseout:function(c){var F=this;c.target===F.getView()?F.tb.setCurrentItem(R):F.handle_mousemove(c)},handle_mousedown:function(h){this.handle_mousemove(h),this.handle_touchstart(h)},handle_touchstart:function(D){var r=this,B=r.tb,d=D.target;Qk(D)&&(d===r.getView()||d===B._canvas)&&(bf(D),B.setFocus(D)&&(this.setItem(D,!0),(B.isScrollable()||r.info&&!r.info.item.disabled)&&(r.x=Bm(D).x,r.tx=B.tx(),Wr(r,D))))},handleWindowMouseMove:function(q){this.handleWindowTouchMove(q)},handleWindowTouchMove:function(q){var f=this,i=f.tb;if(!i._stickToRight){var y=Bm(q).x-f.x;!f._25o&&K(y)>2&&i.isScrollable()&&(f._25o=1),f._25o&&i.tx(f.tx+y)}},handleWindowMouseUp:function(v){this.handleWindowTouchEnd(v)},handleWindowTouchEnd:function(x){var p=this,s=p.tb,F=p.info,w=p.tb.getItemInfoAt(x);if(!p._25o&&F){var L=F.item;w&&w.item===L&&s.handleClick(L,x)}p._25o=p.x=p.tx=R,p.setItem()},setItem:function(V,A){var v=this,x=v.tb,O=v.info=V?x.getItemInfoAt(V):R,J=O?O.item:R;x.setCurrentItem(J),A&&J&&cl(J.onDown)&&J.onDown(V)}}),Wn.BorderPane=function(){this._view=jj(1,this),this.iv()},Mo("BorderPane",G,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(A,$){this._12o("leftView",A),$!=R&&this.setLeftWidth($)},getRightView:function(){return this._rightView},setRightView:function(Q,T){this._12o("rightView",Q),T!=R&&this.setRightWidth(T)},getTopView:function(){return this._topView},setTopView:function(e,Z){this._12o("topView",e),Z!=R&&this.setTopHeight(Z)},getBottomView:function(){return this._bottomView},setBottomView:function(G,O){this._12o("bottomView",G),O!=R&&this.setBottomHeight(O)},getCenterView:function(){return this._centerView},setCenterView:function(Z){this._12o("centerView",Z)},_12o:function(x,$){var G=this,c="_"+x,O=G._view,g=G[c];g!==$&&(g&&(g.getView?un(g.getView()):un(g)),G[c]=$,$&&($.getView?ke(O,$.getView(),1):ke(O,$,1)),G.fp(x,g,$))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var c=this,F=c._topView,g=c._bottomView,v=c._leftView,z=c._rightView,T=c._centerView,X=c.getWidth(),l=c.getHeight(),s=0,U=0,O=X,b=l,C=0,W=0,E=0,J=0;F&&(C=c._topHeight==R?Yk(F):c._topHeight,U=C),g&&(W=c._bottomHeight==R?Yk(g):c._bottomHeight,b=l-W),v&&(E=c._leftWidth==R?ge(v):c._leftWidth,s=E),z&&(J=c._rightWidth==R?ge(z):c._rightWidth,O=X-J);var i=Z(0,O-s),I=Z(0,b-U);F&&Zh(F,0,0,X,C),g&&Zh(g,0,b,X,W),v&&Zh(v,0,U,E,I),z&&Zh(z,O,U,J,I),T&&Zh(T,s,U,i,I)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);